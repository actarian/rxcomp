{"version":3,"sources":["docs/js/main.js","../../src/core/directive.js","../../src/core/component.js","../../src/core/context.js","../../src/core/structure.js","../../src/module/module.js","../../src/class/class.directive.js","../../src/event/event.directive.js","../../src/for/for.item.js","../../src/for/for.structure.js","../../src/if/if.structure.js","../../src/inner-html/inner-html.directive.js","../../src/json/json.pipe.js","../../src/style/style.directive.js","../../todomvc/js/local-storage/local-storage.service.js","../../todomvc/js/store/store.service.js","../../todomvc/js/app.component.js","../../todomvc/js/date/date.pipe.js","../../todomvc/js/colors/colors.js","../../todomvc/js/todo-item/todo-item.component.js","../../todomvc/js/main.js"],"names":["global","factory","exports","module","require","define","amd","self","rxjs","operators","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","_setPrototypeOf","o","p","setPrototypeOf","_construct","Parent","args","Class","Reflect","construct","sham","Proxy","Date","toString","call","e","isNativeReflectConstruct","a","push","apply","instance","Function","bind","arguments","Directive","Component","RESERVED_PROPERTIES","Context","_Component","descriptors","_this","mergeDescriptors","getPrototypeOf","defineProperties","ReferenceError","_assertThisInitialized","source","properties","getOwnPropertyNames","_loop","shift","indexOf","hasOwnProperty","getOwnPropertyDescriptor","value","_len","Array","_key","Structure","ID","CONTEXTS","NODES","ORDER","REMOVED_IDS","Module","options","bootstrap","pipes","forEach","x","meta","name","node","document","querySelector","selector","nodeInnerHTML","innerHTML","factories","sort","b","reduce","c","unshift","selectors","unwrapSelectors","compile","window","pushChanges","_proto","makeContext","parentInstance","makeInstance","parentNode","isComponent","getParentInstance","initialized","changes$","BehaviorSubject","unsubscribe$","Subject","next","parse","setTimeout","onView","context","inputs","makeInputs","outputs","makeOutputs","onInit","pipe","takeUntil","subscribe","changes","resolveInputsOutputs","onChanges","makeFunction","expression","params","join","transforms","getPipesSegments","trim","transformOptionalChaining","transform","getPipeParamsSegments","makeInput","getContext","getAttribute","makeOutput","_this2","outputFunction","output$","tap","event","resolve","remove","traverseDown","id","complete","onDestroy","dataset","rxcompId","deleteContext","destroy","evaluate","text","_this3","replace","undefined","parse_func_","console","error","message","childNodes","child","nodeType","getContextByNode","nodeExpression","nodeValue","replacedText","textNode","createTextNode","replaceChild","expressionFunc","payload","_this4","_this5","inputFunction","getInstance","_this6","traverseUp","previous","tokens","split","_this7","querySelectorsAll","map","match","filter","use","segments","word","block","t","substr","className","classList","has","attribute","hasAttribute","nodeName","toLowerCase","matchSelectors","results","template","callback","result","j","traversePrevious","previousSibling","traverseNext","nextSibling","rxcompNodeId","nodeContexts","index","splice","current","ClassDirective","_Directive","classFunction","add","EventDirective","event$","fromEvent","shareReplay","ForItem","_Context","$key","$value","count","Constructor","protoProps","staticProps","get","even","ForStructure","_Structure","forbegin","createComment","forend","insertBefore","removeAttribute","getExpressionTokens","forFunction","iterable","instances","isArray","array","keys","total","Math","max","clonedNode","cloneNode","forItemContext","removeChild","expressions","forExpressions","keyValueMatches","indexExpressions","IfStructure","ifbegin","ifend","ifFunction","InnerHtmlDirective","innerHtmlExpression","JsonPipe","JSON","stringify","StyleDirective","styleFunction","style","setProperty","LocalStorageService","delete","isLocalStorageSupported","localStorage","removeItem","exist","log","set","cache","json","setItem","supported","StoreService","items","get$","store$","date","now","delay","add$","patch","item","assign","getValue","of","patch$","find","delete$","AppComponent","input","onInput","$event","onAddItem","onToggleItem","done","onRemoveItem","DatePipe","locale","dateStyle","timeStyle","toLocaleDateString","colors","hex","background","foreground","accent","hexToRgb","r","parseInt","slice","g","TodoItemComponent","alpha","onToggle","toggle","onRemove"],"mappings":"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","file":"docs/js/main.min.js","sourcesContent":[null,"export default class Directive {\n\n}\n","export default class Component {\n\n}\n","// import { BehaviorSubject, Subject } from 'rxjs';\nimport Component from './component';\n\nconst RESERVED_PROPERTIES = ['constructor', 'rxcompId', 'onInit', 'onChanges', 'onDestroy', 'pushChanges', 'changes$', 'unsubscribe$'];\n\nexport default class Context extends Component {\n\n\tconstructor(instance, descriptors = {}) {\n\t\tsuper();\n\t\tdescriptors = Context.mergeDescriptors(instance, instance, descriptors);\n\t\tdescriptors = Context.mergeDescriptors(Object.getPrototypeOf(instance), instance, descriptors);\n\t\t/*\n\t\tconst subjects = {\n\t\t\tchanges$: {\n\t\t\t\tvalue: new BehaviorSubject(this),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t},\n\t\t\tunsubscribe$: {\n\t\t\t\tvalue: new Subject(),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t}\n\t\t};\n\t\t*/\n\t\tObject.defineProperties(this, descriptors);\n\t}\n\n\tstatic mergeDescriptors(source, instance, descriptors = {}) {\n\t\tconst properties = Object.getOwnPropertyNames(source);\n\t\twhile (properties.length) {\n\t\t\tlet key = properties.shift();\n\t\t\tif (RESERVED_PROPERTIES.indexOf(key) === -1 && !descriptors.hasOwnProperty(key)) {\n\t\t\t\t// console.log('Context.mergeDescriptors', key, source[key]);\n\t\t\t\tconst descriptor = Object.getOwnPropertyDescriptor(source, key);\n\t\t\t\tif (typeof descriptor.value == \"function\") {\n\t\t\t\t\tdescriptor.value = (...args) => {\n\t\t\t\t\t\tinstance[key].apply(instance, args);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tdescriptors[key] = descriptor;\n\t\t\t}\n\t\t}\n\t\treturn descriptors;\n\t}\n\n}\n","export default class Structure {\n\n}\n","import { BehaviorSubject, Subject } from 'rxjs';\nimport { takeUntil, tap } from 'rxjs/operators';\nimport Component from '../core/component';\nimport Context from '../core/context';\nimport Directive from '../core/directive';\nimport Structure from '../core/structure';\n\nlet ID = 0;\nconst CONTEXTS = {};\nconst NODES = {};\nconst ORDER = [Structure, Component, Directive];\nconst REMOVED_IDS = [];\n\nexport default class Module {\n\n\tconstructor(options) {\n\t\tif (!options) {\n\t\t\tthrow ('missing options');\n\t\t}\n\t\tif (!options.bootstrap) {\n\t\t\tthrow ('missing bootstrap');\n\t\t}\n\t\tthis.options = options;\n\t\tconst pipes = {};\n\t\tif (options.pipes) {\n\t\t\toptions.pipes.forEach(x => pipes[x.meta.name] = x);\n\t\t}\n\t\tthis.pipes = pipes;\n\t\tconst bootstrap = options.bootstrap;\n\t\tconst node = this.node = document.querySelector(bootstrap.meta.selector);\n\t\tthis.nodeInnerHTML = node.innerHTML;\n\t\tif (!node) {\n\t\t\tthrow (`missing node ${bootstrap.meta.selector}`);\n\t\t}\n\t\toptions.factories.sort((a, b) => {\n\t\t\tconst ai = ORDER.reduce((p, c, i) => a.prototype instanceof c ? i : p, -1);\n\t\t\tconst bi = ORDER.reduce((p, c, i) => b.prototype instanceof c ? i : p, -1);\n\t\t\treturn ai - bi;\n\t\t});\n\t\toptions.factories.unshift(bootstrap);\n\t\tthis.selectors = Module.unwrapSelectors(options.factories);\n\t\tconst instances = this.compile(node, window);\n\t\tconst instance = instances[0];\n\t\t// if (instance instanceof module.options.bootstrap) {\n\t\tinstance.pushChanges();\n\t\t// }\n\t}\n\n\tmakeContext(instance, parentInstance, node, selector) {\n\t\tconst context = Module.makeContext(this, instance, parentInstance, node, instance.constructor, selector);\n\t\t// console.log('Module.makeContext', context, context.instance, context.node);\n\t\treturn context;\n\t}\n\n\tmakeInstance(node, factory, selector, parentInstance, args) {\n\t\tif (parentInstance || node.parentNode) {\n\t\t\tconst isComponent = factory.prototype instanceof Component;\n\t\t\tconst meta = factory.meta;\n\t\t\t// collect parentInstance scope\n\t\t\tparentInstance = parentInstance || this.getParentInstance(node);\n\t\t\tif (!parentInstance) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// creating factory instance\n\t\t\tconst instance = new factory(...(args || []));\n\t\t\t// injecting changes$ and unsubscribe$ subjects\n\t\t\tObject.defineProperties(instance, {\n\t\t\t\tchanges$: {\n\t\t\t\t\tvalue: new BehaviorSubject(instance),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t},\n\t\t\t\tunsubscribe$: {\n\t\t\t\t\tvalue: new Subject(),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet initialized;\n\t\t\t// injecting instance pushChanges method\n\t\t\tconst module = this;\n\t\t\tinstance.pushChanges = function() {\n\t\t\t\t// console.log(new Error(`pushChanges ${instance.constructor.name}`).stack);\n\t\t\t\tthis.changes$.next(this);\n\t\t\t\t// parse component text nodes\n\t\t\t\tif (isComponent) {\n\t\t\t\t\t// console.log('Module.parse', instance.constructor.name);\n\t\t\t\t\tinitialized ? module.parse(node, instance) : setTimeout(function() { module.parse(node, instance); });\n\t\t\t\t}\n\t\t\t\t// calling onView event\n\t\t\t\tif (typeof instance.onView === 'function') {\n\t\t\t\t\t// console.log('onView', instance.constructor.name);\n\t\t\t\t\tinstance.onView();\n\t\t\t\t}\n\t\t\t};\n\t\t\t// creating instance context\n\t\t\tconst context = Module.makeContext(this, instance, parentInstance, node, factory, selector);\n\t\t\t// creating component input and outputs\n\t\t\tif (isComponent && meta) {\n\t\t\t\tcontext.inputs = this.makeInputs(meta, instance);\n\t\t\t\tcontext.outputs = this.makeOutputs(meta, instance);\n\t\t\t}\n\t\t\t// calling onInit event\n\t\t\tif (typeof instance.onInit === 'function') {\n\t\t\t\tinstance.onInit();\n\t\t\t}\n\t\t\tinitialized = true;\n\t\t\t// subscribe to parent changes\n\t\t\tif (parentInstance.changes$) {\n\t\t\t\tparentInstance.changes$.pipe(\n\t\t\t\t\t// filter(() => node.parentNode),\n\t\t\t\t\t// debounceTime(1),\n\t\t\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t\t\t).subscribe(changes => {\n\t\t\t\t\t// resolve component input outputs\n\t\t\t\t\tif (isComponent && meta) {\n\t\t\t\t\t\tthis.resolveInputsOutputs(instance, changes);\n\t\t\t\t\t}\n\t\t\t\t\t// calling onChanges event with parentInstance\n\t\t\t\t\tif (typeof instance.onChanges === 'function') {\n\t\t\t\t\t\t// console.log('onChanges', instance.constructor.name);\n\t\t\t\t\t\t// console.log('onChanges', instance.constructor.meta.selector, changes);\n\t\t\t\t\t\tinstance.onChanges(changes);\n\t\t\t\t\t}\n\t\t\t\t\t// push instance changes for subscribers\n\t\t\t\t\tinstance.pushChanges();\n\t\t\t\t});\n\t\t\t}\n\t\t\t/*\n\t\t\t// parse component text nodes\n\t\t\tif (isComponent) {\n\t\t\t\tthis.parse(node, instance);\n\t\t\t}\n\t\t\t*/\n\t\t\treturn instance;\n\t\t}\n\t}\n\n\tmakeFunction(expression, params = ['$instance']) {\n\t\tif (!expression) {\n\t\t\treturn () => { return null; };\n\t\t}\n\t\tconst args = params.join(',');\n\t\tconst pipes = this.pipes;\n\t\tconst transforms = Module.getPipesSegments(expression);\n\t\texpression = transforms.shift().trim();\n\t\texpression = this.transformOptionalChaining(expression);\n\t\t// console.log(pipes, transforms, expression);\n\t\t// console.log(transforms.length, params);\n\t\t// keyword 'this' represents changes from func.apply(changes, instance)\n\t\tif (transforms.length) {\n\t\t\texpression = transforms.reduce((expression, transform, i) => {\n\t\t\t\tconst params = Module.getPipeParamsSegments(transform);\n\t\t\t\tconst name = params.shift().trim();\n\t\t\t\tconst pipe = pipes[name];\n\t\t\t\tif (!pipe || typeof pipe.transform !== 'function') {\n\t\t\t\t\tthrow (`missing pipe ${name}`);\n\t\t\t\t}\n\t\t\t\treturn `$$pipes.${name}.transform(${expression},${params.join(',')})`;\n\t\t\t}, expression);\n\t\t\t// console.log('expression', expression);\n\t\t\tconst expression_func = new Function(`with(this) {\n\t\t\t\treturn (function (${args}, $$module) {\n\t\t\t\t\tconst $$pipes = $$module.pipes;\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t} else {\n\t\t\t// console.log('expression', args, expression);\n\t\t\t// console.log('${expression.replace(/\\'/g,'\"')}', this);\n\t\t\tconst expression_func = new Function(`with(this) {\n\t\t\t\treturn (function (${args}, $$module) {\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t}\n\t}\n\n\tmakeInput(instance, name) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute(`[${name}]`);\n\t\treturn this.makeFunction(expression);\n\t}\n\n\tmakeOutput(instance, name) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst node = context.node;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst expression = node.getAttribute(`(${name})`);\n\t\tconst outputFunction = this.makeFunction(expression, ['$event']);\n\t\tconst output$ = new Subject().pipe(\n\t\t\ttap((event) => {\n\t\t\t\tthis.resolve(outputFunction, parentInstance, event);\n\t\t\t})\n\t\t);\n\t\toutput$.pipe(\n\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t).subscribe();\n\t\tinstance[name] = output$;\n\t\treturn outputFunction;\n\t}\n\n\tremove(node) {\n\t\tModule.traverseDown(node, (node) => {\n\t\t\tfor (let id in CONTEXTS) {\n\t\t\t\tconst context = CONTEXTS[id];\n\t\t\t\tif (context.node === node) {\n\t\t\t\t\tconst instance = context.instance;\n\t\t\t\t\tinstance.unsubscribe$.next();\n\t\t\t\t\tinstance.unsubscribe$.complete();\n\t\t\t\t\tif (typeof instance.onDestroy === 'function') {\n\t\t\t\t\t\tinstance.onDestroy();\n\t\t\t\t\t}\n\t\t\t\t\tdelete node.dataset.rxcompId;\n\t\t\t\t\tREMOVED_IDS.push(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// console.log('Module.remove', REMOVED_IDS);\n\t\twhile (REMOVED_IDS.length) {\n\t\t\tModule.deleteContext(REMOVED_IDS.shift());\n\t\t}\n\t\treturn node;\n\t}\n\n\tdestroy() {\n\t\tthis.remove(this.node);\n\t\tthis.node.innerHTML = this.nodeInnerHTML;\n\t}\n\n\tevaluate(text, instance) {\n\t\tconst parse_eval_ = (...args) => {\n\t\t\tconst expression = args[1];\n\t\t\t// console.log('expression', expression);\n\t\t\ttry {\n\t\t\t\tconst parse_func_ = this.makeFunction(expression);\n\t\t\t\treturn this.resolve(parse_func_, instance, instance);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t\treturn e.message;\n\t\t\t}\n\t\t};\n\t\treturn text.replace(/\\{{2}((([^{}])|(\\{([^{}]|(\\{.*?\\}))+?\\}))*?)\\}{2}/g, parse_eval_);\n\t\t// return text.replace(/\\{{2}((([^{}])|(\\{[^{}]+?\\}))*?)\\}{2}/g, parse_eval_);\n\t}\n\n\tparse(node, instance) {\n\t\t// console.log('parse', instance.constructor.name, node);\n\t\tfor (let i = 0; i < node.childNodes.length; i++) {\n\t\t\tconst child = node.childNodes[i];\n\t\t\tif (child.nodeType === 1) {\n\t\t\t\tconst context = Module.getContextByNode(child);\n\t\t\t\tif (!context) {\n\t\t\t\t\tthis.parse(child, instance);\n\t\t\t\t}\n\t\t\t} else if (child.nodeType === 3) {\n\t\t\t\tconst expression = child.nodeExpression || child.nodeValue;\n\t\t\t\tconst replacedText = this.evaluate(expression, instance);\n\t\t\t\t// console.log(instance.constructor.name, expression, replacedText);\n\t\t\t\tif (expression !== replacedText) {\n\t\t\t\t\tchild.nodeExpression = child.nodeExpression || expression;\n\t\t\t\t\tconst textNode = document.createTextNode(replacedText);\n\t\t\t\t\tnode.replaceChild(textNode, child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tresolve(expressionFunc, changes, payload) {\n\t\treturn expressionFunc.apply(changes, [payload, this]);\n\t}\n\n\tmakeInputs(meta, instance) {\n\t\tconst inputs = {};\n\t\tif (meta.inputs) {\n\t\t\tmeta.inputs.forEach((key, i) => inputs[key] = this.makeInput(instance, key));\n\t\t}\n\t\treturn inputs;\n\t}\n\n\tmakeOutputs(meta, instance) {\n\t\tconst outputs = {};\n\t\tif (meta.outputs) {\n\t\t\tmeta.outputs.forEach((key, i) => outputs[key] = this.makeOutput(instance, key));\n\t\t}\n\t\treturn outputs;\n\t}\n\n\tresolveInputsOutputs(instance, changes) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst inputs = context.inputs;\n\t\tfor (let key in inputs) {\n\t\t\tconst inputFunction = inputs[key];\n\t\t\tconst value = this.resolve(inputFunction, parentInstance, instance);\n\t\t\tinstance[key] = value;\n\t\t}\n\t\t/*\n\t\tconst outputs = context.outputs;\n\t\tfor (let key in outputs) {\n\t\t\tconst inpuoutputFunctiontFunction = outputs[key];\n\t\t\tconst value = this.resolve(outputFunction, parentInstance, null);\n\t\t\t// console.log(`setted -> ${key}`, value);\n\t\t}\n\t\t*/\n\t}\n\n\tgetInstance(node) {\n\t\tif (node === document) {\n\t\t\treturn window;\n\t\t}\n\t\tconst context = Module.getContextByNode(node);\n\t\tif (context) {\n\t\t\treturn context.instance;\n\t\t}\n\t}\n\n\tgetParentInstance(node) {\n\t\treturn Module.traverseUp(node, (node) => {\n\t\t\treturn this.getInstance(node);\n\t\t});\n\t}\n\n\ttransformOptionalChaining(expression) {\n\t\tconst regex = /(\\w+(\\?\\.))+([\\.|\\w]+)/g;\n\t\tlet previous;\n\t\texpression = expression.replace(regex, (...args) => {\n\t\t\tconst tokens = args[0].split('?.');\n\t\t\tfor (let i = 0; i < tokens.length - 1; i++) {\n\t\t\t\tconst a = i > 0 ? `(${tokens[i]} = ${previous})` : tokens[i];\n\t\t\t\tconst b = tokens[i + 1];\n\t\t\t\tprevious = i > 0 ? `${a}.${b}` : `(${a} ? ${a}.${b} : void 0)`;\n\t\t\t\t// log(previous);\n\t\t\t}\n\t\t\treturn previous || '';\n\t\t});\n\t\treturn expression;\n\t}\n\n\tcompile(node, parentInstance) {\n\t\tconst instances = Module.querySelectorsAll(node, this.selectors, []).map(match => {\n\t\t\tconst instance = this.makeInstance(match.node, match.factory, match.selector, parentInstance);\n\t\t\tif (match.factory.prototype instanceof Component) {\n\t\t\t\tparentInstance = undefined;\n\t\t\t}\n\t\t\treturn instance;\n\t\t}).filter(x => x);\n\t\t// console.log('compile', instances, node, parentInstance);\n\t\treturn instances;\n\t}\n\n\tstatic use(options) {\n\t\tconst module = new Module(options);\n\t\treturn module;\n\t}\n\n\tstatic getPipesSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === '|' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic getPipeParamsSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === ':' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic unwrapSelectors(factories) {\n\t\tconst selectors = [];\n\t\tfactories.forEach(factory => {\n\t\t\tfactory.meta.selector.split(',').forEach(selector => {\n\t\t\t\tselector = selector.trim();\n\t\t\t\tif (selector.indexOf('.') === 0) {\n\t\t\t\t\tconst className = selector.replace(/\\./g, '');\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.classList.has(className);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else if (selector.match(/\\[(.+)\\]/)) {\n\t\t\t\t\tconst attribute = selector.substr(1, selector.length - 2);\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.hasAttribute(attribute);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.nodeName.toLowerCase() === selector.toLowerCase();\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn selectors;\n\t}\n\n\tstatic matchSelectors(node, selectors, results) {\n\t\tfor (let i = 0; i < selectors.length; i++) {\n\t\t\tconst match = selectors[i](node);\n\t\t\tif (match) {\n\t\t\t\tconst factory = match.factory;\n\t\t\t\tif (factory.prototype instanceof Component && factory.meta.template) {\n\t\t\t\t\tnode.innerHTML = factory.meta.template;\n\t\t\t\t}\n\t\t\t\tresults.push(match);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic querySelectorsAll(node, selectors, results) {\n\t\tif (node.nodeType === 1) {\n\t\t\tresults = this.matchSelectors(node, selectors, results);\n\t\t}\n\t\tconst childNodes = node.childNodes;\n\t\tif (childNodes) {\n\t\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\t\tresults = this.querySelectorsAll(childNodes[i], selectors, results);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic traverseUp(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseUp(node.parentNode, callback, i + 1);\n\t}\n\n\tstatic traverseDown(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tlet result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tif (node.nodeType === 1) {\n\t\t\tlet j = 0,\n\t\t\t\tt = node.childNodes.length;\n\t\t\twhile (j < t && !result) {\n\t\t\t\tresult = this.traverseDown(node.childNodes[j], callback, i + 1);\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic traversePrevious(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traversePrevious(node.previousSibling, callback, i + 1);\n\t}\n\n\tstatic traverseNext(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseNext(node.nextSibling, callback, i + 1);\n\t}\n\n\tstatic getContext(instance) {\n\t\treturn CONTEXTS[instance.rxcompId];\n\t}\n\n\tstatic makeContext(module, instance, parentInstance, node, factory, selector) {\n\t\tinstance.rxcompId = ++ID;\n\t\tconst context = { module, instance, parentInstance, node, factory, selector };\n\t\tconst rxcompNodeId = node.dataset.rxcompId = (node.dataset.rxcompId || ++ID);\n\t\tconst nodeContexts = NODES[rxcompNodeId] || (NODES[rxcompNodeId] = []);\n\t\tnodeContexts.push(context);\n\t\treturn CONTEXTS[instance.rxcompId] = context;\n\t}\n\n\tstatic deleteContext(id) {\n\t\tconst context = CONTEXTS[id];\n\t\tconst nodeContexts = NODES[context.node.dataset.rxcompId];\n\t\tif (nodeContexts) {\n\t\t\tconst index = nodeContexts.indexOf(context);\n\t\t\tif (index !== -1) {\n\t\t\t\tnodeContexts.splice(index, 1);\n\t\t\t}\n\t\t}\n\t\tdelete CONTEXTS[id];\n\t}\n\n\tstatic getContextByNode(node) {\n\t\tlet context;\n\t\tconst nodeContexts = NODES[node.dataset.rxcompId];\n\t\tif (nodeContexts) {\n\t\t\tcontext = nodeContexts.reduce((previous, current) => {\n\t\t\t\tif (current.node === node && current.factory.prototype instanceof Component) {\n\t\t\t\t\tif (previous && current.factory.prototype instanceof Context) {\n\t\t\t\t\t\treturn previous;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn current;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn previous;\n\t\t\t\t}\n\t\t\t}, null);\n\t\t}\n\t\treturn context;\n\t}\n\n}\n","import Directive from '../core/directive';\nimport Module from '../module/module';\n\nexport default class ClassDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[class]');\n\t\tthis.classFunction = module.makeFunction(expression);\n\t\t// console.log('ClassDirective.onInit', this.classList, expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst classList = module.resolve(this.classFunction, changes, this);\n\t\tfor (let key in classList) {\n\t\t\tclassList[key] ? node.classList.add(key) : node.classList.remove(key);\n\t\t}\n\t\t// console.log('ClassDirective.onChanges', classList);\n\t}\n\n}\n\nClassDirective.meta = {\n\tselector: `[[class]]`,\n};\n","import { fromEvent } from 'rxjs';\nimport { shareReplay, takeUntil } from 'rxjs/operators';\nimport Directive from '../core/directive';\nimport Module from '../module/module';\n\nconst EVENTS = ['click', 'mousedown', 'mouseup', 'touchstart', 'touchmove', 'touchend', 'keydown', 'keyup', 'input', 'change', 'loaded'];\n\nexport default class EventDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst event = this.event = selector.replace(/\\[|\\]|\\(|\\)/g, '');\n\t\tconst event$ = this.event$ = fromEvent(node, event).pipe(shareReplay(1));\n\t\tconst expression = node.getAttribute(`(${event})`);\n\t\tif (expression) {\n\t\t\tconst outputFunction = module.makeFunction(expression, ['$event']);\n\t\t\tevent$.pipe(\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(event => {\n\t\t\t\tmodule.resolve(outputFunction, parentInstance, event);\n\t\t\t});\n\t\t} else {\n\t\t\tparentInstance[`${event}$`] = event$;\n\t\t}\n\t\t// console.log('EventDirective.onInit', 'selector', selector, 'event', event);\n\t}\n\n}\n\nEventDirective.meta = {\n\tselector: `[(${EVENTS.join(')],[(')})]`,\n};\n","import Context from '../core/context';\n\nexport default class ForItem extends Context {\n\n\t// !!! try with payload options { key, $key, value, $value, index, count } or use onInit()\n\n\tconstructor(key, $key, value, $value, index, count, parentInstance) {\n\t\t// console.log('ForItem', arguments);\n\t\tsuper(parentInstance);\n\t\t/*\n\t\tsuper(parentInstance, {\n\t\t\t[key]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$key;\n\t\t\t\t},\n\t\t\t\tset: function(key) {\n\t\t\t\t\tthis.$key = key;\n\t\t\t\t}\n\t\t\t},\n\t\t\t[value]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\tthis.$value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t*/\n\t\tthis[key] = $key;\n\t\tthis[value] = $value;\n\t\tthis.index = index;\n\t\tthis.count = count;\n\t}\n\n\tget first() { return this.index === 0; }\n\n\tget last() { return this.index === this.count - 1; }\n\n\tget even() { return this.index % 2 === 0; }\n\n\tget odd() { return !this.even; }\n\n\t/*\n\tonDestroy() {\n\t\tconsole.log('onDestroy');\n\t}\n\t*/\n\n}\n","import Structure from '../core/structure';\nimport Module from '../module/module';\nimport ForItem from './for.item';\n\nexport default class ForStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst forbegin = this.forbegin = document.createComment(`*for begin`);\n\t\tnode.parentNode.replaceChild(forbegin, node);\n\t\tconst forend = this.forend = document.createComment(`*for end`);\n\t\tforbegin.parentNode.insertBefore(forend, forbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*for');\n\t\tnode.removeAttribute('*for');\n\t\tconst tokens = this.tokens = this.getExpressionTokens(expression);\n\t\tthis.forFunction = module.makeFunction(tokens.iterable);\n\t\tthis.instances = [];\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\t// resolve\n\t\tconst tokens = this.tokens;\n\t\tlet result = module.resolve(this.forFunction, changes, this) || [];\n\t\tconst isArray = Array.isArray(result);\n\t\tconst array = isArray ? result : Object.keys(result);\n\t\tconst total = array.length;\n\t\tconst previous = this.instances.length;\n\t\t// let nextSibling = this.forbegin.nextSibling;\n\t\tfor (let i = 0; i < Math.max(previous, total); i++) {\n\t\t\tif (i < total) {\n\t\t\t\tconst key = isArray ? i : array[i];\n\t\t\t\tconst value = isArray ? array[key] : result[key];\n\t\t\t\tif (i < previous) {\n\t\t\t\t\t// update\n\t\t\t\t\tconst instance = this.instances[i];\n\t\t\t\t\tinstance[tokens.key] = key;\n\t\t\t\t\tinstance[tokens.value] = value;\n\t\t\t\t\t/*\n\t\t\t\t\tif (!nextSibling) {\n\t\t\t\t\t\tconst context = Module.getContext(instance);\n\t\t\t\t\t\tconst node = context.node;\n\t\t\t\t\t\tthis.forend.parentNode.insertBefore(node, this.forend);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextSibling = nextSibling.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t} else {\n\t\t\t\t\t// create\n\t\t\t\t\tconst clonedNode = node.cloneNode(true);\n\t\t\t\t\tdelete clonedNode.dataset.rxcompId;\n\t\t\t\t\tthis.forend.parentNode.insertBefore(clonedNode, this.forend);\n\t\t\t\t\tconst args = [tokens.key, key, tokens.value, value, i, total, context.parentInstance]; // !!! context.parentInstance unused?\n\t\t\t\t\tconst instance = module.makeInstance(clonedNode, ForItem, context.selector, context.parentInstance, args);\n\t\t\t\t\tconst forItemContext = Module.getContext(instance);\n\t\t\t\t\t// console.log('ForStructure', clonedNode, forItemContext.instance.constructor.name);\n\t\t\t\t\tmodule.compile(clonedNode, forItemContext.instance);\n\t\t\t\t\t// nextSibling = clonedNode.nextSibling;\n\t\t\t\t\tthis.instances.push(instance);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// remove\n\t\t\t\tconst instance = this.instances[i];\n\t\t\t\tconst context = Module.getContext(instance);\n\t\t\t\tconst node = context.node;\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\tmodule.remove(node);\n\t\t\t}\n\t\t}\n\t\tthis.instances.length = array.length;\n\t\t// console.log('ForStructure', this.instances, tokens);\n\t}\n\n\tgetExpressionTokens(expression) {\n\t\tif (expression === null) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tif (expression.trim().indexOf('let ') === -1 || expression.trim().indexOf(' of ') === -1) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tconst expressions = expression.split(';').map(x => x.trim()).filter(x => x !== '');\n\t\tconst forExpressions = expressions[0].split(' of ').map(x => x.trim());\n\t\tlet value = forExpressions[0].replace(/\\s*let\\s*/, '');\n\t\tconst iterable = forExpressions[1];\n\t\tlet key = 'index';\n\t\tconst keyValueMatches = value.match(/\\[(.+)\\s*,\\s*(.+)\\]/);\n\t\tif (keyValueMatches) {\n\t\t\tkey = keyValueMatches[1];\n\t\t\tvalue = keyValueMatches[2];\n\t\t}\n\t\tif (expressions.length > 1) {\n\t\t\tconst indexExpressions = expressions[1].split(/\\s*let\\s*|\\s*=\\s*index/).map(x => x.trim());\n\t\t\tif (indexExpressions.length === 3) {\n\t\t\t\tkey = indexExpressions[1];\n\t\t\t}\n\t\t}\n\t\treturn { key, value, iterable };\n\t}\n\n}\n\nForStructure.meta = {\n\tselector: '[*for]',\n};\n","import Structure from '../core/structure';\nimport Module from '../module/module';\n\nexport default class IfStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst ifbegin = this.ifbegin = document.createComment(`*if begin`);\n\t\tnode.parentNode.replaceChild(ifbegin, node);\n\t\tconst ifend = this.ifend = document.createComment(`*if end`);\n\t\tifbegin.parentNode.insertBefore(ifend, ifbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*if');\n\t\tthis.expression = expression;\n\t\tthis.ifFunction = module.makeFunction(expression);\n\t\tconst clonedNode = node.cloneNode(true);\n\t\tclonedNode.removeAttribute('*if');\n\t\tthis.clonedNode = clonedNode;\n\t\t// console.log('IfStructure.expression', expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\t// console.log('IfStructure.onChanges', changes, this.expression);\n\t\tconst value = module.resolve(this.ifFunction, changes, this);\n\t\tif (value) {\n\t\t\tif (!this.clonedNode.parentNode) {\n\t\t\t\tthis.ifend.parentNode.insertBefore(this.clonedNode, this.ifend);\n\t\t\t\tmodule.compile(this.clonedNode);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.clonedNode.parentNode) {\n\t\t\t\tthis.clonedNode.parentNode.removeChild(this.clonedNode);\n\t\t\t\tmodule.remove(this.clonedNode);\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nIfStructure.meta = {\n\tselector: '[*if]',\n};\n","import Directive from '../core/directive';\nimport Module from '../module/module';\n\nexport default class InnerHtmlDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst key = selector.replace(/\\[(.+)\\]/, (...matches) => {\n\t\t\treturn matches[1];\n\t\t});\n\t\tlet expression = node.getAttribute(key);\n\t\tif (!expression) {\n\t\t\tthrow (`invalid ${key}`);\n\t\t}\n\t\tif (key === '[innerHTML]') {\n\t\t\texpression = `{{${expression}}}`;\n\t\t}\n\t\tthis.innerHtmlExpression = expression;\n\t\t// console.log('InnerHtmlDirective.onInit', node, expression, key);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = Module.getContext(this);\n\t\tconst innerHTML = context.module.evaluate(this.innerHtmlExpression, changes);\n\t\t// console.log('InnerHtmlDirective.onChanges', this.innerHtmlExpression, innerHTML);\n\t\tconst node = context.node;\n\t\tnode.innerHTML = innerHTML;\n\t}\n\n}\n\nInnerHtmlDirective.meta = {\n\tselector: `[[innerHTML]],[innerHTML]`\n};\n","export default class JsonPipe {\n\n\tstatic transform(value) {\n\t\treturn JSON.stringify(value);\n\t}\n\n}\n\nJsonPipe.meta = {\n\tname: 'json',\n};\n","import Directive from '../core/directive';\nimport Module from '../module/module';\n\nexport default class StyleDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[style]');\n\t\tthis.styleFunction = module.makeFunction(expression);\n\t\t// console.log('StyleDirective.onInit', expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst style = module.resolve(this.styleFunction, changes, this);\n\t\tfor (let key in style) {\n\t\t\tnode.style.setProperty(key, style[key]);\n\t\t}\n\t\t// console.log('StyleDirective.onChanges', changes, style);\n\t}\n\n}\n\nStyleDirective.meta = {\n\tselector: `[[style]]`\n};\n","export default class LocalStorageService {\n\n\tstatic delete(name) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\twindow.localStorage.removeItem(name);\n\t\t}\n\t}\n\n\tstatic exist(name) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\treturn window.localStorage[name] !== undefined;\n\t\t}\n\t}\n\n\tstatic get(name) {\n\t\tlet value = null;\n\t\tif (this.isLocalStorageSupported() && window.localStorage[name] !== undefined) {\n\t\t\ttry {\n\t\t\t\tvalue = JSON.parse(window.localStorage[name]);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorageService.get.error parsing', name, e);\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t}\n\n\tstatic set(name, value) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\ttry {\n\t\t\t\tconst cache = [];\n\t\t\t\tconst json = JSON.stringify(value, function(key, value) {\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\twindow.localStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorageService.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic isLocalStorageSupported() {\n\t\tif (this.supported) {\n\t\t\treturn true;\n\t\t}\n\t\tlet supported = false;\n\t\ttry {\n\t\t\tsupported = 'localStorage' in window && window.localStorage !== null;\n\t\t\tif (supported) {\n\t\t\t\twindow.localStorage.setItem('test', '1');\n\t\t\t\twindow.localStorage.removeItem('test');\n\t\t\t} else {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsupported = false;\n\t\t}\n\t\tthis.supported = supported;\n\t\treturn supported;\n\t}\n\n}\n","import { BehaviorSubject, of } from 'rxjs';\nimport { delay } from 'rxjs/operators';\nimport LocalStorageService from '../local-storage/local-storage.service';\n\nexport default class StoreService {\n\n\tstatic set(items) {\n\t\tLocalStorageService.set('items', items);\n\t\treturn this.get$().next(items);\n\t}\n\n\tstatic get$() {\n\t\tif (this.store$) {\n\t\t\treturn this.store$;\n\t\t}\n\t\tlet items = LocalStorageService.get('items');\n\t\tif (!items) {\n\t\t\titems = [\n\t\t\t\t{ id: 5, name: 'Cookies', date: new Date(Date.now()) },\n\t\t\t\t{ id: 4, name: 'Pizza', date: new Date(2019, 4, 4, 12) },\n\t\t\t\t{ id: 3, name: 'Pasta', date: new Date(2019, 3, 22, 12) },\n\t\t\t\t{ id: 2, name: 'Bread', date: new Date(2019, 0, 6, 12) },\n\t\t\t\t{ id: 1, name: 'Ham', date: new Date(2018, 11, 30, 12) },\n\t\t\t];\n\t\t\tLocalStorageService.set('items', items);\n\t\t}\n\t\tthis.store$ = new BehaviorSubject(items);\n\t\treturn this.store$.pipe(\n\t\t\tdelay(1) // simulate http\n\t\t);\n\t}\n\n\tstatic add$(patch) {\n\t\tconst item = Object.assign({\n\t\t\tid: Date.now(),\n\t\t\tdate: new Date(Date.now())\n\t\t}, patch);\n\t\tconst items = this.store$.getValue();\n\t\titems.unshift(item);\n\t\tthis.set(items);\n\t\treturn of(item).pipe(\n\t\t\tdelay(1) // simulate http\n\t\t);\n\t}\n\n\tstatic patch$(patch) {\n\t\tconst items = this.store$.getValue();\n\t\tconst item = items.find(x => x.id === patch.id);\n\t\tif (item) {\n\t\t\tObject.assign(item, patch);\n\t\t\tthis.set(items);\n\t\t}\n\t\treturn of(item).pipe(\n\t\t\tdelay(1) // simulate http\n\t\t);\n\t}\n\n\tstatic delete$(item) {\n\t\tconst items = this.store$.getValue();\n\t\tconst index = items.indexOf(item);\n\t\tif (index !== -1) {\n\t\t\titems.splice(index, 1);\n\t\t\tthis.set(items);\n\t\t}\n\t\treturn of(item).pipe(\n\t\t\tdelay(1) // simulate http\n\t\t);\n\t}\n\n}\n","import { takeUntil } from 'rxjs/operators';\nimport { Component, Module } from '../../src/rxcomp';\nimport StoreService from './store/store.service';\n\nexport default class AppComponent extends Component {\n\n\tonInit() {\n\t\t// context\n\t\tconst context = Module.getContext(this);\n\t\t// input\n\t\tthis.input = context.node.querySelector('.control--text');\n\t\t// items\n\t\tthis.items = [];\n\t\t// store service\n\t\tthis.store$ = StoreService.get$();\n\t\tthis.store$.pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe(items => {\n\t\t\tthis.items = items;\n\t\t\t// onpush change detection strategy\n\t\t\tthis.pushChanges();\n\t\t});\n\t}\n\n\tonView() {\n\t\tconst context = Module.getContext(this);\n\t\t// console.log('AppComponent.onView', context.node);\n\t}\n\n\tonInput($event) {\n\t\t// console.log('AppComponent.onInput', $event, this);\n\t\tthis.pushChanges();\n\t}\n\n\tonAddItem($event) {\n\t\tif (this.input.value) {\n\t\t\tStoreService.add$({\n\t\t\t\tname: this.input.value,\n\t\t\t}).subscribe(item => {\n\t\t\t\t// console.log('AppComponent.onAddItem', item);\n\t\t\t\tthis.input.value = null;\n\t\t\t});\n\t\t}\n\t}\n\n\tonToggleItem(item) {\n\t\tStoreService.patch$({\n\t\t\tid: item.id,\n\t\t\tdone: !item.done,\n\t\t}).subscribe(item => {\n\t\t\t// console.log('AppComponent.onToggleItem', item);\n\t\t});\n\t}\n\n\tonRemoveItem(item) {\n\t\tStoreService.delete$(item).subscribe(item => {\n\t\t\t// console.log('AppComponent.onRemoveItem', item);\n\t\t});\n\t}\n\n}\n\nAppComponent.meta = {\n\tselector: '[app-component]',\n};\n","export default class DatePipe {\n\n\tstatic transform(value, locale = 'it-IT-u-ca-gregory', options = {\n\t\tdateStyle: 'short',\n\t\ttimeStyle: 'short',\n\t}) {\n\t\tconst localeDateString = new Date(value).toLocaleDateString(locale, options);\n\t\treturn localeDateString;\n\t}\n\n}\n\nDatePipe.meta = {\n\tname: 'date',\n};\n","export const colors = [\n\t{ hex: '#ffffff', background: '#ffffff', foreground: '#003adc', accent: '#212121' },\n\t{ hex: '#212121', background: '#212121', foreground: '#ffffff', accent: '#003adc' },\n\t{ hex: '#ffffff', background: '#ffffff', foreground: '#212121', accent: '#003adc' },\n\t{ hex: '#003adc', background: '#003adc', foreground: '#ffffff', accent: '#212121' },\n];\n\nexport function hexToInt(hex) {\n\treturn parseInt(hex.replace(/^#/, ''), 16);\n}\n\nexport function randomHex() {\n\treturn colors[Math.floor(Math.random() * colors.length)].hex;\n}\n\nexport function randomColor() {\n\tconst hex = randomHex();\n\treturn hexToInt(hex);\n}\n\nexport function color(index, alpha) {\n\treturn hexToRgb(colors[index % colors.length].hex, alpha);\n}\n\nexport function background(index, alpha) {\n\treturn hexToRgb(colors[index % colors.length].background, alpha);\n}\n\nexport function foreground(index, alpha) {\n\treturn hexToRgb(colors[index % colors.length].foreground, alpha);\n}\n\nexport function accent(index, alpha) {\n\treturn hexToRgb(colors[index % colors.length].accent, alpha);\n}\n\nlet index = -1;\n\nexport function nextHex() {\n\tindex++;\n\treturn colors[index % colors.length].hex;\n}\n\nexport function nextColor() {\n\tconst hex = nextHex();\n\treturn hexToInt(hex);\n}\n\nexport function hexToRgb(hex, a) {\n\tconst r = parseInt(hex.slice(1, 3), 16);\n\tconst g = parseInt(hex.slice(3, 5), 16);\n\tconst b = parseInt(hex.slice(5, 7), 16);\n\tif (a) {\n\t\treturn `rgba(${r},${g},${b},${a})`;\n\t} else {\n\t\treturn `rgb(${r},${g},${b})`;\n\t}\n}\n","import { Component } from '../../../src/rxcomp';\nimport { accent, background, foreground } from '../colors/colors';\n\nexport default class TodoItemComponent extends Component {\n\n\t// onInit() {}\n\n\tonChanges(changes) {\n\t\t// console.log('onChanges', changes);\n\t\tthis.background = background(this.item.id);\n\t\tthis.foreground = foreground(this.item.id);\n\t\tthis.accent = accent(this.item.id);\n\t}\n\n\t// onView() {}\n\n\t// onDestroy() {}\n\n\tonToggle($event) {\n\t\t// console.log('onToggle', $event);\n\t\tthis.toggle.next($event);\n\t}\n\n\tonRemove($event) {\n\t\t// console.log('onRemove', $event);\n\t\tthis.remove.next($event);\n\t}\n\n}\n\nTodoItemComponent.meta = {\n\tselector: '[todo-item-component]',\n\tinputs: ['item'],\n\toutputs: ['toggle', 'remove'],\n\t// template syntax example\n\t/*\n\ttemplate: // html // `\n\t\t<button type=\"button\" class=\"btn--toggle\" (click)=\"onToggle(item)\">\n            <i class=\"icon--check\" *if=\"item.done\"></i>\n            <i class=\"icon--circle\" *if=\"!item.done\"></i>\n            <div class=\"title\" [innerHTML]=\"item.name\"></div>\n        </button>\n        <div class=\"date\" [style]=\"{ background: backgroundColor, color: color }\" [innerHTML]=\"item.date | date : 'en-US' : { month: 'short', day: '2-digit', year: 'numeric' }\"></div>\n        <button type=\"button\" class=\"btn--remove\" (click)=\"onRemove(item)\"><i class=\"icon--remove\"></i></button>\n\t`,\n\t*/\n};\n","import { ClassDirective, EventDirective, ForStructure, IfStructure, InnerHtmlDirective, JsonPipe, Module, StyleDirective } from '../../src/rxcomp';\nimport AppComponent from './app.component';\nimport DatePipe from './date/date.pipe';\nimport TodoItemComponent from './todo-item/todo-item.component';\n\nModule.use({\n\tfactories: [\n\t\tClassDirective,\n\t\tEventDirective,\n\t\tForStructure,\n\t\tIfStructure,\n\t\tInnerHtmlDirective,\n\t\tStyleDirective,\n\t\tTodoItemComponent,\n\t],\n\tpipes: [\n\t\tDatePipe,\n\t\tJsonPipe,\n\t],\n\tbootstrap: AppComponent,\n});\n"]}