{"version":3,"sources":["docs/js/main.js","../../src/core/directive.js","../../src/core/component.js","../../src/core/context.js","../../src/module/module.js","../../src/class/class.directive.js","../../src/event/event.directive.js","../../src/core/structure.js","../../src/for/for.item.js","../../src/for/for.structure.js","../../src/if/if.structure.js","../../src/inner-html/inner-html.directive.js","../../src/core/pipe.js","../../src/json/json.pipe.js","../../src/style/style.directive.js","../../src/core.module.js","../../src/platform/platform.js","../../src/platform/browser.js","../../test/js/local-storage/local-storage.service.js","../../test/js/store/store.service.js","../../test/js/app.component.js","../../test/js/date/date.pipe.js","../../test/js/colors/colors.js","../../test/js/todo-item/todo-item.component.js","../../test/js/app.module.js","../../test/js/main.js"],"names":["global","factory","exports","module","require","define","amd","self","rxjs","operators","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","_setPrototypeOf","o","p","setPrototypeOf","_construct","Parent","args","Class","Reflect","construct","sham","Proxy","Date","toString","call","e","isNativeReflectConstruct","a","push","apply","instance","Function","bind","arguments","Directive","Component","RESERVED_PROPERTIES","Context","_Component","descriptors","_this","mergeDescriptors","getPrototypeOf","defineProperties","ReferenceError","_assertThisInitialized","source","properties","getOwnPropertyNames","_loop","shift","indexOf","hasOwnProperty","getOwnPropertyDescriptor","value","_len","Array","_key","ID","CONTEXTS","NODES","REMOVED_IDS","Module","_proto","compile","node","parentInstance","componentNode","querySelectorsAll","meta","selectors","map","match","undefined","makeInstance","selector","filter","x","_this2","parentNode","isComponent","getParentInstance","initialized","context","makeContext","changes$","BehaviorSubject","unsubscribe$","Subject","pushChanges","next","parse","setTimeout","onView","inputs","makeInputs","outputs","makeOutputs","onInit","pipe","takeUntil","subscribe","changes","resolveInputsOutputs","onChanges","makeFunction","expression","params","join","pipes","transforms","getPipesSegments","trim","transformOptionalChaining","reduce","transform","getPipeParamsSegments","name","makeInput","input","getContext","hasAttribute","getAttribute","makeOutput","_this3","outputFunction","output$","tap","event","resolve","getInstance","document","window","getContextByNode","_this4","traverseUp","remove","traverseDown","id","complete","onDestroy","dataset","rxcompId","deleteContext","destroy","innerHTML","nodeInnerHTML","evaluate","text","_this5","replace","parse_func_","console","error","message","childNodes","child","nodeType","nodeExpression","nodeValue","replacedText","textNode","createTextNode","replaceChild","expressionFunc","payload","_this6","forEach","_this7","inputFunction","previous","tokens","split","b","segments","word","block","t","c","substr","matchSelectors","results","template","callback","result","j","traversePrevious","previousSibling","traverseNext","nextSibling","rxcompNodeId","nodeContexts","index","splice","current","ClassDirective","_Directive","classFunction","classList","add","EventDirective","event$","fromEvent","shareReplay","Structure","ForItem","_Context","$key","$value","count","Constructor","protoProps","staticProps","get","even","ForStructure","_Structure","forbegin","createComment","forend","insertBefore","removeAttribute","getExpressionTokens","forFunction","iterable","instances","isArray","array","keys","total","Math","max","clonedNode","cloneNode","forItemContext","removeChild","expressions","forExpressions","keyValueMatches","indexExpressions","IfStructure","ifbegin","ifend","ifFunction","InnerHtmlDirective","innerHtmlExpression","Pipe","JsonPipe","_Pipe","JSON","stringify","StyleDirective","styleFunction","style","setProperty","CoreModule","_Module","factories","declarations","concat","ORDER","Browser","_Platform","Platform","bootstrap","moduleFactory","resolveMeta","querySelector","resolvePipes","resolveFactories","sortFactories","unshift","unwrapSelectors","assign","imports","exported","importedPipes","pipeFactory","_Array$prototype$conc","importedFactories","factoryList","sort","matchers","className","attrName","nodeName","contains","toLowerCase","matcher","isBrowser","LocalStorageService","delete","isLocalStorageSupported","localStorage","removeItem","exist","log","set","cache","json","setItem","supported","StoreService","items","get$","store$","date","now","delay","add$","patch","item","getValue","of","patch$","find","delete$","AppComponent","onInput","$event","onAddItem","onToggleItem","done","onRemoveItem","DatePipe","locale","options","dateStyle","timeStyle","toLocaleDateString","colors","hex","background","foreground","accent","hexToRgb","r","parseInt","slice","g","TodoItemComponent","alpha","onToggle","toggle","onRemove","AppModule"],"mappings":"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","file":"docs/js/main.min.js","sourcesContent":[null,"export default class Directive {\n\n}\n","export default class Component {\n\n}\n","// import { BehaviorSubject, Subject } from 'rxjs';\nimport Component from './component';\n\nconst RESERVED_PROPERTIES = ['constructor', 'rxcompId', 'onInit', 'onChanges', 'onDestroy', 'pushChanges', 'changes$', 'unsubscribe$'];\n\nexport default class Context extends Component {\n\n\tconstructor(instance, descriptors = {}) {\n\t\tsuper();\n\t\tdescriptors = Context.mergeDescriptors(instance, instance, descriptors);\n\t\tdescriptors = Context.mergeDescriptors(Object.getPrototypeOf(instance), instance, descriptors);\n\t\t/*\n\t\tconst subjects = {\n\t\t\tchanges$: {\n\t\t\t\tvalue: new BehaviorSubject(this),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t},\n\t\t\tunsubscribe$: {\n\t\t\t\tvalue: new Subject(),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t}\n\t\t};\n\t\t*/\n\t\tObject.defineProperties(this, descriptors);\n\t}\n\n\tstatic mergeDescriptors(source, instance, descriptors = {}) {\n\t\tconst properties = Object.getOwnPropertyNames(source);\n\t\twhile (properties.length) {\n\t\t\tlet key = properties.shift();\n\t\t\tif (RESERVED_PROPERTIES.indexOf(key) === -1 && !descriptors.hasOwnProperty(key)) {\n\t\t\t\t// console.log('Context.mergeDescriptors', key, source[key]);\n\t\t\t\tconst descriptor = Object.getOwnPropertyDescriptor(source, key);\n\t\t\t\tif (typeof descriptor.value == \"function\") {\n\t\t\t\t\tdescriptor.value = (...args) => {\n\t\t\t\t\t\tinstance[key].apply(instance, args);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tdescriptors[key] = descriptor;\n\t\t\t}\n\t\t}\n\t\treturn descriptors;\n\t}\n\n}\n","import { BehaviorSubject, Subject } from 'rxjs';\nimport { takeUntil, tap } from 'rxjs/operators';\nimport Component from '../core/component';\nimport Context from '../core/context';\n\nlet ID = 0;\nconst CONTEXTS = {};\nconst NODES = {};\nconst REMOVED_IDS = [];\n\nexport default class Module {\n\n\tcompile(node, parentInstance) {\n\t\tlet componentNode;\n\t\tconst instances = Module.querySelectorsAll(node, this.meta.selectors, []).map(match => {\n\t\t\tif (componentNode && componentNode !== match.node) {\n\t\t\t\tparentInstance = undefined;\n\t\t\t}\n\t\t\tconst instance = this.makeInstance(match.node, match.factory, match.selector, parentInstance);\n\t\t\tif (match.factory.prototype instanceof Component) {\n\t\t\t\tcomponentNode = match.node;\n\t\t\t}\n\t\t\treturn instance;\n\t\t}).filter(x => x);\n\t\t// console.log('compile', instances, node, parentInstance);\n\t\treturn instances;\n\t}\n\n\tmakeInstance(node, factory, selector, parentInstance, args) {\n\t\tif (parentInstance || node.parentNode) {\n\t\t\tconst isComponent = factory.prototype instanceof Component;\n\t\t\tconst meta = factory.meta;\n\t\t\t// collect parentInstance scope\n\t\t\tparentInstance = parentInstance || this.getParentInstance(node.parentNode);\n\t\t\tif (!parentInstance) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// creating factory instance\n\t\t\tconst instance = new factory(...(args || []));\n\t\t\t// creating instance context\n\t\t\tconst context = Module.makeContext(this, instance, parentInstance, node, factory, selector);\n\t\t\t// injecting changes$ and unsubscribe$ subjects\n\t\t\tObject.defineProperties(instance, {\n\t\t\t\tchanges$: {\n\t\t\t\t\tvalue: new BehaviorSubject(instance),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t},\n\t\t\t\tunsubscribe$: {\n\t\t\t\t\tvalue: new Subject(),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet initialized;\n\t\t\t// injecting instance pushChanges method\n\t\t\tconst module = this;\n\t\t\tinstance.pushChanges = function() {\n\t\t\t\t// console.log(new Error(`pushChanges ${instance.constructor.name}`).stack);\n\t\t\t\tthis.changes$.next(this);\n\t\t\t\t// parse component text nodes\n\t\t\t\tif (isComponent) {\n\t\t\t\t\t// console.log('Module.parse', instance.constructor.name);\n\t\t\t\t\tinitialized ? module.parse(node, instance) : setTimeout(function() { module.parse(node, instance); });\n\t\t\t\t}\n\t\t\t\t// calling onView event\n\t\t\t\tif (typeof instance.onView === 'function') {\n\t\t\t\t\t// console.log('onView', instance.constructor.name);\n\t\t\t\t\tinstance.onView();\n\t\t\t\t}\n\t\t\t};\n\t\t\t// creating component input and outputs\n\t\t\t// if (isComponent && meta) {\n\t\t\tif (meta) {\n\t\t\t\tcontext.inputs = this.makeInputs(meta, instance);\n\t\t\t\tcontext.outputs = this.makeOutputs(meta, instance);\n\t\t\t}\n\t\t\t// calling onInit event\n\t\t\tif (typeof instance.onInit === 'function') {\n\t\t\t\tinstance.onInit();\n\t\t\t}\n\t\t\tinitialized = true;\n\t\t\t// subscribe to parent changes\n\t\t\tif (parentInstance.changes$) {\n\t\t\t\tparentInstance.changes$.pipe(\n\t\t\t\t\t// filter(() => node.parentNode),\n\t\t\t\t\t// debounceTime(1),\n\t\t\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t\t\t).subscribe(changes => {\n\t\t\t\t\t// resolve component input outputs\n\t\t\t\t\t// if (isComponent && meta) {\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tthis.resolveInputsOutputs(instance, changes);\n\t\t\t\t\t}\n\t\t\t\t\t// calling onChanges event with parentInstance\n\t\t\t\t\tif (typeof instance.onChanges === 'function') {\n\t\t\t\t\t\t// console.log('onChanges', instance.constructor.name);\n\t\t\t\t\t\t// console.log('onChanges', instance.constructor.meta.selector, changes);\n\t\t\t\t\t\tinstance.onChanges(changes);\n\t\t\t\t\t}\n\t\t\t\t\t// push instance changes for subscribers\n\t\t\t\t\tinstance.pushChanges();\n\t\t\t\t});\n\t\t\t}\n\t\t\t/*\n\t\t\t// parse component text nodes\n\t\t\tif (isComponent) {\n\t\t\t\tthis.parse(node, instance);\n\t\t\t}\n\t\t\t*/\n\t\t\treturn instance;\n\t\t}\n\t}\n\n\tmakeContext(instance, parentInstance, node, selector) {\n\t\tconst context = Module.makeContext(this, instance, parentInstance, node, instance.constructor, selector);\n\t\t// console.log('Module.makeContext', context, context.instance, context.node);\n\t\treturn context;\n\t}\n\n\tmakeFunction(expression, params = ['$instance']) {\n\t\tif (!expression) {\n\t\t\treturn () => { return null; };\n\t\t}\n\t\tconst args = params.join(',');\n\t\tconst pipes = this.meta.pipes;\n\t\tconst transforms = Module.getPipesSegments(expression);\n\t\texpression = transforms.shift().trim();\n\t\texpression = this.transformOptionalChaining(expression);\n\t\t// console.log(pipes, transforms, expression);\n\t\t// console.log(transforms.length, params);\n\t\t// keyword 'this' represents changes from func.apply(changes, instance)\n\t\tif (transforms.length) {\n\t\t\texpression = transforms.reduce((expression, transform, i) => {\n\t\t\t\tconst params = Module.getPipeParamsSegments(transform);\n\t\t\t\tconst name = params.shift().trim();\n\t\t\t\tconst pipe = pipes[name];\n\t\t\t\tif (!pipe || typeof pipe.transform !== 'function') {\n\t\t\t\t\tthrow (`missing pipe '${name}'`);\n\t\t\t\t}\n\t\t\t\treturn `$$pipes.${name}.transform(${expression},${params.join(',')})`;\n\t\t\t}, expression);\n\t\t\t// console.log('expression', expression);\n\t\t\tconst expression_func = new Function(`with(this) {\n\t\t\t\treturn (function (${args}, $$module) {\n\t\t\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t} else {\n\t\t\t// console.log('expression', args, expression);\n\t\t\t// console.log('${expression.replace(/\\'/g,'\"')}', this);\n\t\t\tconst expression_func = new Function(`with(this) {\n\t\t\t\treturn (function (${args}, $$module) {\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t}\n\t}\n\n\tmakeInput(instance, key) {\n\t\tconst { node } = getContext(instance);\n\t\tlet input, expression = null;\n\t\tif (node.hasAttribute(key)) {\n\t\t\texpression = `'${node.getAttribute(key)}'`;\n\t\t} else if (node.hasAttribute(`[${key}]`)) {\n\t\t\texpression = node.getAttribute(`[${key}]`);\n\t\t}\n\t\tif (expression !== null) {\n\t\t\tinput = this.makeFunction(expression);\n\t\t}\n\t\treturn input;\n\t}\n\n\tmakeOutput(instance, key) {\n\t\tconst context = getContext(instance);\n\t\tconst node = context.node;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst expression = node.getAttribute(`(${key})`);\n\t\tconst outputFunction = this.makeFunction(expression, ['$event']);\n\t\tconst output$ = new Subject().pipe(\n\t\t\ttap((event) => {\n\t\t\t\tthis.resolve(outputFunction, parentInstance, event);\n\t\t\t})\n\t\t);\n\t\toutput$.pipe(\n\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t).subscribe();\n\t\tinstance[key] = output$;\n\t\treturn outputFunction;\n\t}\n\n\tgetInstance(node) {\n\t\tif (node === document) {\n\t\t\treturn window;\n\t\t}\n\t\tconst context = getContextByNode(node);\n\t\tif (context) {\n\t\t\treturn context.instance;\n\t\t}\n\t}\n\n\tgetParentInstance(node) {\n\t\treturn Module.traverseUp(node, (node) => {\n\t\t\treturn this.getInstance(node);\n\t\t});\n\t}\n\n\tremove(node) {\n\t\tModule.traverseDown(node, (node) => {\n\t\t\tfor (let id in CONTEXTS) {\n\t\t\t\tconst context = CONTEXTS[id];\n\t\t\t\tif (context.node === node) {\n\t\t\t\t\tconst instance = context.instance;\n\t\t\t\t\tinstance.unsubscribe$.next();\n\t\t\t\t\tinstance.unsubscribe$.complete();\n\t\t\t\t\tif (typeof instance.onDestroy === 'function') {\n\t\t\t\t\t\tinstance.onDestroy();\n\t\t\t\t\t}\n\t\t\t\t\tdelete node.dataset.rxcompId;\n\t\t\t\t\tREMOVED_IDS.push(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// console.log('Module.remove', REMOVED_IDS);\n\t\twhile (REMOVED_IDS.length) {\n\t\t\tModule.deleteContext(REMOVED_IDS.shift());\n\t\t}\n\t\treturn node;\n\t}\n\n\tdestroy() {\n\t\tthis.remove(this.meta.node);\n\t\tthis.meta.node.innerHTML = this.meta.nodeInnerHTML;\n\t}\n\n\tevaluate(text, instance) {\n\t\tconst parse_eval_ = (...args) => {\n\t\t\tconst expression = args[1];\n\t\t\t// console.log('expression', expression);\n\t\t\ttry {\n\t\t\t\tconst parse_func_ = this.makeFunction(expression);\n\t\t\t\treturn this.resolve(parse_func_, instance, instance);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t\treturn e.message;\n\t\t\t}\n\t\t};\n\t\treturn text.replace(/\\{{2}((([^{}])|(\\{([^{}]|(\\{.*?\\}))+?\\}))*?)\\}{2}/g, parse_eval_);\n\t\t// return text.replace(/\\{{2}((([^{}])|(\\{[^{}]+?\\}))*?)\\}{2}/g, parse_eval_);\n\t}\n\n\tparse(node, instance) {\n\t\t// console.log('parse', instance.constructor.name, node);\n\t\tfor (let i = 0; i < node.childNodes.length; i++) {\n\t\t\tconst child = node.childNodes[i];\n\t\t\tif (child.nodeType === 1) {\n\t\t\t\tconst context = getContextByNode(child);\n\t\t\t\tif (!context) {\n\t\t\t\t\tthis.parse(child, instance);\n\t\t\t\t}\n\t\t\t} else if (child.nodeType === 3) {\n\t\t\t\tconst expression = child.nodeExpression || child.nodeValue;\n\t\t\t\tconst replacedText = this.evaluate(expression, instance);\n\t\t\t\t// console.log(instance.constructor.name, expression, replacedText);\n\t\t\t\tif (expression !== replacedText) {\n\t\t\t\t\tchild.nodeExpression = child.nodeExpression || expression;\n\t\t\t\t\tconst textNode = document.createTextNode(replacedText);\n\t\t\t\t\tnode.replaceChild(textNode, child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tresolve(expressionFunc, changes, payload) {\n\t\treturn expressionFunc.apply(changes, [payload, this]);\n\t}\n\n\tmakeInputs(meta, instance) {\n\t\tconst inputs = {};\n\t\tif (meta.inputs) {\n\t\t\tmeta.inputs.forEach((key, i) => {\n\t\t\t\tconst input = this.makeInput(instance, key);\n\t\t\t\tif (input) {\n\t\t\t\t\tinputs[key] = input;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn inputs;\n\t};\n\n\tmakeOutputs(meta, instance) {\n\t\tconst outputs = {};\n\t\tif (meta.outputs) {\n\t\t\tmeta.outputs.forEach((key, i) => outputs[key] = this.makeOutput(instance, key));\n\t\t}\n\t\treturn outputs;\n\t}\n\n\tresolveInputsOutputs(instance, changes) {\n\t\tconst context = getContext(instance);\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst inputs = context.inputs;\n\t\tfor (let key in inputs) {\n\t\t\tconst inputFunction = inputs[key];\n\t\t\tconst value = this.resolve(inputFunction, parentInstance, instance);\n\t\t\tinstance[key] = value;\n\t\t}\n\t\t/*\n\t\tconst outputs = context.outputs;\n\t\tfor (let key in outputs) {\n\t\t\tconst inpuoutputFunctiontFunction = outputs[key];\n\t\t\tconst value = this.resolve(outputFunction, parentInstance, null);\n\t\t\t// console.log(`setted -> ${key}`, value);\n\t\t}\n\t\t*/\n\t}\n\n\ttransformOptionalChaining(expression) {\n\t\tconst regex = /(\\w+(\\?\\.))+([\\.|\\w]+)/g;\n\t\tlet previous;\n\t\texpression = expression.replace(regex, (...args) => {\n\t\t\tconst tokens = args[0].split('?.');\n\t\t\tfor (let i = 0; i < tokens.length - 1; i++) {\n\t\t\t\tconst a = i > 0 ? `(${tokens[i]} = ${previous})` : tokens[i];\n\t\t\t\tconst b = tokens[i + 1];\n\t\t\t\tprevious = i > 0 ? `${a}.${b}` : `(${a} ? ${a}.${b} : void 0)`;\n\t\t\t\t// log(previous);\n\t\t\t}\n\t\t\treturn previous || '';\n\t\t});\n\t\treturn expression;\n\t}\n\n\tstatic getPipesSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === '|' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic getPipeParamsSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === ':' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic matchSelectors(node, selectors, results) {\n\t\tfor (let i = 0; i < selectors.length; i++) {\n\t\t\tconst match = selectors[i](node);\n\t\t\tif (match) {\n\t\t\t\tconst factory = match.factory;\n\t\t\t\tif (factory.prototype instanceof Component && factory.meta.template) {\n\t\t\t\t\tnode.innerHTML = factory.meta.template;\n\t\t\t\t}\n\t\t\t\tresults.push(match);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic querySelectorsAll(node, selectors, results) {\n\t\tif (node.nodeType === 1) {\n\t\t\tresults = this.matchSelectors(node, selectors, results);\n\t\t}\n\t\tconst childNodes = node.childNodes;\n\t\tif (childNodes) {\n\t\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\t\tresults = this.querySelectorsAll(childNodes[i], selectors, results);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic traverseUp(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseUp(node.parentNode, callback, i + 1);\n\t}\n\n\tstatic traverseDown(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tlet result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tif (node.nodeType === 1) {\n\t\t\tlet j = 0,\n\t\t\t\tt = node.childNodes.length;\n\t\t\twhile (j < t && !result) {\n\t\t\t\tresult = this.traverseDown(node.childNodes[j], callback, i + 1);\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic traversePrevious(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traversePrevious(node.previousSibling, callback, i + 1);\n\t}\n\n\tstatic traverseNext(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseNext(node.nextSibling, callback, i + 1);\n\t}\n\n\tstatic makeContext(module, instance, parentInstance, node, factory, selector) {\n\t\tinstance.rxcompId = ++ID;\n\t\tconst context = { module, instance, parentInstance, node, factory, selector };\n\t\tconst rxcompNodeId = node.dataset.rxcompId = (node.dataset.rxcompId || instance.rxcompId);\n\t\tconst nodeContexts = NODES[rxcompNodeId] || (NODES[rxcompNodeId] = []);\n\t\tnodeContexts.push(context);\n\t\treturn CONTEXTS[instance.rxcompId] = context;\n\t}\n\n\tstatic deleteContext(id) {\n\t\tconst context = CONTEXTS[id];\n\t\tconst nodeContexts = NODES[context.node.dataset.rxcompId];\n\t\tif (nodeContexts) {\n\t\t\tconst index = nodeContexts.indexOf(context);\n\t\t\tif (index !== -1) {\n\t\t\t\tnodeContexts.splice(index, 1);\n\t\t\t}\n\t\t}\n\t\tdelete CONTEXTS[id];\n\t}\n\n}\n\nexport function getContext(instance) {\n\treturn CONTEXTS[instance.rxcompId];\n}\n\nexport function getContextByNode(node) {\n\tlet context;\n\tconst nodeContexts = NODES[node.dataset.rxcompId];\n\tif (nodeContexts) {\n\t\t/*\n\t\tconst same = nodeContexts.reduce((p, c) => {\n\t\t\treturn p && c.node === node;\n\t\t}, true);\n\t\tconsole.log('same', same);\n\t\t*/\n\t\tcontext = nodeContexts.reduce((previous, current) => {\n\t\t\tif (current.factory.prototype instanceof Component) {\n\t\t\t\treturn current;\n\t\t\t} else if (current.factory.prototype instanceof Context) {\n\t\t\t\treturn previous ? previous : current;\n\t\t\t} else {\n\t\t\t\treturn previous;\n\t\t\t}\n\t\t}, null);\n\t\t// console.log(node.dataset.rxcompId, context);\n\t}\n\treturn context;\n}\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class ClassDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[class]');\n\t\tthis.classFunction = module.makeFunction(expression);\n\t\t// console.log('ClassDirective.onInit', this.classList, expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst classList = module.resolve(this.classFunction, changes, this);\n\t\tfor (let key in classList) {\n\t\t\tclassList[key] ? node.classList.add(key) : node.classList.remove(key);\n\t\t}\n\t\t// console.log('ClassDirective.onChanges', classList);\n\t}\n\n}\n\nClassDirective.meta = {\n\tselector: `[[class]]`,\n};\n","import { fromEvent } from 'rxjs';\nimport { shareReplay, takeUntil } from 'rxjs/operators';\nimport Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nconst EVENTS = ['click', 'mousedown', 'mouseup', 'touchstart', 'touchmove', 'touchend', 'keydown', 'keyup', 'input', 'change', 'loaded'];\n\nexport default class EventDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst event = this.event = selector.replace(/\\[|\\]|\\(|\\)/g, '');\n\t\tconst event$ = this.event$ = fromEvent(node, event).pipe(shareReplay(1));\n\t\tconst expression = node.getAttribute(`(${event})`);\n\t\tif (expression) {\n\t\t\tconst outputFunction = module.makeFunction(expression, ['$event']);\n\t\t\tevent$.pipe(\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(event => {\n\t\t\t\t// console.log(parentInstance);\n\t\t\t\tmodule.resolve(outputFunction, parentInstance, event);\n\t\t\t});\n\t\t} else {\n\t\t\tparentInstance[`${event}$`] = event$;\n\t\t}\n\t\t// console.log('EventDirective.onInit', 'selector', selector, 'event', event);\n\t}\n\n}\n\nEventDirective.meta = {\n\tselector: `[(${EVENTS.join(')],[(')})]`,\n};\n","export default class Structure {\n\n}\n","import Context from '../core/context';\n\nexport default class ForItem extends Context {\n\n\t// !!! try with payload options { key, $key, value, $value, index, count } or use onInit()\n\n\tconstructor(key, $key, value, $value, index, count, parentInstance) {\n\t\t// console.log('ForItem', arguments);\n\t\tsuper(parentInstance);\n\t\t/*\n\t\tsuper(parentInstance, {\n\t\t\t[key]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$key;\n\t\t\t\t},\n\t\t\t\tset: function(key) {\n\t\t\t\t\tthis.$key = key;\n\t\t\t\t}\n\t\t\t},\n\t\t\t[value]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\tthis.$value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t*/\n\t\tthis[key] = $key;\n\t\tthis[value] = $value;\n\t\tthis.index = index;\n\t\tthis.count = count;\n\t}\n\n\tget first() { return this.index === 0; }\n\n\tget last() { return this.index === this.count - 1; }\n\n\tget even() { return this.index % 2 === 0; }\n\n\tget odd() { return !this.even; }\n\n\t/*\n\tonDestroy() {\n\t\tconsole.log('onDestroy');\n\t}\n\t*/\n\n}\n","import Structure from '../core/structure';\nimport { getContext } from '../module/module';\nimport ForItem from './for.item';\n\nexport default class ForStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst forbegin = this.forbegin = document.createComment(`*for begin`);\n\t\tnode.parentNode.replaceChild(forbegin, node);\n\t\tconst forend = this.forend = document.createComment(`*for end`);\n\t\tforbegin.parentNode.insertBefore(forend, forbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*for');\n\t\tnode.removeAttribute('*for');\n\t\tconst tokens = this.tokens = this.getExpressionTokens(expression);\n\t\tthis.forFunction = module.makeFunction(tokens.iterable);\n\t\tthis.instances = [];\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\t// resolve\n\t\tconst tokens = this.tokens;\n\t\tlet result = module.resolve(this.forFunction, changes, this) || [];\n\t\tconst isArray = Array.isArray(result);\n\t\tconst array = isArray ? result : Object.keys(result);\n\t\tconst total = array.length;\n\t\tconst previous = this.instances.length;\n\t\t// let nextSibling = this.forbegin.nextSibling;\n\t\tfor (let i = 0; i < Math.max(previous, total); i++) {\n\t\t\tif (i < total) {\n\t\t\t\tconst key = isArray ? i : array[i];\n\t\t\t\tconst value = isArray ? array[key] : result[key];\n\t\t\t\tif (i < previous) {\n\t\t\t\t\t// update\n\t\t\t\t\tconst instance = this.instances[i];\n\t\t\t\t\tinstance[tokens.key] = key;\n\t\t\t\t\tinstance[tokens.value] = value;\n\t\t\t\t\t/*\n\t\t\t\t\tif (!nextSibling) {\n\t\t\t\t\t\tconst context = getContext(instance);\n\t\t\t\t\t\tconst node = context.node;\n\t\t\t\t\t\tthis.forend.parentNode.insertBefore(node, this.forend);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextSibling = nextSibling.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t} else {\n\t\t\t\t\t// create\n\t\t\t\t\tconst clonedNode = node.cloneNode(true);\n\t\t\t\t\tdelete clonedNode.dataset.rxcompId;\n\t\t\t\t\tthis.forend.parentNode.insertBefore(clonedNode, this.forend);\n\t\t\t\t\tconst args = [tokens.key, key, tokens.value, value, i, total, context.parentInstance]; // !!! context.parentInstance unused?\n\t\t\t\t\tconst instance = module.makeInstance(clonedNode, ForItem, context.selector, context.parentInstance, args);\n\t\t\t\t\tconst forItemContext = getContext(instance);\n\t\t\t\t\t// console.log('ForStructure', clonedNode, forItemContext.instance.constructor.name);\n\t\t\t\t\tmodule.compile(clonedNode, forItemContext.instance);\n\t\t\t\t\t// nextSibling = clonedNode.nextSibling;\n\t\t\t\t\tthis.instances.push(instance);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// remove\n\t\t\t\tconst instance = this.instances[i];\n\t\t\t\tconst context = getContext(instance);\n\t\t\t\tconst node = context.node;\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\tmodule.remove(node);\n\t\t\t}\n\t\t}\n\t\tthis.instances.length = array.length;\n\t\t// console.log('ForStructure', this.instances, tokens);\n\t}\n\n\tgetExpressionTokens(expression) {\n\t\tif (expression === null) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tif (expression.trim().indexOf('let ') === -1 || expression.trim().indexOf(' of ') === -1) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tconst expressions = expression.split(';').map(x => x.trim()).filter(x => x !== '');\n\t\tconst forExpressions = expressions[0].split(' of ').map(x => x.trim());\n\t\tlet value = forExpressions[0].replace(/\\s*let\\s*/, '');\n\t\tconst iterable = forExpressions[1];\n\t\tlet key = 'index';\n\t\tconst keyValueMatches = value.match(/\\[(.+)\\s*,\\s*(.+)\\]/);\n\t\tif (keyValueMatches) {\n\t\t\tkey = keyValueMatches[1];\n\t\t\tvalue = keyValueMatches[2];\n\t\t}\n\t\tif (expressions.length > 1) {\n\t\t\tconst indexExpressions = expressions[1].split(/\\s*let\\s*|\\s*=\\s*index/).map(x => x.trim());\n\t\t\tif (indexExpressions.length === 3) {\n\t\t\t\tkey = indexExpressions[1];\n\t\t\t}\n\t\t}\n\t\treturn { key, value, iterable };\n\t}\n\n}\n\nForStructure.meta = {\n\tselector: '[*for]',\n};\n","import Structure from '../core/structure';\nimport { getContext } from '../module/module';\n\nexport default class IfStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst ifbegin = this.ifbegin = document.createComment(`*if begin`);\n\t\tnode.parentNode.replaceChild(ifbegin, node);\n\t\tconst ifend = this.ifend = document.createComment(`*if end`);\n\t\tifbegin.parentNode.insertBefore(ifend, ifbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*if');\n\t\tthis.expression = expression;\n\t\tthis.ifFunction = module.makeFunction(expression);\n\t\tconst clonedNode = node.cloneNode(true);\n\t\tclonedNode.removeAttribute('*if');\n\t\tthis.clonedNode = clonedNode;\n\t\t// console.log('IfStructure.expression', expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\t// console.log('IfStructure.onChanges', changes, this.expression);\n\t\tconst value = module.resolve(this.ifFunction, changes, this);\n\t\tif (value) {\n\t\t\tif (!this.clonedNode.parentNode) {\n\t\t\t\tthis.ifend.parentNode.insertBefore(this.clonedNode, this.ifend);\n\t\t\t\tmodule.compile(this.clonedNode);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.clonedNode.parentNode) {\n\t\t\t\tthis.clonedNode.parentNode.removeChild(this.clonedNode);\n\t\t\t\tmodule.remove(this.clonedNode);\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nIfStructure.meta = {\n\tselector: '[*if]',\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class InnerHtmlDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst key = selector.replace(/\\[(.+)\\]/, (...matches) => {\n\t\t\treturn matches[1];\n\t\t});\n\t\tlet expression = node.getAttribute(key);\n\t\tif (!expression) {\n\t\t\tthrow (`invalid ${key}`);\n\t\t}\n\t\tif (key === '[innerHTML]') {\n\t\t\texpression = `{{${expression}}}`;\n\t\t}\n\t\tthis.innerHtmlExpression = expression;\n\t\t// console.log('InnerHtmlDirective.onInit', node, expression, key);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst innerHTML = context.module.evaluate(this.innerHtmlExpression, changes);\n\t\t// console.log('InnerHtmlDirective.onChanges', this.innerHtmlExpression, innerHTML);\n\t\tconst node = context.node;\n\t\tnode.innerHTML = innerHTML;\n\t}\n\n}\n\nInnerHtmlDirective.meta = {\n\tselector: `[[innerHTML]],[innerHTML]`\n};\n","export default class Pipe {\n\n\tstatic transform(value) {\n\t\treturn value;\n\t}\n\n}\n","import Pipe from \"../core/pipe\";\n\nexport default class JsonPipe extends Pipe {\n\n\tstatic transform(value) {\n\t\treturn JSON.stringify(value);\n\t}\n\n}\n\nJsonPipe.meta = {\n\tname: 'json',\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class StyleDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[style]');\n\t\tthis.styleFunction = module.makeFunction(expression);\n\t\t// console.log('StyleDirective.onInit', expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst style = module.resolve(this.styleFunction, changes, this);\n\t\tfor (let key in style) {\n\t\t\tnode.style.setProperty(key, style[key]);\n\t\t}\n\t\t// console.log('StyleDirective.onChanges', changes, style);\n\t}\n\n}\n\nStyleDirective.meta = {\n\tselector: `[[style]]`\n};\n","import ClassDirective from './class/class.directive';\nimport EventDirective from './event/event.directive';\nimport ForStructure from './for/for.structure';\nimport IfStructure from './if/if.structure';\nimport InnerHtmlDirective from './inner-html/inner-html.directive';\nimport JsonPipe from './json/json.pipe';\nimport Module from './module/module';\nimport StyleDirective from './style/style.directive';\n\nexport default class CoreModule extends Module {}\nconst factories = [\n\tClassDirective,\n\tEventDirective,\n\tForStructure,\n\tIfStructure,\n\tInnerHtmlDirective,\n\tStyleDirective,\n\tJsonPipe,\n];\nconst pipes = [\n\tJsonPipe,\n];\nCoreModule.meta = {\n\tdeclarations: [\n\t\t...factories,\n\t\t...pipes,\n\t],\n\texports: [\n\t\t...factories,\n\t\t...pipes,\n\t]\n};\n","import Component from '../core/component';\nimport Directive from '../core/directive';\nimport Pipe from '../core/pipe';\nimport Structure from '../core/structure';\n\nconst ORDER = [Structure, Component, Directive];\n\nexport default class Platform {\n\n\tstatic bootstrap(moduleFactory) {\n\t\tconst meta = this.resolveMeta(moduleFactory);\n\t\tconst bootstrap = meta.bootstrap;\n\t\tif (!bootstrap) {\n\t\t\tthrow ('missing bootstrap');\n\t\t}\n\t\tconst node = meta.node = this.querySelector(bootstrap.meta.selector);\n\t\tif (!node) {\n\t\t\tthrow (`missing node ${bootstrap.meta.selector}`);\n\t\t}\n\t\tmeta.nodeInnerHTML = node.innerHTML;\n\t\tconst pipes = meta.pipes = this.resolvePipes(meta);\n\t\tconst factories = meta.factories = this.resolveFactories(meta);\n\t\tthis.sortFactories(factories);\n\t\tfactories.unshift(bootstrap);\n\t\tconst selectors = meta.selectors = this.unwrapSelectors(factories);\n\t\tconst module = new moduleFactory();\n\t\tmodule.meta = meta;\n\t\tconst instances = module.compile(node, window);\n\t\tconst root = instances[0];\n\t\t// if (root instanceof module.meta.bootstrap) {\n\t\troot.pushChanges();\n\t\t// }\n\t\treturn module;\n\t}\n\n\tstatic querySelector(selector) {\n\t\treturn document.querySelector(selector);\n\t}\n\n\tstatic resolveMeta(moduleFactory) {\n\t\tconst meta = Object.assign({ imports: [], declarations: [], pipes: [], exports: [] }, moduleFactory.meta);\n\t\tmeta.imports = meta.imports.map(moduleFactory => this.resolveMeta(moduleFactory));\n\t\treturn meta;\n\t}\n\n\tstatic resolvePipes(meta, exported) {\n\t\tconst importedPipes = meta.imports.map(meta => this.resolvePipes(meta, true));\n\t\tconst pipes = {};\n\t\tconst pipeList = (exported ? meta.exports : meta.declarations).filter(x => x.prototype instanceof Pipe);\n\t\tpipeList.forEach(pipeFactory => pipes[pipeFactory.meta.name] = pipeFactory);\n\t\treturn Object.assign({}, ...importedPipes, pipes);\n\t}\n\n\tstatic resolveFactories(meta, exported) {\n\t\tconst importedFactories = meta.imports.map(meta => this.resolveFactories(meta, true));\n\t\tconst factoryList = (exported ? meta.exports : meta.declarations).filter(x => (x.prototype instanceof Structure || x.prototype instanceof Component || x.prototype instanceof Directive));\n\t\treturn Array.prototype.concat.call(factoryList, ...importedFactories);\n\t}\n\n\tstatic sortFactories(factories) {\n\t\tfactories.sort((a, b) => {\n\t\t\tconst ai = ORDER.reduce((p, c, i) => a.prototype instanceof c ? i : p, -1);\n\t\t\tconst bi = ORDER.reduce((p, c, i) => b.prototype instanceof c ? i : p, -1);\n\t\t\treturn ai - bi;\n\t\t});\n\t}\n\n\tstatic unwrapSelectors(factories) {\n\t\tconst selectors = [];\n\t\tfactories.forEach(factory => {\n\t\t\tfactory.meta.selector.split(',').forEach(selector => {\n\t\t\t\tselector = selector.trim();\n\t\t\t\t// (\\:not\\((\\.[\\w\\-\\_]+)|(\\[.+?\\])|([\\w\\-\\_]+)\\))|(\\.[\\w\\-\\_]+)|(\\[.+?\\])|([\\w\\-\\_]+);\n\t\t\t\tlet matchers = [];\n\t\t\t\tselector.replace(/(\\.[\\w\\-\\_]+)|(\\[+.+?\\]+)|([\\w\\-\\_]+)/g, function(value, className, attrName, nodeName) {\n\t\t\t\t\tif (className) {\n\t\t\t\t\t\tmatchers.push(function(node) {\n\t\t\t\t\t\t\treturn node.classList.contains(className.replace(/\\./g, ''));\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (attrName) {\n\t\t\t\t\t\tmatchers.push(function(node) {\n\t\t\t\t\t\t\treturn node.hasAttribute(attrName.substr(1, attrName.length - 2));\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (nodeName) {\n\t\t\t\t\t\tmatchers.push(function(node) {\n\t\t\t\t\t\t\treturn node.nodeName.toLowerCase() === nodeName.toLowerCase();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tselectors.push(function(node) {\n\t\t\t\t\tconst match = matchers.reduce((match, matcher) => {\n\t\t\t\t\t\treturn match && matcher(node);\n\t\t\t\t\t}, true);\n\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\treturn selectors;\n\t}\n\n\t/*\n\tstatic unwrapSelectors(factories) {\n\t\tconst selectors = [];\n\t\tfactories.forEach(factory => {\n\t\t\tfactory.meta.selector.split(',').forEach(selector => {\n\t\t\t\tselector = selector.trim();\n\t\t\t\tif (selector.indexOf('.') === 0) {\n\t\t\t\t\tconst className = selector.replace(/\\./g, '');\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.classList.contains(className);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else if (selector.match(/\\[(.+)\\]/)) {\n\t\t\t\t\tconst attribute = selector.substr(1, selector.length - 2);\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.hasAttribute(attribute);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.nodeName.toLowerCase() === selector.toLowerCase();\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn selectors;\n\t}\n\t*/\n\n\tstatic isBrowser() {\n\t\treturn window;\n\t}\n\n\t// static isServer() {}\n\n}\n","import Platform from './platform';\n\nexport default class Browser extends Platform {}\n","export default class LocalStorageService {\n\n\tstatic delete(name) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\twindow.localStorage.removeItem(name);\n\t\t}\n\t}\n\n\tstatic exist(name) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\treturn window.localStorage[name] !== undefined;\n\t\t}\n\t}\n\n\tstatic get(name) {\n\t\tlet value = null;\n\t\tif (this.isLocalStorageSupported() && window.localStorage[name] !== undefined) {\n\t\t\ttry {\n\t\t\t\tvalue = JSON.parse(window.localStorage[name]);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorageService.get.error parsing', name, e);\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t}\n\n\tstatic set(name, value) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\ttry {\n\t\t\t\tconst cache = [];\n\t\t\t\tconst json = JSON.stringify(value, function(key, value) {\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\twindow.localStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorageService.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic isLocalStorageSupported() {\n\t\tif (this.supported) {\n\t\t\treturn true;\n\t\t}\n\t\tlet supported = false;\n\t\ttry {\n\t\t\tsupported = 'localStorage' in window && window.localStorage !== null;\n\t\t\tif (supported) {\n\t\t\t\twindow.localStorage.setItem('test', '1');\n\t\t\t\twindow.localStorage.removeItem('test');\n\t\t\t} else {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsupported = false;\n\t\t}\n\t\tthis.supported = supported;\n\t\treturn supported;\n\t}\n\n}\n","import { BehaviorSubject, of } from 'rxjs';\nimport { delay } from 'rxjs/operators';\nimport LocalStorageService from '../local-storage/local-storage.service';\n\nexport default class StoreService {\n\n\tstatic set(items) {\n\t\tLocalStorageService.set('items', items);\n\t\treturn this.get$().next(items);\n\t}\n\n\tstatic get$() {\n\t\tif (this.store$) {\n\t\t\treturn this.store$;\n\t\t}\n\t\tlet items = LocalStorageService.get('items');\n\t\tif (!items) {\n\t\t\titems = [\n\t\t\t\t{ id: 5, name: 'Cookies', date: new Date(Date.now()) },\n\t\t\t\t{ id: 4, name: 'Pizza', date: new Date(2019, 4, 4, 12) },\n\t\t\t\t{ id: 3, name: 'Pasta', date: new Date(2019, 3, 22, 12) },\n\t\t\t\t{ id: 2, name: 'Bread', date: new Date(2019, 0, 6, 12) },\n\t\t\t\t{ id: 1, name: 'Ham', date: new Date(2018, 11, 30, 12) },\n\t\t\t];\n\t\t\tLocalStorageService.set('items', items);\n\t\t}\n\t\tthis.store$ = new BehaviorSubject(items);\n\t\treturn this.store$.pipe(\n\t\t\tdelay(1) // simulate http\n\t\t);\n\t}\n\n\tstatic add$(patch) {\n\t\tconst item = Object.assign({\n\t\t\tid: Date.now(),\n\t\t\tdate: new Date(Date.now())\n\t\t}, patch);\n\t\tconst items = this.store$.getValue();\n\t\titems.unshift(item);\n\t\tthis.set(items);\n\t\treturn of(item).pipe(\n\t\t\tdelay(1) // simulate http\n\t\t);\n\t}\n\n\tstatic patch$(patch) {\n\t\tconst items = this.store$.getValue();\n\t\tconst item = items.find(x => x.id === patch.id);\n\t\tif (item) {\n\t\t\tObject.assign(item, patch);\n\t\t\tthis.set(items);\n\t\t}\n\t\treturn of(item).pipe(\n\t\t\tdelay(1) // simulate http\n\t\t);\n\t}\n\n\tstatic delete$(item) {\n\t\tconst items = this.store$.getValue();\n\t\tconst index = items.indexOf(item);\n\t\tif (index !== -1) {\n\t\t\titems.splice(index, 1);\n\t\t\tthis.set(items);\n\t\t}\n\t\treturn of(item).pipe(\n\t\t\tdelay(1) // simulate http\n\t\t);\n\t}\n\n}\n","import { takeUntil } from 'rxjs/operators';\nimport { Component, getContext } from '../../src/rxcomp';\nimport StoreService from './store/store.service';\n\nexport default class AppComponent extends Component {\n\n\tonInit() {\n\t\t// context\n\t\tconst context = getContext(this);\n\t\t// input\n\t\tthis.input = context.node.querySelector('.control--text');\n\t\t// items\n\t\tthis.items = [];\n\t\t// store service\n\t\tthis.store$ = StoreService.get$();\n\t\tthis.store$.pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe(items => {\n\t\t\tthis.items = items;\n\t\t\t// onpush change detection strategy\n\t\t\tthis.pushChanges();\n\t\t});\n\t}\n\n\tonInput($event) {\n\t\t// console.log('AppComponent.onInput', $event, this);\n\t\tthis.pushChanges();\n\t}\n\n\tonAddItem($event) {\n\t\tif (this.input.value) {\n\t\t\tStoreService.add$({\n\t\t\t\tname: this.input.value,\n\t\t\t}).subscribe(item => {\n\t\t\t\t// console.log('AppComponent.onAddItem', item);\n\t\t\t\tthis.input.value = null;\n\t\t\t});\n\t\t}\n\t}\n\n\tonToggleItem(item) {\n\t\tStoreService.patch$({\n\t\t\tid: item.id,\n\t\t\tdone: !item.done,\n\t\t}).subscribe(item => {\n\t\t\t// console.log('AppComponent.onToggleItem', item);\n\t\t});\n\t}\n\n\tonRemoveItem(item) {\n\t\tStoreService.delete$(item).subscribe(item => {\n\t\t\t// console.log('AppComponent.onRemoveItem', item);\n\t\t});\n\t}\n\n}\n\nAppComponent.meta = {\n\tselector: '[app-component]',\n};\n","import { Pipe } from \"../../../src/rxcomp\";\n\nexport default class DatePipe extends Pipe {\n\n\tstatic transform(value, locale = 'it-IT-u-ca-gregory', options = {\n\t\tdateStyle: 'short',\n\t\ttimeStyle: 'short',\n\t}) {\n\t\tconst localeDateString = new Date(value).toLocaleDateString(locale, options);\n\t\treturn localeDateString;\n\t}\n\n}\n\nDatePipe.meta = {\n\tname: 'date',\n};\n","export const colors = [\n\t{ hex: '#ffffff', background: '#ffffff', foreground: '#003adc', accent: '#212121' },\n\t{ hex: '#212121', background: '#212121', foreground: '#ffffff', accent: '#003adc' },\n\t{ hex: '#ffffff', background: '#ffffff', foreground: '#212121', accent: '#003adc' },\n\t{ hex: '#003adc', background: '#003adc', foreground: '#ffffff', accent: '#212121' },\n];\n\nexport function hexToInt(hex) {\n\treturn parseInt(hex.replace(/^#/, ''), 16);\n}\n\nexport function randomHex() {\n\treturn colors[Math.floor(Math.random() * colors.length)].hex;\n}\n\nexport function randomColor() {\n\tconst hex = randomHex();\n\treturn hexToInt(hex);\n}\n\nexport function color(index, alpha) {\n\treturn hexToRgb(colors[index % colors.length].hex, alpha);\n}\n\nexport function background(index, alpha) {\n\treturn hexToRgb(colors[index % colors.length].background, alpha);\n}\n\nexport function foreground(index, alpha) {\n\treturn hexToRgb(colors[index % colors.length].foreground, alpha);\n}\n\nexport function accent(index, alpha) {\n\treturn hexToRgb(colors[index % colors.length].accent, alpha);\n}\n\nlet index = -1;\n\nexport function nextHex() {\n\tindex++;\n\treturn colors[index % colors.length].hex;\n}\n\nexport function nextColor() {\n\tconst hex = nextHex();\n\treturn hexToInt(hex);\n}\n\nexport function hexToRgb(hex, a) {\n\tconst r = parseInt(hex.slice(1, 3), 16);\n\tconst g = parseInt(hex.slice(3, 5), 16);\n\tconst b = parseInt(hex.slice(5, 7), 16);\n\tif (a) {\n\t\treturn `rgba(${r},${g},${b},${a})`;\n\t} else {\n\t\treturn `rgb(${r},${g},${b})`;\n\t}\n}\n","import { Component } from '../../../src/rxcomp';\nimport { accent, background, foreground } from '../colors/colors';\n\nexport default class TodoItemComponent extends Component {\n\n\t// onInit() {}\n\n\tonChanges(changes) {\n\t\t// console.log('onChanges', changes);\n\t\tthis.background = background(this.item.id);\n\t\tthis.foreground = foreground(this.item.id);\n\t\tthis.accent = accent(this.item.id);\n\t}\n\n\t// onView() {}\n\n\t// onDestroy() {}\n\n\tonToggle($event) {\n\t\t// console.log('onToggle', $event);\n\t\tthis.toggle.next($event);\n\t}\n\n\tonRemove($event) {\n\t\t// console.log('onRemove', $event);\n\t\tthis.remove.next($event);\n\t}\n\n}\n\nTodoItemComponent.meta = {\n\tselector: '[todo-item-component]',\n\tinputs: ['item'],\n\toutputs: ['toggle', 'remove'],\n\t// template syntax example\n\t/*\n\ttemplate: // html // `\n\t\t<div class=\"content\" [style]=\"{ background: background, color: foreground, '--accent': accent }\">\n\t\t\t<button type=\"button\" class=\"btn--toggle\" (click)=\"onToggle(item)\">\n\t\t\t\t<i class=\"icon--check\" *if=\"item.done\"></i>\n\t\t\t\t<i class=\"icon--circle\" *if=\"!item.done\"></i>\n\t\t\t\t<div class=\"title\" [innerHTML]=\"item.name\"></div>\n\t\t\t</button>\n\t\t\t<div class=\"date\" [style]=\"{ background: backgroundColor, color: color }\" [innerHTML]=\"item.date | date : 'en-US' : { month: 'short', day: '2-digit', year: 'numeric' }\"></div>\n\t\t\t<button type=\"button\" class=\"btn--remove\" (click)=\"onRemove(item)\"><i class=\"icon--remove\"></i></button>\n\t\t</div>\n\t`,\n\t*/\n};\n","import { CoreModule, Module } from '../../src/rxcomp';\nimport AppComponent from './app.component';\nimport DatePipe from './date/date.pipe';\nimport TodoItemComponent from './todo-item/todo-item.component';\n\nexport default class AppModule extends Module {}\n\nAppModule.meta = {\n\timports: [\n\t\tCoreModule\n\t],\n\tdeclarations: [\n\t\tTodoItemComponent,\n\t\tDatePipe,\n\t],\n\tbootstrap: AppComponent,\n};\n","import { Browser } from '../../src/rxcomp';\nimport AppModule from './app.module';\n\nBrowser.bootstrap(AppModule);\n"]}