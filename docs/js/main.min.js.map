{"version":3,"sources":["docs/js/main.js","../../lib/directive/directive.js","../../lib/component/component.js","../../lib/context/context.js","../../lib/module/module.js","../../lib/class/class.directive.js","../../lib/event/event.directive.js","../../lib/structure/structure.js","../../lib/for/for.item.js","../../lib/for/for.structure.js","../../lib/if/if.structure.js","../../lib/inner-html/inner-html.directive.js","../../lib/json/json.pipe.js","../../lib/style/style.directive.js","../../src/js/local-storage/local-storage.service.js","../../src/js/store/store.service.js","../../src/js/app.component.js","../../src/js/date/date.pipe.js","../../src/js/colors/colors.js","../../src/js/todo-item/todo-item.component.js","../../src/js/main.js"],"names":["global","factory","exports","module","require","define","amd","self","rxjs","operators","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","_setPrototypeOf","o","p","setPrototypeOf","_construct","Parent","args","Class","Reflect","construct","sham","Proxy","Date","toString","call","e","isNativeReflectConstruct","a","push","apply","instance","Function","bind","arguments","Directive","meta","selector","Component","Context","_Component","parent","descriptors","_this","parentPrototypeDescriptors","getOwnPropertyDescriptors","getPrototypeOf","keys","forEach","console","log","value","_len","Array","_key","parentDescriptors","_len2","_key2","ID","CONTEXTS","NODES","Module","options","bootstrap","pipes","x","name","node","document","querySelector","root","makeInstance","window","selectors","unwrapSelectors","factories","_proto","use$","of","querySelectorsAll","pipe","filter","matches","map","match","tap","instances","context","getContext","parse","shareReplay","makeContext","parentInstance","_this2","parentNode","isComponent","getParentScope","defineProperties","state$","BehaviorSubject","unsubscribe$","Subject","moduleRef","pushState","next","inputs","makeInputs","outputs","makeOutputs","onInit","takeUntil","subscribe","state","resolveInputsOutputs","onState","remove","ids","traverseDown","_i","_Object$entries","entries","_Object$entries$_i","id","complete","onDestroy","deleteContext","compile","_this3","undefined","evaluate","text","_this4","replace","expression","parse_func_","makeFunction","resolve","childNodes","child","nodeType","nodeValue","replacedText","textNode","createTextNode","replaceChild","expressionFunc","payload","_this5","makeInput","_this6","makeOutput","_this7","inputFunction","getScope","getContextByNode","_this8","traverseUp","optionalChaining","previous","tokens","split","b","params","transforms","getPipesSegments","shift","trim","reduce","transform","getPipeParamsSegments","join","debug","getAttribute","_this9","outputFunction","output$","event","segments","word","block","t","c","substr","indexOf","className","classList","has","attribute","hasAttribute","nodeName","toLowerCase","matchSelectors","results","template","innerHTML","callback","result","j","traversePrevious","previousSibling","traverseNext","nextSibling","rxcompId","rxcompNodeId","dataset","nodeContexts","index","splice","current","ClassDirective","_Directive","classFunction","add","EventDirective","event$","fromEvent","Structure","ForItem","_Context","$key","$value","count","Constructor","protoProps","staticProps","get","even","ForStructure","_Structure","forbegin","createComment","forend","insertBefore","removeAttribute","getExpressionTokens","forFunction","iterable","isArray","array","total","Math","max","clonedNode","cloneNode","forItemContext","removeChild","expressions","forExpressions","keyValueMatches","indexExpressions","IfStructure","ifbegin","ifend","ifFunction","InnerHtmlDirective","innerHtmlExpression","JsonPipe","JSON","stringify","StyleDirective","styleFunction","style","LocalStorageService","delete","isLocalStorageSupported","localStorage","removeItem","exist","set","cache","json","setItem","supported","StoreService","items","get$","store$","date","now","add$","patch","item","assign","getValue","unshift","patch$","find","delete$","AppComponent","input","onInput","$event","onAddItem","onToggleItem","done","onRemoveItem","DatePipe","locale","dateStyle","timeStyle","toLocaleDateString","colors","hex","color","alpha","r","parseInt","slice","g","TodoItemComponent","backgroundColor","onToggle","toggle","onRemove","createdInstances"],"mappings":"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","file":"docs/js/main.min.js","sourcesContent":[null,"export default class Directive {\n\n}\n\nDirective.meta = {\n\tselector: '[(directive)]',\n};\n","export default class Component {\n\n}\n\nComponent.meta = {\n\tselector: '[component]',\n};\n","// import { BehaviorSubject, Subject } from 'rxjs';\nimport Component from '../component/component';\n\nexport default class Context extends Component {\n\n\tconstructor(parent, descriptors) {\n\t\tsuper();\n\t\tconst parentPrototypeDescriptors = Object.getOwnPropertyDescriptors(Object.getPrototypeOf(parent));\n\t\tdelete parentPrototypeDescriptors.constructor;\n\t\tObject.keys(parentPrototypeDescriptors).forEach(key => {\n\t\t\tconsole.log('1', key);\n\t\t\tconst descriptor = parentPrototypeDescriptors[key];\n\t\t\tif (typeof descriptor.value == \"function\") {\n\t\t\t\tdescriptor.value = (...args) => {\n\t\t\t\t\tparent[key].apply(parent, args);\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\t// console.log('parentPrototypeDescriptors', parentPrototypeDescriptors);\n\t\tconst parentDescriptors = Object.getOwnPropertyDescriptors(parent);\n\t\tObject.keys(parentDescriptors).forEach(key => {\n\t\t\tswitch (key) {\n\t\t\t\tcase '$id':\n\t\t\t\tcase 'state$':\n\t\t\t\tcase 'unsubscribe$':\n\t\t\t\tcase 'pushState':\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.log('2', key);\n\t\t\t\t\tconst descriptor = parentDescriptors[key];\n\t\t\t\t\tif (typeof descriptor.value == \"function\") {\n\t\t\t\t\t\tdescriptor.value = (...args) => {\n\t\t\t\t\t\t\tparent[key].apply(parent, args);\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t/*\n\t\t// console.log('parentDescriptors', parentDescriptors);\n\t\tObject.defineProperties(this, Object.assign(parentPrototypeDescriptors, parentDescriptors, {\n\t\t\tstate$: {\n\t\t\t\tvalue: new BehaviorSubject(this),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t},\n\t\t\tunsubscribe$: {\n\t\t\t\tvalue: new Subject(),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t}\n\t\t}, descriptors));\n\t\t*/\n\t}\n\n\t/*\n\tpushState() {\n\t\tthis.state$.next(this);\n\t}\n\t*/\n\n}\n","import { BehaviorSubject, of , Subject } from 'rxjs';\nimport { filter, map, shareReplay, takeUntil, tap } from 'rxjs/operators';\nimport Component from '../component/component';\nimport Context from '../context/context';\n\nlet ID = 0;\nconst CONTEXTS = {};\nconst NODES = {};\n\nexport default class Module {\n\n\tconstructor(options) {\n\t\tif (!options) {\n\t\t\tthrow ('missing options');\n\t\t}\n\t\tif (!options.bootstrap) {\n\t\t\tthrow ('missing bootstrap');\n\t\t}\n\t\tthis.options = options;\n\t\tconst pipes = {};\n\t\tif (options.pipes) {\n\t\t\toptions.pipes.forEach(x => pipes[x.meta.name] = x);\n\t\t}\n\t\tthis.pipes = pipes;\n\t\tconst bootstrap = options.bootstrap;\n\t\tthis.node = document.querySelector(bootstrap.meta.selector);\n\t\tif (!this.node) {\n\t\t\tthrow (`missing node ${bootstrap.meta.selector}`);\n\t\t}\n\t\tthis.root = this.makeInstance(this.node, bootstrap, bootstrap.meta.selector, window);\n\t\tthis.selectors = Module.unwrapSelectors(options.factories);\n\t}\n\n\tuse$() {\n\t\treturn of(Module.querySelectorsAll(this.node, this.selectors, [])).pipe(\n\t\t\tfilter(matches => matches.length > 0),\n\t\t\tmap((matches) => {\n\t\t\t\treturn matches.map(match => this.makeInstance(match.node, match.factory, match.selector)).filter(x => x);\n\t\t\t}),\n\t\t\ttap(instances => instances.forEach(instance => {\n\t\t\t\t// parse component text nodes\n\t\t\t\tconst context = Module.getContext(instance);\n\t\t\t\tconst isComponent = context.factory.prototype instanceof Component;\n\t\t\t\tif (isComponent) {\n\t\t\t\t\tthis.parse(context.node, instance);\n\t\t\t\t}\n\t\t\t})),\n\t\t\tshareReplay(1)\n\t\t);\n\t}\n\n\tmakeContext(instance, parentInstance, node, selector) {\n\t\tconst context = Module.makeContext(this, instance, parentInstance, node, instance.constructor, selector);\n\t\tconsole.log('Module.makeContext', context, context.instance, context.node);\n\t\treturn context;\n\t}\n\n\tmakeInstance(node, factory, selector, parentInstance, args) {\n\t\tif (parentInstance || node.parentNode) {\n\t\t\tconst isComponent = factory.prototype instanceof Component;\n\t\t\tconst meta = factory.meta;\n\t\t\t// collect parentInstance scope\n\t\t\tparentInstance = parentInstance || this.getParentScope(node.parentNode);\n\t\t\tif (!parentInstance) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// creating factory instance\n\t\t\tconst instance = new factory(...(args || []));\n\t\t\t// injecting state$ and unsubscribe$ subjects\n\t\t\tObject.defineProperties(instance, {\n\t\t\t\tstate$: {\n\t\t\t\t\tvalue: new BehaviorSubject(instance),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t},\n\t\t\t\tunsubscribe$: {\n\t\t\t\t\tvalue: new Subject(),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t}\n\t\t\t});\n\t\t\t// injecting instance pushState method\n\t\t\tconst moduleRef = this;\n\t\t\tinstance.pushState = function() {\n\t\t\t\tif (isComponent) {\n\t\t\t\t\tmoduleRef.parse(node, instance);\n\t\t\t\t}\n\t\t\t\tthis.state$.next(this);\n\t\t\t};\n\t\t\t// creating instance context\n\t\t\tconst context = Module.makeContext(this, instance, parentInstance, node, factory, selector);\n\t\t\t// creating component input and outputs\n\t\t\tif (isComponent) {\n\t\t\t\tcontext.inputs = this.makeInputs(meta, instance);\n\t\t\t\tcontext.outputs = this.makeOutputs(meta, instance);\n\t\t\t}\n\t\t\t// calling onInit event\n\t\t\tif (typeof instance.onInit === 'function') {\n\t\t\t\tinstance.onInit();\n\t\t\t}\n\t\t\t// subscribe to parent state\n\t\t\tif (parentInstance.state$) {\n\t\t\t\tparentInstance.state$.pipe(\n\t\t\t\t\t// filter(() => node.parentNode),\n\t\t\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t\t\t).subscribe(state => {\n\t\t\t\t\t// resolve component input outputs\n\t\t\t\t\tif (isComponent) {\n\t\t\t\t\t\tthis.resolveInputsOutputs(instance, state);\n\t\t\t\t\t}\n\t\t\t\t\t// calling onState event with parentInstance\n\t\t\t\t\tif (typeof instance.onState === 'function') {\n\t\t\t\t\t\t// console.log('onState', instance.constructor.meta.selector, state);\n\t\t\t\t\t\tinstance.onState(state);\n\t\t\t\t\t}\n\t\t\t\t\t// push instance state for subscribers\n\t\t\t\t\tinstance.pushState();\n\t\t\t\t});\n\t\t\t}\n\t\t\t/*\n\t\t\t// parse component text nodes\n\t\t\tif (isComponent) {\n\t\t\t\tthis.parse(node, instance);\n\t\t\t}\n\t\t\t*/\n\t\t\treturn instance;\n\t\t}\n\t}\n\n\tremove(node) {\n\t\tconst ids = [];\n\t\tModule.traverseDown(node, (node) => {\n\t\t\tfor (let [id, context] of Object.entries(CONTEXTS)) {\n\t\t\t\tif (context.node === node) {\n\t\t\t\t\tconst instance = context.instance;\n\t\t\t\t\tinstance.unsubscribe$.next();\n\t\t\t\t\tinstance.unsubscribe$.complete();\n\t\t\t\t\tif (typeof instance.onDestroy === 'function') {\n\t\t\t\t\t\tinstance.onDestroy();\n\t\t\t\t\t}\n\t\t\t\t\tids.push(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tids.forEach(id => Module.deleteContext(id));\n\t\t// console.log('Module.remove', ids);\n\t\treturn node;\n\t}\n\n\tcompile(node, context) {\n\t\tconsole.log('Module.compile', context);\n\t\tconst matches = Module.querySelectorsAll(node, this.selectors, []);\n\t\tconst instances = matches.map(match => {\n\t\t\tconst instance = this.makeInstance(match.node, match.factory, match.selector, context ? context.instance : undefined);\n\t\t\tif (match.factory.prototype instanceof Component) {\n\t\t\t\tcontext = undefined; // !!!\n\t\t\t}\n\t\t\treturn instance;\n\t\t}).filter(x => x !== undefined);\n\t\treturn instances;\n\t}\n\n\tevaluate(text, instance) {\n\t\tconst parse_eval_ = (...args) => {\n\t\t\tconst expression = args[1];\n\t\t\t// console.log('expression', expression);\n\t\t\tconst parse_func_ = this.makeFunction(expression);\n\t\t\treturn this.resolve(parse_func_, instance, instance);\n\t\t};\n\t\t// console.log(text);\n\t\treturn text.replace(/\\{{2}(?!\\{)(.*?\\}*)\\}{2}/g, parse_eval_);\n\t}\n\n\tparse(node, instance) {\n\t\t// console.log('node', node.childNodes.length, node);\n\t\t/*\n\t\tif (node.hasAttribute('[innerHTML]')) {\n\t\t\tconst innerHTML = `{{${node.getAttribute('[innerHTML]')}}}`;\n\t\t\tnode.innerHTML = parse_replace_(innerHTML);\n\t\t} else if (node.hasAttribute('innerHTML')) {\n\t\t\tconst innerHTML = node.getAttribute('innerHTML');\n\t\t\tnode.innerHTML = parse_replace_(innerHTML);\n\t\t} else {\n\t\t\t// childNodes\n\t\t}\n\t\t*/\n\t\t// console.log(node, instance);\n\t\tfor (let i = 0; i < node.childNodes.length; i++) {\n\t\t\tconst child = node.childNodes[i];\n\t\t\tif (child.nodeType === 1) {\n\t\t\t\tthis.parse(child, instance);\n\t\t\t} else if (child.nodeType === 3) {\n\t\t\t\tconst text = child.nodeValue;\n\t\t\t\tconst replacedText = this.evaluate(text, instance);\n\t\t\t\tif (text !== replacedText) {\n\t\t\t\t\t// !!! save in var\n\t\t\t\t\t// node.setAttribute('innerHTML', text);\n\t\t\t\t\tconst textNode = document.createTextNode(replacedText);\n\t\t\t\t\tnode.replaceChild(textNode, child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tresolve(expressionFunc, state, payload) {\n\t\treturn expressionFunc.apply(state, [payload, this]);\n\t}\n\n\tmakeInputs(meta, instance) {\n\t\tconst inputs = {};\n\t\tif (meta.inputs) {\n\t\t\tmeta.inputs.forEach((key, i) => inputs[key] = this.makeInput(instance, key));\n\t\t}\n\t\treturn inputs;\n\t}\n\n\tmakeOutputs(meta, instance) {\n\t\tconst outputs = {};\n\t\tif (meta.outputs) {\n\t\t\tmeta.outputs.forEach((key, i) => outputs[key] = this.makeOutput(instance, key));\n\t\t}\n\t\treturn outputs;\n\t}\n\n\tresolveInputsOutputs(instance, state) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst inputs = context.inputs;\n\t\tObject.keys(inputs).forEach(key => {\n\t\t\tconst inputFunction = inputs[key];\n\t\t\tconst value = this.resolve(inputFunction, parentInstance, instance);\n\t\t\tinstance[key] = value;\n\t\t});\n\t\t/*\n\t\tconst outputs = context.outputs;\n\t\tObject.keys(outputs).forEach(key => {\n\t\t\tconst inpuoutputFunctiontFunction = outputs[key];\n\t\t\tconst value = this.resolve(outputFunction, parentInstance, null);\n\t\t\t// console.log(`setted -> ${key}`, value);\n\t\t});\n\t\t*/\n\t}\n\n\tgetScope(node) {\n\t\tif (node === document) {\n\t\t\treturn window;\n\t\t}\n\t\tconst context = Module.getContextByNode(node);\n\t\tif (context) {\n\t\t\treturn context.instance;\n\t\t}\n\t}\n\n\tgetParentScope(node) {\n\t\treturn Module.traverseUp(node, (node) => {\n\t\t\treturn this.getScope(node);\n\t\t});\n\t}\n\n\t//\n\n\toptionalChaining(expression) {\n\t\tconst regex = /(\\w+(\\?\\.))+([\\.|\\w]+)/g;\n\t\tlet previous;\n\t\texpression = expression.replace(regex, (...args) => {\n\t\t\tconst tokens = args[0].split('?.');\n\t\t\tfor (let i = 0; i < tokens.length - 1; i++) {\n\t\t\t\tconst a = i > 0 ? `(${tokens[i]} = ${previous})` : tokens[i];\n\t\t\t\tconst b = tokens[i + 1];\n\t\t\t\tprevious = i > 0 ? `${a}.${b}` : `(${a} ? ${a}.${b} : void 0)`;\n\t\t\t\t// log(previous);\n\t\t\t}\n\t\t\treturn previous || '';\n\t\t});\n\t\treturn expression;\n\t}\n\n\tmakeFunction(expression, params = ['$instance']) {\n\t\tif (!expression) {\n\t\t\treturn () => { return null; };\n\t\t}\n\t\tconst pipes = this.pipes;\n\t\tconst transforms = Module.getPipesSegments(expression);\n\t\texpression = transforms.shift().trim();\n\t\texpression = this.optionalChaining(expression);\n\t\t// console.log('expression', \"${expression}\", ${params.join(',')}, this);\n\t\t// return expression_func;\n\t\t// console.log(pipes, transforms, expression);\n\t\t// console.log(transforms.length, params);\n\t\tparams.push('module');\n\t\t// keyword 'this' represents state from func.apply(state, instance)\n\t\tif (transforms.length) {\n\t\t\texpression = transforms.reduce((expression, transform, i) => {\n\t\t\t\tconst params = Module.getPipeParamsSegments(transform);\n\t\t\t\tconst name = params.shift().trim();\n\t\t\t\tconst pipe = pipes[name];\n\t\t\t\tif (!pipe || typeof pipe.transform !== 'function') {\n\t\t\t\t\tthrow (`missing pipe ${name}`);\n\t\t\t\t}\n\t\t\t\treturn `pipes.${name}.transform(${expression},${params.join(',')})`;\n\t\t\t}, expression);\n\t\t\t// console.log('expression', expression);\n\t\t\tconst expression_func = new Function(`with(this) {\n\t\t\t\treturn (function (${params.join(',')}) {\n\t\t\t\t\tconst pipes = module.pipes;\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t} else {\n\t\t\t// console.log('expression', expression);\n\t\t\tconst expression_func = new Function(this.options.debug ? `with(this) {\n\t\t\t\treturn (function (${params.join(',')}) {\n\t\t\t\t\tlet value;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = ${expression};\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error('${expression.replace(/\\'/g,'\"')}', this);\n\t\t\t\t\t\tvalue = e.message;\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}` : `with(this) {\n\t\t\t\treturn (function (${params.join(',')}) {\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t}\n\t}\n\n\tmakeInput(instance, name) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute(`[${name}]`);\n\t\treturn this.makeFunction(expression);\n\t}\n\n\tmakeOutput(instance, name) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst node = context.node;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst expression = node.getAttribute(`(${name})`);\n\t\tconst outputFunction = this.makeFunction(expression, ['$event']);\n\t\tconst output$ = new Subject().pipe(\n\t\t\ttap((event) => {\n\t\t\t\tthis.resolve(outputFunction, parentInstance, event);\n\t\t\t})\n\t\t);\n\t\toutput$.pipe(\n\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t).subscribe();\n\t\tinstance[name] = output$;\n\t\treturn outputFunction;\n\t}\n\n\tstatic getPipesSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === '|' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic getPipeParamsSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === ':' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic unwrapSelectors(factories) {\n\t\tconst selectors = [];\n\t\tfactories.forEach(factory => {\n\t\t\tfactory.meta.selector.split(',').forEach(selector => {\n\t\t\t\tselector = selector.trim();\n\t\t\t\tif (selector.indexOf('.') === 0) {\n\t\t\t\t\tconst className = selector.replace(/\\./g, '');\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.classList.has(className);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else if (selector.match(/\\[(.+)\\]/)) {\n\t\t\t\t\tconst attribute = selector.substr(1, selector.length - 2);\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.hasAttribute(attribute);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.nodeName.toLowerCase() === selector.toLowerCase();\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn selectors;\n\t}\n\n\tstatic matchSelectors(node, selectors, results) {\n\t\tselectors.forEach(selector => {\n\t\t\tconst match = selector(node);\n\t\t\tif (match) {\n\t\t\t\tconst factory = match.factory;\n\t\t\t\tif (factory.prototype instanceof Component && factory.meta.template) {\n\t\t\t\t\tnode.innerHTML = factory.meta.template;\n\t\t\t\t}\n\t\t\t\tresults.push(match);\n\t\t\t}\n\t\t});\n\t\treturn results;\n\t}\n\n\tstatic querySelectorsAll(node, selectors, results) {\n\t\tif (node.nodeType === 1) {\n\t\t\tresults = this.matchSelectors(node, selectors, results);\n\t\t}\n\t\tconst childNodes = node.childNodes;\n\t\tif (childNodes) {\n\t\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\t\tresults = this.querySelectorsAll(childNodes[i], selectors, results);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic traverseUp(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseUp(node.parentNode, callback, i + 1);\n\t}\n\n\tstatic traverseDown(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tlet result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tif (node.nodeType === 1) {\n\t\t\tlet j = 0,\n\t\t\t\tt = node.childNodes.length;\n\t\t\twhile (j < t && !result) {\n\t\t\t\tresult = this.traverseDown(node.childNodes[j], callback, i + 1);\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic traversePrevious(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traversePrevious(node.previousSibling, callback, i + 1);\n\t}\n\n\tstatic traverseNext(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseNext(node.nextSibling, callback, i + 1);\n\t}\n\n\tstatic use$(options) {\n\t\t/*\n\t\tif (!options.factories) {\n\t\t\toptions.factories = [\n\t\t\t\tClassDirective,\n\t\t\t\tEventDirective,\n\t\t\t\tIfStructure,\n\t\t\t\tForStructure,\n\t\t\t\tStyleDirective\n\t\t\t];\n\t\t}\n\t\tif (!options.pipes) {\n\t\t\toptions.pipes = [\n\t\t\t\tJsonPipe\n\t\t\t];\n\t\t}\n\t\t*/\n\t\treturn new Module(options).use$();\n\t}\n\n\tstatic getContext(instance) {\n\t\treturn CONTEXTS[instance.rxcompId];\n\t}\n\n\tstatic makeContext(module, instance, parentInstance, node, factory, selector) {\n\t\tinstance.rxcompId = ++ID;\n\t\tconst context = { module, instance, parentInstance, node, factory, selector };\n\t\tconst rxcompNodeId = node.dataset.rxcompId = (node.dataset.rxcompId || ++ID);\n\t\tconst nodeContexts = NODES[rxcompNodeId] || (NODES[rxcompNodeId] = []);\n\t\tnodeContexts.push(context);\n\t\treturn CONTEXTS[instance.rxcompId] = context;\n\t}\n\n\tstatic deleteContext(id) {\n\t\tconst context = CONTEXTS[id];\n\t\tconst nodeContexts = NODES[context.node.dataset.id];\n\t\tconst index = nodeContexts.indexOf(context);\n\t\tif (index !== -1) {\n\t\t\tnodeContexts.splice(index, 1);\n\t\t}\n\t\tdelete CONTEXTS[id];\n\t}\n\n\tstatic getContextByNode(node) {\n\t\tlet context;\n\t\tconst nodeContexts = NODES[node.dataset.rxcompId];\n\t\tif (nodeContexts) {\n\t\t\tcontext = nodeContexts.reduce((previous, current) => {\n\t\t\t\tif (current.node === node && current.factory.prototype instanceof Component) {\n\t\t\t\t\tif (previous && current.factory.prototype instanceof Context) {\n\t\t\t\t\t\treturn previous;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn current;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn previous;\n\t\t\t\t}\n\t\t\t}, null);\n\t\t}\n\t\treturn context;\n\t\t/*\n\t\tconst context = Object.keys(CONTEXTS).reduce((previous, id) => {\n\t\t\tconst current = CONTEXTS[id];\n\t\t\tif (current.node === node && current.factory.prototype instanceof Component) {\n\t\t\t\tif (previous && current.factory.prototype instanceof Context) {\n\t\t\t\t\treturn previous;\n\t\t\t\t} else {\n\t\t\t\t\treturn current;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn previous;\n\t\t\t}\n\t\t}, null);\n\t\t\treturn context;\n\t\t*/\n\t\t/*\n\t\tlet id = Object.keys(CONTEXTS).find(id => CONTEXTS[id].node === node && CONTEXTS[id].factory.prototype instanceof Component);\n\t\tif (id) {\n\t\t\tconst context = CONTEXTS[id];\n\t\t\treturn context;\n\t\t}\n\t\t*/\n\t}\n\n}\n","import Directive from '../directive/directive';\nimport Module from '../module/module';\n\nexport default class ClassDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[class]');\n\t\tthis.classFunction = module.makeFunction(expression);\n\t\t// this.classList = [...node.classList.keys()];\n\t\t// console.log('ClassDirective.onInit', this.classList, expression);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst classList = module.resolve(this.classFunction, state, this);\n\t\tObject.keys(classList).forEach(key => {\n\t\t\tif (classList[key]) {\n\t\t\t\tnode.classList.add(key);\n\t\t\t} else {\n\t\t\t\tnode.classList.remove(key);\n\t\t\t}\n\t\t});\n\t\t// console.log('ClassDirective.onState', classList);\n\t}\n\n}\n\nClassDirective.meta = {\n\tselector: `[[class]]`,\n};\n","import { fromEvent } from 'rxjs';\nimport { shareReplay, takeUntil } from 'rxjs/operators';\nimport Directive from '../directive/directive';\nimport Module from '../module/module';\n\nconst EVENTS = ['click', 'mousedown', 'mouseup', 'touchstart', 'touchmove', 'touchend', 'keydown', 'keyup', 'input', 'change', 'loaded'];\n\nexport default class EventDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst event = this.event = selector.replace(/\\[|\\]|\\(|\\)/g, '');\n\t\tconst event$ = this.event$ = fromEvent(node, event).pipe(shareReplay(1));\n\t\tconst expression = node.getAttribute(`(${event})`);\n\t\tif (expression) {\n\t\t\tconst outputFunction = module.makeFunction(expression, ['$event']);\n\t\t\tevent$.pipe(\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(event => {\n\t\t\t\t// console.log(parentInstance);\n\t\t\t\tmodule.resolve(outputFunction, parentInstance, event);\n\t\t\t});\n\t\t} else {\n\t\t\tparentInstance[`${event}$`] = event$;\n\t\t}\n\t\t// console.log('EventDirective.onInit', 'selector', selector, 'event', event);\n\t}\n\n}\n\nEventDirective.meta = {\n\tselector: `[(${EVENTS.join(')],[(')})]`,\n};\n","export default class Structure {\n\n}\n\nStructure.meta = {\n\tselector: '[(directive)]',\n};\n","import Context from '../context/context';\n// import Component from '../component/component';\n\nexport default class ForItem extends Context {\n\n\t// !!! try with payload options { key, $key, value, $value, index, count } or use onInit()\n\n\tconstructor(key, $key, value, $value, index, count, parentInstance) {\n\t\t// console.log(key, $key, value, $value);\n\t\tsuper(parentInstance);\n\t\t/*\n\t\tsuper(parentInstance, {\n\t\t\t[key]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$key;\n\t\t\t\t},\n\t\t\t\tset: function(key) {\n\t\t\t\t\tthis.$key = key;\n\t\t\t\t}\n\t\t\t},\n\t\t\t[value]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\tthis.$value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t*/\n\t\tthis[key] = $key;\n\t\tthis[value] = $value;\n\t\tthis.index = index;\n\t\tthis.count = count;\n\t}\n\n\tget first() { return this.index === 0; }\n\n\tget last() { return this.index === this.count - 1; }\n\n\tget even() { return this.index % 2 === 0; }\n\n\tget odd() { return !this.even; }\n\n}\n","import Component from '../component/component';\nimport Module from '../module/module';\nimport Structure from '../structure/structure';\nimport ForItem from './for.item';\n\nexport default class ForStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst forbegin = this.forbegin = document.createComment(`*for begin`);\n\t\tnode.parentNode.replaceChild(forbegin, node);\n\t\tconst forend = this.forend = document.createComment(`*for end`);\n\t\tforbegin.parentNode.insertBefore(forend, forbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*for');\n\t\tnode.removeAttribute('*for');\n\t\tconst tokens = this.tokens = this.getExpressionTokens(expression);\n\t\tthis.forFunction = module.makeFunction(tokens.iterable);\n\t\tthis.instances = [];\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\t// resolve\n\t\tconst tokens = this.tokens;\n\t\tlet result = module.resolve(this.forFunction, state, this) || [];\n\t\tconst isArray = Array.isArray(result);\n\t\tconst array = isArray ? result : Object.keys(result);\n\t\tconst total = array.length;\n\t\tconst previous = this.instances.length;\n\t\tlet nextSibling = this.forbegin.nextSibling;\n\t\tfor (let i = 0; i < Math.max(previous, total); i++) {\n\t\t\tif (i < total) {\n\t\t\t\tconst key = isArray ? i : array[i];\n\t\t\t\tconst value = isArray ? array[key] : result[key];\n\t\t\t\tif (i < previous) {\n\t\t\t\t\t// update\n\t\t\t\t\tconst clonedNode = nextSibling;\n\t\t\t\t\tconst instance = this.instances[i];\n\t\t\t\t\tinstance[tokens.key] = key;\n\t\t\t\t\tinstance[tokens.value] = value;\n\t\t\t\t\tinstance.pushState();\n\t\t\t\t\tmodule.parse(clonedNode, instance);\n\t\t\t\t\tnextSibling = nextSibling.nextSibling;\n\t\t\t\t} else {\n\t\t\t\t\t// create\n\t\t\t\t\tconst clonedNode = node.cloneNode(true);\n\t\t\t\t\tthis.forend.parentNode.insertBefore(clonedNode, this.forend);\n\t\t\t\t\tconst args = [tokens.key, key, tokens.value, value, i, total, context.parentInstance]; // !!! context.parentInstance unused?\n\t\t\t\t\tconst instance = module.makeInstance(clonedNode, ForItem, context.selector, context.parentInstance, args);\n\t\t\t\t\tconst forItemContext = Module.getContext(instance);\n\t\t\t\t\t// const instance = new ForItem(tokens.key, key, tokens.value, value, i, total, context.parentInstance);\n\t\t\t\t\t// const forItemContext = module.makeContext(instance, context.parentInstance, clonedNode, context.selector);\n\t\t\t\t\tconst instances = module.compile(clonedNode, forItemContext);\n\t\t\t\t\tconsole.log(instances.length, instances.filter(x => x.constructor instanceof Component).length);\n\t\t\t\t\tmodule.parse(clonedNode, instance);\n\t\t\t\t\tnextSibling = clonedNode.nextSibling;\n\t\t\t\t\tthis.instances.push(instance);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// remove\n\t\t\t\tconst instance = this.instances[i];\n\t\t\t\tconst context = Module.getContext(instance);\n\t\t\t\tconst node = context.node;\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\tmodule.remove(node);\n\t\t\t}\n\t\t}\n\t\tthis.instances.length = array.length;\n\t\t// console.log(this.instances, tokens);\n\t}\n\n\tgetExpressionTokens(expression) {\n\t\tif (expression === null) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tif (expression.trim().indexOf('let ') === -1 || expression.trim().indexOf(' of ') === -1) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tconst expressions = expression.split(';').map(x => x.trim()).filter(x => x !== '');\n\t\tconst forExpressions = expressions[0].split(' of ').map(x => x.trim());\n\t\tlet value = forExpressions[0].replace(/\\s*let\\s*/, '');\n\t\tconst iterable = forExpressions[1];\n\t\tlet key = 'index';\n\t\tconst keyValueMatches = value.match(/\\[(.+)\\s*,\\s*(.+)\\]/);\n\t\tif (keyValueMatches) {\n\t\t\tkey = keyValueMatches[1];\n\t\t\tvalue = keyValueMatches[2];\n\t\t}\n\t\tif (expressions.length > 1) {\n\t\t\tconst indexExpressions = expressions[1].split(/\\s*let\\s*|\\s*=\\s*index/).map(x => x.trim());\n\t\t\tif (indexExpressions.length === 3) {\n\t\t\t\tkey = indexExpressions[1];\n\t\t\t}\n\t\t}\n\t\treturn { key, value, iterable };\n\t}\n\n\t/*\n\tonState_unoptimized(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst tokens = this.tokens;\n\t\twhile (this.forbegin.nextSibling !== this.forend) {\n\t\t\tconst nextSibling = this.forbegin.nextSibling;\n\t\t\tthis.forbegin.parentNode.removeChild(nextSibling);\n\t\t\tmodule.remove(nextSibling);\n\t\t}\n\t\tconst array = module.resolve(this.forFunction, state, this).map((value, index, array) => {\n\t\t\tconst item = new ForItem(tokens.key, index, tokens.value, value, array, this.parent);\n\t\t\tconst clonedNode = node.cloneNode(true);\n\t\t\tthis.forend.parentNode.insertBefore(clonedNode, this.forend);\n\t\t\tconst instances = module.compile(clonedNode, item);\n\t\t\tmodule.parse(clonedNode, item);\n\t\t\treturn item;\n\t\t});\n\t\t// console.log('ForStructure.onState', array);\n\t}\n\t*/\n\n}\n\nForStructure.meta = {\n\tselector: '[*for]',\n};\n","import Module from '../module/module';\nimport Structure from '../structure/structure';\n\nexport default class IfStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst ifbegin = this.ifbegin = document.createComment(`*if begin`);\n\t\tnode.parentNode.replaceChild(ifbegin, node);\n\t\tconst ifend = this.ifend = document.createComment(`*if end`);\n\t\tifbegin.parentNode.insertBefore(ifend, ifbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*if');\n\t\tthis.expression = expression;\n\t\tthis.ifFunction = module.makeFunction(expression);\n\t\tconst clonedNode = node.cloneNode(true);\n\t\tclonedNode.removeAttribute('*if');\n\t\tthis.clonedNode = clonedNode;\n\t\t// console.log('expression', expression);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\t// console.log('IfStructure.onState', state, this.expression);\n\t\tconst value = module.resolve(this.ifFunction, state, this);\n\t\tif (value) {\n\t\t\tif (!this.clonedNode.parentNode) {\n\t\t\t\tthis.ifend.parentNode.insertBefore(this.clonedNode, this.ifend);\n\t\t\t\tmodule.compile(this.clonedNode);\n\t\t\t\tmodule.parse(this.clonedNode, state);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.clonedNode.parentNode) {\n\t\t\t\tthis.clonedNode.parentNode.removeChild(this.clonedNode);\n\t\t\t\tmodule.remove(this.clonedNode);\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nIfStructure.meta = {\n\tselector: '[*if]',\n};\n","import Directive from '../directive/directive';\nimport Module from '../module/module';\n\nexport default class InnerHtmlDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst key = selector.replace(/\\[(.+)\\]/, (...matches) => {\n\t\t\treturn matches[1];\n\t\t});\n\t\tlet expression = node.getAttribute(key);\n\t\tif (!expression) {\n\t\t\tthrow (`invalid ${key}`);\n\t\t}\n\t\tif (key === '[innerHTML]') {\n\t\t\texpression = `{{${expression}}}`;\n\t\t}\n\t\tthis.innerHtmlExpression = expression;\n\t\tconsole.log('InnerHtmlDirective.onInit', node, expression, key);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst innerHTML = context.module.evaluate(this.innerHtmlExpression, state);\n\t\tconst node = context.node;\n\t\tnode.innerHTML = innerHTML;\n\t\t// console.log('InnerHtmlDirective.onState', innerHTML);\n\t}\n\n}\n\nInnerHtmlDirective.meta = {\n\tselector: `[[innerHTML]],[innerHTML]`\n};\n","export default class JsonPipe {\n\n\tstatic transform(value) {\n\t\treturn JSON.stringify(value);\n\t}\n\n}\n\nJsonPipe.meta = {\n\tname: 'json',\n};\n","import Directive from '../directive/directive';\nimport Module from '../module/module';\n\nexport default class StyleDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[style]');\n\t\tthis.styleFunction = module.makeFunction(expression);\n\t\t// console.log('StyleDirective.onInit', expression);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst style = module.resolve(this.styleFunction, state, this);\n\t\tObject.keys(style).forEach(key => {\n\t\t\tnode.style[key] = style[key];\n\t\t});\n\t\t// console.log('StyleDirective.onState', state, style);\n\t}\n\n}\n\nStyleDirective.meta = {\n\tselector: `[[style]]`\n};\n","export default class LocalStorageService {\n\n\tstatic delete(name) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\twindow.localStorage.removeItem(name);\n\t\t}\n\t}\n\n\tstatic exist(name) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\treturn window.localStorage[name] !== undefined;\n\t\t}\n\t}\n\n\tstatic get(name) {\n\t\tlet value = null;\n\t\tif (this.isLocalStorageSupported() && window.localStorage[name] !== undefined) {\n\t\t\ttry {\n\t\t\t\tvalue = JSON.parse(window.localStorage[name]);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorageService.get.error parsing', name, e);\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t}\n\n\tstatic set(name, value) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\ttry {\n\t\t\t\tconst cache = [];\n\t\t\t\tconst json = JSON.stringify(value, function(key, value) {\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\twindow.localStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorageService.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic isLocalStorageSupported() {\n\t\tif (this.supported) {\n\t\t\treturn true;\n\t\t}\n\t\tlet supported = false;\n\t\ttry {\n\t\t\tsupported = 'localStorage' in window && window.localStorage !== null;\n\t\t\tif (supported) {\n\t\t\t\twindow.localStorage.setItem('test', '1');\n\t\t\t\twindow.localStorage.removeItem('test');\n\t\t\t} else {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsupported = false;\n\t\t}\n\t\tthis.supported = supported;\n\t\treturn supported;\n\t}\n\n}\n","import { BehaviorSubject, of } from 'rxjs';\nimport LocalStorageService from '../local-storage/local-storage.service';\n\nexport default class StoreService {\n\n\tstatic set(items) {\n\t\tLocalStorageService.set('items', items);\n\t\treturn this.get$().next(items);\n\t}\n\n\tstatic get$() {\n\t\tif (this.store$) {\n\t\t\treturn this.store$;\n\t\t}\n\t\tlet items = LocalStorageService.get('items');\n\t\tif (!items) {\n\t\t\titems = [\n\t\t\t\t{ id: 3, name: 'cookies', date: new Date(Date.now()) },\n\t\t\t\t{ id: 2, name: 'pizza', date: new Date(2019, 3, 22, 12) },\n\t\t\t\t{ id: 1, name: 'bread', date: new Date(2019, 0, 6, 12) },\n\t\t\t];\n\t\t\tLocalStorageService.set('items', items);\n\t\t}\n\t\treturn this.store$ = new BehaviorSubject(items);\n\t}\n\n\tstatic add$(patch) {\n\t\tconst item = Object.assign({\n\t\t\tid: Date.now(),\n\t\t\tdate: new Date(Date.now())\n\t\t}, patch);\n\t\tconst items = this.store$.getValue();\n\t\titems.unshift(item);\n\t\tthis.set(items);\n\t\treturn of(item);\n\t}\n\n\tstatic patch$(patch) {\n\t\tconst items = this.store$.getValue();\n\t\tconst item = items.find(x => x.id === patch.id);\n\t\tif (item) {\n\t\t\tObject.assign(item, patch);\n\t\t\tthis.set(items);\n\t\t}\n\t\treturn of(item);\n\t}\n\n\tstatic delete$(item) {\n\t\tconst items = this.store$.getValue();\n\t\tconst index = items.indexOf(item);\n\t\tif (index !== -1) {\n\t\t\titems.splice(index, 1);\n\t\t\tthis.set(items);\n\t\t}\n\t\treturn of(item);\n\t}\n\n}\n","/*\nimport { fromEvent } from 'rxjs';\nimport { auditTime, distinctUntilChanged, map, takeUntil } from 'rxjs/operators';\n*/\nimport { takeUntil } from 'rxjs/operators';\nimport { Component, Module } from '../../lib/rxcomp';\nimport StoreService from './store/store.service';\n\nexport default class AppComponent extends Component {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tthis.input = context.node.querySelector('.control--text');\n\t\tthis.items = [];\n\t\tthis.store$ = StoreService.get$();\n\t\tthis.store$.pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe(items => {\n\t\t\t// console.log('AppComponent.store$', items);\n\t\t\tthis.items = items;\n\t\t\tthis.pushState();\n\t\t});\n\t\t/*\n\t\tthis.input$().pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe(input => {\n\t\t\t// console.log(input);\n\t\t\tthis.input = input;\n\t\t});\n\t\t*/\n\t\t// console.log('AppComponent', Object.keys(this).join(','));\n\t}\n\n\t/*\n\tinput$() {\n\t\tconst context = Module.getContext(this);\n\t\tconst input = context.node.querySelector('.control--text');\n\t\treturn fromEvent(input, 'input').pipe(\n\t\t\tmap(event => input.value),\n\t\t\tauditTime(200),\n\t\t\tdistinctUntilChanged()\n\t\t);\n\t}\n\t*/\n\n\tonInput($event) {\n\t\t// console.log('AppComponent.onInput', $event, this);\n\t\tthis.pushState();\n\t}\n\n\tonAddItem($event) {\n\t\tif (this.input.value) {\n\t\t\tStoreService.add$({\n\t\t\t\tname: this.input.value,\n\t\t\t}).subscribe(item => {\n\t\t\t\t// console.log('AppComponent.onAddItem', item);\n\t\t\t\tthis.input.value = null;\n\t\t\t});\n\t\t}\n\t}\n\n\tonToggleItem(item) {\n\t\tStoreService.patch$({\n\t\t\tid: item.id,\n\t\t\tdone: !item.done,\n\t\t}).subscribe(item => {\n\t\t\t// console.log('AppComponent.onToggleItem', item);\n\t\t});\n\t}\n\n\tonRemoveItem(item) {\n\t\tStoreService.delete$(item).subscribe(item => {\n\t\t\t// console.log('AppComponent.onRemoveItem', item);\n\t\t});\n\t}\n\n}\n\nAppComponent.meta = {\n\tselector: '[app-component]',\n};\n","\n\nexport default class DatePipe {\n\n\tstatic transform(value, locale = 'it-IT-u-ca-gregory', options = {\n\t\tdateStyle: 'short',\n\t\ttimeStyle: 'short',\n\t}) {\n\t\treturn new Date(value).toLocaleDateString(locale, options);\n\t}\n\n}\n\nDatePipe.meta = {\n\tname: 'date',\n};\n","export const colors = [\n\t{ hex: '#073B4C' },\n\t{ hex: '#EF476F' },\n\t{ hex: '#1CCC9D' },\n\t{ hex: '#118AB2' },\n\t{ hex: '#EFC156' },\n];\n\nexport function hexToInt(hex) {\n\treturn parseInt(hex.replace(/^#/, ''), 16);\n}\n\nexport function randomHex() {\n\treturn colors[Math.floor(Math.random() * colors.length)].hex;\n}\n\nexport function randomColor() {\n\tconst hex = randomHex();\n\treturn hexToInt(hex);\n}\n\nexport function color(index, alpha) {\n\treturn hexToRgb(colors[index % colors.length].hex, alpha);\n}\n\nlet index = -1;\n\nexport function nextHex() {\n\tindex++;\n\treturn colors[index % colors.length].hex;\n}\n\nexport function nextColor() {\n\tconst hex = nextHex();\n\treturn hexToInt(hex);\n}\n\nexport function hexToRgb(hex, a) {\n\tconst r = parseInt(hex.slice(1, 3), 16);\n\tconst g = parseInt(hex.slice(3, 5), 16);\n\tconst b = parseInt(hex.slice(5, 7), 16);\n\tif (a) {\n\t\treturn `rgba(${r},${g},${b},${a})`;\n\t} else {\n\t\treturn `rgb(${r},${g},${b})`;\n\t}\n}\n","import Component from '../../../lib/component/component';\nimport { color } from '../colors/colors';\n\nexport default class TodoItemComponent extends Component {\n\n\tonState(state) {\n\t\t// console.log('onState', state);\n\t\tthis.backgroundColor = color(this.item.id, 0.15);\n\t\tthis.color = color(this.item.id);\n\t}\n\n\tonToggle($event) {\n\t\t// console.log('onToggle', $event);\n\t\tthis.toggle.next($event);\n\t}\n\n\tonRemove($event) {\n\t\t// console.log('onRemove', $event);\n\t\tthis.remove.next($event);\n\t}\n\n}\n\nTodoItemComponent.meta = {\n\tselector: '[todo-item-component]',\n\tinputs: ['item'],\n\toutputs: ['toggle', 'remove'],\n\ttemplate: /* html */ `\n\t\t<button type=\"button\" class=\"btn--toggle\" [style]=\"{ color: color }\" (click)=\"onToggle(item)\">\n\t\t\t<i class=\"icon--check\" *if=\"item.done\"></i>\n\t\t\t<i class=\"icon--circle\" *if=\"!item.done\"></i>\n\t\t</button>\n\t\t<div class=\"title\" [style]=\"{ color: color }\" [innerHTML]=\"item.name\"></div>\n\t\t<div class=\"date\" [style]=\"{ background: backgroundColor, color: color }\" [innerHTML]=\"item.date | date : 'en-US' : { month: 'short', day: '2-digit', year: 'numeric' }\"></div>\n\t\t<button type=\"button\" class=\"btn--remove\" [style]=\"{ color: color }\" (click)=\"onRemove(item)\"><i class=\"icon--remove\"></i></button>\n\t`,\n};\n","import { ClassDirective, EventDirective, ForStructure, IfStructure, InnerHtmlDirective, JsonPipe, Module, StyleDirective } from '../../lib/rxcomp';\nimport AppComponent from './app.component';\nimport DatePipe from './date/date.pipe';\nimport TodoItemComponent from './todo-item/todo-item.component';\n\nModule.use$({\n\tfactories: [\n\t\tClassDirective,\n\t\tEventDirective,\n\t\tForStructure,\n\t\tIfStructure,\n\t\tInnerHtmlDirective,\n\t\tStyleDirective,\n\t\tTodoItemComponent,\n\t],\n\tpipes: [\n\t\tDatePipe,\n\t\tJsonPipe,\n\t],\n\tbootstrap: AppComponent,\n}).subscribe(createdInstances => {\n\t// console.log('createdInstances', createdInstances);\n});\n"]}