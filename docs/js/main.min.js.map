{"version":3,"sources":["docs/js/main.js","../../lib/directive/directive.js","../../lib/component/component.js","../../lib/module/module.js","../../lib/class/class.directive.js","../../lib/event/event.directive.js","../../lib/structure/structure.js","../../lib/for/for.item.js","../../lib/context/context.js","../../lib/for/for.structure.js","../../lib/if/if.structure.js","../../lib/json/json.pipe.js","../../lib/style/style.directive.js","../../src/js/local-storage/local-storage.service.js","../../src/js/store/store.service.js","../../src/js/app.component.js","../../src/js/date/date.pipe.js","../../src/js/colors/colors.js","../../src/js/todo-item/todo-item.component.js","../../src/js/main.js"],"names":["global","factory","exports","module","require","define","amd","self","rxjs","operators","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","Directive","meta","selector","Component","ID","CONTEXTS","Module","options","bootstrap","pipes","forEach","x","name","root","makeInstance","document","querySelector","selectors","unwrapSelectors","factories","_proto","use$","_this","of","querySelectorsAll","pipe","filter","matches","map","match","node","shareReplay","parentInstance","_this2","parentNode","isComponent","getParentScope","instance","defineProperties","state$","value","BehaviorSubject","unsubscribe$","Subject","pushState","next","context","setContext","inputs","makeInputs","outputs","makeOutputs","onInit","takeUntil","subscribe","state","resolveInputsOutputs","parse","remove","ids","traverseDown","_i","_Object$entries","entries","_Object$entries$_i","id","complete","onDestroy","push","compile","parent","_this3","$id","undefined","_this4","parse_eval_","expression","arguments","parse_func_","makeFunction","resolve","parse_replace_","text","replace","RegExp","hasAttribute","innerHTML","getAttribute","childNodes","child","nodeType","nodeValue","replacedText","setAttribute","textNode","createTextNode","replaceChild","onParse","scope","expressionFunc","payload","apply","_this5","makeInput","_this6","makeOutput","_this7","getContext","keys","inputFunction","getScope","window","getComponentInstanceByNode","_this8","traverseUp","onState","optionalChaining","previous","_len","args","Array","_key","tokens","split","a","b","params","transforms","getPipesSegments","shift","trim","reduce","transform","getPipeParamsSegments","join","Function","debug","_this9","outputFunction","output$","tap","event","contexts_","segments","word","block","t","c","substr","indexOf","className","classList","has","attribute","nodeName","toLowerCase","matchSelectors","results","template","callback","result","j","traversePrevious","previousSibling","traverseNext","nextSibling","find","ClassDirective","_Directive","classFunction","add","EventDirective","event$","fromEvent","Structure","ForItem","_Context","$key","$value","index","array","_Context$call","call","get","set","count","Constructor","protoProps","staticProps","even","descriptors","parentPrototypeDescriptors","getOwnPropertyDescriptors","getPrototypeOf","parentDescriptors","_len2","_key2","assign","ForStructure","_Structure","forbegin","createComment","forend","insertBefore","removeAttribute","data","forFunction","items","total","Math","max","item","clonedNode","cloneNode","removeChild","IfStructure","ifbegin","ifend","ifFunction","JsonPipe","JSON","stringify","StyleDirective","styleFunction","style","LocalStorageService","delete","isLocalStorageSupported","localStorage","removeItem","exist","e","console","log","cache","json","setItem","supported","StoreService","get$","store$","date","Date","now","add$","patch","getValue","unshift","patch$","delete$","splice","AppComponent","_Component","input","onInput","$event","onAddItem","onToggleItem","done","onRemoveItem","DatePipe","locale","dateStyle","timeStyle","toLocaleDateString","colors","hex","color","alpha","r","parseInt","slice","g","TodoItemComponent","backgroundColor","onToggle","toggle","onRemove","createdInstances"],"mappings":"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","file":"docs/js/main.min.js","sourcesContent":[null,"export default class Directive {\n\n}\n\nDirective.meta = {\n\tselector: '[(directive)]',\n};\n","export default class Component {\n\n}\n\nComponent.meta = {\n\tselector: '[component]',\n};\n","import { BehaviorSubject, of , Subject } from 'rxjs';\nimport { filter, map, shareReplay, takeUntil, tap } from 'rxjs/operators';\nimport Component from '../component/component';\n\nlet ID = 0;\nconst CONTEXTS = {};\n\nexport default class Module {\n\n\tconstructor(options) {\n\t\tif (!options) {\n\t\t\tthrow ('missing options');\n\t\t}\n\t\tif (!options.bootstrap) {\n\t\t\tthrow ('missing bootstrap');\n\t\t}\n\t\tthis.options = options;\n\t\tconst pipes = {};\n\t\tif (options.pipes) {\n\t\t\toptions.pipes.forEach(x => pipes[x.meta.name] = x);\n\t\t}\n\t\tthis.pipes = pipes;\n\t\tconst bootstrap = options.bootstrap;\n\t\tthis.root = this.makeInstance(document.querySelector(bootstrap.meta.selector), bootstrap);\n\t\tthis.selectors = Module.unwrapSelectors(options.factories);\n\t}\n\n\tuse$() {\n\t\treturn of(Module.querySelectorsAll(document, this.selectors, [])).pipe(\n\t\t\tfilter(matches => matches.length > 0),\n\t\t\tmap((matches) => {\n\t\t\t\treturn matches.map(match => this.makeInstance(match.node, match.factory, match.selector));\n\t\t\t}),\n\t\t\tshareReplay(1)\n\t\t);\n\t}\n\n\tmakeInstance(node, factory, selector, parentInstance) {\n\t\tif (node.parentNode) {\n\t\t\tconst isComponent = factory.prototype instanceof Component;\n\t\t\tconst meta = factory.meta;\n\t\t\tparentInstance = parentInstance || this.getParentScope(node.parentNode);\n\t\t\tif (!parentInstance) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst instance = new factory();\n\t\t\tObject.defineProperties(instance, {\n\t\t\t\tstate$: {\n\t\t\t\t\tvalue: new BehaviorSubject(instance),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t},\n\t\t\t\tunsubscribe$: {\n\t\t\t\t\tvalue: new Subject(),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t}\n\t\t\t});\n\t\t\tinstance.pushState = function() {\n\t\t\t\tthis.state$.next(this);\n\t\t\t};\n\t\t\tconst context = Module.setContext(this, instance, parentInstance, node, factory, selector);\n\t\t\tif (isComponent) {\n\t\t\t\tcontext.inputs = this.makeInputs(meta, instance);\n\t\t\t\tcontext.outputs = this.makeOutputs(meta, instance);\n\t\t\t}\n\t\t\tif (typeof instance.onInit === 'function') {\n\t\t\t\tinstance.onInit();\n\t\t\t}\n\t\t\tif (parentInstance.state$) {\n\t\t\t\tparentInstance.state$.pipe(\n\t\t\t\t\t// filter(() => node.parentNode),\n\t\t\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t\t\t).subscribe(state => {\n\t\t\t\t\tif (isComponent) {\n\t\t\t\t\t\tthis.resolveInputsOutputs(instance, state);\n\t\t\t\t\t}\n\t\t\t\t\tthis.pushState(instance, state);\n\t\t\t\t\tif (isComponent) {\n\t\t\t\t\t\tthis.parse(node, instance);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn instance;\n\t\t}\n\t}\n\n\tremove(node) {\n\t\tconst ids = [];\n\t\tModule.traverseDown(node, (node) => {\n\t\t\tfor (let [id, context] of Object.entries(CONTEXTS)) {\n\t\t\t\tif (context.node === node) {\n\t\t\t\t\tconst instance = context.instance;\n\t\t\t\t\tinstance.unsubscribe$.next();\n\t\t\t\t\tinstance.unsubscribe$.complete();\n\t\t\t\t\tif (typeof instance.onDestroy === 'function') {\n\t\t\t\t\t\tinstance.onDestroy();\n\t\t\t\t\t}\n\t\t\t\t\tids.push(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tids.forEach(id => delete CONTEXTS[id]);\n\t\t// console.log('Module.remove', ids);\n\t\treturn node;\n\t}\n\n\tcompile(node, parent) {\n\t\tif (parent) {\n\t\t\tconst $id = ++ID;\n\t\t\tparent.$id = $id;\n\t\t\tconst context = Module.setContext(this, parent, parent.parentInstance, node, parent.constructor);\n\t\t}\n\t\tconst matches = Module.querySelectorsAll(node, this.selectors, []);\n\t\tconst instances = matches.map(match => {\n\t\t\tconst instance = this.makeInstance(match.node, match.factory, match.selector, parent);\n\t\t\tif (match.factory.prototype instanceof Component) {\n\t\t\t\tparent = undefined; // !!!\n\t\t\t}\n\t\t\treturn instance;\n\t\t}).filter(x => x !== undefined);\n\t\treturn instances;\n\t}\n\n\tparse(node, instance) {\n\t\t// console.log('node', node.childNodes.length, node);\n\t\tconst parse_eval_ = (...args) => {\n\t\t\tconst expression = args[1];\n\t\t\t// console.log('expression', expression);\n\t\t\tconst parse_func_ = this.makeFunction(expression);\n\t\t\treturn this.resolve(parse_func_, instance, instance);\n\t\t};\n\t\tconst parse_replace_ = function(text) {\n\t\t\treturn text.replace(new RegExp('\\{{2}(.*?)\\}{2}(?!})', 'g'), parse_eval_);\n\t\t};\n\t\tif (node.hasAttribute('[innerHTML]')) {\n\t\t\tconst innerHTML = `{{${node.getAttribute('[innerHTML]')}}}`;\n\t\t\tnode.innerHTML = parse_replace_(innerHTML);\n\t\t} else if (node.hasAttribute('innerHTML')) {\n\t\t\tconst innerHTML = node.getAttribute('innerHTML');\n\t\t\tnode.innerHTML = parse_replace_(innerHTML);\n\t\t} else {\n\t\t\tfor (let i = 0; i < node.childNodes.length; i++) {\n\t\t\t\tconst child = node.childNodes[i];\n\t\t\t\t// console.log('node', child, child.nodeType);\n\t\t\t\tif (child.nodeType === 1) {\n\t\t\t\t\t// if (!has_scope_(child)) {\n\t\t\t\t\t// if (!child.hasAttribute(`instance`)) {\n\t\t\t\t\tthis.parse(child, instance);\n\t\t\t\t\t// }\n\t\t\t\t} else if (child.nodeType === 3) {\n\t\t\t\t\t// console.log(child);\n\t\t\t\t\tconst text = child.nodeValue;\n\t\t\t\t\tconst replacedText = parse_replace_(text);\n\t\t\t\t\tif (text !== replacedText) {\n\t\t\t\t\t\tnode.setAttribute('innerHTML', text);\n\t\t\t\t\t\tconst textNode = document.createTextNode(replacedText);\n\t\t\t\t\t\tnode.replaceChild(textNode, child);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (typeof instance.onParse === 'function') {\n\t\t\tscope.onParse();\n\t\t}\n\t\t/*\n\t\tconst scope = this.getScope(node);\n\t\tif (scope) {\n\t\t\tif (typeof instance.onParse === 'function') {\n\t\t\t\tscope.onParse();\n\t\t\t}\n\t\t}\n\t\t*/\n\t}\n\n\tresolve(expressionFunc, state, payload) {\n\t\treturn expressionFunc.apply(state, [payload, this]);\n\t}\n\n\tmakeInputs(meta, instance) {\n\t\tconst inputs = {};\n\t\tif (meta.inputs) {\n\t\t\tmeta.inputs.forEach((key, i) => inputs[key] = this.makeInput(instance, key));\n\t\t}\n\t\treturn inputs;\n\t}\n\n\tmakeOutputs(meta, instance) {\n\t\tconst outputs = {};\n\t\tif (meta.outputs) {\n\t\t\tmeta.outputs.forEach((key, i) => outputs[key] = this.makeOutput(instance, key));\n\t\t}\n\t\treturn outputs;\n\t}\n\n\tresolveInputsOutputs(instance, state) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst inputs = context.inputs;\n\t\tObject.keys(inputs).forEach(key => {\n\t\t\tconst inputFunction = inputs[key];\n\t\t\tconst value = this.resolve(inputFunction, parentInstance, instance);\n\t\t\tinstance[key] = value;\n\t\t});\n\t\t/*\n\t\tconst outputs = context.outputs;\n\t\tObject.keys(outputs).forEach(key => {\n\t\t\tconst inpuoutputFunctiontFunction = outputs[key];\n\t\t\tconst value = this.resolve(outputFunction, parentInstance, null);\n\t\t\t// console.log(`setted -> ${key}`, value);\n\t\t});\n\t\t*/\n\t}\n\n\tgetScope(node) {\n\t\tif (node === document) {\n\t\t\treturn window;\n\t\t}\n\t\tconst instance = Module.getComponentInstanceByNode(node);\n\t\treturn instance;\n\t}\n\n\tgetParentScope(node) {\n\t\treturn Module.traverseUp(node, (node) => {\n\t\t\treturn this.getScope(node);\n\t\t});\n\t}\n\n\tpushState(instance, state) {\n\t\tif (typeof instance.onState === 'function') {\n\t\t\t// console.log('onState', instance.constructor.meta.selector, state);\n\t\t\tinstance.onState(state);\n\t\t}\n\t\tif (instance.state$) {\n\t\t\tinstance.state$.next(instance);\n\t\t}\n\t}\n\n\t//\n\n\toptionalChaining(expression) {\n\t\tconst regex = /(\\w+(\\?\\.))+([\\.|\\w]+)/g;\n\t\tlet previous;\n\t\texpression = expression.replace(regex, (...args) => {\n\t\t\tconst tokens = args[0].split('?.');\n\t\t\tfor (let i = 0; i < tokens.length - 1; i++) {\n\t\t\t\tconst a = i > 0 ? `(${tokens[i]} = ${previous})` : tokens[i];\n\t\t\t\tconst b = tokens[i + 1];\n\t\t\t\tprevious = i > 0 ? `${a}.${b}` : `(${a} ? ${a}.${b} : void 0)`;\n\t\t\t\t// log(previous);\n\t\t\t}\n\t\t\treturn previous || '';\n\t\t});\n\t\treturn expression;\n\t}\n\n\tmakeFunction(expression, params = ['$instance']) {\n\t\tif (!expression) {\n\t\t\treturn () => { return null; };\n\t\t}\n\t\tconst pipes = this.pipes;\n\t\tconst transforms = Module.getPipesSegments(expression);\n\t\texpression = transforms.shift().trim();\n\t\texpression = this.optionalChaining(expression);\n\t\t// console.log('expression', \"${expression}\", ${params.join(',')}, this);\n\t\t// return expression_func;\n\t\t// console.log(pipes, transforms, expression);\n\t\t// console.log(transforms.length, params);\n\t\tparams.push('module');\n\t\t// keyword 'this' represents state from func.apply(state, instance)\n\t\tif (transforms.length) {\n\t\t\texpression = transforms.reduce((expression, transform, i) => {\n\t\t\t\tconst params = Module.getPipeParamsSegments(transform);\n\t\t\t\tconst name = params.shift().trim();\n\t\t\t\tconst pipe = pipes[name];\n\t\t\t\tif (!pipe || typeof pipe.transform !== 'function') {\n\t\t\t\t\tthrow (`missing pipe ${name}`);\n\t\t\t\t}\n\t\t\t\treturn `pipes.${name}.transform(${expression},${params.join(',')})`;\n\t\t\t}, expression);\n\t\t\t// console.log('expression', expression);\n\t\t\tconst expression_func = new Function(`with(this) {\n\t\t\t\treturn (function (${params.join(',')}) {\n\t\t\t\t\tconst pipes = module.pipes;\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t} else {\n\t\t\tconst expression_func = new Function(this.options.debug ? `with(this) {\n\t\t\t\treturn (function (${params.join(',')}) {\n\t\t\t\t\tlet value;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = ${expression};\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\tvalue = '<span style=\"color:red;\">' + e.message + ' in expression ' + expression + '</span>';\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}` : `with(this) {\n\t\t\t\treturn (function (${params.join(',')}) {\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t}\n\t}\n\n\tmakeInput(instance, name) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute(`[${name}]`);\n\t\treturn this.makeFunction(expression);\n\t}\n\n\tmakeOutput(instance, name) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst node = context.node;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst expression = node.getAttribute(`(${name})`);\n\t\tconst outputFunction = this.makeFunction(expression, ['$event']);\n\t\tconst output$ = new Subject().pipe(\n\t\t\ttap((event) => {\n\t\t\t\tthis.resolve(outputFunction, parentInstance, event);\n\t\t\t})\n\t\t);\n\t\toutput$.pipe(\n\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t).subscribe();\n\t\tinstance[name] = output$;\n\t\treturn outputFunction;\n\t}\n\n\t//\n\n\tcontexts_() {\n\t\treturn CONTEXTS;\n\t}\n\n\t//\n\n\tstatic getPipesSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === '|' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic getPipeParamsSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === ':' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic unwrapSelectors(factories) {\n\t\tconst selectors = [];\n\t\tfactories.forEach(factory => {\n\t\t\tfactory.meta.selector.split(',').forEach(selector => {\n\t\t\t\tselector = selector.trim();\n\t\t\t\tif (selector.indexOf('.') === 0) {\n\t\t\t\t\tconst className = selector.replace(/\\./g, '');\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.classList.has(className);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else if (selector.match(/\\[(.+)\\]/)) {\n\t\t\t\t\tconst attribute = selector.substr(1, selector.length - 2);\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.hasAttribute(attribute);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.nodeName.toLowerCase() === selector.toLowerCase();\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn selectors;\n\t}\n\n\tstatic matchSelectors(node, selectors, results) {\n\t\tselectors.forEach(selector => {\n\t\t\tconst match = selector(node);\n\t\t\tif (match) {\n\t\t\t\tconst factory = match.factory;\n\t\t\t\tif (factory.prototype instanceof Component && factory.meta.template) {\n\t\t\t\t\tnode.innerHTML = factory.meta.template;\n\t\t\t\t}\n\t\t\t\tresults.push(match);\n\t\t\t}\n\t\t});\n\t\treturn results;\n\t}\n\n\tstatic querySelectorsAll(node, selectors, results) {\n\t\tif (node.nodeType === 1) {\n\t\t\tresults = this.matchSelectors(node, selectors, results);\n\t\t}\n\t\tconst childNodes = node.childNodes;\n\t\tif (childNodes) {\n\t\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\t\tresults = this.querySelectorsAll(childNodes[i], selectors, results);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic traverseUp(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseUp(node.parentNode, callback, i + 1);\n\t}\n\n\tstatic traverseDown(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tlet result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tif (node.nodeType === 1) {\n\t\t\tlet j = 0,\n\t\t\t\tt = node.childNodes.length;\n\t\t\twhile (j < t && !result) {\n\t\t\t\tresult = this.traverseDown(node.childNodes[j], callback, i + 1);\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic traversePrevious(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traversePrevious(node.previousSibling, callback, i + 1);\n\t}\n\n\tstatic traverseNext(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseNext(node.nextSibling, callback, i + 1);\n\t}\n\n\tstatic use$(options) {\n\t\t/*\n\t\tif (!options.factories) {\n\t\t\toptions.factories = [\n\t\t\t\tClassDirective,\n\t\t\t\tEventDirective,\n\t\t\t\tIfStructure,\n\t\t\t\tForStructure,\n\t\t\t\tStyleDirective\n\t\t\t];\n\t\t}\n\t\tif (!options.pipes) {\n\t\t\toptions.pipes = [\n\t\t\t\tJsonPipe\n\t\t\t];\n\t\t}\n\t\t*/\n\t\treturn new Module(options).use$();\n\t}\n\n\tstatic getContext(instance) {\n\t\treturn CONTEXTS[instance.$id];\n\t}\n\n\tstatic setContext(module, instance, parentInstance, node, factory, selector) {\n\t\tconst $id = ++ID;\n\t\tinstance.$id = $id;\n\t\treturn CONTEXTS[$id] = { module, instance, parentInstance, node, factory, selector };\n\t}\n\n\tstatic getComponentInstanceByNode(node) {\n\t\tconst id = Object.keys(CONTEXTS).find(id => CONTEXTS[id].node === node && CONTEXTS[id].factory.prototype instanceof Component);\n\t\tif (id) {\n\t\t\tconst context = CONTEXTS[id];\n\t\t\treturn context.instance;\n\t\t}\n\t}\n\n}\n","import Directive from '../directive/directive';\nimport Module from '../module/module';\n\nexport default class ClassDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[class]');\n\t\tthis.classFunction = module.makeFunction(expression);\n\t\t// this.classList = [...node.classList.keys()];\n\t\t// console.log('ClassDirective.onInit', this.classList, expression);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst classList = module.resolve(this.classFunction, state, this);\n\t\tObject.keys(classList).forEach(key => {\n\t\t\tif (classList[key]) {\n\t\t\t\tnode.classList.add(key);\n\t\t\t} else {\n\t\t\t\tnode.classList.remove(key);\n\t\t\t}\n\t\t});\n\t\t// console.log('ClassDirective.onState', classList);\n\t}\n\n}\n\nClassDirective.meta = {\n\tselector: `[[class]]`,\n};\n","import { fromEvent } from 'rxjs';\nimport { shareReplay, takeUntil } from 'rxjs/operators';\nimport Directive from '../directive/directive';\nimport Module from '../module/module';\n\nconst EVENTS = ['click', 'mousedown', 'mouseup', 'touchstart', 'touchmove', 'touchend', 'keydown', 'keyup', 'input', 'change', 'loaded'];\n\nexport default class EventDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst event = this.event = selector.replace(/\\[|\\]|\\(|\\)/g, '');\n\t\tconst event$ = this.event$ = fromEvent(node, event).pipe(shareReplay(1));\n\t\tconst expression = node.getAttribute(`(${event})`);\n\t\tif (expression) {\n\t\t\tconst outputFunction = module.makeFunction(expression, ['$event']);\n\t\t\tevent$.pipe(\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(event => {\n\t\t\t\t// console.log(parentInstance);\n\t\t\t\tmodule.resolve(outputFunction, parentInstance, event);\n\t\t\t});\n\t\t} else {\n\t\t\tparentInstance[`${event}$`] = event$;\n\t\t}\n\t\t// console.log('EventDirective.onInit', 'selector', selector, 'event', event);\n\t}\n\n}\n\nEventDirective.meta = {\n\tselector: `[(${EVENTS.join(')],[(')})]`,\n};\n","export default class Structure {\n\n}\n\nStructure.meta = {\n\tselector: '[(directive)]',\n};\n","import Context from '../context/context';\n\nexport default class ForItem extends Context {\n\n\tconstructor($key, $value, index, array, parentInstance) {\n\t\tsuper(parentInstance, {\n\t\t\t[$key]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\tthis.$value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.$key = $key;\n\t\tthis.$value = $value;\n\t\tthis.index = index;\n\t\tthis.count = array.length;\n\t\t// console.log(this);\n\t}\n\n\tget first() { return this.index === 0; }\n\n\tget last() { return this.index === this.count - 1; }\n\n\tget even() { return this.index % 2 === 0; }\n\n\tget odd() { return !this.even; }\n\n\tpushState() {\n\t\tthis.state$.next(this);\n\t}\n\n}\n","import { BehaviorSubject, Subject } from \"rxjs\";\n\nexport default class Context {\n\n\tconstructor(parent, descriptors) {\n\t\tconst parentPrototypeDescriptors = Object.getOwnPropertyDescriptors(Object.getPrototypeOf(parent));\n\t\tdelete parentPrototypeDescriptors.constructor;\n\t\tObject.keys(parentPrototypeDescriptors).forEach(key => {\n\t\t\tconst descriptor = parentPrototypeDescriptors[key];\n\t\t\tif (typeof descriptor.value == \"function\") {\n\t\t\t\tdescriptor.value = (...args) => {\n\t\t\t\t\tparent[key].apply(parent, args);\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\t// console.log('parentPrototypeDescriptors', parentPrototypeDescriptors);\n\t\tconst parentDescriptors = Object.getOwnPropertyDescriptors(parent);\n\t\tObject.keys(parentDescriptors).forEach(key => {\n\t\t\tconst descriptor = parentDescriptors[key];\n\t\t\tif (typeof descriptor.value == \"function\") {\n\t\t\t\tdescriptor.value = (...args) => {\n\t\t\t\t\tparent[key].apply(parent, args);\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\t// console.log('parentDescriptors', parentDescriptors);\n\t\tObject.defineProperties(this, Object.assign(parentPrototypeDescriptors, parentDescriptors, {\n\t\t\tstate$: {\n\t\t\t\tvalue: new BehaviorSubject(this),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t},\n\t\t\tunsubscribe$: {\n\t\t\t\tvalue: new Subject(),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t}\n\t\t}, descriptors));\n\t\tthis.pushState = () => {\n\t\t\tthis.state$.next(this);\n\t\t};\n\t}\n\n}\n","import Module from '../module/module';\nimport Structure from '../structure/structure';\nimport ForItem from './for.item';\n\nexport default class ForStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst forbegin = this.forbegin = document.createComment(`*for begin`);\n\t\tnode.parentNode.replaceChild(forbegin, node);\n\t\tconst forend = this.forend = document.createComment(`*for end`);\n\t\tforbegin.parentNode.insertBefore(forend, forbegin.nextSibling);\n\t\tlet expression = node.getAttribute('*for');\n\t\tnode.removeAttribute('*for');\n\t\tif (expression === null) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tif (expression.trim().indexOf('let') !== 0) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\texpression = expression.substr(3);\n\t\texpression = expression.split(' of ');\n\t\tconst key = expression[0].trim();\n\t\tconst data = expression[1].trim();\n\t\tthis.forFunction = module.makeFunction(data);\n\t\tthis.key = key;\n\t\tthis.items = [];\n\t\t// console.log('expression', expression);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\t// resolve\n\t\tconst items = module.resolve(this.forFunction, state, this) || [];\n\t\tconst total = items.length;\n\t\tconst previous = this.items.length;\n\t\tlet nextSibling = this.forbegin.nextSibling;\n\t\tfor (let i = 0; i < Math.max(previous, total); i++) {\n\t\t\tif (i < total) {\n\t\t\t\tconst item = items[i];\n\t\t\t\tif (i < previous) {\n\t\t\t\t\t// update\n\t\t\t\t\tconst clonedNode = nextSibling;\n\t\t\t\t\tconst instance = this.items[i];\n\t\t\t\t\tinstance[this.key] = item;\n\t\t\t\t\tinstance.pushState();\n\t\t\t\t\tmodule.parse(clonedNode, instance);\n\t\t\t\t\tnextSibling = nextSibling.nextSibling;\n\t\t\t\t} else {\n\t\t\t\t\t// create\n\t\t\t\t\tconst clonedNode = node.cloneNode(true);\n\t\t\t\t\tthis.forend.parentNode.insertBefore(clonedNode, this.forend);\n\t\t\t\t\tconst instance = new ForItem(this.key, item, i, items, context.parentInstance);\n\t\t\t\t\tconst instances = module.compile(clonedNode, instance);\n\t\t\t\t\tmodule.parse(clonedNode, instance);\n\t\t\t\t\tnextSibling = clonedNode.nextSibling;\n\t\t\t\t\tthis.items.push(instance);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// remove\n\t\t\t\tconst item = this.items[i];\n\t\t\t\tconst context = Module.getContext(item);\n\t\t\t\tconst node = context.node;\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\tmodule.remove(node);\n\t\t\t}\n\t\t}\n\t\tthis.items.length = items.length;\n\t}\n\n\t/*\n\tonState_unoptimized(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\twhile (this.forbegin.nextSibling !== this.forend) {\n\t\t\tconst nextSibling = this.forbegin.nextSibling;\n\t\t\tthis.forbegin.parentNode.removeChild(nextSibling);\n\t\t\tmodule.remove(nextSibling);\n\t\t}\n\t\tconst items = module.resolve(this.forFunction, state, this).map((value, index, items) => {\n\t\t\tconst item = new ForItem(this.key, value, index, items, this.parent);\n\t\t\tconst clonedNode = node.cloneNode(true);\n\t\t\tthis.forend.parentNode.insertBefore(clonedNode, this.forend);\n\t\t\tconst instances = module.compile(clonedNode, item);\n\t\t\tmodule.parse(clonedNode, item);\n\t\t\treturn item;\n\t\t});\n\t\t// console.log('ForStructure.onState', items);\n\t}\n\t*/\n\n}\n\nForStructure.meta = {\n\tselector: '[*for]',\n};\n","import Module from '../module/module';\nimport Structure from '../structure/structure';\n\nexport default class IfStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst ifbegin = this.ifbegin = document.createComment(`*if begin`);\n\t\tnode.parentNode.replaceChild(ifbegin, node);\n\t\tconst ifend = this.ifend = document.createComment(`*if end`);\n\t\tifbegin.parentNode.insertBefore(ifend, ifbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*if');\n\t\tthis.expression = expression;\n\t\tthis.ifFunction = module.makeFunction(expression);\n\t\tconst clonedNode = node.cloneNode(true);\n\t\tclonedNode.removeAttribute('*if');\n\t\tthis.clonedNode = clonedNode;\n\t\t// console.log('expression', expression);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\t// console.log('IfStructure.onState', state, this.expression);\n\t\tconst value = module.resolve(this.ifFunction, state, this);\n\t\tif (value) {\n\t\t\tif (!this.clonedNode.parentNode) {\n\t\t\t\tthis.ifend.parentNode.insertBefore(this.clonedNode, this.ifend);\n\t\t\t\tmodule.compile(this.clonedNode);\n\t\t\t\tmodule.parse(this.clonedNode, state);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.clonedNode.parentNode) {\n\t\t\t\tthis.clonedNode.parentNode.removeChild(this.clonedNode);\n\t\t\t\tmodule.remove(this.clonedNode);\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nIfStructure.meta = {\n\tselector: '[*if]',\n};\n","export default class JsonPipe {\n\n\tstatic transform(value) {\n\t\treturn JSON.stringify(value);\n\t}\n\n}\n\nJsonPipe.meta = {\n\tname: 'json',\n};\n","import Directive from '../directive/directive';\nimport Module from '../module/module';\n\nexport default class StyleDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[style]');\n\t\tthis.styleFunction = module.makeFunction(expression);\n\t\t// console.log('StyleDirective.onInit', expression);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst style = module.resolve(this.styleFunction, state, this);\n\t\tObject.keys(style).forEach(key => {\n\t\t\tnode.style[key] = style[key];\n\t\t});\n\t\t// console.log('StyleDirective.onState', state, style);\n\t}\n\n}\n\nStyleDirective.meta = {\n\tselector: `[[style]]`\n};\n","export default class LocalStorageService {\n\n\tstatic delete(name) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\twindow.localStorage.removeItem(name);\n\t\t}\n\t}\n\n\tstatic exist(name) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\treturn window.localStorage[name] !== undefined;\n\t\t}\n\t}\n\n\tstatic get(name) {\n\t\tlet value = null;\n\t\tif (this.isLocalStorageSupported() && window.localStorage[name] !== undefined) {\n\t\t\ttry {\n\t\t\t\tvalue = JSON.parse(window.localStorage[name]);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorageService.get.error parsing', name, e);\n\t\t\t}\n\t\t}\n\t\treturn value;\n\t}\n\n\tstatic set(name, value) {\n\t\tif (this.isLocalStorageSupported()) {\n\t\t\ttry {\n\t\t\t\tconst cache = [];\n\t\t\t\tconst json = JSON.stringify(value, function(key, value) {\n\t\t\t\t\tif (typeof value === 'object' && value !== null) {\n\t\t\t\t\t\tif (cache.indexOf(value) !== -1) {\n\t\t\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcache.push(value);\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t});\n\t\t\t\twindow.localStorage.setItem(name, json);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('LocalStorageService.set.error serializing', name, value, e);\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic isLocalStorageSupported() {\n\t\tif (this.supported) {\n\t\t\treturn true;\n\t\t}\n\t\tlet supported = false;\n\t\ttry {\n\t\t\tsupported = 'localStorage' in window && window.localStorage !== null;\n\t\t\tif (supported) {\n\t\t\t\twindow.localStorage.setItem('test', '1');\n\t\t\t\twindow.localStorage.removeItem('test');\n\t\t\t} else {\n\t\t\t\tsupported = false;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tsupported = false;\n\t\t}\n\t\tthis.supported = supported;\n\t\treturn supported;\n\t}\n\n}\n","import { BehaviorSubject, of } from 'rxjs';\nimport LocalStorageService from '../local-storage/local-storage.service';\n\nexport default class StoreService {\n\n\tstatic set(items) {\n\t\tLocalStorageService.set('items', items);\n\t\treturn this.get$().next(items);\n\t}\n\n\tstatic get$() {\n\t\tif (this.store$) {\n\t\t\treturn this.store$;\n\t\t}\n\t\tlet items = LocalStorageService.get('items');\n\t\tif (!items) {\n\t\t\titems = [\n\t\t\t\t{ id: 3, name: 'cookies', date: new Date(Date.now()) },\n\t\t\t\t{ id: 2, name: 'pizza', date: new Date(2019, 3, 22, 12) },\n\t\t\t\t{ id: 1, name: 'bread', date: new Date(2019, 0, 6, 12) },\n\t\t\t];\n\t\t\tLocalStorageService.set('items', items);\n\t\t}\n\t\treturn this.store$ = new BehaviorSubject(items);\n\t}\n\n\tstatic add$(patch) {\n\t\tconst item = Object.assign({\n\t\t\tid: Date.now(),\n\t\t\tdate: new Date(Date.now())\n\t\t}, patch);\n\t\tconst items = this.store$.getValue();\n\t\titems.unshift(item);\n\t\tthis.set(items);\n\t\treturn of(item);\n\t}\n\n\tstatic patch$(patch) {\n\t\tconst items = this.store$.getValue();\n\t\tconst item = items.find(x => x.id === patch.id);\n\t\tif (item) {\n\t\t\tObject.assign(item, patch);\n\t\t\tthis.set(items);\n\t\t}\n\t\treturn of(item);\n\t}\n\n\tstatic delete$(item) {\n\t\tconst items = this.store$.getValue();\n\t\tconst index = items.indexOf(item);\n\t\tif (index !== -1) {\n\t\t\titems.splice(index, 1);\n\t\t\tthis.set(items);\n\t\t}\n\t\treturn of(item);\n\t}\n\n}\n","/*\nimport { fromEvent } from 'rxjs';\nimport { auditTime, distinctUntilChanged, map, takeUntil } from 'rxjs/operators';\n*/\nimport { takeUntil } from 'rxjs/operators';\nimport { Component, Module } from '../../lib/rxcomp';\nimport StoreService from './store/store.service';\n\nexport default class AppComponent extends Component {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tthis.input = context.node.querySelector('.control--text');\n\t\tthis.items = [];\n\t\tthis.store$ = StoreService.get$();\n\t\tthis.store$.pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe(items => {\n\t\t\t// console.log('AppComponent.store$', items);\n\t\t\tthis.items = items;\n\t\t\tthis.pushState();\n\t\t});\n\t\t/*\n\t\tthis.input$().pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe(input => {\n\t\t\t// console.log(input);\n\t\t\tthis.input = input;\n\t\t});\n\t\t*/\n\t\t// console.log('AppComponent', Object.keys(this).join(','));\n\t}\n\n\t/*\n\tinput$() {\n\t\tconst context = Module.getContext(this);\n\t\tconst input = context.node.querySelector('.control--text');\n\t\treturn fromEvent(input, 'input').pipe(\n\t\t\tmap(event => input.value),\n\t\t\tauditTime(200),\n\t\t\tdistinctUntilChanged()\n\t\t);\n\t}\n\t*/\n\n\tonInput($event) {\n\t\t// console.log('AppComponent.onInput', $event, this);\n\t\tthis.pushState();\n\t}\n\n\tonAddItem($event) {\n\t\tif (this.input.value) {\n\t\t\tStoreService.add$({\n\t\t\t\tname: this.input.value,\n\t\t\t}).subscribe(item => {\n\t\t\t\t// console.log('AppComponent.onAddItem', item);\n\t\t\t\tthis.input.value = null;\n\t\t\t});\n\t\t}\n\t}\n\n\tonToggleItem(item) {\n\t\tStoreService.patch$({\n\t\t\tid: item.id,\n\t\t\tdone: !item.done,\n\t\t}).subscribe(item => {\n\t\t\t// console.log('AppComponent.onToggleItem', item);\n\t\t});\n\t}\n\n\tonRemoveItem(item) {\n\t\tStoreService.delete$(item).subscribe(item => {\n\t\t\t// console.log('AppComponent.onRemoveItem', item);\n\t\t});\n\t}\n\n}\n\nAppComponent.meta = {\n\tselector: '[app-component]',\n};\n","\n\nexport default class DatePipe {\n\n\tstatic transform(value, locale = 'it-IT-u-ca-gregory', options = {\n\t\tdateStyle: 'short',\n\t\ttimeStyle: 'short',\n\t}) {\n\t\treturn new Date(value).toLocaleDateString(locale, options);\n\t}\n\n}\n\nDatePipe.meta = {\n\tname: 'date',\n};\n","export const colors = [\n\t{ hex: '#073B4C' },\n\t{ hex: '#EF476F' },\n\t{ hex: '#1CCC9D' },\n\t{ hex: '#118AB2' },\n\t{ hex: '#EFC156' },\n];\n\nexport function hexToInt(hex) {\n\treturn parseInt(hex.replace(/^#/, ''), 16);\n}\n\nexport function randomHex() {\n\treturn colors[Math.floor(Math.random() * colors.length)].hex;\n}\n\nexport function randomColor() {\n\tconst hex = randomHex();\n\treturn hexToInt(hex);\n}\n\nexport function color(index, alpha) {\n\treturn hexToRgb(colors[index % colors.length].hex, alpha);\n}\n\nlet index = -1;\n\nexport function nextHex() {\n\tindex++;\n\treturn colors[index % colors.length].hex;\n}\n\nexport function nextColor() {\n\tconst hex = nextHex();\n\treturn hexToInt(hex);\n}\n\nexport function hexToRgb(hex, a) {\n\tconst r = parseInt(hex.slice(1, 3), 16);\n\tconst g = parseInt(hex.slice(3, 5), 16);\n\tconst b = parseInt(hex.slice(5, 7), 16);\n\tif (a) {\n\t\treturn `rgba(${r},${g},${b},${a})`;\n\t} else {\n\t\treturn `rgb(${r},${g},${b})`;\n\t}\n}\n","import Component from '../../../lib/component/component';\nimport { color } from '../colors/colors';\n\nexport default class TodoItemComponent extends Component {\n\n\tonState(state) {\n\t\t// console.log('onState', state);\n\t\tthis.backgroundColor = color(this.item.id, 0.15);\n\t\tthis.color = color(this.item.id);\n\t}\n\n\tonToggle($event) {\n\t\t// console.log('onToggle', $event);\n\t\tthis.toggle.next($event);\n\t}\n\n\tonRemove($event) {\n\t\t// console.log('onRemove', $event);\n\t\tthis.remove.next($event);\n\t}\n\n}\n\nTodoItemComponent.meta = {\n\tselector: '[todo-item-component]',\n\tinputs: ['item'],\n\toutputs: ['toggle', 'remove'],\n\ttemplate: /* html */ `\n\t\t<button type=\"button\" class=\"btn--toggle\" [style]=\"{ color: color }\" (click)=\"onToggle(item)\">\n\t\t\t<i class=\"icon--check\" *if=\"item.done\"></i>\n\t\t\t<i class=\"icon--circle\" *if=\"!item.done\"></i>\n\t\t</button>\n\t\t<div class=\"title\" [style]=\"{ color: color }\" [innerHTML]=\"item.name\"></div>\n\t\t<div class=\"date\" [style]=\"{ background: backgroundColor, color: color }\" [innerHTML]=\"item.date | date : 'en-US' : { month: 'short', day: '2-digit', year: 'numeric' }\"></div>\n\t\t<button type=\"button\" class=\"btn--remove\" [style]=\"{ color: color }\" (click)=\"onRemove(item)\"><i class=\"icon--remove\"></i></button>\n\t`,\n};\n","import { ClassDirective, EventDirective, ForStructure, IfStructure, JsonPipe, Module, StyleDirective } from '../../lib/rxcomp';\nimport AppComponent from './app.component';\nimport DatePipe from './date/date.pipe';\nimport TodoItemComponent from './todo-item/todo-item.component';\n\nModule.use$({\n\tfactories: [\n\t\tClassDirective,\n\t\tEventDirective,\n\t\tForStructure,\n\t\tIfStructure,\n\t\tStyleDirective,\n\t\tTodoItemComponent,\n\t],\n\tpipes: [\n\t\tDatePipe,\n\t\tJsonPipe,\n\t],\n\tbootstrap: AppComponent,\n}).subscribe(createdInstances => {\n\t// console.log('createdInstances', createdInstances);\n});\n"]}