{"version":3,"sources":["test/js/test.parsing.ts","../../src/core/factory.ts","../../src/core/directive.ts","../../src/class/class.directive.ts","../../src/event/event.directive.ts","../../src/core/structure.ts","../../src/core/component.ts","../../src/core/context.ts","../../src/for/for.item.ts","../../src/for/for.structure.ts","../../src/href/href.directive.ts","../../src/if/if.structure.ts","../../src/inner-html/inner-html.directive.ts","../../src/core/pipe.ts","../../src/json/json.pipe.ts","../../src/module/module.ts","../../src/src/src.directive.ts","../../src/style/style.directive.ts","../../src/core.module.ts","../../src/platform/platform.ts","../../src/platform/browser.ts","../../test/js/date/date.pipe.ts","../../test/js/test.parsing.ts"],"names":["rxjs","operators","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","_setPrototypeOf","o","p","setPrototypeOf","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","call","e","_construct","Parent","args","Class","a","push","apply","instance","Function","bind","arguments","CONTEXTS","NODES","Factory","this","rxcompId","unsubscribe$","Subject","changes$","ReplaySubject","_proto","onInit","onChanges","changes","onView","onDestroy","pushChanges","next","getContext","Directive","_Factory","ClassDirective","_this","_Directive","class","keys","_this2","node","classList","forEach","x","object","split","concat","setAttribute","join","meta","selector","inputs","EventDirective","event","_getContext","module","parentInstance","replace","event$","fromEvent","pipe","shareReplay","expression","getAttribute","outputFunction","makeFunction","takeUntil","subscribe","resolve","Structure","Component","parse","RESERVED_PROPERTIES","Context","descriptors","_Component","mergeDescriptors","getPrototypeOf","defineProperties","self","ReferenceError","_assertThisInitialized","source","properties","getOwnPropertyNames","_loop","shift","indexOf","hasOwnProperty","getOwnPropertyDescriptor","value","_len","ForItem","$key","$value","index","count","_Context","Constructor","protoProps","staticProps","get","even","ForStructure","_Structure","instances","forbegin","document","createComment","parentNode","replaceChild","forend","insertBefore","nextSibling","removeAttribute","token","getExpressionToken","forFunction","iterable","context","result","isArray","Array","array","total","previous","Math","max","clonedNode","cloneNode","makeInstance","forItemContext","compile","removeChild","remove","trim","expressions","map","filter","forExpressions","keyValueMatches","match","indexExpressions","HrefDirective","href","IfStructure","ifbegin","ifend","ifFunction","element","InnerHtmlDirective","innerHTML","undefined","Pipe","transform","JsonPipe","_Pipe","JSON","stringify","name","ID","Module","componentNode","querySelectorsAll","selectors","factory","getParentInstance","makeContext","makeHosts","makeInputs","outputs","makeOutputs","resolveInputsOutputs","params","parseExpression","payload","childNodes","child","nodeType","getContextByNode","text","parseTextNode","keepInstance","keepContext","traverseDown","deleteContext","destroy","nodeInnerHTML","getInstance","Document","window","_this3","traverseUp","_this4","nodeExpressions","parseTextNodeExpression","wholeText","replacedText","reduce","c","nodeValue","textNode","createTextNode","pushFragment","from","to","fragment","substring","matches","regex","lastIndex","exec","hosts","getHost","nodeContexts","makeInput","input","hasAttribute","b","_this5","makeOutput","_this6","output$","tap","_this7","output","inputFunction","rx1","parsePipes","parseOptionalChaining","parsePipeParams","func","segments","word","block","t","substr","tokens","rxcompNodeId","id","keepContexts","complete","matchSelectors","results","selectorResult","template","selectorResults","find","callback","j","traversePrevious","previousSibling","traverseNext","current","SrcDirective","src","StyleDirective","style","previousStyle","propertyName","removeProperty","splitted","setProperty","factories","pipes","CoreModule","_Module","declarations","exports","ORDER","Browser","_Platform","Platform","bootstrap","moduleFactory","resolveMeta","isBrowser","Boolean","querySelector","resolveImportedMeta","resolvePipes","resolveFactories","sortFactories","unshift","unwrapSelectors","assign","imports","exported","importedPipes","importMeta","pipeFactory","_Array$prototype$conc","importedFactories","factoryList","sort","getExpressions","matchers","c1","a2","u3","v4","a5","e6","contains","nodeName","toLowerCase","excludes","matchSelector","unmatchSelector","includes","included","excluded","DatePipe","locale","options","dateStyle","timeStyle","toLocaleDateString","RootComponent","html","valueUndefined","valueDefined","ticks","items","date","interval","Root2Component","_Component2","AppModule","App2Module","_Module2","setTimeout"],"mappings":"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","file":"docs/js/test.parsing.min.js","sourcesContent":[null,"import { ReplaySubject, Subject } from 'rxjs';\nimport { IContext, IFactoryMeta } from './types';\n\nexport const CONTEXTS: { [key: number]: IContext } = {};\nexport const NODES: { [key: number]: IContext[] } = {};\n\nexport default class Factory {\n\n\tstatic meta: IFactoryMeta;\n\n\trxcompId: number = -1;\n\n\tunsubscribe$: Subject<void> = new Subject();\n\tchanges$: ReplaySubject<Factory> = new ReplaySubject(1);\n\n\tonInit(): void { }\n\tonChanges(changes: Factory | Window): void { }\n\tonView(): void { }\n\tonDestroy(): void { }\n\n\tpushChanges(): void {\n\t\tthis.changes$.next(this);\n\t\tthis.onView();\n\t}\n\n\t[key: string]: any; // extensible object\n\n\tconstructor(...args: any[]) { }\n}\n\nexport function getContext(instance: Factory): IContext {\n\treturn CONTEXTS[instance.rxcompId];\n}\n","import Factory from './factory';\n\nexport default class Directive extends Factory {\n}\n","// import Factory, { ExpressionFunction } from '../core/factory';\nimport Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nexport default class ClassDirective extends Directive {\n\n\tclass: { [key: string]: string } | string | null = '';\n\tkeys: string[] = [];\n\n\tonInit() {\n\t\tconst { node } = getContext(this);\n\t\tnode.classList.forEach(x => this.keys.push(x));\n\t}\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tlet keys: string[] = [];\n\t\tconst object = this.class;\n\t\tif (typeof object === 'object') {\n\t\t\tfor (let key in object) {\n\t\t\t\tif (object[key]) {\n\t\t\t\t\tkeys.push(key);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (typeof object === 'string') {\n\t\t\tkeys = object.split(/\\s+/);\n\t\t}\n\t\tkeys = keys.concat(this.keys);\n\t\t// console.log(keys);\n\t\tnode.setAttribute('class', keys.join(' '));\n\t\t// console.log('ClassDirective.onChanges', keys);\n\t}\n\n}\n\nClassDirective.meta = {\n\tselector: `[[class]]`,\n\tinputs: ['class']\n};\n","import { fromEvent, Observable } from 'rxjs';\nimport { shareReplay, takeUntil } from 'rxjs/operators';\nimport Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nconst EVENTS = ['mousedown', 'mouseup', 'mousemove', 'click', 'dblclick', 'mouseover', 'mouseout', 'mouseenter', 'mouseleave', 'contextmenu', 'touchstart', 'touchmove', 'touchend', 'keydown', 'keyup', 'input', 'change', 'loaded'];\n\nexport default class EventDirective extends Directive {\n\n\tevent: string = '';\n\n\tonInit() {\n\t\tconst { module, node, parentInstance, selector } = getContext(this);\n\t\t// console.log('parentInstance', parentInstance);\n\t\tconst event = this.event = selector.replace(/\\[|\\]|\\(|\\)/g, '');\n\t\tconst event$: Observable<Event> = fromEvent<Event>(node, event).pipe(shareReplay(1));\n\t\tconst expression = node.getAttribute(`(${event})`);\n\t\tif (expression) {\n\t\t\tconst outputFunction = module.makeFunction(expression, ['$event']);\n\t\t\tevent$.pipe(\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(event => {\n\t\t\t\tmodule.resolve(outputFunction, parentInstance, event);\n\t\t\t});\n\t\t} else {\n\t\t\tparentInstance[`${event}$`] = event$;\n\t\t}\n\t\t// console.log('EventDirective.onInit', 'selector', selector, 'event', event);\n\t}\n\n}\n\nEventDirective.meta = {\n\tselector: `[(${EVENTS.join(')],[(')})]`,\n};\n","import Factory from './factory';\n\nexport default class Structure extends Factory {\n}\n","\nimport Factory, { getContext } from './factory';\n\nexport default class Component extends Factory {\n\n\tpushChanges(): void {\n\t\tconst { module, node } = getContext(this);\n\t\t// console.log(new Error(`pushChanges ${instance.constructor.name}`).stack);\n\t\tthis.changes$.next(this);\n\t\t// console.log('Module.parse', instance.constructor.name);\n\t\t// parse component text nodes\n\t\tmodule.parse(node, this);\n\t\t// calling onView event\n\t\tthis.onView();\n\t}\n\n}\n","// import { BehaviorSubject, Subject } from 'rxjs';\nimport Component from './component';\nimport Factory from './factory';\n\nconst RESERVED_PROPERTIES = ['constructor', 'rxcompId', 'onInit', 'onChanges', 'onDestroy', 'pushChanges', 'changes$', 'unsubscribe$'];\n\nexport default class Context extends Component {\n\n\tconstructor(instance: Factory, descriptors: { [key: string]: PropertyDescriptor } = {}) {\n\t\tsuper();\n\t\tdescriptors = Context.mergeDescriptors(instance, instance, descriptors);\n\t\tdescriptors = Context.mergeDescriptors(Object.getPrototypeOf(instance), instance, descriptors);\n\t\tObject.defineProperties(this, descriptors);\n\t}\n\n\tstatic mergeDescriptors(source: Object, instance: Factory, descriptors: { [key: string]: PropertyDescriptor } = {}): { [key: string]: PropertyDescriptor } {\n\t\tconst properties: string[] = Object.getOwnPropertyNames(source);\n\t\twhile (properties.length) {\n\t\t\tconst key: string = properties.shift() as string;\n\t\t\tif (RESERVED_PROPERTIES.indexOf(key) === -1 && !descriptors.hasOwnProperty(key)) {\n\t\t\t\tconst descriptor: PropertyDescriptor = Object.getOwnPropertyDescriptor(source, key) as PropertyDescriptor;\n\t\t\t\tif (typeof descriptor.value == 'function') {\n\t\t\t\t\tdescriptor.value = (...args: any[]) => {\n\t\t\t\t\t\treturn instance[key].apply(instance, args);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tdescriptors[key] = descriptor;\n\t\t\t}\n\t\t}\n\t\treturn descriptors;\n\t}\n\n}\n","import Context from '../core/context';\nimport Factory from '../core/factory';\n\nexport default class ForItem extends Context {\n\n\tindex: number;\n\tcount: number;\n\t[key: string]: any;\n\n\t// !!! todo: payload options { key, $key, value, $value, index, count }\n\n\tconstructor(key: string, $key: number | string, value: string, $value: any, index: number, count: number, parentInstance: Factory) {\n\t\t// console.log('ForItem', arguments);\n\t\tsuper(parentInstance);\n\t\t/*\n\t\tsuper(parentInstance, {\n\t\t\t[key]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$key;\n\t\t\t\t},\n\t\t\t\tset: function(key) {\n\t\t\t\t\tthis.$key = key;\n\t\t\t\t}\n\t\t\t},\n\t\t\t[value]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\tthis.$value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t*/\n\t\tthis[key] = $key;\n\t\tthis[value] = $value;\n\t\tthis.index = index;\n\t\tthis.count = count;\n\t}\n\n\tget first(): boolean { return this.index === 0; }\n\n\tget last(): boolean { return this.index === this.count - 1; }\n\n\tget even(): boolean { return this.index % 2 === 0; }\n\n\tget odd(): boolean { return !this.even; }\n\n}\n","import Factory, { getContext } from '../core/factory';\nimport Structure from '../core/structure';\nimport { ExpressionFunction, IComment, IContext, IElement, IExpressionToken } from '../core/types';\nimport Module from '../module/module';\nimport ForItem from './for.item';\n\nexport default class ForStructure extends Structure {\n\n\tinstances: Factory[] = [];\n\tforend?: IComment;\n\ttoken?: IExpressionToken;\n\tforFunction?: ExpressionFunction;\n\n\tonInit() {\n\t\tconst { module, node } = getContext(this);\n\t\tconst forbegin: IComment = document.createComment(`*for begin`);\n\t\tforbegin.rxcompId = node.rxcompId;\n\t\tnode.parentNode!.replaceChild(forbegin, node);\n\t\tconst forend: IComment = this.forend = document.createComment(`*for end`);\n\t\tforbegin.parentNode!.insertBefore(forend, forbegin.nextSibling);\n\t\tconst expression: string = node.getAttribute('*for')!;\n\t\tnode.removeAttribute('*for');\n\t\tconst token = this.token = this.getExpressionToken(expression);\n\t\tthis.forFunction = module.makeFunction(token.iterable);\n\t}\n\n\tonChanges(changes: Factory | Window) {\n\t\tconst context: IContext = getContext(this);\n\t\tconst module: Module = context.module;\n\t\tconst node: IElement = context.node;\n\t\t// resolve\n\t\tconst token: IExpressionToken = this.token!;\n\t\tlet result = module.resolve(this.forFunction!, changes, this) || [];\n\t\tconst isArray = Array.isArray(result);\n\t\tconst array: any[] = isArray ? result : Object.keys(result);\n\t\tconst total: number = array.length;\n\t\tconst previous: number = this.instances.length;\n\t\tfor (let i: number = 0; i < Math.max(previous, total); i++) {\n\t\t\tif (i < total) {\n\t\t\t\tconst key: number | string = isArray ? i : array[i];\n\t\t\t\tconst value: any = isArray ? array[key as number] : result[key];\n\t\t\t\tif (i < previous) {\n\t\t\t\t\t// update\n\t\t\t\t\tconst instance: Factory = this.instances[i];\n\t\t\t\t\tinstance[token.key] = key;\n\t\t\t\t\tinstance[token.value] = value;\n\t\t\t\t\t/*\n\t\t\t\t\tif (!nextSibling) {\n\t\t\t\t\t\tconst context = getContext(instance);\n\t\t\t\t\t\tconst node = context.node;\n\t\t\t\t\t\tthis.forend.parentNode.insertBefore(node, this.forend);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextSibling = nextSibling.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t} else {\n\t\t\t\t\t// create\n\t\t\t\t\tconst clonedNode: IElement = node.cloneNode(true) as IElement;\n\t\t\t\t\tdelete clonedNode.rxcompId;\n\t\t\t\t\tthis.forend!.parentNode!.insertBefore(clonedNode, this.forend!);\n\t\t\t\t\t// !!! todo: check context.parentInstance\n\t\t\t\t\tconst args = [token.key, key, token.value, value, i, total, context.parentInstance];\n\t\t\t\t\tconst instance = module.makeInstance(clonedNode, ForItem, context.selector, context.parentInstance, args);\n\t\t\t\t\tif (instance) {\n\t\t\t\t\t\tconst forItemContext = getContext(instance);\n\t\t\t\t\t\t// console.log('ForStructure', clonedNode, forItemContext.instance.constructor.name);\n\t\t\t\t\t\tmodule.compile(clonedNode, forItemContext.instance);\n\t\t\t\t\t\t// nextSibling = clonedNode.nextSibling;\n\t\t\t\t\t\tthis.instances.push(instance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// remove\n\t\t\t\tconst instance: Factory = this.instances[i];\n\t\t\t\tconst { node } = getContext(instance);\n\t\t\t\tnode.parentNode!.removeChild(node);\n\t\t\t\tmodule.remove(node);\n\t\t\t}\n\t\t}\n\t\tthis.instances.length = array.length;\n\t\t// console.log('ForStructure', this.instances, token);\n\t}\n\n\tgetExpressionToken(expression: string): IExpressionToken {\n\t\tif (expression === null) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tif (expression.trim().indexOf('let ') === -1 || expression.trim().indexOf(' of ') === -1) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tconst expressions: string[] = expression.split(';').map(x => x.trim()).filter(x => x !== '');\n\t\tconst forExpressions: string[] = expressions[0].split(' of ').map(x => x.trim());\n\t\tlet value: string = forExpressions[0].replace(/\\s*let\\s*/, '');\n\t\tconst iterable: string = forExpressions[1];\n\t\tlet key: string = 'index';\n\t\tconst keyValueMatches: RegExpMatchArray | null = value.match(/\\[(.+)\\s*,\\s*(.+)\\]/);\n\t\tif (keyValueMatches) {\n\t\t\tkey = keyValueMatches[1];\n\t\t\tvalue = keyValueMatches[2];\n\t\t}\n\t\tif (expressions.length > 1) {\n\t\t\tconst indexExpressions: string[] = expressions[1].split(/\\s*let\\s*|\\s*=\\s*index/).map(x => x.trim());\n\t\t\tif (indexExpressions.length === 3) {\n\t\t\t\tkey = indexExpressions[1];\n\t\t\t}\n\t\t}\n\t\treturn { key, value, iterable };\n\t}\n\n}\n\nForStructure.meta = {\n\tselector: '[*for]',\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nexport default class HrefDirective extends Directive {\n\n\thref?: string;\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tnode.setAttribute('href', this.href || '');\n\t}\n\n}\n\nHrefDirective.meta = {\n\tselector: '[[href]]',\n\tinputs: ['href'],\n};\n","import Factory, { getContext } from '../core/factory';\nimport Structure from '../core/structure';\nimport { ExpressionFunction, IComment, IElement } from '../core/types';\n\nexport default class IfStructure extends Structure {\n\n\tifend?: IComment;\n\tifFunction?: ExpressionFunction;\n\tclonedNode?: IElement;\n\telement?: IElement;\n\n\tonInit() {\n\t\tconst { module, node } = getContext(this);\n\t\tconst ifbegin: IComment = this.ifbegin = document.createComment(`*if begin`);\n\t\tifbegin.rxcompId = node.rxcompId;\n\t\tnode.parentNode!.replaceChild(ifbegin, node);\n\t\tconst ifend = this.ifend = document.createComment(`*if end`);\n\t\tifbegin.parentNode!.insertBefore(ifend, ifbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*if');\n\t\tthis.ifFunction = module.makeFunction(expression!);\n\t\tconst clonedNode = node.cloneNode(true) as IElement;\n\t\tclonedNode.removeAttribute('*if');\n\t\tthis.clonedNode = clonedNode;\n\t\tthis.element = clonedNode.cloneNode(true) as IElement;\n\t\t// console.log('IfStructure.expression', expression);\n\t}\n\n\tonChanges(changes: Factory | Window) {\n\t\tconst { module } = getContext(this);\n\t\t// console.log('IfStructure.onChanges', changes);\n\t\tconst value = module.resolve(this.ifFunction!, changes, this);\n\t\tconst element: IElement = this.element!;\n\t\tif (value) {\n\t\t\tif (!element.parentNode) {\n\t\t\t\tconst ifend = this.ifend!;\n\t\t\t\tifend.parentNode!.insertBefore(element, ifend);\n\t\t\t\tmodule.compile(element);\n\t\t\t}\n\t\t} else {\n\t\t\tif (element.parentNode) {\n\t\t\t\tmodule.remove(element, this);\n\t\t\t\telement.parentNode.removeChild(element);\n\t\t\t\tthis.element = this.clonedNode!.cloneNode(true) as IElement;\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic meta = {\n\t\tselector: '[*if]',\n\t};\n\n}\n","import Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nexport default class InnerHtmlDirective extends Directive {\n\n\tinnerHTML?: string;\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tnode.innerHTML = this.innerHTML == undefined ? '' : this.innerHTML; // !!! keep == loose equality\n\t}\n\n}\n\nInnerHtmlDirective.meta = {\n\tselector: `[innerHTML]`,\n\tinputs: ['innerHTML'],\n};\n","import { IPipeMeta } from \"./types\";\n\nexport default class Pipe {\n\n\tstatic transform(value: any): any {\n\t\treturn value;\n\t}\n\n\tstatic meta: IPipeMeta;\n}\n","import Pipe from '../core/pipe';\n\nexport default class JsonPipe extends Pipe {\n\n\t// !!! todo: Remove circular structures when converting to JSON\n\n\tstatic transform(value: any): string {\n\t\treturn JSON.stringify(value, null, '\\t');\n\t}\n\n}\n\nJsonPipe.meta = {\n\tname: 'json',\n};\n","import { Observable, Subject } from 'rxjs';\nimport { takeUntil, tap } from 'rxjs/operators';\nimport Component from '../core/component';\nimport Context from '../core/context';\nimport Factory, { CONTEXTS, getContext, NODES } from '../core/factory';\nimport Structure from '../core/structure';\nimport { ExpressionFunction, IContext, IElement, IFactoryMeta, IModuleMeta, IModuleParsedMeta, ISelectorResult, IText, SelectorFunction } from '../core/types';\n\nlet ID: number = 0;\n\nexport default class Module {\n\n\tmeta?: IModuleParsedMeta;\n\n\tpublic compile(node: IElement, parentInstance?: Factory | Window): Factory[] {\n\t\tlet componentNode: IElement;\n\t\tconst instances: Factory[] = Module.querySelectorsAll(node, this.meta!.selectors, []).map((match: ISelectorResult) => {\n\t\t\tif (componentNode && componentNode !== match.node) {\n\t\t\t\tparentInstance = undefined;\n\t\t\t}\n\t\t\tconst instance: Factory | undefined = this.makeInstance(match.node, match.factory, match.selector, parentInstance);\n\t\t\tif (match.factory.prototype instanceof Component) {\n\t\t\t\tcomponentNode = match.node;\n\t\t\t}\n\t\t\treturn instance;\n\t\t}).filter((x): x is Factory => x !== undefined);\n\t\t// console.log('compile', instances, node, parentInstance);\n\t\treturn instances;\n\t}\n\n\tpublic makeInstance(node: IElement, factory: typeof Factory, selector: string, parentInstance?: Factory | Window, args?: any[]): Factory | undefined {\n\t\tif (parentInstance || node.parentNode) {\n\t\t\tconst meta: IFactoryMeta = factory.meta;\n\t\t\t// collect parentInstance scope\n\t\t\tparentInstance = parentInstance || this.getParentInstance(node.parentNode);\n\t\t\tif (!parentInstance) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\t// creating factory instance\n\t\t\tconst instance = new factory(...(args || []));\n\t\t\t// creating instance context\n\t\t\tconst context = Module.makeContext(this, instance, parentInstance, node, factory, selector);\n\t\t\t// creating component input and outputs\n\t\t\tif (meta) {\n\t\t\t\tthis.makeHosts(meta, instance, node);\n\t\t\t\tcontext.inputs = this.makeInputs(meta, instance);\n\t\t\t\tcontext.outputs = this.makeOutputs(meta, instance);\n\t\t\t\tif (parentInstance instanceof Factory) {\n\t\t\t\t\tthis.resolveInputsOutputs(instance, parentInstance);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// calling onInit event\n\t\t\tinstance.onInit();\n\t\t\t// subscribe to parent changes\n\t\t\tif (parentInstance instanceof Factory) {\n\t\t\t\tparentInstance.changes$.pipe(\n\t\t\t\t\t// filter(() => node.parentNode),\n\t\t\t\t\t// debounceTime(1),\n\t\t\t\t\t/*\n\t\t\t\t\tdistinctUntilChanged(function(prev, curr) {\n\t\t\t\t\t\t// console.log(isComponent, context.inputs);\n\t\t\t\t\t\tif (isComponent && meta && Object.keys(context.inputs).length === 0) {\n\t\t\t\t\t\t\treturn true; // same\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\t*/\n\t\t\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t\t\t).subscribe((changes: Factory | Window) => {\n\t\t\t\t\t// resolve component input outputs\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tthis.resolveInputsOutputs(instance, changes);\n\t\t\t\t\t}\n\t\t\t\t\t// calling onChanges event with changes\n\t\t\t\t\tinstance.onChanges(changes);\n\t\t\t\t\t// push instance changes for subscribers\n\t\t\t\t\tinstance.pushChanges();\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn instance;\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tpublic makeFunction(expression: string, params: string[] = ['$instance']): ExpressionFunction {\n\t\tif (expression) {\n\t\t\texpression = Module.parseExpression(expression);\n\t\t\t// console.log(expression);\n\t\t\tconst args: string = params.join(',');\n\t\t\tconst expression_func: ExpressionFunction = new Function(`with(this) {\n\t\t\t\treturn (function (${args}, $$module) {\n\t\t\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`) as ExpressionFunction;\n\t\t\t// console.log(this, $$module, $$pipes, \"${expression}\");\n\t\t\t// console.log(expression_func);\n\t\t\treturn expression_func;\n\t\t} else {\n\t\t\treturn () => { return null; };\n\t\t}\n\t}\n\n\tpublic resolve(expression: ExpressionFunction, parentInstance: Factory | Window, payload: any): any {\n\t\t// console.log(expression, parentInstance, payload);\n\t\treturn expression.apply(parentInstance, [payload, this]);\n\t}\n\n\tpublic parse(node: IElement, instance: Factory): void {\n\t\tfor (let i: number = 0; i < node.childNodes.length; i++) {\n\t\t\tconst child: ChildNode = node.childNodes[i];\n\t\t\tif (child.nodeType === 1) {\n\t\t\t\tconst element: HTMLElement = child as HTMLElement;\n\t\t\t\tconst context: IContext | void = getContextByNode(element);\n\t\t\t\tif (!context) {\n\t\t\t\t\tthis.parse(element, instance);\n\t\t\t\t}\n\t\t\t} else if (child.nodeType === 3) {\n\t\t\t\tconst text: IText = child as IText;\n\t\t\t\tthis.parseTextNode(text, instance);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic remove(node: Node, keepInstance?: Factory): Node {\n\t\tconst keepContext: IContext | undefined = keepInstance ? getContext(keepInstance) : undefined;\n\t\tModule.traverseDown(node, (node: Node) => {\n\t\t\tconst rxcompId: number | undefined = (node as IElement).rxcompId;\n\t\t\tif (rxcompId) {\n\t\t\t\tconst keepContexts: IContext[] = Module.deleteContext(rxcompId, keepContext);\n\t\t\t\tif (keepContexts.length === 0) {\n\t\t\t\t\tdelete (node as IElement).rxcompId;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn node;\n\t}\n\n\tpublic destroy(): void {\n\t\tthis.remove(this.meta!.node);\n\t\tthis.meta!.node.innerHTML = this.meta!.nodeInnerHTML;\n\t}\n\n\tprotected makeContext(instance: Factory, parentInstance: Factory | Window, node: IElement, selector: string): IContext {\n\t\tconst context: IContext = Module.makeContext(this, instance, parentInstance, node, instance.constructor as typeof Factory, selector);\n\t\t// console.log('Module.makeContext', context, context.instance, context.node);\n\t\treturn context;\n\t}\n\n\tprotected getInstance(node: HTMLElement | Document): Factory | Window | undefined {\n\t\tif (node instanceof Document) {\n\t\t\treturn window; // !!! window or global\n\t\t}\n\t\tconst context: IContext | undefined = getContextByNode(node);\n\t\tif (context) {\n\t\t\treturn context.instance;\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprotected getParentInstance(node: Node | null): Factory | Window {\n\t\treturn Module.traverseUp(node, (node: Node) => {\n\t\t\treturn this.getInstance(node as HTMLElement);\n\t\t});\n\t}\n\n\t// reduce(callbackfn: (previousValue: T, currentValue: T, currentIndex: number, array: T[]) => T, initialValue: T): T;\n\n\tprotected parseTextNode(node: IText, instance: Factory): void {\n\t\tlet expressions: (ExpressionFunction | string)[] | undefined = node.nodeExpressions;\n\t\tif (!expressions) {\n\t\t\texpressions = this.parseTextNodeExpression(node.wholeText);\n\t\t}\n\t\tconst replacedText: string = expressions.reduce((p: string, c: ExpressionFunction | string) => {\n\t\t\tlet text: string;\n\t\t\tif (typeof c === 'function') { // instanceOf ExpressionFunction ?;\n\t\t\t\ttext = this.resolve(c as ExpressionFunction, instance, instance);\n\t\t\t\tif (text == undefined) { // !!! keep == loose equality\n\t\t\t\t\ttext = '';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttext = c;\n\t\t\t}\n\t\t\treturn p + text;\n\t\t}, '');\n\t\tif (node.nodeValue !== replacedText) {\n\t\t\tconst textNode: IText = document.createTextNode(replacedText) as IText;\n\t\t\ttextNode.nodeExpressions = expressions;\n\t\t\tnode.parentNode!.replaceChild(textNode, node);\n\t\t}\n\t}\n\n\tprotected pushFragment(nodeValue: string, from: number, to: number, expressions: (ExpressionFunction | string)[]): void {\n\t\tconst fragment: string = nodeValue.substring(from, to);\n\t\texpressions.push(fragment);\n\t}\n\n\tprotected parseTextNodeExpression(nodeValue: string): (ExpressionFunction | string)[] {\n\t\tconst expressions: (ExpressionFunction | string)[] = [];\n\t\tconst regex: RegExp = /\\{{2}((([^{}])|(\\{([^{}]|(\\{.*?\\}))+?\\}))*?)\\}{2}/g;\n\t\tlet lastIndex: number = 0,\n\t\t\tmatches: RegExpExecArray | null;\n\t\twhile ((matches = regex.exec(nodeValue)) !== null) {\n\t\t\tconst index: number = regex.lastIndex - matches[0].length;\n\t\t\tif (index > lastIndex) {\n\t\t\t\tthis.pushFragment(nodeValue, index, lastIndex, expressions);\n\t\t\t}\n\t\t\tlastIndex = regex.lastIndex;\n\t\t\tconst expression: ExpressionFunction = this.makeFunction(matches[1]);\n\t\t\texpressions.push(expression);\n\t\t}\n\t\tconst length: number = nodeValue.length;\n\t\tif (length > lastIndex) {\n\t\t\tthis.pushFragment(nodeValue, lastIndex, length, expressions);\n\t\t}\n\t\treturn expressions;\n\t}\n\n\tprotected makeHosts(meta: IFactoryMeta, instance: Factory, node: IElement): void {\n\t\tif (meta.hosts) {\n\t\t\tObject.keys(meta.hosts).forEach((key: string) => {\n\t\t\t\tconst factory: typeof Factory = meta.hosts![key];\n\t\t\t\tinstance[key] = getHost(instance, factory, node);\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected makeInput(instance: Factory, key: string): ExpressionFunction | null {\n\t\tconst { node } = getContext(instance);\n\t\tlet input: ExpressionFunction | null = null,\n\t\t\texpression: string | null = null;\n\t\tif (node.hasAttribute(`[${key}]`)) {\n\t\t\texpression = node.getAttribute(`[${key}]`)!;\n\t\t} else if (node.hasAttribute(key)) {\n\t\t\t// const attribute = node.getAttribute(key).replace(/{{/g, '\"+').replace(/}}/g, '+\"');\n\t\t\tconst attribute: string = node.getAttribute(key)!.replace(/({{)|(}})|(\")/g, function (substring: string, a, b, c) {\n\t\t\t\tif (a) {\n\t\t\t\t\treturn '\"+';\n\t\t\t\t}\n\t\t\t\tif (b) {\n\t\t\t\t\treturn '+\"';\n\t\t\t\t}\n\t\t\t\tif (c) {\n\t\t\t\t\treturn '\\\"';\n\t\t\t\t}\n\t\t\t\treturn '';\n\t\t\t});\n\t\t\texpression = `\"${attribute}\"`;\n\t\t}\n\t\tif (expression) {\n\t\t\tinput = this.makeFunction(expression);\n\t\t}\n\t\treturn input;\n\t}\n\n\tprotected makeInputs(meta: IFactoryMeta, instance: Factory): { [key: string]: ExpressionFunction } {\n\t\tconst inputs: { [key: string]: ExpressionFunction } = {};\n\t\tif (meta.inputs) {\n\t\t\tmeta.inputs.forEach((key: string, i: number) => {\n\t\t\t\tconst input = this.makeInput(instance, key);\n\t\t\t\tif (input) {\n\t\t\t\t\tinputs[key] = input;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn inputs;\n\t}\n\n\tprotected makeOutput(instance: Factory, key: string): Observable<any> {\n\t\tconst context: IContext = getContext(instance);\n\t\tconst node: IElement = context.node;\n\t\tconst parentInstance: Factory | Window = context.parentInstance;\n\t\tconst expression: string | null = node.getAttribute(`(${key})`);\n\t\tconst outputFunction: ExpressionFunction | null = expression ? this.makeFunction(expression, ['$event']) : null;\n\t\tconst output$: Observable<any> = new Subject<any>().pipe(\n\t\t\ttap((event) => {\n\t\t\t\tif (outputFunction) {\n\t\t\t\t\t// console.log(expression, parentInstance);\n\t\t\t\t\tthis.resolve(outputFunction, parentInstance, event);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\toutput$.pipe(\n\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t).subscribe();\n\t\tinstance[key] = output$;\n\t\treturn output$;\n\t}\n\n\tprotected makeOutputs(meta: IFactoryMeta, instance: Factory): { [key: string]: Observable<any> } {\n\t\tconst outputs: { [key: string]: Observable<any> } = {};\n\t\tif (meta.outputs) {\n\t\t\tmeta.outputs.forEach((key: string) => {\n\t\t\t\tconst output = this.makeOutput(instance, key);\n\t\t\t\tif (output) {\n\t\t\t\t\toutputs[key] = output;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn outputs;\n\t}\n\n\tprotected resolveInputsOutputs(instance: Factory, changes: Factory | Window): void {\n\t\tconst context: IContext = getContext(instance);\n\t\tconst parentInstance: Factory | Window = context.parentInstance;\n\t\tconst inputs: { [key: string]: ExpressionFunction } = context.inputs!;\n\t\tfor (let key in inputs) {\n\t\t\tconst inputFunction: ExpressionFunction = inputs[key];\n\t\t\tconst value: any = this.resolve(inputFunction, parentInstance, instance);\n\t\t\tinstance[key] = value;\n\t\t}\n\t}\n\n\tprotected static parseExpression(expression: string): string {\n\t\tconst l: string = '';\n\t\tconst r: string = '';\n\t\tconst rx1: RegExp = /(\\()([^\\(\\)]*)(\\))/;\n\t\twhile (expression.match(rx1)) {\n\t\t\texpression = expression.replace(rx1, function (substring: string, ...args: any[]) {\n\t\t\t\treturn `${l}${Module.parsePipes(args[1])}${r}`;\n\t\t\t});\n\t\t}\n\t\texpression = Module.parsePipes(expression);\n\t\texpression = expression.replace(/()|()/g, function (substring: string, ...args) {\n\t\t\treturn args[0] ? '(' : ')';\n\t\t});\n\t\treturn Module.parseOptionalChaining(expression);\n\t}\n\n\tprotected static parsePipes(expression: string): string {\n\t\tconst l: string = '';\n\t\tconst r: string = '';\n\t\tconst rx1: RegExp = /(.*?[^\\|])\\|([^\\|]+)/;\n\t\twhile (expression.match(rx1)) {\n\t\t\texpression = expression.replace(rx1, function (substring: string, ...args: any[]) {\n\t\t\t\tconst value: string = args[0].trim();\n\t\t\t\tconst params: string[] = Module.parsePipeParams(args[1]);\n\t\t\t\tconst func: string = params.shift()!.trim();\n\t\t\t\treturn `$$pipes.${func}.transform${l}${[value, ...params]}${r}`;\n\t\t\t});\n\t\t}\n\t\treturn expression;\n\t}\n\n\tprotected static parsePipeParams(expression: string): string[] {\n\t\tconst segments: string[] = [];\n\t\tlet i: number = 0,\n\t\t\tword: string = '',\n\t\t\tblock: number = 0;\n\t\tconst t: number = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c: string = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === ':' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word.trim());\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word.trim());\n\t\t}\n\t\treturn segments;\n\t}\n\n\tprotected static parseOptionalChaining(expression: string): string {\n\t\tconst regex: RegExp = /(\\w+(\\?\\.))+([\\.|\\w]+)/g;\n\t\tlet previous: string;\n\t\texpression = expression.replace(regex, function (substring: string, ...args: any[]) {\n\t\t\tconst tokens: string[] = substring.split('?.');\n\t\t\tfor (let i: number = 0; i < tokens.length - 1; i++) {\n\t\t\t\tconst a: string = i > 0 ? `(${tokens[i]} = ${previous})` : tokens[i];\n\t\t\t\tconst b: string = tokens[i + 1];\n\t\t\t\tprevious = i > 0 ? `${a}.${b}` : `(${a} ? ${a}.${b} : void 0)`;\n\t\t\t}\n\t\t\treturn previous || '';\n\t\t});\n\t\treturn expression;\n\t}\n\n\tprotected static makeContext(module: Module, instance: Factory, parentInstance: Factory | Window, node: IElement, factory: typeof Factory, selector: string): IContext {\n\t\tinstance.rxcompId = ++ID;\n\t\tconst context: IContext = { module, instance, parentInstance, node, factory, selector };\n\t\tconst rxcompNodeId = node.rxcompId = (node.rxcompId || instance.rxcompId);\n\t\tconst nodeContexts = NODES[rxcompNodeId] || (NODES[rxcompNodeId] = []);\n\t\tnodeContexts.push(context);\n\t\tCONTEXTS[instance.rxcompId] = context;\n\t\treturn context;\n\t}\n\n\tprotected static deleteContext(id: number, keepContext: IContext | undefined): IContext[] {\n\t\tconst keepContexts: IContext[] = [];\n\t\tconst nodeContexts: IContext[] = NODES[id];\n\t\tif (nodeContexts) {\n\t\t\tnodeContexts.forEach((context: IContext) => {\n\t\t\t\tif (context === keepContext) {\n\t\t\t\t\tkeepContexts.push(keepContext);\n\t\t\t\t} else {\n\t\t\t\t\tconst instance: Factory = context.instance;\n\t\t\t\t\tinstance.unsubscribe$.next();\n\t\t\t\t\tinstance.unsubscribe$.complete();\n\t\t\t\t\tinstance.onDestroy();\n\t\t\t\t\tdelete CONTEXTS[instance.rxcompId];\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (keepContexts.length) {\n\t\t\t\tNODES[id] = keepContexts;\n\t\t\t} else {\n\t\t\t\tdelete NODES[id];\n\t\t\t}\n\t\t}\n\t\treturn keepContexts;\n\t}\n\n\tprotected static matchSelectors(node: HTMLElement, selectors: SelectorFunction[], results: ISelectorResult[]): ISelectorResult[] {\n\t\tfor (let i: number = 0; i < selectors.length; i++) {\n\t\t\tconst selectorResult: ISelectorResult | false = selectors[i](node);\n\t\t\tif (selectorResult) {\n\t\t\t\tconst factory: typeof Factory = selectorResult.factory;\n\t\t\t\tif (factory.prototype instanceof Component && factory.meta.template) {\n\t\t\t\t\tnode.innerHTML = factory.meta.template;\n\t\t\t\t}\n\t\t\t\tresults.push(selectorResult);\n\t\t\t\tif (factory.prototype instanceof Structure) {\n\t\t\t\t\t// console.log('Structure', node);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tprotected static querySelectorsAll(node: Node, selectors: SelectorFunction[], results: ISelectorResult[]): ISelectorResult[] {\n\t\tif (node.nodeType === 1) {\n\t\t\tconst selectorResults: ISelectorResult[] = this.matchSelectors(node as HTMLElement, selectors, []);\n\t\t\tresults = results.concat(selectorResults);\n\t\t\tconst structure: ISelectorResult | undefined = selectorResults.find(x => x.factory.prototype instanceof Structure);\n\t\t\tif (structure) {\n\t\t\t\treturn results;\n\t\t\t}\n\t\t\tconst childNodes: NodeListOf<ChildNode> = node.childNodes;\n\t\t\tfor (let i: number = 0; i < childNodes.length; i++) {\n\t\t\t\tresults = this.querySelectorsAll(childNodes[i], selectors, results);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tprotected static traverseUp(node: Node | null, callback: (node: Node, i: number) => any, i: number = 0): any {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseUp(node.parentNode, callback, i + 1);\n\t}\n\n\tprotected static traverseDown(node: Node | null, callback: (node: Node, i: number) => any, i: number = 0): any {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tlet result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tif (node.nodeType === 1) {\n\t\t\tlet j = 0,\n\t\t\t\tt = node.childNodes.length;\n\t\t\twhile (j < t && !result) {\n\t\t\t\tresult = this.traverseDown(node.childNodes[j], callback, i + 1);\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected static traversePrevious(node: Node | null, callback: (node: Node, i: number) => any, i: number = 0): any {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traversePrevious(node.previousSibling, callback, i + 1);\n\t}\n\n\tprotected static traverseNext(node: Node | null, callback: (node: Node, i: number) => any, i: number = 0): any {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseNext(node.nextSibling, callback, i + 1);\n\t}\n\n\tstatic meta: IModuleMeta;\n\n}\n\nexport function getContextByNode(node: Node): IContext | undefined {\n\tlet context: IContext | undefined;\n\tconst rxcompId: number | undefined = (node as IElement).rxcompId;\n\tif (rxcompId) {\n\t\tconst nodeContexts: IContext[] = NODES[rxcompId];\n\t\tif (nodeContexts) {\n\t\t\tcontext = nodeContexts.reduce((previous: IContext | undefined, current: IContext) => {\n\t\t\t\tif (current.factory.prototype instanceof Component) {\n\t\t\t\t\treturn current;\n\t\t\t\t} else if (current.factory.prototype instanceof Context) {\n\t\t\t\t\treturn previous ? previous : current;\n\t\t\t\t} else {\n\t\t\t\t\treturn previous;\n\t\t\t\t}\n\t\t\t}, undefined);\n\t\t\t// console.log(node.rxcompId, context);\n\t\t}\n\t}\n\treturn context;\n}\n\nexport function getHost(instance: Factory, factory: typeof Factory, node: IElement): Factory | undefined {\n\tif (!node) {\n\t\tnode = getContext(instance).node;\n\t}\n\tif (node.rxcompId) {\n\t\tconst nodeContexts: IContext[] = NODES[node.rxcompId];\n\t\tif (nodeContexts) {\n\t\t\t// console.log(nodeContexts);\n\t\t\tfor (let i: number = 0; i < nodeContexts.length; i++) {\n\t\t\t\tconst context: IContext = nodeContexts[i];\n\t\t\t\tif (context.instance !== instance) {\n\t\t\t\t\t// console.log(context.instance, instance);\n\t\t\t\t\tif (context.instance instanceof factory) {\n\t\t\t\t\t\treturn context.instance;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (node.parentNode) {\n\t\treturn getHost(instance, factory, node.parentNode as IElement);\n\t} else {\n\t\treturn undefined;\n\t}\n}\n","import Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nexport default class SrcDirective extends Directive {\n\n\tsrc?: string;\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tif (this.src) {\n\t\t\tnode.setAttribute('src', this.src);\n\t\t} else {\n\t\t\tnode.removeAttribute('src');\n\t\t}\n\t}\n\n}\n\nSrcDirective.meta = {\n\tselector: '[[src]]',\n\tinputs: ['src'],\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nexport default class StyleDirective extends Directive {\n\n\tstyle?: { [key: string]: string } | null;\n\tpreviousStyle?: { [key: string]: string } | null;\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tconst style = this.style;\n\t\tconst previousStyle = this.previousStyle;\n\t\tif (previousStyle) {\n\t\t\tfor (let key in previousStyle) {\n\t\t\t\tif (!style || !style[key]) {\n\t\t\t\t\tconst splitted: string[] = key.split('.');\n\t\t\t\t\tconst propertyName = splitted.shift();\n\t\t\t\t\tnode.style.removeProperty(propertyName!);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (style) {\n\t\t\tfor (let key in style) {\n\t\t\t\tif (!previousStyle || previousStyle[key] !== style[key]) {\n\t\t\t\t\tconst splitted: string[] = key.split('.');\n\t\t\t\t\tconst propertyName = splitted.shift();\n\t\t\t\t\tconst value = style[key] + (splitted.length ? splitted[0] : '');\n\t\t\t\t\t// console.log(propertyName, value, style, key, style[key]);\n\t\t\t\t\tnode.style.setProperty(propertyName!, value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.previousStyle = style;\n\t\t// console.log('StyleDirective.onChanges', style);\n\t}\n\n}\n\nStyleDirective.meta = {\n\tselector: `[[style]]`,\n\tinputs: ['style']\n};\n","\nimport ClassDirective from './class/class.directive';\nimport Factory from './core/factory';\nimport Pipe from './core/pipe';\nimport EventDirective from './event/event.directive';\nimport ForStructure from './for/for.structure';\nimport HrefDirective from './href/href.directive';\nimport IfStructure from './if/if.structure';\nimport InnerHtmlDirective from './inner-html/inner-html.directive';\nimport JsonPipe from './json/json.pipe';\nimport Module from './module/module';\nimport SrcDirective from './src/src.directive';\nimport StyleDirective from './style/style.directive';\n\nconst factories: typeof Factory[] = [\n\tClassDirective,\n\tEventDirective,\n\tForStructure,\n\tHrefDirective,\n\tIfStructure,\n\tInnerHtmlDirective,\n\tSrcDirective,\n\tStyleDirective,\n];\n\nconst pipes: typeof Pipe[] = [\n\tJsonPipe,\n];\n\nexport default class CoreModule extends Module {\n\n\tstatic meta = {\n\t\tdeclarations: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t],\n\t\texports: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t]\n\t};\n\n}\n","import Component from '../core/component';\nimport Directive from '../core/directive';\nimport Factory from '../core/factory';\nimport Pipe from '../core/pipe';\nimport Structure from '../core/structure';\nimport { FactoryList, IElement, IModuleParsedImportedMeta, IModuleParsedMeta, ISelectorResult, MatchFunction, PipeList, PipeMap, SelectorFunction } from '../core/types';\nimport Module from '../module/module';\n\nconst ORDER: FactoryList = [Structure, Component, Directive];\n\nexport default class Platform {\n\n\tstatic bootstrap(moduleFactory?: typeof Module): Module {\n\t\tif (!moduleFactory) {\n\t\t\tthrow ('missing moduleFactory');\n\t\t}\n\t\tif (!moduleFactory.meta) {\n\t\t\tthrow ('missing moduleFactory meta');\n\t\t}\n\t\tif (!moduleFactory.meta.bootstrap) {\n\t\t\tthrow ('missing bootstrap');\n\t\t}\n\t\tif (!moduleFactory.meta.bootstrap.meta) {\n\t\t\tthrow ('missing bootstrap meta');\n\t\t}\n\t\tif (!moduleFactory.meta.bootstrap.meta.selector) {\n\t\t\tthrow ('missing bootstrap meta selector');\n\t\t}\n\t\tconst meta: IModuleParsedMeta = this.resolveMeta(moduleFactory!);\n\t\tconst module = new moduleFactory();\n\t\tmodule.meta = meta;\n\t\tconst instances = module.compile(meta.node, window);\n\t\tconst root = instances[0];\n\t\t// if (root instanceof module.meta.bootstrap) {\n\t\troot.pushChanges();\n\t\t// }\n\t\treturn module;\n\t}\n\n\tstatic isBrowser(): boolean {\n\t\treturn Boolean(window);\n\t}\n\n\t// static isServer() {}\n\n\tprotected static querySelector(selector: string): IElement | null {\n\t\treturn document.querySelector(selector);\n\t}\n\n\tprotected static resolveMeta(moduleFactory: typeof Module): IModuleParsedMeta {\n\t\tconst meta: IModuleParsedImportedMeta = this.resolveImportedMeta(moduleFactory);\n\t\tconst bootstrap: typeof Factory = moduleFactory.meta.bootstrap!;\n\t\tconst node = this.querySelector(bootstrap.meta.selector!);\n\t\tif (!node) {\n\t\t\tthrow (`missing node ${bootstrap.meta.selector}`);\n\t\t}\n\t\tconst nodeInnerHTML = node.innerHTML;\n\t\tconst pipes = this.resolvePipes(meta);\n\t\tconst factories = this.resolveFactories(meta);\n\t\tthis.sortFactories(factories);\n\t\tfactories.unshift(bootstrap);\n\t\tconst selectors = this.unwrapSelectors(factories);\n\t\treturn { factories, pipes, selectors, bootstrap, node, nodeInnerHTML };\n\t}\n\n\tprotected static resolveImportedMeta(moduleFactory: typeof Module): IModuleParsedImportedMeta {\n\t\tconst meta: IModuleParsedImportedMeta = Object.assign({\n\t\t\timports: [],\n\t\t\tdeclarations: [],\n\t\t\tpipes: [],\n\t\t\texports: []\n\t\t}, moduleFactory.meta);\n\t\tmeta.imports = (moduleFactory.meta.imports || []).map(moduleFactory => this.resolveImportedMeta(moduleFactory));\n\t\treturn meta;\n\t}\n\n\tprotected static resolvePipes(meta: IModuleParsedImportedMeta, exported?: boolean): PipeMap {\n\t\tconst importedPipes: PipeMap[] = meta.imports.map((importMeta: IModuleParsedImportedMeta) => this.resolvePipes(importMeta, true));\n\t\tconst pipes: PipeMap = {};\n\t\tconst pipeList: PipeList = (exported ? meta.exports : meta.declarations).filter((x): x is typeof Pipe => x.prototype instanceof Pipe);\n\t\tpipeList.forEach(pipeFactory => pipes[pipeFactory.meta.name] = pipeFactory);\n\t\treturn Object.assign({}, ...importedPipes, pipes);\n\t}\n\n\tprotected static resolveFactories(meta: IModuleParsedImportedMeta, exported?: boolean): FactoryList {\n\t\tconst importedFactories: FactoryList[] = meta.imports.map((importMeta: any) => this.resolveFactories(importMeta, true));\n\t\tconst factoryList: FactoryList = (exported ? meta.exports : meta.declarations).filter((x): x is typeof Factory => x.prototype instanceof Factory);\n\t\treturn Array.prototype.concat.call(factoryList, ...importedFactories);\n\t}\n\n\tprotected static sortFactories(factories: FactoryList): void {\n\t\tfactories.sort((a, b) => {\n\t\t\tconst ai = ORDER.reduce((p, c, i) => a.prototype instanceof c ? i : p, -1);\n\t\t\tconst bi = ORDER.reduce((p, c, i) => b.prototype instanceof c ? i : p, -1);\n\t\t\t// return ai - bi;\n\t\t\tconst o = ai - bi;\n\t\t\tif (o === 0) {\n\t\t\t\treturn (a.meta.hosts ? 1 : 0) - (b.meta.hosts ? 1 : 0);\n\t\t\t}\n\t\t\treturn o;\n\t\t});\n\t}\n\n\tprotected static getExpressions(selector: string): MatchFunction[] {\n\t\tlet matchers: ((node: HTMLElement) => boolean)[] = [];\n\t\tselector.replace(/\\.([\\w\\-\\_]+)|\\[(.+?\\]*)(\\=)(.*?)\\]|\\[(.+?\\]*)\\]|([\\w\\-\\_]+)/g, function (value: string, c1, a2, u3, v4, a5, e6) {\n\t\t\tif (c1) {\n\t\t\t\tmatchers.push(function (node) {\n\t\t\t\t\treturn node.classList.contains(c1);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (a2) {\n\t\t\t\tmatchers.push(function (node) {\n\t\t\t\t\treturn (node.hasAttribute(a2) && node.getAttribute(a2) === v4) ||\n\t\t\t\t\t\t(node.hasAttribute(`[${a2}]`) && node.getAttribute(`[${a2}]`) === v4);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (a5) {\n\t\t\t\tmatchers.push(function (node) {\n\t\t\t\t\treturn node.hasAttribute(a5) || node.hasAttribute(`[${a5}]`);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (e6) {\n\t\t\t\tmatchers.push(function (node) {\n\t\t\t\t\treturn node.nodeName.toLowerCase() === e6.toLowerCase();\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn '';\n\t\t});\n\t\treturn matchers;\n\t}\n\n\tprotected static unwrapSelectors(factories: FactoryList): SelectorFunction[] {\n\t\tconst selectors: SelectorFunction[] = [];\n\t\tfactories.forEach((factory: typeof Factory) => {\n\t\t\tif (factory.meta && factory.meta.selector) {\n\t\t\t\tfactory.meta.selector.split(',').forEach((selector: string) => {\n\t\t\t\t\tselector = selector.trim();\n\t\t\t\t\tlet excludes: MatchFunction[] = [];\n\t\t\t\t\tconst matchSelector = selector.replace(/\\:not\\((.+?)\\)/g, (value, unmatchSelector) => {\n\t\t\t\t\t\texcludes = this.getExpressions(unmatchSelector);\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t});\n\t\t\t\t\tconst includes: MatchFunction[] = this.getExpressions(matchSelector);\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst included = includes.reduce((p, match) => {\n\t\t\t\t\t\t\treturn p && match(node);\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t\tconst excluded = excludes.reduce((p, match) => {\n\t\t\t\t\t\t\treturn p || match(node);\n\t\t\t\t\t\t}, false);\n\t\t\t\t\t\tif (included && !excluded) {\n\t\t\t\t\t\t\treturn { node, factory, selector } as ISelectorResult;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn selectors;\n\t}\n\n}\n","import Platform from './platform';\n\nexport default class Browser extends Platform { }\n","import { Pipe } from \"../../../src/rxcomp\";\n\nexport default class DatePipe extends Pipe {\n\n\tstatic transform(value: Date | string, locale = 'it-IT-u-ca-gregory', options: Intl.DateTimeFormatOptions = {\n\t\tdateStyle: 'short',\n\t\ttimeStyle: 'short',\n\t} as Intl.DateTimeFormatOptions): string {\n\t\tconst localeDateString = new Date(value).toLocaleDateString(locale, options);\n\t\treturn localeDateString;\n\t}\n\n\tstatic meta = {\n\t\tname: 'date',\n\t};\n\n}\n","import { interval } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\nimport { Browser, Component, CoreModule, Module } from '../../src/rxcomp';\nimport DatePipe from './date/date.pipe';\n\n// !!! todo: check {{ item | json }} vs [innerHTML]=\"item | json\"\n\nclass RootComponent extends Component {\n\thtml = /* html */ `<b class=\"bold\">bold</b>`;\n\tvalueUndefined = undefined;\n\tvalueDefined = 1;\n\tticks = -1;\n\titems = [1, 2];\n\tobject = { a: 1, b: 2 };\n\tdate = new Date();\n\n\tonInit() {\n\t\t// console.log('RootComponent.onInit');\n\t\tinterval(1000).pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe(ticks => {\n\t\t\tthis.ticks = ticks;\n\t\t\tthis.pushChanges();\n\t\t});\n\t}\n\n}\nRootComponent.meta = {\n\tselector: '[root-component]',\n};\n\nclass Root2Component extends Component {\n\thtml = /* html */ `<strong class=\"bold\">strong</strong>`;\n\tvalueUndefined = undefined;\n\tvalueDefined = 2;\n\tticks = -1;\n\titems = [2, 3];\n\tobject = { a: 2, b: 3 };\n\tdate = new Date();\n\n\tonInit() {\n\t\t// console.log('RootComponent.onInit');\n\t\tinterval(1000).pipe(\n\t\t\ttakeUntil(this.unsubscribe$)\n\t\t).subscribe(ticks => {\n\t\t\tthis.ticks = ticks;\n\t\t\tthis.pushChanges();\n\t\t});\n\t}\n\n}\nRoot2Component.meta = {\n\tselector: '[root-component]',\n};\n\nclass AppModule extends Module { }\nAppModule.meta = {\n\timports: [\n\t\tCoreModule\n\t],\n\tdeclarations: [\n\t\tDatePipe,\n\t],\n\tbootstrap: RootComponent,\n};\n\nclass App2Module extends Module { }\nApp2Module.meta = {\n\timports: [\n\t\tCoreModule\n\t],\n\tdeclarations: [\n\t\tDatePipe,\n\t],\n\tbootstrap: Root2Component,\n};\n\nlet module = Browser.bootstrap(AppModule);\n\nfunction init() {\n\tmodule.destroy();\n\tmodule = Browser.bootstrap(App2Module);\n}\n\nsetTimeout(() => {\n\tinit();\n}, 5000);\n"]}