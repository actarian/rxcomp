{"version":3,"file":"test/js/test.for.ts","sources":["../../src/core/factory.ts","../../src/core/directive.ts","../../src/class/class.directive.ts","../../src/event/event.directive.ts","../../src/core/structure.ts","../../src/core/component.ts","../../src/core/context.ts","../../src/for/for.item.ts","../../src/for/for.structure.ts","../../src/href/href.directive.ts","../../src/if/if.structure.ts","../../src/inner-html/inner-html.directive.ts","../../src/core/pipe.ts","../../src/json/json.pipe.ts","../../src/module/module.ts","../../src/src/src.directive.ts","../../src/style/style.directive.ts","../../src/core.module.ts","../../src/platform/platform.ts","../../src/platform/browser.ts","../../test/js/test.for.ts"],"sourcesContent":["import { ReplaySubject, Subject } from 'rxjs';\nimport { IContext, IFactoryMeta } from './types';\n\nexport const CONTEXTS: { [key: number]: IContext } = {};\nexport const NODES: { [key: number]: IContext[] } = {};\n\nexport default class Factory {\n\n\tstatic meta: IFactoryMeta;\n\n\trxcompId: number = -1;\n\n\tunsubscribe$: Subject<void> = new Subject();\n\tchanges$: ReplaySubject<Factory> = new ReplaySubject(1);\n\n\tonInit(): void { }\n\tonChanges(changes: Factory | Window): void { }\n\tonView(): void { }\n\tonDestroy(): void { }\n\n\tpushChanges(): void {\n\t\tthis.changes$.next(this);\n\t\tthis.onView();\n\t}\n\n\t[key: string]: any; // extensible object\n\n\tconstructor(...args: any[]) { }\n}\n\nexport function getContext(instance: Factory): IContext {\n\treturn CONTEXTS[instance.rxcompId];\n}\n","import Factory from './factory';\n\nexport default class Directive extends Factory {\n}\n","// import Factory, { ExpressionFunction } from '../core/factory';\nimport Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nexport default class ClassDirective extends Directive {\n\n\tclass: { [key: string]: string } | string | null = '';\n\tkeys: string[] = [];\n\n\tonInit() {\n\t\tconst { node } = getContext(this);\n\t\tnode.classList.forEach(x => this.keys.push(x));\n\t}\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tlet keys: string[] = [];\n\t\tconst object = this.class;\n\t\tif (typeof object === 'object') {\n\t\t\tfor (let key in object) {\n\t\t\t\tif (object[key]) {\n\t\t\t\t\tkeys.push(key);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (typeof object === 'string') {\n\t\t\tkeys = object.split(/\\s+/);\n\t\t}\n\t\tkeys = keys.concat(this.keys);\n\t\t// console.log(keys);\n\t\tnode.setAttribute('class', keys.join(' '));\n\t\t// console.log('ClassDirective.onChanges', keys);\n\t}\n\n}\n\nClassDirective.meta = {\n\tselector: `[[class]]`,\n\tinputs: ['class']\n};\n","import { fromEvent, Observable } from 'rxjs';\nimport { shareReplay, takeUntil } from 'rxjs/operators';\nimport Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nconst EVENTS = ['mousedown', 'mouseup', 'mousemove', 'click', 'dblclick', 'mouseover', 'mouseout', 'mouseenter', 'mouseleave', 'contextmenu', 'touchstart', 'touchmove', 'touchend', 'keydown', 'keyup', 'input', 'change', 'loaded'];\n\nexport default class EventDirective extends Directive {\n\n\tevent: string = '';\n\n\tonInit() {\n\t\tconst { module, node, parentInstance, selector } = getContext(this);\n\t\t// console.log('parentInstance', parentInstance);\n\t\tconst event = this.event = selector.replace(/\\[|\\]|\\(|\\)/g, '');\n\t\tconst event$: Observable<Event> = fromEvent<Event>(node, event).pipe(shareReplay(1));\n\t\tconst expression = node.getAttribute(`(${event})`);\n\t\tif (expression) {\n\t\t\tconst outputFunction = module.makeFunction(expression, ['$event']);\n\t\t\tevent$.pipe(\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(event => {\n\t\t\t\tmodule.resolve(outputFunction, parentInstance, event);\n\t\t\t});\n\t\t} else {\n\t\t\tparentInstance[`${event}$`] = event$;\n\t\t}\n\t\t// console.log('EventDirective.onInit', 'selector', selector, 'event', event);\n\t}\n\n}\n\nEventDirective.meta = {\n\tselector: `[(${EVENTS.join(')],[(')})]`,\n};\n","import Factory from './factory';\n\nexport default class Structure extends Factory {\n}\n","\nimport Factory, { getContext } from './factory';\n\nexport default class Component extends Factory {\n\n\tpushChanges(): void {\n\t\tconst { module, node } = getContext(this);\n\t\t// console.log(new Error(`pushChanges ${instance.constructor.name}`).stack);\n\t\tthis.changes$.next(this);\n\t\t// console.log('Module.parse', instance.constructor.name);\n\t\t// parse component text nodes\n\t\tmodule.parse(node, this);\n\t\t// calling onView event\n\t\tthis.onView();\n\t}\n\n}\n","// import { BehaviorSubject, Subject } from 'rxjs';\nimport Component from './component';\nimport Factory from './factory';\n\nconst RESERVED_PROPERTIES = ['constructor', 'rxcompId', 'onInit', 'onChanges', 'onDestroy', 'pushChanges', 'changes$', 'unsubscribe$'];\n\nexport default class Context extends Component {\n\n\tconstructor(instance: Factory, descriptors: { [key: string]: PropertyDescriptor } = {}) {\n\t\tsuper();\n\t\tdescriptors = Context.mergeDescriptors(instance, instance, descriptors);\n\t\tdescriptors = Context.mergeDescriptors(Object.getPrototypeOf(instance), instance, descriptors);\n\t\tObject.defineProperties(this, descriptors);\n\t}\n\n\tstatic mergeDescriptors(source: Object, instance: Factory, descriptors: { [key: string]: PropertyDescriptor } = {}): { [key: string]: PropertyDescriptor } {\n\t\tconst properties: string[] = Object.getOwnPropertyNames(source);\n\t\twhile (properties.length) {\n\t\t\tconst key: string = properties.shift() as string;\n\t\t\tif (RESERVED_PROPERTIES.indexOf(key) === -1 && !descriptors.hasOwnProperty(key)) {\n\t\t\t\tconst descriptor: PropertyDescriptor = Object.getOwnPropertyDescriptor(source, key) as PropertyDescriptor;\n\t\t\t\tif (typeof descriptor.value == 'function') {\n\t\t\t\t\tdescriptor.value = (...args: any[]) => {\n\t\t\t\t\t\treturn instance[key].apply(instance, args);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tdescriptors[key] = descriptor;\n\t\t\t}\n\t\t}\n\t\treturn descriptors;\n\t}\n\n}\n","import Context from '../core/context';\nimport Factory from '../core/factory';\n\nexport default class ForItem extends Context {\n\n\tindex: number;\n\tcount: number;\n\t[key: string]: any;\n\n\t// !!! todo: payload options { key, $key, value, $value, index, count }\n\n\tconstructor(key: string, $key: number | string, value: string, $value: any, index: number, count: number, parentInstance: Factory) {\n\t\t// console.log('ForItem', arguments);\n\t\tsuper(parentInstance);\n\t\t/*\n\t\tsuper(parentInstance, {\n\t\t\t[key]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$key;\n\t\t\t\t},\n\t\t\t\tset: function(key) {\n\t\t\t\t\tthis.$key = key;\n\t\t\t\t}\n\t\t\t},\n\t\t\t[value]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\tthis.$value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t*/\n\t\tthis[key] = $key;\n\t\tthis[value] = $value;\n\t\tthis.index = index;\n\t\tthis.count = count;\n\t}\n\n\tget first(): boolean { return this.index === 0; }\n\n\tget last(): boolean { return this.index === this.count - 1; }\n\n\tget even(): boolean { return this.index % 2 === 0; }\n\n\tget odd(): boolean { return !this.even; }\n\n}\n","import Factory, { getContext } from '../core/factory';\nimport Structure from '../core/structure';\nimport { ExpressionFunction, IComment, IContext, IElement, IExpressionToken } from '../core/types';\nimport Module from '../module/module';\nimport ForItem from './for.item';\n\nexport default class ForStructure extends Structure {\n\n\tinstances: Factory[] = [];\n\tforend?: IComment;\n\ttoken?: IExpressionToken;\n\tforFunction?: ExpressionFunction;\n\n\tonInit() {\n\t\tconst { module, node } = getContext(this);\n\t\tconst forbegin: IComment = document.createComment(`*for begin`);\n\t\tforbegin.rxcompId = node.rxcompId;\n\t\tnode.parentNode!.replaceChild(forbegin, node);\n\t\tconst forend: IComment = this.forend = document.createComment(`*for end`);\n\t\tforbegin.parentNode!.insertBefore(forend, forbegin.nextSibling);\n\t\tconst expression: string = node.getAttribute('*for')!;\n\t\tnode.removeAttribute('*for');\n\t\tconst token = this.token = this.getExpressionToken(expression);\n\t\tthis.forFunction = module.makeFunction(token.iterable);\n\t\t// console.log('ForStructure.expression', expression);\n\t}\n\n\tonChanges(changes: Factory | Window) {\n\t\tconst context: IContext = getContext(this);\n\t\tconst parentInstance: Factory | Window = context.parentInstance;\n\t\tconst module: Module = context.module;\n\t\tconst node: IElement = context.node;\n\t\t// resolve\n\t\tconst token: IExpressionToken = this.token!;\n\t\tlet result = module.resolve(this.forFunction!, parentInstance, this) || [];\n\t\tconst isArray = Array.isArray(result);\n\t\tconst array: any[] = isArray ? result : Object.keys(result);\n\t\tconst total: number = array.length;\n\t\tconst previous: number = this.instances.length;\n\t\tfor (let i: number = 0; i < Math.max(previous, total); i++) {\n\t\t\tif (i < total) {\n\t\t\t\tconst key: number | string = isArray ? i : array[i];\n\t\t\t\tconst value: any = isArray ? array[key as number] : result[key];\n\t\t\t\tif (i < previous) {\n\t\t\t\t\t// update\n\t\t\t\t\tconst instance: Factory = this.instances[i];\n\t\t\t\t\tinstance[token.key] = key;\n\t\t\t\t\tinstance[token.value] = value;\n\t\t\t\t\t/*\n\t\t\t\t\tif (!nextSibling) {\n\t\t\t\t\t\tconst context = getContext(instance);\n\t\t\t\t\t\tconst node = context.node;\n\t\t\t\t\t\tthis.forend.parentNode.insertBefore(node, this.forend);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextSibling = nextSibling.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t} else {\n\t\t\t\t\t// create\n\t\t\t\t\tconst clonedNode: IElement = node.cloneNode(true) as IElement;\n\t\t\t\t\tdelete clonedNode.rxcompId;\n\t\t\t\t\tthis.forend!.parentNode!.insertBefore(clonedNode, this.forend!);\n\t\t\t\t\t// !!! todo: check context.parentInstance\n\t\t\t\t\tconst args = [token.key, key, token.value, value, i, total, context.parentInstance];\n\t\t\t\t\tconst instance = module.makeInstance(clonedNode, ForItem, context.selector, context.parentInstance, args);\n\t\t\t\t\tif (instance) {\n\t\t\t\t\t\tconst forItemContext = getContext(instance);\n\t\t\t\t\t\t// console.log('ForStructure', clonedNode, forItemContext.instance.constructor.name);\n\t\t\t\t\t\tmodule.compile(clonedNode, forItemContext.instance);\n\t\t\t\t\t\tmodule.parse(clonedNode, instance); // !!! parse component\n\t\t\t\t\t\t// nextSibling = clonedNode.nextSibling;\n\t\t\t\t\t\tthis.instances.push(instance);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// remove\n\t\t\t\tconst instance: Factory = this.instances[i];\n\t\t\t\tconst { node } = getContext(instance);\n\t\t\t\tnode.parentNode!.removeChild(node);\n\t\t\t\tmodule.remove(node);\n\t\t\t}\n\t\t}\n\t\tthis.instances.length = array.length;\n\t\t// console.log('ForStructure', this.instances, token);\n\t}\n\n\tgetExpressionToken(expression: string): IExpressionToken {\n\t\tif (expression === null) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tif (expression.trim().indexOf('let ') === -1 || expression.trim().indexOf(' of ') === -1) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tconst expressions: string[] = expression.split(';').map(x => x.trim()).filter(x => x !== '');\n\t\tconst forExpressions: string[] = expressions[0].split(' of ').map(x => x.trim());\n\t\tlet value: string = forExpressions[0].replace(/\\s*let\\s*/, '');\n\t\tconst iterable: string = forExpressions[1];\n\t\tlet key: string = 'index';\n\t\tconst keyValueMatches: RegExpMatchArray | null = value.match(/\\[(.+)\\s*,\\s*(.+)\\]/);\n\t\tif (keyValueMatches) {\n\t\t\tkey = keyValueMatches[1];\n\t\t\tvalue = keyValueMatches[2];\n\t\t}\n\t\tif (expressions.length > 1) {\n\t\t\tconst indexExpressions: string[] = expressions[1].split(/\\s*let\\s*|\\s*=\\s*index/).map(x => x.trim());\n\t\t\tif (indexExpressions.length === 3) {\n\t\t\t\tkey = indexExpressions[1];\n\t\t\t}\n\t\t}\n\t\treturn { key, value, iterable };\n\t}\n\n}\n\nForStructure.meta = {\n\tselector: '[*for]',\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nexport default class HrefDirective extends Directive {\n\n\thref?: string;\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tnode.setAttribute('href', this.href || '');\n\t}\n\n}\n\nHrefDirective.meta = {\n\tselector: '[[href]]',\n\tinputs: ['href'],\n};\n","import Factory, { getContext } from '../core/factory';\nimport Structure from '../core/structure';\nimport { ExpressionFunction, IComment, IElement } from '../core/types';\n\nexport default class IfStructure extends Structure {\n\n\tifend?: IComment;\n\tifFunction?: ExpressionFunction;\n\tclonedNode?: IElement;\n\telement?: IElement;\n\n\tonInit() {\n\t\tconst { module, node } = getContext(this);\n\t\tconst ifbegin: IComment = this.ifbegin = document.createComment(`*if begin`);\n\t\tifbegin.rxcompId = node.rxcompId;\n\t\tnode.parentNode!.replaceChild(ifbegin, node);\n\t\tconst ifend = this.ifend = document.createComment(`*if end`);\n\t\tifbegin.parentNode!.insertBefore(ifend, ifbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*if');\n\t\tthis.ifFunction = module.makeFunction(expression!);\n\t\tconst clonedNode = node.cloneNode(true) as IElement;\n\t\tclonedNode.removeAttribute('*if');\n\t\tthis.clonedNode = clonedNode;\n\t\tthis.element = clonedNode.cloneNode(true) as IElement;\n\t\t// console.log('IfStructure.expression', expression);\n\t}\n\n\tonChanges(changes: Factory | Window) {\n\t\tconst { module, parentInstance } = getContext(this);\n\t\t// console.log('IfStructure.onChanges', parentInstance);\n\t\tconst value = module.resolve(this.ifFunction!, parentInstance, this);\n\t\tconst element: IElement = this.element!;\n\t\tif (value) {\n\t\t\tif (!element.parentNode) {\n\t\t\t\tconst ifend = this.ifend!;\n\t\t\t\tifend.parentNode!.insertBefore(element, ifend);\n\t\t\t\tmodule.compile(element);\n\t\t\t}\n\t\t} else {\n\t\t\tif (element.parentNode) {\n\t\t\t\tmodule.remove(element, this);\n\t\t\t\telement.parentNode.removeChild(element);\n\t\t\t\tthis.element = this.clonedNode!.cloneNode(true) as IElement;\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic meta = {\n\t\tselector: '[*if]',\n\t};\n\n}\n","import Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nexport default class InnerHtmlDirective extends Directive {\n\n\tinnerHTML?: string;\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tnode.innerHTML = this.innerHTML == undefined ? '' : this.innerHTML; // !!! keep == loose equality\n\t}\n\n}\n\nInnerHtmlDirective.meta = {\n\tselector: `[innerHTML]`,\n\tinputs: ['innerHTML'],\n};\n","import { IPipeMeta } from \"./types\";\n\nexport default class Pipe {\n\n\tstatic transform(value: any): any {\n\t\treturn value;\n\t}\n\n\tstatic meta: IPipeMeta;\n}\n","import Pipe from '../core/pipe';\n\nexport default class JsonPipe extends Pipe {\n\n\tstatic transform(value: any): string {\n\t\tconst cache: Map<any, boolean> = new Map();\n\t\tconst json: string = JSON.stringify(value, function (key, value) {\n\t\t\tif (typeof value === 'object' && value != null) {\n\t\t\t\tif (cache.has(value)) {\n\t\t\t\t\t// Circular reference found, discard key\n\t\t\t\t\treturn '#ref';\n\t\t\t\t}\n\t\t\t\tcache.set(value, true);\n\t\t\t}\n\t\t\treturn value;\n\t\t}, 2);\n\t\treturn json;\n\t}\n\n}\n\nJsonPipe.meta = {\n\tname: 'json',\n};\n\n","import { Observable, Subject } from 'rxjs';\nimport { takeUntil, tap } from 'rxjs/operators';\nimport Component from '../core/component';\nimport Context from '../core/context';\nimport Factory, { CONTEXTS, getContext, NODES } from '../core/factory';\nimport Structure from '../core/structure';\nimport { ExpressionFunction, IContext, IElement, IFactoryMeta, IModuleMeta, IModuleParsedMeta, ISelectorResult, IText, SelectorFunction } from '../core/types';\n\nlet ID: number = 0;\n\nexport default class Module {\n\n\tmeta?: IModuleParsedMeta;\n\n\tpublic compile(node: IElement, parentInstance?: Factory | Window): Factory[] {\n\t\tlet componentNode: IElement;\n\t\tconst instances: Factory[] = Module.querySelectorsAll(node, this.meta!.selectors, []).map((match: ISelectorResult) => {\n\t\t\tif (componentNode && componentNode !== match.node) {\n\t\t\t\tparentInstance = undefined;\n\t\t\t}\n\t\t\tconst instance: Factory | undefined = this.makeInstance(match.node, match.factory, match.selector, parentInstance);\n\t\t\tif (match.factory.prototype instanceof Component) {\n\t\t\t\t// if (instance) console.log('Component', instance.constructor.name);\n\t\t\t\t// if (instance) this.parse(match.node, instance);\n\t\t\t\tcomponentNode = match.node;\n\t\t\t}\n\t\t\treturn instance;\n\t\t}).filter((x): x is Factory => x !== undefined);\n\t\t// console.log(instances);\n\t\tinstances.forEach(x => {\n\t\t\tif (x instanceof Component) {\n\t\t\t\tconst context = getContext(x);\n\t\t\t\tconsole.log(context.node !== node);\n\t\t\t\tthis.parse(context.node, x);\n\t\t\t}\n\t\t});\n\t\t// console.log('compile', instances, node, parentInstance);\n\t\tconsole.log('e', instances);\n\t\treturn instances;\n\t}\n\n\tpublic makeInstance(node: IElement, factory: typeof Factory, selector: string, parentInstance?: Factory | Window, args?: any[]): Factory | undefined {\n\t\tif (parentInstance || node.parentNode) {\n\t\t\tconst meta: IFactoryMeta = factory.meta;\n\t\t\t// collect parentInstance scope\n\t\t\tparentInstance = parentInstance || this.getParentInstance(node.parentNode);\n\t\t\tif (!parentInstance) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\t// creating factory instance\n\t\t\tconst instance = new factory(...(args || []));\n\t\t\tconsole.log('instance', instance.constructor.name);\n\t\t\t// creating instance context\n\t\t\tconst context = Module.makeContext(this, instance, parentInstance, node, factory, selector);\n\t\t\t// creating component input and outputs\n\t\t\tif (meta) {\n\t\t\t\tthis.makeHosts(meta, instance, node);\n\t\t\t\tcontext.inputs = this.makeInputs(meta, instance);\n\t\t\t\tcontext.outputs = this.makeOutputs(meta, instance);\n\t\t\t\tif (parentInstance instanceof Factory) {\n\t\t\t\t\tthis.resolveInputsOutputs(instance, parentInstance);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// calling onInit event\n\t\t\tinstance.onInit();\n\t\t\t// calling onChanges event\n\t\t\tinstance.onChanges(parentInstance);\n\t\t\t// subscribe to parent changes\n\t\t\tif (parentInstance instanceof Factory) {\n\t\t\t\tparentInstance.changes$.pipe(\n\t\t\t\t\t// filter(() => node.parentNode),\n\t\t\t\t\t// debounceTime(1),\n\t\t\t\t\t/*\n\t\t\t\t\tdistinctUntilChanged(function(prev, curr) {\n\t\t\t\t\t\t// console.log(isComponent, context.inputs);\n\t\t\t\t\t\tif (isComponent && meta && Object.keys(context.inputs).length === 0) {\n\t\t\t\t\t\t\treturn true; // same\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\t*/\n\t\t\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t\t\t).subscribe((changes: Factory | Window) => {\n\t\t\t\t\t// resolve component input outputs\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tthis.resolveInputsOutputs(instance, changes);\n\t\t\t\t\t}\n\t\t\t\t\t// calling onChanges event with changes\n\t\t\t\t\tinstance.onChanges(changes);\n\t\t\t\t\t// push instance changes for subscribers\n\t\t\t\t\tinstance.pushChanges();\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn instance;\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tpublic makeFunction(expression: string, params: string[] = ['$instance']): ExpressionFunction {\n\t\tif (expression) {\n\t\t\texpression = Module.parseExpression(expression);\n\t\t\t// console.log(expression);\n\t\t\tconst args: string = params.join(',');\n\t\t\tconst expression_func: ExpressionFunction = new Function(`with(this) {\n\t\t\t\treturn (function (${args}, $$module) {\n\t\t\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`) as ExpressionFunction;\n\t\t\t// console.log(this, $$module, $$pipes, \"${expression}\");\n\t\t\t// console.log(expression_func);\n\t\t\treturn expression_func;\n\t\t} else {\n\t\t\treturn () => { return null; };\n\t\t}\n\t}\n\n\tpublic resolve(expression: ExpressionFunction, parentInstance: Factory | Window, payload: any): any {\n\t\t// console.log(expression, parentInstance, payload);\n\t\treturn expression.apply(parentInstance, [payload, this]);\n\t}\n\n\tpublic parse(node: IElement, instance: Factory): void {\n\t\tfor (let i: number = 0; i < node.childNodes.length; i++) {\n\t\t\tconst child: ChildNode = node.childNodes[i];\n\t\t\tif (child.nodeType === 1) {\n\t\t\t\tconst element: HTMLElement = child as HTMLElement;\n\t\t\t\tconst context: IContext | void = getContextByNode(element);\n\t\t\t\tif (!context) {\n\t\t\t\t\tthis.parse(element, instance);\n\t\t\t\t}\n\t\t\t} else if (child.nodeType === 3) {\n\t\t\t\tconst text: IText = child as IText;\n\t\t\t\tthis.parseTextNode(text, instance);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic remove(node: Node, keepInstance?: Factory): Node {\n\t\tconst keepContext: IContext | undefined = keepInstance ? getContext(keepInstance) : undefined;\n\t\tModule.traverseDown(node, (node: Node) => {\n\t\t\tconst rxcompId: number | undefined = (node as IElement).rxcompId;\n\t\t\tif (rxcompId) {\n\t\t\t\tconst keepContexts: IContext[] = Module.deleteContext(rxcompId, keepContext);\n\t\t\t\tif (keepContexts.length === 0) {\n\t\t\t\t\tdelete (node as IElement).rxcompId;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn node;\n\t}\n\n\tpublic destroy(): void {\n\t\tthis.remove(this.meta!.node);\n\t\tthis.meta!.node.innerHTML = this.meta!.nodeInnerHTML;\n\t}\n\n\tprotected makeContext(instance: Factory, parentInstance: Factory | Window, node: IElement, selector: string): IContext {\n\t\tconst context: IContext = Module.makeContext(this, instance, parentInstance, node, instance.constructor as typeof Factory, selector);\n\t\t// console.log('Module.makeContext', context, context.instance, context.node);\n\t\treturn context;\n\t}\n\n\tprotected getInstance(node: HTMLElement | Document): Factory | Window | undefined {\n\t\tif (node instanceof Document) {\n\t\t\treturn window; // !!! window or global\n\t\t}\n\t\tconst context: IContext | undefined = getContextByNode(node);\n\t\tif (context) {\n\t\t\treturn context.instance;\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\n\tprotected getParentInstance(node: Node | null): Factory | Window {\n\t\treturn Module.traverseUp(node, (node: Node) => {\n\t\t\treturn this.getInstance(node as HTMLElement);\n\t\t});\n\t}\n\n\t// reduce(callbackfn: (previousValue: T, currentValue: T, currentIndex: number, array: T[]) => T, initialValue: T): T;\n\n\tprotected parseTextNode(node: IText, instance: Factory): void {\n\t\tlet expressions: (ExpressionFunction | string)[] | undefined = node.nodeExpressions;\n\t\tif (!expressions) {\n\t\t\texpressions = this.parseTextNodeExpression(node.wholeText);\n\t\t}\n\t\tconst replacedText: string = expressions.reduce((p: string, c: ExpressionFunction | string) => {\n\t\t\tlet text: string;\n\t\t\tif (typeof c === 'function') { // instanceOf ExpressionFunction ?;\n\t\t\t\ttext = this.resolve(c as ExpressionFunction, instance, instance);\n\t\t\t\tif (text == undefined) { // !!! keep == loose equality\n\t\t\t\t\ttext = '';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttext = c;\n\t\t\t}\n\t\t\treturn p + text;\n\t\t}, '');\n\t\tif (node.nodeValue !== replacedText) {\n\t\t\tconst textNode: IText = document.createTextNode(replacedText) as IText;\n\t\t\ttextNode.nodeExpressions = expressions;\n\t\t\tnode.parentNode!.replaceChild(textNode, node);\n\t\t}\n\t}\n\n\tprotected pushFragment(nodeValue: string, from: number, to: number, expressions: (ExpressionFunction | string)[]): void {\n\t\tconst fragment: string = nodeValue.substring(from, to);\n\t\texpressions.push(fragment);\n\t}\n\n\tprotected parseTextNodeExpression(nodeValue: string): (ExpressionFunction | string)[] {\n\t\tconst expressions: (ExpressionFunction | string)[] = [];\n\t\tconst regex: RegExp = /\\{{2}((([^{}])|(\\{([^{}]|(\\{.*?\\}))+?\\}))*?)\\}{2}/g;\n\t\tlet lastIndex: number = 0,\n\t\t\tmatches: RegExpExecArray | null;\n\t\twhile ((matches = regex.exec(nodeValue)) !== null) {\n\t\t\tconst index: number = regex.lastIndex - matches[0].length;\n\t\t\tif (index > lastIndex) {\n\t\t\t\tthis.pushFragment(nodeValue, index, lastIndex, expressions);\n\t\t\t}\n\t\t\tlastIndex = regex.lastIndex;\n\t\t\tconst expression: ExpressionFunction = this.makeFunction(matches[1]);\n\t\t\texpressions.push(expression);\n\t\t}\n\t\tconst length: number = nodeValue.length;\n\t\tif (length > lastIndex) {\n\t\t\tthis.pushFragment(nodeValue, lastIndex, length, expressions);\n\t\t}\n\t\treturn expressions;\n\t}\n\n\tprotected makeHosts(meta: IFactoryMeta, instance: Factory, node: IElement): void {\n\t\tif (meta.hosts) {\n\t\t\tObject.keys(meta.hosts).forEach((key: string) => {\n\t\t\t\tconst factory: typeof Factory = meta.hosts![key];\n\t\t\t\tinstance[key] = getHost(instance, factory, node);\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected makeInput(instance: Factory, key: string): ExpressionFunction | null {\n\t\tconst { node } = getContext(instance);\n\t\tlet input: ExpressionFunction | null = null,\n\t\t\texpression: string | null = null;\n\t\tif (node.hasAttribute(`[${key}]`)) {\n\t\t\texpression = node.getAttribute(`[${key}]`)!;\n\t\t} else if (node.hasAttribute(key)) {\n\t\t\t// const attribute = node.getAttribute(key).replace(/{{/g, '\"+').replace(/}}/g, '+\"');\n\t\t\tconst attribute: string = node.getAttribute(key)!.replace(/({{)|(}})|(\")/g, function (substring: string, a, b, c) {\n\t\t\t\tif (a) {\n\t\t\t\t\treturn '\"+';\n\t\t\t\t}\n\t\t\t\tif (b) {\n\t\t\t\t\treturn '+\"';\n\t\t\t\t}\n\t\t\t\tif (c) {\n\t\t\t\t\treturn '\\\"';\n\t\t\t\t}\n\t\t\t\treturn '';\n\t\t\t});\n\t\t\texpression = `\"${attribute}\"`;\n\t\t}\n\t\tif (expression) {\n\t\t\tinput = this.makeFunction(expression);\n\t\t}\n\t\treturn input;\n\t}\n\n\tprotected makeInputs(meta: IFactoryMeta, instance: Factory): { [key: string]: ExpressionFunction } {\n\t\tconst inputs: { [key: string]: ExpressionFunction } = {};\n\t\tif (meta.inputs) {\n\t\t\tmeta.inputs.forEach((key: string, i: number) => {\n\t\t\t\tconst input = this.makeInput(instance, key);\n\t\t\t\tif (input) {\n\t\t\t\t\tinputs[key] = input;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn inputs;\n\t}\n\n\tprotected makeOutput(instance: Factory, key: string): Observable<any> {\n\t\tconst context: IContext = getContext(instance);\n\t\tconst node: IElement = context.node;\n\t\tconst parentInstance: Factory | Window = context.parentInstance;\n\t\tconst expression: string | null = node.getAttribute(`(${key})`);\n\t\tconst outputFunction: ExpressionFunction | null = expression ? this.makeFunction(expression, ['$event']) : null;\n\t\tconst output$: Observable<any> = new Subject<any>().pipe(\n\t\t\ttap((event) => {\n\t\t\t\tif (outputFunction) {\n\t\t\t\t\t// console.log(expression, parentInstance);\n\t\t\t\t\tthis.resolve(outputFunction, parentInstance, event);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t\toutput$.pipe(\n\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t).subscribe();\n\t\tinstance[key] = output$;\n\t\treturn output$;\n\t}\n\n\tprotected makeOutputs(meta: IFactoryMeta, instance: Factory): { [key: string]: Observable<any> } {\n\t\tconst outputs: { [key: string]: Observable<any> } = {};\n\t\tif (meta.outputs) {\n\t\t\tmeta.outputs.forEach((key: string) => {\n\t\t\t\tconst output = this.makeOutput(instance, key);\n\t\t\t\tif (output) {\n\t\t\t\t\toutputs[key] = output;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn outputs;\n\t}\n\n\tprotected resolveInputsOutputs(instance: Factory, changes: Factory | Window): void {\n\t\tconst context: IContext = getContext(instance);\n\t\tconst parentInstance: Factory | Window = context.parentInstance;\n\t\tconst inputs: { [key: string]: ExpressionFunction } = context.inputs!;\n\t\tfor (let key in inputs) {\n\t\t\tconst inputFunction: ExpressionFunction = inputs[key];\n\t\t\tconst value: any = this.resolve(inputFunction, parentInstance, instance);\n\t\t\tinstance[key] = value;\n\t\t}\n\t}\n\n\tprotected static parseExpression(expression: string): string {\n\t\tconst l: string = '┌';\n\t\tconst r: string = '┘';\n\t\tconst rx1: RegExp = /(\\()([^\\(\\)]*)(\\))/;\n\t\twhile (expression.match(rx1)) {\n\t\t\texpression = expression.replace(rx1, function (substring: string, ...args: any[]) {\n\t\t\t\treturn `${l}${Module.parsePipes(args[1])}${r}`;\n\t\t\t});\n\t\t}\n\t\texpression = Module.parsePipes(expression);\n\t\texpression = expression.replace(/(┌)|(┘)/g, function (substring: string, ...args) {\n\t\t\treturn args[0] ? '(' : ')';\n\t\t});\n\t\treturn Module.parseOptionalChaining(expression);\n\t}\n\n\tprotected static parsePipes(expression: string): string {\n\t\tconst l: string = '┌';\n\t\tconst r: string = '┘';\n\t\tconst rx1: RegExp = /(.*?[^\\|])\\|([^\\|]+)/;\n\t\twhile (expression.match(rx1)) {\n\t\t\texpression = expression.replace(rx1, function (substring: string, ...args: any[]) {\n\t\t\t\tconst value: string = args[0].trim();\n\t\t\t\tconst params: string[] = Module.parsePipeParams(args[1]);\n\t\t\t\tconst func: string = params.shift()!.trim();\n\t\t\t\treturn `$$pipes.${func}.transform${l}${[value, ...params]}${r}`;\n\t\t\t});\n\t\t}\n\t\treturn expression;\n\t}\n\n\tprotected static parsePipeParams(expression: string): string[] {\n\t\tconst segments: string[] = [];\n\t\tlet i: number = 0,\n\t\t\tword: string = '',\n\t\t\tblock: number = 0;\n\t\tconst t: number = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c: string = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === ':' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word.trim());\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word.trim());\n\t\t}\n\t\treturn segments;\n\t}\n\n\tprotected static parseOptionalChaining(expression: string): string {\n\t\tconst regex: RegExp = /(\\w+(\\?\\.))+([\\.|\\w]+)/g;\n\t\tlet previous: string;\n\t\texpression = expression.replace(regex, function (substring: string, ...args: any[]) {\n\t\t\tconst tokens: string[] = substring.split('?.');\n\t\t\tfor (let i: number = 0; i < tokens.length - 1; i++) {\n\t\t\t\tconst a: string = i > 0 ? `(${tokens[i]} = ${previous})` : tokens[i];\n\t\t\t\tconst b: string = tokens[i + 1];\n\t\t\t\tprevious = i > 0 ? `${a}.${b}` : `(${a} ? ${a}.${b} : void 0)`;\n\t\t\t}\n\t\t\treturn previous || '';\n\t\t});\n\t\treturn expression;\n\t}\n\n\tprotected static makeContext(module: Module, instance: Factory, parentInstance: Factory | Window, node: IElement, factory: typeof Factory, selector: string): IContext {\n\t\tinstance.rxcompId = ++ID;\n\t\tconst context: IContext = { module, instance, parentInstance, node, factory, selector };\n\t\tconst rxcompNodeId = node.rxcompId = (node.rxcompId || instance.rxcompId);\n\t\tconst nodeContexts = NODES[rxcompNodeId] || (NODES[rxcompNodeId] = []);\n\t\tnodeContexts.push(context);\n\t\tCONTEXTS[instance.rxcompId] = context;\n\t\treturn context;\n\t}\n\n\tprotected static deleteContext(id: number, keepContext: IContext | undefined): IContext[] {\n\t\tconst keepContexts: IContext[] = [];\n\t\tconst nodeContexts: IContext[] = NODES[id];\n\t\tif (nodeContexts) {\n\t\t\tnodeContexts.forEach((context: IContext) => {\n\t\t\t\tif (context === keepContext) {\n\t\t\t\t\tkeepContexts.push(keepContext);\n\t\t\t\t} else {\n\t\t\t\t\tconst instance: Factory = context.instance;\n\t\t\t\t\tinstance.unsubscribe$.next();\n\t\t\t\t\tinstance.unsubscribe$.complete();\n\t\t\t\t\tinstance.onDestroy();\n\t\t\t\t\tdelete CONTEXTS[instance.rxcompId];\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (keepContexts.length) {\n\t\t\t\tNODES[id] = keepContexts;\n\t\t\t} else {\n\t\t\t\tdelete NODES[id];\n\t\t\t}\n\t\t}\n\t\treturn keepContexts;\n\t}\n\n\tprotected static matchSelectors(node: HTMLElement, selectors: SelectorFunction[], results: ISelectorResult[]): ISelectorResult[] {\n\t\tfor (let i: number = 0; i < selectors.length; i++) {\n\t\t\tconst selectorResult: ISelectorResult | false = selectors[i](node);\n\t\t\tif (selectorResult) {\n\t\t\t\tconst factory: typeof Factory = selectorResult.factory;\n\t\t\t\tif (factory.prototype instanceof Component && factory.meta.template) {\n\t\t\t\t\tnode.innerHTML = factory.meta.template;\n\t\t\t\t}\n\t\t\t\tresults.push(selectorResult);\n\t\t\t\tif (factory.prototype instanceof Structure) {\n\t\t\t\t\t// console.log('Structure', node);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tprotected static querySelectorsAll(node: Node, selectors: SelectorFunction[], results: ISelectorResult[]): ISelectorResult[] {\n\t\tif (node.nodeType === 1) {\n\t\t\tconst selectorResults: ISelectorResult[] = this.matchSelectors(node as HTMLElement, selectors, []);\n\t\t\tresults = results.concat(selectorResults);\n\t\t\tconst structure: ISelectorResult | undefined = selectorResults.find(x => x.factory.prototype instanceof Structure);\n\t\t\tif (structure) {\n\t\t\t\treturn results;\n\t\t\t}\n\t\t\tconst childNodes: NodeListOf<ChildNode> = node.childNodes;\n\t\t\tfor (let i: number = 0; i < childNodes.length; i++) {\n\t\t\t\tresults = this.querySelectorsAll(childNodes[i], selectors, results);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tprotected static traverseUp(node: Node | null, callback: (node: Node, i: number) => any, i: number = 0): any {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseUp(node.parentNode, callback, i + 1);\n\t}\n\n\tprotected static traverseDown(node: Node | null, callback: (node: Node, i: number) => any, i: number = 0): any {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tlet result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tif (node.nodeType === 1) {\n\t\t\tlet j = 0,\n\t\t\t\tt = node.childNodes.length;\n\t\t\twhile (j < t && !result) {\n\t\t\t\tresult = this.traverseDown(node.childNodes[j], callback, i + 1);\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprotected static traversePrevious(node: Node | null, callback: (node: Node, i: number) => any, i: number = 0): any {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traversePrevious(node.previousSibling, callback, i + 1);\n\t}\n\n\tprotected static traverseNext(node: Node | null, callback: (node: Node, i: number) => any, i: number = 0): any {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseNext(node.nextSibling, callback, i + 1);\n\t}\n\n\tstatic meta: IModuleMeta;\n\n}\n\nexport function getContextByNode(node: Node): IContext | undefined {\n\tlet context: IContext | undefined;\n\tconst rxcompId: number | undefined = (node as IElement).rxcompId;\n\tif (rxcompId) {\n\t\tconst nodeContexts: IContext[] = NODES[rxcompId];\n\t\tif (nodeContexts) {\n\t\t\tcontext = nodeContexts.reduce((previous: IContext | undefined, current: IContext) => {\n\t\t\t\tif (current.factory.prototype instanceof Component) {\n\t\t\t\t\treturn current;\n\t\t\t\t} else if (current.factory.prototype instanceof Context) {\n\t\t\t\t\treturn previous ? previous : current;\n\t\t\t\t} else {\n\t\t\t\t\treturn previous;\n\t\t\t\t}\n\t\t\t}, undefined);\n\t\t\t// console.log(node.rxcompId, context);\n\t\t}\n\t}\n\treturn context;\n}\n\nexport function getHost(instance: Factory, factory: typeof Factory, node: IElement): Factory | undefined {\n\tif (!node) {\n\t\tnode = getContext(instance).node;\n\t}\n\tif (node.rxcompId) {\n\t\tconst nodeContexts: IContext[] = NODES[node.rxcompId];\n\t\tif (nodeContexts) {\n\t\t\t// console.log(nodeContexts);\n\t\t\tfor (let i: number = 0; i < nodeContexts.length; i++) {\n\t\t\t\tconst context: IContext = nodeContexts[i];\n\t\t\t\tif (context.instance !== instance) {\n\t\t\t\t\t// console.log(context.instance, instance);\n\t\t\t\t\tif (context.instance instanceof factory) {\n\t\t\t\t\t\treturn context.instance;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (node.parentNode) {\n\t\treturn getHost(instance, factory, node.parentNode as IElement);\n\t} else {\n\t\treturn undefined;\n\t}\n}\n","import Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nexport default class SrcDirective extends Directive {\n\n\tsrc?: string;\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tif (this.src) {\n\t\t\tnode.setAttribute('src', this.src);\n\t\t} else {\n\t\t\tnode.removeAttribute('src');\n\t\t}\n\t}\n\n}\n\nSrcDirective.meta = {\n\tselector: '[[src]]',\n\tinputs: ['src'],\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../core/factory';\n\nexport default class StyleDirective extends Directive {\n\n\tstyle?: { [key: string]: string } | null;\n\tpreviousStyle?: { [key: string]: string } | null;\n\n\tonChanges() {\n\t\tconst { node } = getContext(this);\n\t\tconst style = this.style;\n\t\tconst previousStyle = this.previousStyle;\n\t\tif (previousStyle) {\n\t\t\tfor (let key in previousStyle) {\n\t\t\t\tif (!style || !style[key]) {\n\t\t\t\t\tconst splitted: string[] = key.split('.');\n\t\t\t\t\tconst propertyName = splitted.shift();\n\t\t\t\t\tnode.style.removeProperty(propertyName!);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (style) {\n\t\t\tfor (let key in style) {\n\t\t\t\tif (!previousStyle || previousStyle[key] !== style[key]) {\n\t\t\t\t\tconst splitted: string[] = key.split('.');\n\t\t\t\t\tconst propertyName = splitted.shift();\n\t\t\t\t\tconst value = style[key] + (splitted.length ? splitted[0] : '');\n\t\t\t\t\t// console.log(propertyName, value, style, key, style[key]);\n\t\t\t\t\tnode.style.setProperty(propertyName!, value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.previousStyle = style;\n\t\t// console.log('StyleDirective.onChanges', style);\n\t}\n\n}\n\nStyleDirective.meta = {\n\tselector: `[[style]]`,\n\tinputs: ['style']\n};\n","\nimport ClassDirective from './class/class.directive';\nimport Factory from './core/factory';\nimport Pipe from './core/pipe';\nimport EventDirective from './event/event.directive';\nimport ForStructure from './for/for.structure';\nimport HrefDirective from './href/href.directive';\nimport IfStructure from './if/if.structure';\nimport InnerHtmlDirective from './inner-html/inner-html.directive';\nimport JsonPipe from './json/json.pipe';\nimport Module from './module/module';\nimport SrcDirective from './src/src.directive';\nimport StyleDirective from './style/style.directive';\n\nconst factories: typeof Factory[] = [\n\tClassDirective,\n\tEventDirective,\n\tForStructure,\n\tHrefDirective,\n\tIfStructure,\n\tInnerHtmlDirective,\n\tSrcDirective,\n\tStyleDirective,\n];\n\nconst pipes: typeof Pipe[] = [\n\tJsonPipe,\n];\n\nexport default class CoreModule extends Module {\n\n\tstatic meta = {\n\t\tdeclarations: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t],\n\t\texports: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t]\n\t};\n\n}\n","import Component from '../core/component';\nimport Directive from '../core/directive';\nimport Factory from '../core/factory';\nimport Pipe from '../core/pipe';\nimport Structure from '../core/structure';\nimport { FactoryList, IElement, IModuleParsedImportedMeta, IModuleParsedMeta, ISelectorResult, MatchFunction, PipeList, PipeMap, SelectorFunction } from '../core/types';\nimport Module from '../module/module';\n\nconst ORDER: FactoryList = [Structure, Component, Directive];\n\nexport default class Platform {\n\n\tstatic bootstrap(moduleFactory?: typeof Module): Module {\n\t\tif (!moduleFactory) {\n\t\t\tthrow ('missing moduleFactory');\n\t\t}\n\t\tif (!moduleFactory.meta) {\n\t\t\tthrow ('missing moduleFactory meta');\n\t\t}\n\t\tif (!moduleFactory.meta.bootstrap) {\n\t\t\tthrow ('missing bootstrap');\n\t\t}\n\t\tif (!moduleFactory.meta.bootstrap.meta) {\n\t\t\tthrow ('missing bootstrap meta');\n\t\t}\n\t\tif (!moduleFactory.meta.bootstrap.meta.selector) {\n\t\t\tthrow ('missing bootstrap meta selector');\n\t\t}\n\t\tconst meta: IModuleParsedMeta = this.resolveMeta(moduleFactory!);\n\t\tconst module = new moduleFactory();\n\t\tmodule.meta = meta;\n\t\tconst instances = module.compile(meta.node, window);\n\t\tconst root = instances[0];\n\t\tconsole.log('end', instances);\n\t\t// if (root instanceof module.meta.bootstrap) {\n\t\t// root.pushChanges();\n\t\t// }\n\t\treturn module;\n\t}\n\n\tstatic isBrowser(): boolean {\n\t\treturn Boolean(window);\n\t}\n\n\t// static isServer() {}\n\n\tprotected static querySelector(selector: string): IElement | null {\n\t\treturn document.querySelector(selector);\n\t}\n\n\tprotected static resolveMeta(moduleFactory: typeof Module): IModuleParsedMeta {\n\t\tconst meta: IModuleParsedImportedMeta = this.resolveImportedMeta(moduleFactory);\n\t\tconst bootstrap: typeof Factory = moduleFactory.meta.bootstrap!;\n\t\tconst node = this.querySelector(bootstrap.meta.selector!);\n\t\tif (!node) {\n\t\t\tthrow (`missing node ${bootstrap.meta.selector}`);\n\t\t}\n\t\tconst nodeInnerHTML = node.innerHTML;\n\t\tconst pipes = this.resolvePipes(meta);\n\t\tconst factories = this.resolveFactories(meta);\n\t\tthis.sortFactories(factories);\n\t\tfactories.unshift(bootstrap);\n\t\tconst selectors = this.unwrapSelectors(factories);\n\t\treturn { factories, pipes, selectors, bootstrap, node, nodeInnerHTML };\n\t}\n\n\tprotected static resolveImportedMeta(moduleFactory: typeof Module): IModuleParsedImportedMeta {\n\t\tconst meta: IModuleParsedImportedMeta = Object.assign({\n\t\t\timports: [],\n\t\t\tdeclarations: [],\n\t\t\tpipes: [],\n\t\t\texports: []\n\t\t}, moduleFactory.meta);\n\t\tmeta.imports = (moduleFactory.meta.imports || []).map(moduleFactory => this.resolveImportedMeta(moduleFactory));\n\t\treturn meta;\n\t}\n\n\tprotected static resolvePipes(meta: IModuleParsedImportedMeta, exported?: boolean): PipeMap {\n\t\tconst importedPipes: PipeMap[] = meta.imports.map((importMeta: IModuleParsedImportedMeta) => this.resolvePipes(importMeta, true));\n\t\tconst pipes: PipeMap = {};\n\t\tconst pipeList: PipeList = (exported ? meta.exports : meta.declarations).filter((x): x is typeof Pipe => x.prototype instanceof Pipe);\n\t\tpipeList.forEach(pipeFactory => pipes[pipeFactory.meta.name] = pipeFactory);\n\t\treturn Object.assign({}, ...importedPipes, pipes);\n\t}\n\n\tprotected static resolveFactories(meta: IModuleParsedImportedMeta, exported?: boolean): FactoryList {\n\t\tconst importedFactories: FactoryList[] = meta.imports.map((importMeta: any) => this.resolveFactories(importMeta, true));\n\t\tconst factoryList: FactoryList = (exported ? meta.exports : meta.declarations).filter((x): x is typeof Factory => x.prototype instanceof Factory);\n\t\treturn Array.prototype.concat.call(factoryList, ...importedFactories);\n\t}\n\n\tprotected static sortFactories(factories: FactoryList): void {\n\t\tfactories.sort((a, b) => {\n\t\t\tconst ai = ORDER.reduce((p, c, i) => a.prototype instanceof c ? i : p, -1);\n\t\t\tconst bi = ORDER.reduce((p, c, i) => b.prototype instanceof c ? i : p, -1);\n\t\t\t// return ai - bi;\n\t\t\tconst o = ai - bi;\n\t\t\tif (o === 0) {\n\t\t\t\treturn (a.meta.hosts ? 1 : 0) - (b.meta.hosts ? 1 : 0);\n\t\t\t}\n\t\t\treturn o;\n\t\t});\n\t}\n\n\tprotected static getExpressions(selector: string): MatchFunction[] {\n\t\tlet matchers: ((node: HTMLElement) => boolean)[] = [];\n\t\tselector.replace(/\\.([\\w\\-\\_]+)|\\[(.+?\\]*)(\\=)(.*?)\\]|\\[(.+?\\]*)\\]|([\\w\\-\\_]+)/g, function (value: string, c1, a2, u3, v4, a5, e6) {\n\t\t\tif (c1) {\n\t\t\t\tmatchers.push(function (node) {\n\t\t\t\t\treturn node.classList.contains(c1);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (a2) {\n\t\t\t\tmatchers.push(function (node) {\n\t\t\t\t\treturn (node.hasAttribute(a2) && node.getAttribute(a2) === v4) ||\n\t\t\t\t\t\t(node.hasAttribute(`[${a2}]`) && node.getAttribute(`[${a2}]`) === v4);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (a5) {\n\t\t\t\tmatchers.push(function (node) {\n\t\t\t\t\treturn node.hasAttribute(a5) || node.hasAttribute(`[${a5}]`);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (e6) {\n\t\t\t\tmatchers.push(function (node) {\n\t\t\t\t\treturn node.nodeName.toLowerCase() === e6.toLowerCase();\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn '';\n\t\t});\n\t\treturn matchers;\n\t}\n\n\tprotected static unwrapSelectors(factories: FactoryList): SelectorFunction[] {\n\t\tconst selectors: SelectorFunction[] = [];\n\t\tfactories.forEach((factory: typeof Factory) => {\n\t\t\tif (factory.meta && factory.meta.selector) {\n\t\t\t\tfactory.meta.selector.split(',').forEach((selector: string) => {\n\t\t\t\t\tselector = selector.trim();\n\t\t\t\t\tlet excludes: MatchFunction[] = [];\n\t\t\t\t\tconst matchSelector = selector.replace(/\\:not\\((.+?)\\)/g, (value, unmatchSelector) => {\n\t\t\t\t\t\texcludes = this.getExpressions(unmatchSelector);\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t});\n\t\t\t\t\tconst includes: MatchFunction[] = this.getExpressions(matchSelector);\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst included = includes.reduce((p, match) => {\n\t\t\t\t\t\t\treturn p && match(node);\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t\tconst excluded = excludes.reduce((p, match) => {\n\t\t\t\t\t\t\treturn p || match(node);\n\t\t\t\t\t\t}, false);\n\t\t\t\t\t\tif (included && !excluded) {\n\t\t\t\t\t\t\treturn { node, factory, selector } as ISelectorResult;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn selectors;\n\t}\n\n}\n","import Platform from './platform';\n\nexport default class Browser extends Platform { }\n","import { interval } from 'rxjs';\nimport { take, takeUntil } from 'rxjs/operators';\nimport { Browser, Component, CoreModule, Module, Pipe } from '../../src/rxcomp';\n\n// component\nclass RootComponent extends Component {\n\tflag = false;\n\tnested = [\n\t\t{ items: [1, 2, 3, 4] },\n\t\t{ items: [1, 2, 3, 4] },\n\t\t{ items: [1, 2, 3, 4] }\n\t];\n\titems = [1, 2, 3, 4];\n\tobject = { a: 1, b: { c: 2 } };\n\n\tonInit() {\n\n\t\tif (false) {\n\t\t\tinterval(1000).pipe(\n\t\t\t\ttake(1000),\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(items => {\n\t\t\t\tthis.flag = !this.flag;\n\t\t\t\tthis.pushChanges();\n\t\t\t});\n\t\t}\n\n\t\tif (false) {\n\t\t\tinterval(50).pipe(\n\t\t\t\ttake(1000),\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(items => {\n\t\t\t\tthis.items = new Array(1 + Math.floor(Math.random() * 9)).fill(0).map((x, i) => i + 1);\n\t\t\t\tthis.pushChanges();\n\t\t\t});\n\t\t}\n\n\t}\n\n\tgetColor(index: number): string {\n\t\treturn ['red', 'green', 'blue'][index % 3];\n\t}\n}\nRootComponent.meta = {\n\tselector: '[root-component]',\n};\n\n// pipe\nclass ExamplePipe extends Pipe {\n\tstatic transform(value: number): number {\n\t\treturn value * 2;\n\t}\n}\nExamplePipe.meta = {\n\tname: 'example',\n};\n\nclass AppModule extends Module { }\nAppModule.meta = {\n\timports: [\n\t\tCoreModule\n\t],\n\tdeclarations: [\n\t\tExamplePipe,\n\t],\n\tbootstrap: RootComponent,\n};\n\nBrowser.bootstrap(AppModule);\n"],"names":["CONTEXTS","NODES","Factory","Subject","ReplaySubject","onInit","onChanges","changes","onView","onDestroy","pushChanges","changes$","next","getContext","instance","rxcompId","Directive","ClassDirective","node","classList","forEach","x","keys","push","object","class","key","split","concat","setAttribute","join","meta","selector","inputs","EVENTS","EventDirective","module","parentInstance","event","replace","event$","fromEvent","pipe","shareReplay","expression","getAttribute","outputFunction","makeFunction","takeUntil","unsubscribe$","subscribe","resolve","Structure","Component","parse","RESERVED_PROPERTIES","Context","descriptors","mergeDescriptors","Object","getPrototypeOf","defineProperties","source","properties","getOwnPropertyNames","shift","indexOf","hasOwnProperty","descriptor","getOwnPropertyDescriptor","value","args","apply","length","ForItem","$key","$value","index","count","even","ForStructure","forbegin","document","createComment","parentNode","replaceChild","forend","insertBefore","nextSibling","removeAttribute","token","getExpressionToken","forFunction","iterable","context","result","isArray","Array","array","total","previous","instances","i","Math","max","clonedNode","cloneNode","makeInstance","forItemContext","compile","removeChild","remove","trim","expressions","map","filter","forExpressions","keyValueMatches","match","indexExpressions","HrefDirective","href","IfStructure","ifbegin","ifend","ifFunction","element","InnerHtmlDirective","innerHTML","undefined","Pipe","transform","JsonPipe","cache","Map","json","JSON","stringify","has","set","name","ID","Module","componentNode","querySelectorsAll","selectors","factory","prototype","console","log","getParentInstance","constructor","makeContext","makeHosts","makeInputs","outputs","makeOutputs","resolveInputsOutputs","params","parseExpression","expression_func","Function","payload","childNodes","child","nodeType","getContextByNode","text","parseTextNode","keepInstance","keepContext","traverseDown","keepContexts","deleteContext","destroy","nodeInnerHTML","getInstance","Document","window","traverseUp","nodeExpressions","parseTextNodeExpression","wholeText","replacedText","reduce","p","c","nodeValue","textNode","createTextNode","pushFragment","from","to","fragment","substring","regex","lastIndex","matches","exec","hosts","getHost","makeInput","input","hasAttribute","attribute","a","b","makeOutput","output$","tap","output","inputFunction","l","r","rx1","parsePipes","parseOptionalChaining","parsePipeParams","func","segments","word","block","t","substr","tokens","rxcompNodeId","nodeContexts","id","complete","matchSelectors","results","selectorResult","template","selectorResults","structure","find","callback","j","traversePrevious","previousSibling","traverseNext","current","SrcDirective","src","StyleDirective","style","previousStyle","splitted","propertyName","removeProperty","setProperty","factories","pipes","CoreModule","declarations","exports","ORDER","Platform","bootstrap","moduleFactory","resolveMeta","root","isBrowser","Boolean","querySelector","resolveImportedMeta","resolvePipes","resolveFactories","sortFactories","unshift","unwrapSelectors","assign","imports","exported","importedPipes","importMeta","pipeList","pipeFactory","importedFactories","factoryList","call","sort","ai","bi","o","getExpressions","matchers","c1","a2","u3","v4","a5","e6","contains","nodeName","toLowerCase","excludes","matchSelector","unmatchSelector","includes","included","excluded","Browser","RootComponent","items","getColor","ExamplePipe","AppModule"],"mappings":"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"}