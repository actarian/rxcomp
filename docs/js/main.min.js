!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("main",["rxjs","rxjs/operators"],e):e((t=t||self).rxjs,t.rxjs.operators)}(this,(function(t,e){"use strict";function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var o=function(){};o.meta={selector:"[(directive)]"};var i=function(){};i.meta={selector:"[component]"};var s=0,a={},u=function(){function n(t){if(!t)throw"missing options";if(!t.bootstrap)throw"missing bootstrap";this.options=t;var e={};t.pipes&&t.pipes.forEach((function(t){return e[t.meta.name]=t})),this.pipes=e;var r=t.bootstrap;this.root=this.makeInstance(document.querySelector(r.meta.selector),r),this.selectors=n.unwrapSelectors(t.factories)}var r=n.prototype;return r.use$=function(){var r=this;return t.of(n.querySelectorsAll(document,this.selectors,[])).pipe(e.filter((function(t){return t.length>0})),e.map((function(t){return t.map((function(t){return r.makeInstance(t.node,t.factory,t.selector)}))})),e.shareReplay(1))},r.makeInstance=function(r,o,s,a){var u=this;if(r.parentNode){var c=o.prototype instanceof i,l=o.meta;if(!(a=a||this.getParentScope(r.parentNode)))return;var f=new o;Object.defineProperties(f,{state$:{value:new t.BehaviorSubject(f),writable:!1,enumerable:!1},unsubscribe$:{value:new t.Subject,writable:!1,enumerable:!1}}),f.pushState=function(){this.state$.next(this)};var p=n.setContext(this,f,a,r,o,s);return c&&(p.inputs=this.makeInputs(l,f),p.outputs=this.makeOutputs(l,f)),"function"==typeof f.onInit&&f.onInit(),a.state$&&a.state$.pipe(e.takeUntil(f.unsubscribe$)).subscribe((function(t){c&&u.resolveInputsOutputs(f,t),u.pushState(f,t),c&&u.parse(r,f)})),f}},r.remove=function(t){var e=[];return n.traverseDown(t,(function(t){for(var n=0,r=Object.entries(a);n<r.length;n++){var o=r[n],i=o[0],s=o[1];if(s.node===t){var u=s.instance;u.unsubscribe$.next(),u.unsubscribe$.complete(),"function"==typeof u.onDestroy&&u.onDestroy(),e.push(i)}}})),e.forEach((function(t){return delete a[t]})),t},r.compile=function(t,e){var r=this;if(e){var o=++s;e.$id=o;n.setContext(this,e,e.parentInstance,t,e.constructor)}return n.querySelectorsAll(t,this.selectors,[]).map((function(t){var n=r.makeInstance(t.node,t.factory,t.selector,e);return t.factory.prototype instanceof i&&(e=void 0),n})).filter((function(t){return void 0!==t}))},r.parse=function(t,e){var n=this,r=function(){var t=arguments.length<=1?void 0:arguments[1],r=n.makeFunction(t);return n.resolve(r,e,e)},o=function(t){return t.replace(new RegExp("{{2}(.*?)}{2}(?!})","g"),r)};if(t.hasAttribute("[innerHTML]")){var i="{{"+t.getAttribute("[innerHTML]")+"}}";t.innerHTML=o(i)}else if(t.hasAttribute("innerHTML")){var s=t.getAttribute("innerHTML");t.innerHTML=o(s)}else for(var a=0;a<t.childNodes.length;a++){var u=t.childNodes[a];if(1===u.nodeType)this.parse(u,e);else if(3===u.nodeType){var c=u.nodeValue,l=o(c);if(c!==l){t.setAttribute("innerHTML",c);var f=document.createTextNode(l);t.replaceChild(f,u)}}}"function"==typeof e.onParse&&scope.onParse()},r.resolve=function(t,e,n){return t.apply(e,[n,this])},r.makeInputs=function(t,e){var n=this,r={};return t.inputs&&t.inputs.forEach((function(t,o){return r[t]=n.makeInput(e,t)})),r},r.makeOutputs=function(t,e){var n=this,r={};return t.outputs&&t.outputs.forEach((function(t,o){return r[t]=n.makeOutput(e,t)})),r},r.resolveInputsOutputs=function(t,e){var r=this,o=n.getContext(t),i=o.parentInstance,s=o.inputs;Object.keys(s).forEach((function(e){var n=s[e],o=r.resolve(n,i,t);t[e]=o}))},r.getScope=function(t){return t===document?window:n.getComponentInstanceByNode(t)},r.getParentScope=function(t){var e=this;return n.traverseUp(t,(function(t){return e.getScope(t)}))},r.pushState=function(t,e){"function"==typeof t.onState&&t.onState(e),t.state$&&t.state$.next(t)},r.optionalChaining=function(t){var e;return t=t.replace(/(\w+(\?\.))+([\.|\w]+)/g,(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var o=n[0].split("?."),i=0;i<o.length-1;i++){var s=i>0?"("+o[i]+" = "+e+")":o[i],a=o[i+1];e=i>0?s+"."+a:"("+s+" ? "+s+"."+a+" : void 0)"}return e||""}))},r.makeFunction=function(t,e){if(void 0===e&&(e=["$instance"]),!t)return function(){return null};var r=this.pipes,o=n.getPipesSegments(t);return t=o.shift().trim(),t=this.optionalChaining(t),e.push("module"),o.length?(t=o.reduce((function(t,e,o){var i=n.getPipeParamsSegments(e),s=i.shift().trim(),a=r[s];if(!a||"function"!=typeof a.transform)throw"missing pipe "+s;return"pipes."+s+".transform("+t+","+i.join(",")+")"}),t),new Function("with(this) {\n\t\t\t\treturn (function ("+e.join(",")+") {\n\t\t\t\t\tconst pipes = module.pipes;\n\t\t\t\t\treturn "+t+";\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}")):new Function(this.options.debug?"with(this) {\n\t\t\t\treturn (function ("+e.join(",")+") {\n\t\t\t\t\tlet value;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = "+t+";\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\tvalue = '<span style=\"color:red;\">' + e.message + ' in expression ' + expression + '</span>';\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}":"with(this) {\n\t\t\t\treturn (function ("+e.join(",")+") {\n\t\t\t\t\treturn "+t+";\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}")},r.makeInput=function(t,e){var r=n.getContext(t).node.getAttribute("["+e+"]");return this.makeFunction(r)},r.makeOutput=function(r,o){var i=this,s=n.getContext(r),a=s.node,u=s.parentInstance,c=a.getAttribute("("+o+")"),l=this.makeFunction(c,["$event"]),f=(new t.Subject).pipe(e.tap((function(t){i.resolve(l,u,t)})));return f.pipe(e.takeUntil(r.unsubscribe$)).subscribe(),r[o]=f,l},r.contexts_=function(){return a},n.getPipesSegments=function(t){for(var e=[],n=0,r="",o=0,i=t.length;n<i;){var s=t.substr(n,1);"{"!==s&&"("!==s&&"["!==s||o++,"}"!==s&&")"!==s&&"]"!==s||o--,"|"===s&&0===o?(r.length&&e.push(r),r=""):r+=s,n++}return r.length&&e.push(r),e},n.getPipeParamsSegments=function(t){for(var e=[],n=0,r="",o=0,i=t.length;n<i;){var s=t.substr(n,1);"{"!==s&&"("!==s&&"["!==s||o++,"}"!==s&&")"!==s&&"]"!==s||o--,":"===s&&0===o?(r.length&&e.push(r),r=""):r+=s,n++}return r.length&&e.push(r),e},n.unwrapSelectors=function(t){var e=[];return t.forEach((function(t){t.meta.selector.split(",").forEach((function(n){if(0===(n=n.trim()).indexOf(".")){var r=n.replace(/\./g,"");e.push((function(e){return!!e.classList.has(r)&&{node:e,factory:t,selector:n}}))}else if(n.match(/\[(.+)\]/)){var o=n.substr(1,n.length-2);e.push((function(e){return!!e.hasAttribute(o)&&{node:e,factory:t,selector:n}}))}else e.push((function(e){return!!(e.nodeName.toLowerCase()===n.toLowerCase())&&{node:e,factory:t,selector:n}}))}))})),e},n.matchSelectors=function(t,e,n){return e.forEach((function(e){var r=e(t);if(r){var o=r.factory;o.prototype instanceof i&&o.meta.template&&(t.innerHTML=o.meta.template),n.push(r)}})),n},n.querySelectorsAll=function(t,e,n){1===t.nodeType&&(n=this.matchSelectors(t,e,n));var r=t.childNodes;if(r)for(var o=0;o<r.length;o++)n=this.querySelectorsAll(r[o],e,n);return n},n.traverseUp=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);return r||this.traverseUp(t.parentNode,e,n+1)}},n.traverseDown=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);if(r)return r;if(1===t.nodeType)for(var o=0,i=t.childNodes.length;o<i&&!r;)r=this.traverseDown(t.childNodes[o],e,n+1),o++;return r}},n.traversePrevious=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);return r||this.traversePrevious(t.previousSibling,e,n+1)}},n.traverseNext=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);return r||this.traverseNext(t.nextSibling,e,n+1)}},n.use$=function(t){return new n(t).use$()},n.getContext=function(t){return a[t.$id]},n.setContext=function(t,e,n,r,o,i){var u=++s;return e.$id=u,a[u]={module:t,instance:e,parentInstance:n,node:r,factory:o,selector:i}},n.getComponentInstanceByNode=function(t){var e=Object.keys(a).find((function(e){return a[e].node===t&&a[e].factory.prototype instanceof i}));if(e)return a[e].instance},n}(),c=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.onInit=function(){var t=u.getContext(this),e=t.module,n=t.node.getAttribute("[class]");this.classFunction=e.makeFunction(n)},n.onState=function(t){var e=u.getContext(this),n=e.module,r=e.node,o=n.resolve(this.classFunction,t,this);Object.keys(o).forEach((function(t){o[t]?r.classList.add(t):r.classList.remove(t)}))},e}(o);c.meta={selector:"[[class]]"};var l=function(n){function o(){return n.apply(this,arguments)||this}return r(o,n),o.prototype.onInit=function(){var n=u.getContext(this),r=n.module,o=n.node,i=n.selector,s=n.parentInstance,a=this.event=i.replace(/\[|\]|\(|\)/g,""),c=this.event$=t.fromEvent(o,a).pipe(e.shareReplay(1)),l=o.getAttribute("("+a+")");if(l){var f=r.makeFunction(l,["$event"]);c.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){r.resolve(f,s,t)}))}else s[a+"$"]=c},o}(o);l.meta={selector:"[("+["click","mousedown","mouseup","touchstart","touchmove","touchend","keydown","keyup","input","change","loaded"].join(")],[(")+")]"};var f=function(){};f.meta={selector:"[(directive)]"};var p=function(t){function e(e,n,r,o,i){var s,a;return(a=t.call(this,i,((s={})[e]={get:function(){return this.$value},set:function(t){this.$value=t}},s))||this).$key=e,a.$value=n,a.index=r,a.count=o.length,a}var o,i,s;return r(e,t),e.prototype.pushState=function(){this.state$.next(this)},o=e,(i=[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}])&&n(o.prototype,i),s&&n(o,s),e}((function(e,n){var r=this,o=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(e));delete o.constructor,Object.keys(o).forEach((function(t){var n=o[t];"function"==typeof n.value&&(n.value=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];e[t].apply(e,r)})}));var i=Object.getOwnPropertyDescriptors(e);Object.keys(i).forEach((function(t){var n=i[t];"function"==typeof n.value&&(n.value=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];e[t].apply(e,r)})})),Object.defineProperties(this,Object.assign(o,i,{state$:{value:new t.BehaviorSubject(this),writable:!1,enumerable:!1},unsubscribe$:{value:new t.Subject,writable:!1,enumerable:!1}},n)),this.pushState=function(){r.state$.next(r)}})),h=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.onInit=function(){var t=u.getContext(this),e=t.module,n=t.node,r=this.forbegin=document.createComment("*for begin");n.parentNode.replaceChild(r,n);var o=this.forend=document.createComment("*for end");r.parentNode.insertBefore(o,r.nextSibling);var i=n.getAttribute("*for");if(n.removeAttribute("*for"),null===i)throw"invalid for";if(0!==i.trim().indexOf("let"))throw"invalid for";var s=(i=(i=i.substr(3)).split(" of "))[0].trim(),a=i[1].trim();this.forFunction=e.makeFunction(a),this.key=s,this.items=[]},n.onState=function(t){for(var e=u.getContext(this),n=e.module,r=e.node,o=n.resolve(this.forFunction,t,this)||[],i=o.length,s=this.items.length,a=this.forbegin.nextSibling,c=0;c<Math.max(s,i);c++)if(c<i){var l=o[c];if(c<s){var f=a,h=this.items[c];h[this.key]=l,h.pushState(),n.parse(f,h),a=a.nextSibling}else{var d=r.cloneNode(!0);this.forend.parentNode.insertBefore(d,this.forend);var v=new p(this.key,l,c,o,e.parentInstance);n.compile(d,v);n.parse(d,v),a=d.nextSibling,this.items.push(v)}}else{var m=this.items[c],g=u.getContext(m).node;g.parentNode.removeChild(g),n.remove(g)}this.items.length=o.length},e}(f);h.meta={selector:"[*for]"};var d=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.onInit=function(){var t=u.getContext(this),e=t.module,n=t.node,r=this.ifbegin=document.createComment("*if begin");n.parentNode.replaceChild(r,n);var o=this.ifend=document.createComment("*if end");r.parentNode.insertBefore(o,r.nextSibling);var i=n.getAttribute("*if");this.expression=i,this.ifFunction=e.makeFunction(i);var s=n.cloneNode(!0);s.removeAttribute("*if"),this.clonedNode=s},n.onState=function(t){var e=u.getContext(this).module;e.resolve(this.ifFunction,t,this)?this.clonedNode.parentNode||(this.ifend.parentNode.insertBefore(this.clonedNode,this.ifend),e.compile(this.clonedNode),e.parse(this.clonedNode,t)):this.clonedNode.parentNode&&(this.clonedNode.parentNode.removeChild(this.clonedNode),e.remove(this.clonedNode))},e}(f);d.meta={selector:"[*if]"};var v=function(){function t(){}return t.transform=function(t){return JSON.stringify(t)},t}();v.meta={name:"json"};var m=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.onInit=function(){var t=u.getContext(this),e=t.module,n=t.node.getAttribute("[style]");this.styleFunction=e.makeFunction(n)},n.onState=function(t){var e=u.getContext(this),n=e.module,r=e.node,o=n.resolve(this.styleFunction,t,this);Object.keys(o).forEach((function(t){r.style[t]=o[t]}))},e}(o);m.meta={selector:"[[style]]"};var g=function(){function t(){}return t.delete=function(t){this.isLocalStorageSupported()&&window.localStorage.removeItem(t)},t.exist=function(t){if(this.isLocalStorageSupported())return void 0!==window.localStorage[t]},t.get=function(t){var e=null;if(this.isLocalStorageSupported()&&void 0!==window.localStorage[t])try{e=JSON.parse(window.localStorage[t])}catch(e){console.log("LocalStorageService.get.error parsing",t,e)}return e},t.set=function(t,e){if(this.isLocalStorageSupported())try{var n=[],r=JSON.stringify(e,(function(t,e){if("object"==typeof e&&null!==e){if(-1!==n.indexOf(e))return;n.push(e)}return e}));window.localStorage.setItem(t,r)}catch(n){console.log("LocalStorageService.set.error serializing",t,e,n)}},t.isLocalStorageSupported=function(){if(this.supported)return!0;var t=!1;try{(t="localStorage"in window&&null!==window.localStorage)?(window.localStorage.setItem("test","1"),window.localStorage.removeItem("test")):t=!1}catch(e){t=!1}return this.supported=t,t},t}(),b=function(){function e(){}return e.set=function(t){return g.set("items",t),this.get$().next(t)},e.get$=function(){if(this.store$)return this.store$;var e=g.get("items");return e||(e=[{id:3,name:"cookies",date:new Date(Date.now())},{id:2,name:"pizza",date:new Date(2019,3,22,12)},{id:1,name:"bread",date:new Date(2019,0,6,12)}],g.set("items",e)),this.store$=new t.BehaviorSubject(e)},e.add$=function(e){var n=Object.assign({id:Date.now(),date:new Date(Date.now())},e),r=this.store$.getValue();return r.unshift(n),this.set(r),t.of(n)},e.patch$=function(e){var n=this.store$.getValue(),r=n.find((function(t){return t.id===e.id}));return r&&(Object.assign(r,e),this.set(n)),t.of(r)},e.delete$=function(e){var n=this.store$.getValue(),r=n.indexOf(e);return-1!==r&&(n.splice(r,1),this.set(n)),t.of(e)},e}(),y=function(t){function n(){return t.apply(this,arguments)||this}r(n,t);var o=n.prototype;return o.onInit=function(){var t=this,n=u.getContext(this);this.input=n.node.querySelector(".control--text"),this.items=[],this.store$=b.get$(),this.store$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushState()}))},o.onInput=function(t){this.pushState()},o.onAddItem=function(t){var e=this;this.input.value&&b.add$({name:this.input.value}).subscribe((function(t){e.input.value=null}))},o.onToggleItem=function(t){b.patch$({id:t.id,done:!t.done}).subscribe((function(t){}))},o.onRemoveItem=function(t){b.delete$(t).subscribe((function(t){}))},n}(i);y.meta={selector:"[app-component]"};var S=function(){function t(){}return t.transform=function(t,e,n){return void 0===e&&(e="it-IT-u-ca-gregory"),void 0===n&&(n={dateStyle:"short",timeStyle:"short"}),new Date(t).toLocaleDateString(e,n)},t}();S.meta={name:"date"};var w=[{hex:"#073B4C"},{hex:"#EF476F"},{hex:"#1CCC9D"},{hex:"#118AB2"},{hex:"#EFC156"}];function x(t,e){return n=w[t%w.length].hex,r=e,o=parseInt(n.slice(1,3),16),i=parseInt(n.slice(3,5),16),s=parseInt(n.slice(5,7),16),r?"rgba("+o+","+i+","+s+","+r+")":"rgb("+o+","+i+","+s+")";var n,r,o,i,s}var k=function(t){function e(){return t.apply(this,arguments)||this}r(e,t);var n=e.prototype;return n.onState=function(t){this.backgroundColor=x(this.item.id,.15),this.color=x(this.item.id)},n.onToggle=function(t){this.toggle.next(t)},n.onRemove=function(t){this.remove.next(t)},e}(i);k.meta={selector:"[todo-item-component]",inputs:["item"],outputs:["toggle","remove"],template:'\n\t\t<button type="button" class="btn--toggle" [style]="{ color: color }" (click)="onToggle(item)">\n\t\t\t<i class="icon--check" *if="item.done"></i>\n\t\t\t<i class="icon--circle" *if="!item.done"></i>\n\t\t</button>\n\t\t<div class="title" [style]="{ color: color }" [innerHTML]="item.name"></div>\n\t\t<div class="date" [style]="{ background: backgroundColor, color: color }" [innerHTML]="item.date | date : \'en-US\' : { month: \'short\', day: \'2-digit\', year: \'numeric\' }"></div>\n\t\t<button type="button" class="btn--remove" [style]="{ color: color }" (click)="onRemove(item)"><i class="icon--remove"></i></button>\n\t'},u.use$({factories:[c,l,h,d,m,k],pipes:[S,v],bootstrap:y}).subscribe((function(t){}))}));
//# sourceMappingURL=main.min.js.map