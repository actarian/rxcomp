!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("main",["rxjs","rxjs/operators"],e):e((t=t||self).rxjs,t.rxjs.operators)}(this,(function(t,e){"use strict";function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t,e,n){return(i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var o=[null];o.push.apply(o,e);var i=new(Function.bind.apply(t,o));return n&&r(i,n.prototype),i}).apply(null,arguments)}var s=function(){};s.meta={selector:"[(directive)]"};var a=function(){};a.meta={selector:"[component]"};var u=function(t){function e(e,n){var o;o=t.call(this)||this;var r=Object.getOwnPropertyDescriptors(Object.getPrototypeOf(e));delete r.constructor,Object.keys(r).forEach((function(t){console.log("1",t);var n=r[t];"function"==typeof n.value&&(n.value=function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];e[t].apply(e,o)})}));var i=Object.getOwnPropertyDescriptors(e);return Object.keys(i).forEach((function(t){switch(t){case"$id":case"state$":case"unsubscribe$":case"pushState":break;default:console.log("2",t);var n=i[t];"function"==typeof n.value&&(n.value=function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];e[t].apply(e,o)})}})),o}return o(e,t),e}(a),c=0,l={},f={},p=function(){function n(t){if(!t)throw"missing options";if(!t.bootstrap)throw"missing bootstrap";this.options=t;var e={};t.pipes&&t.pipes.forEach((function(t){return e[t.meta.name]=t})),this.pipes=e;var o=t.bootstrap;if(this.node=document.querySelector(o.meta.selector),!this.node)throw"missing node "+o.meta.selector;this.root=this.makeInstance(this.node,o,o.meta.selector,window),this.selectors=n.unwrapSelectors(t.factories)}var o=n.prototype;return o.use$=function(){var o=this;return t.of(n.querySelectorsAll(this.node,this.selectors,[])).pipe(e.filter((function(t){return t.length>0})),e.map((function(t){return t.map((function(t){return o.makeInstance(t.node,t.factory,t.selector)})).filter((function(t){return t}))})),e.tap((function(t){return t.forEach((function(t){var e=n.getContext(t);e.factory.prototype instanceof a&&o.parse(e.node,t)}))})),e.shareReplay(1))},o.makeContext=function(t,e,o,r){var i=n.makeContext(this,t,e,o,t.constructor,r);return console.log("Module.makeContext",i,i.instance,i.node),i},o.makeInstance=function(o,r,s,u,c){var l=this;if(u||o.parentNode){var f=r.prototype instanceof a,p=r.meta;if(!(u=u||this.getParentScope(o.parentNode)))return;var h=i(r,c||[]);Object.defineProperties(h,{state$:{value:new t.BehaviorSubject(h),writable:!1,enumerable:!1},unsubscribe$:{value:new t.Subject,writable:!1,enumerable:!1}});var d=this;h.pushState=function(){f&&d.parse(o,h),this.state$.next(this)};var v=n.makeContext(this,h,u,o,r,s);return f&&(v.inputs=this.makeInputs(p,h),v.outputs=this.makeOutputs(p,h)),"function"==typeof h.onInit&&h.onInit(),u.state$&&u.state$.pipe(e.takeUntil(h.unsubscribe$)).subscribe((function(t){f&&l.resolveInputsOutputs(h,t),"function"==typeof h.onState&&h.onState(t),h.pushState()})),h}},o.remove=function(t){var e=[];return n.traverseDown(t,(function(t){for(var n=0,o=Object.entries(l);n<o.length;n++){var r=o[n],i=r[0],s=r[1];if(s.node===t){var a=s.instance;a.unsubscribe$.next(),a.unsubscribe$.complete(),"function"==typeof a.onDestroy&&a.onDestroy(),e.push(i)}}})),e.forEach((function(t){return n.deleteContext(t)})),t},o.compile=function(t,e){var o=this;return console.log("Module.compile",e),n.querySelectorsAll(t,this.selectors,[]).map((function(t){var n=o.makeInstance(t.node,t.factory,t.selector,e?e.instance:void 0);return t.factory.prototype instanceof a&&(e=void 0),n})).filter((function(t){return void 0!==t}))},o.evaluate=function(t,e){var n=this;return t.replace(/\{{2}(?!\{)(.*?\}*)\}{2}/g,(function(){var t=arguments.length<=1?void 0:arguments[1],o=n.makeFunction(t);return n.resolve(o,e,e)}))},o.parse=function(t,e){for(var n=0;n<t.childNodes.length;n++){var o=t.childNodes[n];if(1===o.nodeType)this.parse(o,e);else if(3===o.nodeType){var r=o.nodeValue,i=this.evaluate(r,e);if(r!==i){var s=document.createTextNode(i);t.replaceChild(s,o)}}}},o.resolve=function(t,e,n){return t.apply(e,[n,this])},o.makeInputs=function(t,e){var n=this,o={};return t.inputs&&t.inputs.forEach((function(t,r){return o[t]=n.makeInput(e,t)})),o},o.makeOutputs=function(t,e){var n=this,o={};return t.outputs&&t.outputs.forEach((function(t,r){return o[t]=n.makeOutput(e,t)})),o},o.resolveInputsOutputs=function(t,e){var o=this,r=n.getContext(t),i=r.parentInstance,s=r.inputs;Object.keys(s).forEach((function(e){var n=s[e],r=o.resolve(n,i,t);t[e]=r}))},o.getScope=function(t){if(t===document)return window;var e=n.getContextByNode(t);return e?e.instance:void 0},o.getParentScope=function(t){var e=this;return n.traverseUp(t,(function(t){return e.getScope(t)}))},o.optionalChaining=function(t){var e;return t=t.replace(/(\w+(\?\.))+([\.|\w]+)/g,(function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];for(var r=n[0].split("?."),i=0;i<r.length-1;i++){var s=i>0?"("+r[i]+" = "+e+")":r[i],a=r[i+1];e=i>0?s+"."+a:"("+s+" ? "+s+"."+a+" : void 0)"}return e||""}))},o.makeFunction=function(t,e){if(void 0===e&&(e=["$instance"]),!t)return function(){return null};var o=this.pipes,r=n.getPipesSegments(t);return t=r.shift().trim(),t=this.optionalChaining(t),e.push("module"),r.length?(t=r.reduce((function(t,e,r){var i=n.getPipeParamsSegments(e),s=i.shift().trim(),a=o[s];if(!a||"function"!=typeof a.transform)throw"missing pipe "+s;return"pipes."+s+".transform("+t+","+i.join(",")+")"}),t),new Function("with(this) {\n\t\t\t\treturn (function ("+e.join(",")+") {\n\t\t\t\t\tconst pipes = module.pipes;\n\t\t\t\t\treturn "+t+";\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}")):new Function(this.options.debug?"with(this) {\n\t\t\t\treturn (function ("+e.join(",")+") {\n\t\t\t\t\tlet value;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = "+t+";\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error('"+t.replace(/\'/g,'"')+"', this);\n\t\t\t\t\t\tvalue = e.message;\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}":"with(this) {\n\t\t\t\treturn (function ("+e.join(",")+") {\n\t\t\t\t\treturn "+t+";\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}")},o.makeInput=function(t,e){var o=n.getContext(t).node.getAttribute("["+e+"]");return this.makeFunction(o)},o.makeOutput=function(o,r){var i=this,s=n.getContext(o),a=s.node,u=s.parentInstance,c=a.getAttribute("("+r+")"),l=this.makeFunction(c,["$event"]),f=(new t.Subject).pipe(e.tap((function(t){i.resolve(l,u,t)})));return f.pipe(e.takeUntil(o.unsubscribe$)).subscribe(),o[r]=f,l},n.getPipesSegments=function(t){for(var e=[],n=0,o="",r=0,i=t.length;n<i;){var s=t.substr(n,1);"{"!==s&&"("!==s&&"["!==s||r++,"}"!==s&&")"!==s&&"]"!==s||r--,"|"===s&&0===r?(o.length&&e.push(o),o=""):o+=s,n++}return o.length&&e.push(o),e},n.getPipeParamsSegments=function(t){for(var e=[],n=0,o="",r=0,i=t.length;n<i;){var s=t.substr(n,1);"{"!==s&&"("!==s&&"["!==s||r++,"}"!==s&&")"!==s&&"]"!==s||r--,":"===s&&0===r?(o.length&&e.push(o),o=""):o+=s,n++}return o.length&&e.push(o),e},n.unwrapSelectors=function(t){var e=[];return t.forEach((function(t){t.meta.selector.split(",").forEach((function(n){if(0===(n=n.trim()).indexOf(".")){var o=n.replace(/\./g,"");e.push((function(e){return!!e.classList.has(o)&&{node:e,factory:t,selector:n}}))}else if(n.match(/\[(.+)\]/)){var r=n.substr(1,n.length-2);e.push((function(e){return!!e.hasAttribute(r)&&{node:e,factory:t,selector:n}}))}else e.push((function(e){return!!(e.nodeName.toLowerCase()===n.toLowerCase())&&{node:e,factory:t,selector:n}}))}))})),e},n.matchSelectors=function(t,e,n){return e.forEach((function(e){var o=e(t);if(o){var r=o.factory;r.prototype instanceof a&&r.meta.template&&(t.innerHTML=r.meta.template),n.push(o)}})),n},n.querySelectorsAll=function(t,e,n){1===t.nodeType&&(n=this.matchSelectors(t,e,n));var o=t.childNodes;if(o)for(var r=0;r<o.length;r++)n=this.querySelectorsAll(o[r],e,n);return n},n.traverseUp=function(t,e,n){if(void 0===n&&(n=0),t){var o=e(t,n);return o||this.traverseUp(t.parentNode,e,n+1)}},n.traverseDown=function(t,e,n){if(void 0===n&&(n=0),t){var o=e(t,n);if(o)return o;if(1===t.nodeType)for(var r=0,i=t.childNodes.length;r<i&&!o;)o=this.traverseDown(t.childNodes[r],e,n+1),r++;return o}},n.traversePrevious=function(t,e,n){if(void 0===n&&(n=0),t){var o=e(t,n);return o||this.traversePrevious(t.previousSibling,e,n+1)}},n.traverseNext=function(t,e,n){if(void 0===n&&(n=0),t){var o=e(t,n);return o||this.traverseNext(t.nextSibling,e,n+1)}},n.use$=function(t){return new n(t).use$()},n.getContext=function(t){return l[t.rxcompId]},n.makeContext=function(t,e,n,o,r,i){e.rxcompId=++c;var s={module:t,instance:e,parentInstance:n,node:o,factory:r,selector:i},a=o.dataset.rxcompId=o.dataset.rxcompId||++c;return(f[a]||(f[a]=[])).push(s),l[e.rxcompId]=s},n.deleteContext=function(t){var e=l[t],n=f[e.node.dataset.id],o=n.indexOf(e);-1!==o&&n.splice(o,1),delete l[t]},n.getContextByNode=function(t){var e,n=f[t.dataset.rxcompId];return n&&(e=n.reduce((function(e,n){return n.node===t&&n.factory.prototype instanceof a?e&&n.factory.prototype instanceof u?e:n:e}),null)),e},n}(),h=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){var t=p.getContext(this),e=t.module,n=t.node.getAttribute("[class]");this.classFunction=e.makeFunction(n)},n.onState=function(t){var e=p.getContext(this),n=e.module,o=e.node,r=n.resolve(this.classFunction,t,this);Object.keys(r).forEach((function(t){r[t]?o.classList.add(t):o.classList.remove(t)}))},e}(s);h.meta={selector:"[[class]]"};var d=function(n){function r(){return n.apply(this,arguments)||this}return o(r,n),r.prototype.onInit=function(){var n=p.getContext(this),o=n.module,r=n.node,i=n.selector,s=n.parentInstance,a=this.event=i.replace(/\[|\]|\(|\)/g,""),u=this.event$=t.fromEvent(r,a).pipe(e.shareReplay(1)),c=r.getAttribute("("+a+")");if(c){var l=o.makeFunction(c,["$event"]);u.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){o.resolve(l,s,t)}))}else s[a+"$"]=u},r}(s);d.meta={selector:"[("+["click","mousedown","mouseup","touchstart","touchmove","touchend","keydown","keyup","input","change","loaded"].join(")],[(")+")]"};var v=function(){};v.meta={selector:"[(directive)]"};var m=function(t){function e(e,n,o,r,i,s,a){var u;return(u=t.call(this,a)||this)[e]=n,u[o]=r,u.index=i,u.count=s,u}var r,i,s;return o(e,t),r=e,(i=[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}])&&n(r.prototype,i),s&&n(r,s),e}(u),g=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){var t=p.getContext(this),e=t.module,n=t.node,o=this.forbegin=document.createComment("*for begin");n.parentNode.replaceChild(o,n);var r=this.forend=document.createComment("*for end");o.parentNode.insertBefore(r,o.nextSibling);var i=n.getAttribute("*for");n.removeAttribute("*for");var s=this.tokens=this.getExpressionTokens(i);this.forFunction=e.makeFunction(s.iterable),this.instances=[]},n.onState=function(t){for(var e=p.getContext(this),n=e.module,o=e.node,r=this.tokens,i=n.resolve(this.forFunction,t,this)||[],s=Array.isArray(i),u=s?i:Object.keys(i),c=u.length,l=this.instances.length,f=this.forbegin.nextSibling,h=0;h<Math.max(l,c);h++)if(h<c){var d=s?h:u[h],v=s?u[d]:i[d];if(h<l){var g=f,y=this.instances[h];y[r.key]=d,y[r.value]=v,y.pushState(),n.parse(g,y),f=f.nextSibling}else{var b=o.cloneNode(!0);this.forend.parentNode.insertBefore(b,this.forend);var x=[r.key,d,r.value,v,h,c,e.parentInstance],S=n.makeInstance(b,m,e.selector,e.parentInstance,x),w=p.getContext(S),k=n.compile(b,w);console.log(k.length,k.filter((function(t){return t.constructor instanceof a})).length),n.parse(b,S),f=b.nextSibling,this.instances.push(S)}}else{var C=this.instances[h],I=p.getContext(C).node;I.parentNode.removeChild(I),n.remove(I)}this.instances.length=u.length},n.getExpressionTokens=function(t){if(null===t)throw"invalid for";if(-1===t.trim().indexOf("let ")||-1===t.trim().indexOf(" of "))throw"invalid for";var e=t.split(";").map((function(t){return t.trim()})).filter((function(t){return""!==t})),n=e[0].split(" of ").map((function(t){return t.trim()})),o=n[0].replace(/\s*let\s*/,""),r=n[1],i="index",s=o.match(/\[(.+)\s*,\s*(.+)\]/);if(s&&(i=s[1],o=s[2]),e.length>1){var a=e[1].split(/\s*let\s*|\s*=\s*index/).map((function(t){return t.trim()}));3===a.length&&(i=a[1])}return{key:i,value:o,iterable:r}},e}(v);g.meta={selector:"[*for]"};var y=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){var t=p.getContext(this),e=t.module,n=t.node,o=this.ifbegin=document.createComment("*if begin");n.parentNode.replaceChild(o,n);var r=this.ifend=document.createComment("*if end");o.parentNode.insertBefore(r,o.nextSibling);var i=n.getAttribute("*if");this.expression=i,this.ifFunction=e.makeFunction(i);var s=n.cloneNode(!0);s.removeAttribute("*if"),this.clonedNode=s},n.onState=function(t){var e=p.getContext(this).module;e.resolve(this.ifFunction,t,this)?this.clonedNode.parentNode||(this.ifend.parentNode.insertBefore(this.clonedNode,this.ifend),e.compile(this.clonedNode),e.parse(this.clonedNode,t)):this.clonedNode.parentNode&&(this.clonedNode.parentNode.removeChild(this.clonedNode),e.remove(this.clonedNode))},e}(v);y.meta={selector:"[*if]"};var b=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){var t=p.getContext(this),e=t.node,n=t.selector.replace(/\[(.+)\]/,(function(){return arguments.length<=1?void 0:arguments[1]})),o=e.getAttribute(n);if(!o)throw"invalid "+n;"[innerHTML]"===n&&(o="{{"+o+"}}"),this.innerHtmlExpression=o,console.log("InnerHtmlDirective.onInit",e,o,n)},n.onState=function(t){var e=p.getContext(this),n=e.module.evaluate(this.innerHtmlExpression,t);e.node.innerHTML=n},e}(s);b.meta={selector:"[[innerHTML]],[innerHTML]"};var x=function(){function t(){}return t.transform=function(t){return JSON.stringify(t)},t}();x.meta={name:"json"};var S=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){var t=p.getContext(this),e=t.module,n=t.node.getAttribute("[style]");this.styleFunction=e.makeFunction(n)},n.onState=function(t){var e=p.getContext(this),n=e.module,o=e.node,r=n.resolve(this.styleFunction,t,this);Object.keys(r).forEach((function(t){o.style[t]=r[t]}))},e}(s);S.meta={selector:"[[style]]"};var w=function(){function t(){}return t.delete=function(t){this.isLocalStorageSupported()&&window.localStorage.removeItem(t)},t.exist=function(t){if(this.isLocalStorageSupported())return void 0!==window.localStorage[t]},t.get=function(t){var e=null;if(this.isLocalStorageSupported()&&void 0!==window.localStorage[t])try{e=JSON.parse(window.localStorage[t])}catch(e){console.log("LocalStorageService.get.error parsing",t,e)}return e},t.set=function(t,e){if(this.isLocalStorageSupported())try{var n=[],o=JSON.stringify(e,(function(t,e){if("object"==typeof e&&null!==e){if(-1!==n.indexOf(e))return;n.push(e)}return e}));window.localStorage.setItem(t,o)}catch(n){console.log("LocalStorageService.set.error serializing",t,e,n)}},t.isLocalStorageSupported=function(){if(this.supported)return!0;var t=!1;try{(t="localStorage"in window&&null!==window.localStorage)?(window.localStorage.setItem("test","1"),window.localStorage.removeItem("test")):t=!1}catch(e){t=!1}return this.supported=t,t},t}(),k=function(){function e(){}return e.set=function(t){return w.set("items",t),this.get$().next(t)},e.get$=function(){if(this.store$)return this.store$;var e=w.get("items");return e||(e=[{id:3,name:"cookies",date:new Date(Date.now())},{id:2,name:"pizza",date:new Date(2019,3,22,12)},{id:1,name:"bread",date:new Date(2019,0,6,12)}],w.set("items",e)),this.store$=new t.BehaviorSubject(e)},e.add$=function(e){var n=Object.assign({id:Date.now(),date:new Date(Date.now())},e),o=this.store$.getValue();return o.unshift(n),this.set(o),t.of(n)},e.patch$=function(e){var n=this.store$.getValue(),o=n.find((function(t){return t.id===e.id}));return o&&(Object.assign(o,e),this.set(n)),t.of(o)},e.delete$=function(e){var n=this.store$.getValue(),o=n.indexOf(e);return-1!==o&&(n.splice(o,1),this.set(n)),t.of(e)},e}(),C=function(t){function n(){return t.apply(this,arguments)||this}o(n,t);var r=n.prototype;return r.onInit=function(){var t=this,n=p.getContext(this);this.input=n.node.querySelector(".control--text"),this.items=[],this.store$=k.get$(),this.store$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushState()}))},r.onInput=function(t){this.pushState()},r.onAddItem=function(t){var e=this;this.input.value&&k.add$({name:this.input.value}).subscribe((function(t){e.input.value=null}))},r.onToggleItem=function(t){k.patch$({id:t.id,done:!t.done}).subscribe((function(t){}))},r.onRemoveItem=function(t){k.delete$(t).subscribe((function(t){}))},n}(a);C.meta={selector:"[app-component]"};var I=function(){function t(){}return t.transform=function(t,e,n){return void 0===e&&(e="it-IT-u-ca-gregory"),void 0===n&&(n={dateStyle:"short",timeStyle:"short"}),new Date(t).toLocaleDateString(e,n)},t}();I.meta={name:"date"};var $=[{hex:"#073B4C"},{hex:"#EF476F"},{hex:"#1CCC9D"},{hex:"#118AB2"},{hex:"#EFC156"}];function N(t,e){return n=$[t%$.length].hex,o=e,r=parseInt(n.slice(1,3),16),i=parseInt(n.slice(3,5),16),s=parseInt(n.slice(5,7),16),o?"rgba("+r+","+i+","+s+","+o+")":"rgb("+r+","+i+","+s+")";var n,o,r,i,s}var O=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onState=function(t){this.backgroundColor=N(this.item.id,.15),this.color=N(this.item.id)},n.onToggle=function(t){this.toggle.next(t)},n.onRemove=function(t){this.remove.next(t)},e}(a);O.meta={selector:"[todo-item-component]",inputs:["item"],outputs:["toggle","remove"],template:'\n\t\t<button type="button" class="btn--toggle" [style]="{ color: color }" (click)="onToggle(item)">\n\t\t\t<i class="icon--check" *if="item.done"></i>\n\t\t\t<i class="icon--circle" *if="!item.done"></i>\n\t\t</button>\n\t\t<div class="title" [style]="{ color: color }" [innerHTML]="item.name"></div>\n\t\t<div class="date" [style]="{ background: backgroundColor, color: color }" [innerHTML]="item.date | date : \'en-US\' : { month: \'short\', day: \'2-digit\', year: \'numeric\' }"></div>\n\t\t<button type="button" class="btn--remove" [style]="{ color: color }" (click)="onRemove(item)"><i class="icon--remove"></i></button>\n\t'},p.use$({factories:[h,d,g,y,b,S,O],pipes:[I,x],bootstrap:C}).subscribe((function(t){}))}));
//# sourceMappingURL=main.min.js.map