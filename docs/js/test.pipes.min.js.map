{"version":3,"sources":["docs/js/test.pipes.js","../../src/core/directive.js","../../src/core/component.js","../../src/core/context.js","../../src/core/structure.js","../../src/module/module.js","../../src/class/class.directive.js","../../src/event/event.directive.js","../../src/for/for.item.js","../../src/for/for.structure.js","../../src/href/href.directive.js","../../src/if/if.structure.js","../../src/inner-html/inner-html.directive.js","../../src/core/pipe.js","../../src/json/json.pipe.js","../../src/src/src.directive.js","../../src/style/style.directive.js","../../src/core.module.js","../../src/platform/platform.js","../../src/platform/browser.js","../../test/js/test.pipes.js"],"names":["global","factory","exports","module","require","define","amd","self","rxjs","operators","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","_setPrototypeOf","o","p","setPrototypeOf","isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","call","e","_construct","Parent","args","Class","a","push","apply","instance","Function","bind","arguments","Directive","Component","RESERVED_PROPERTIES","Context","_Component","descriptors","_this","mergeDescriptors","getPrototypeOf","defineProperties","ReferenceError","_assertThisInitialized","source","properties","getOwnPropertyNames","_loop","shift","indexOf","hasOwnProperty","getOwnPropertyDescriptor","value","_len","Array","_key","Structure","ID","CONTEXTS","NODES","Module","_proto","compile","node","parentInstance","componentNode","querySelectorsAll","meta","selectors","map","match","undefined","makeInstance","selector","filter","x","_this2","parentNode","isComponent","getParentInstance","initialized","context","makeContext","changes$","BehaviorSubject","unsubscribe$","Subject","pushChanges","next","parse","setTimeout","onView","makeHosts","inputs","makeInputs","outputs","makeOutputs","onInit","pipe","takeUntil","subscribe","changes","resolveInputsOutputs","onChanges","makeFunction","expression","params","parseExpression","join","rx1","replace","parsePipes","parseOptionalChaining","g1","trim","parsePipeParams","func","concat","segments","word","block","t","c","substr","previous","_len2","_key2","tokens","split","b","getInstance","document","window","getContextByNode","_this3","traverseUp","childNodes","child","nodeType","parseTextNode","_this4","expressions","nodeExpressions","parseTextNodeExpression","nodeValue","replacedText","reduce","text","resolve","textNode","createTextNode","replaceChild","matches","regex","lastIndex","pushFragment","from","to","fragment","substring","exec","index","expressionFunc","payload","hosts","keys","forEach","getHost","getContext","rxcompId","nodeContexts","makeInput","input","hasAttribute","getAttribute","_this5","makeOutput","_this6","outputFunction","output$","tap","event","_this7","inputFunction","destroy","remove","innerHTML","nodeInnerHTML","keepInstance","keepContext","traverseDown","deleteContext","rxcompNodeId","id","keepContexts","complete","onDestroy","matchSelectors","results","template","find","callback","result","j","traversePrevious","previousSibling","traverseNext","nextSibling","current","ClassDirective","_Directive","_getContext","classFunction","_getContext2","classList","add","EventDirective","event$","fromEvent","shareReplay","ForItem","_Context","$key","$value","count","Constructor","protoProps","staticProps","get","even","ForStructure","_Structure","forbegin","createComment","forend","insertBefore","removeAttribute","getExpressionTokens","forFunction","iterable","instances","isArray","array","total","Math","max","clonedNode","cloneNode","forItemContext","removeChild","forExpressions","keyValueMatches","indexExpressions","HrefDirective","setAttribute","href","IfStructure","ifbegin","ifend","ifFunction","InnerHtmlDirective","Pipe","transform","JsonPipe","_Pipe","JSON","stringify","name","SrcDirective","src","StyleDirective","styleFunction","style","setProperty","CoreModule","_Module","factories","pipes","declarations","ORDER","Browser","_Platform","Platform","bootstrap","moduleFactory","resolveMeta","querySelector","resolvePipes","resolveFactories","sortFactories","unshift","unwrapSelectors","assign","imports","exported","importedPipes","pipeFactory","_Array$prototype$conc","importedFactories","factoryList","sort","getExpressions","matchers","c1","a2","u3","v4","a5","e6","contains","nodeName","toLowerCase","excludes","matchSelector","unmatchSelector","includes","include","exclude","isBrowser","RootComponent","time","TimePipe","options","date","getHours","getMinutes","MultPipe","_Pipe2","mult1","mult2","Number","AppModule"],"mappings":"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","file":"docs/js/test.pipes.min.js","sourcesContent":[null,"export default class Directive {\n\n}\n","export default class Component {\n\n}\n","// import { BehaviorSubject, Subject } from 'rxjs';\nimport Component from './component';\n\nconst RESERVED_PROPERTIES = ['constructor', 'rxcompId', 'onInit', 'onChanges', 'onDestroy', 'pushChanges', 'changes$', 'unsubscribe$'];\n\nexport default class Context extends Component {\n\n\tconstructor(instance, descriptors = {}) {\n\t\tsuper();\n\t\tdescriptors = Context.mergeDescriptors(instance, instance, descriptors);\n\t\tdescriptors = Context.mergeDescriptors(Object.getPrototypeOf(instance), instance, descriptors);\n\t\t/*\n\t\tconst subjects = {\n\t\t\tchanges$: {\n\t\t\t\tvalue: new BehaviorSubject(this),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t},\n\t\t\tunsubscribe$: {\n\t\t\t\tvalue: new Subject(),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t}\n\t\t};\n\t\t*/\n\t\tObject.defineProperties(this, descriptors);\n\t}\n\n\tstatic mergeDescriptors(source, instance, descriptors = {}) {\n\t\tconst properties = Object.getOwnPropertyNames(source);\n\t\twhile (properties.length) {\n\t\t\tlet key = properties.shift();\n\t\t\tif (RESERVED_PROPERTIES.indexOf(key) === -1 && !descriptors.hasOwnProperty(key)) {\n\t\t\t\t// console.log('Context.mergeDescriptors', key, source[key]);\n\t\t\t\tconst descriptor = Object.getOwnPropertyDescriptor(source, key);\n\t\t\t\tif (typeof descriptor.value == \"function\") {\n\t\t\t\t\tdescriptor.value = (...args) => {\n\t\t\t\t\t\treturn instance[key].apply(instance, args);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tdescriptors[key] = descriptor;\n\t\t\t}\n\t\t}\n\t\treturn descriptors;\n\t}\n\n}\n","export default class Structure {\n\n}\n","import { BehaviorSubject, Subject } from 'rxjs';\nimport { takeUntil, tap } from 'rxjs/operators';\nimport Component from '../core/component';\nimport Context from '../core/context';\nimport Structure from '../core/structure';\n\nlet ID = 0;\nconst CONTEXTS = {};\nconst NODES = {};\n\nexport default class Module {\n\n\tcompile(node, parentInstance) {\n\t\tlet componentNode;\n\t\tconst instances = Module.querySelectorsAll(node, this.meta.selectors, []).map(match => {\n\t\t\tif (componentNode && componentNode !== match.node) {\n\t\t\t\tparentInstance = undefined;\n\t\t\t}\n\t\t\tconst instance = this.makeInstance(match.node, match.factory, match.selector, parentInstance);\n\t\t\tif (match.factory.prototype instanceof Component) {\n\t\t\t\tcomponentNode = match.node;\n\t\t\t}\n\t\t\treturn instance;\n\t\t}).filter(x => x);\n\t\t// console.log('compile', instances, node, parentInstance);\n\t\treturn instances;\n\t}\n\n\tmakeInstance(node, factory, selector, parentInstance, args) {\n\t\tif (parentInstance || node.parentNode) {\n\t\t\tconst isComponent = factory.prototype instanceof Component;\n\t\t\tconst meta = factory.meta;\n\t\t\t// collect parentInstance scope\n\t\t\tparentInstance = parentInstance || this.getParentInstance(node.parentNode);\n\t\t\tif (!parentInstance) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// creating factory instance\n\t\t\tconst instance = new factory(...(args || []));\n\t\t\t// creating instance context\n\t\t\tconst context = Module.makeContext(this, instance, parentInstance, node, factory, selector);\n\t\t\t// injecting changes$ and unsubscribe$ subjects\n\t\t\tObject.defineProperties(instance, {\n\t\t\t\tchanges$: {\n\t\t\t\t\tvalue: new BehaviorSubject(instance),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t},\n\t\t\t\tunsubscribe$: {\n\t\t\t\t\tvalue: new Subject(),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet initialized;\n\t\t\t// injecting instance pushChanges method\n\t\t\tconst module = this;\n\t\t\tinstance.pushChanges = function() {\n\t\t\t\t// console.log(new Error(`pushChanges ${instance.constructor.name}`).stack);\n\t\t\t\tthis.changes$.next(this);\n\t\t\t\t// parse component text nodes\n\t\t\t\tif (isComponent) {\n\t\t\t\t\t// console.log('Module.parse', instance.constructor.name);\n\t\t\t\t\tinitialized ? module.parse(node, instance) : setTimeout(function() { module.parse(node, instance); });\n\t\t\t\t}\n\t\t\t\t// calling onView event\n\t\t\t\tif (typeof instance.onView === 'function') {\n\t\t\t\t\t// console.log('onView', instance.constructor.name);\n\t\t\t\t\tinstance.onView();\n\t\t\t\t}\n\t\t\t};\n\t\t\t// creating component input and outputs\n\t\t\t// if (isComponent && meta) {\n\t\t\tif (meta) {\n\t\t\t\tthis.makeHosts(meta, instance, node);\n\t\t\t\tcontext.inputs = this.makeInputs(meta, instance);\n\t\t\t\tcontext.outputs = this.makeOutputs(meta, instance);\n\t\t\t}\n\t\t\t// calling onInit event\n\t\t\tif (typeof instance.onInit === 'function') {\n\t\t\t\tinstance.onInit();\n\t\t\t}\n\t\t\tinitialized = true;\n\t\t\t// subscribe to parent changes\n\t\t\tif (parentInstance.changes$) {\n\t\t\t\tparentInstance.changes$.pipe(\n\t\t\t\t\t// filter(() => node.parentNode),\n\t\t\t\t\t// debounceTime(1),\n\t\t\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t\t\t).subscribe(changes => {\n\t\t\t\t\t// resolve component input outputs\n\t\t\t\t\t// if (isComponent && meta) {\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tthis.resolveInputsOutputs(instance, changes);\n\t\t\t\t\t}\n\t\t\t\t\t// calling onChanges event with parentInstance\n\t\t\t\t\tif (typeof instance.onChanges === 'function') {\n\t\t\t\t\t\t// console.log('onChanges', instance.constructor.name);\n\t\t\t\t\t\t// console.log('onChanges', instance.constructor.meta.selector, changes);\n\t\t\t\t\t\tinstance.onChanges(changes);\n\t\t\t\t\t}\n\t\t\t\t\t// push instance changes for subscribers\n\t\t\t\t\tinstance.pushChanges();\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn instance;\n\t\t}\n\t}\n\n\tmakeContext(instance, parentInstance, node, selector) {\n\t\tconst context = Module.makeContext(this, instance, parentInstance, node, instance.constructor, selector);\n\t\t// console.log('Module.makeContext', context, context.instance, context.node);\n\t\treturn context;\n\t}\n\n\tmakeFunction(expression, params = ['$instance']) {\n\t\tif (expression) {\n\t\t\texpression = Module.parseExpression(expression);\n\t\t\t// console.log(expression);\n\t\t\tconst args = params.join(',');\n\t\t\tconst expression_func = new Function(`with(this) {\n\t\t\t\treturn (function (${args}, $$module) {\n\t\t\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\t// console.log(expression_func);\n\t\t\treturn expression_func;\n\t\t} else {\n\t\t\treturn () => { return null; };\n\t\t}\n\t}\n\n\tstatic parseExpression(expression) {\n\t\tconst l = '┌';\n\t\tconst r = '┘';\n\t\tconst rx1 = /(\\()([^\\(\\)]*)(\\))/;\n\t\twhile (expression.match(rx1)) {\n\t\t\texpression = expression.replace(rx1, function(...g1) {\n\t\t\t\treturn `${l}${Module.parsePipes(g1[2])}${r}`;\n\t\t\t});\n\t\t}\n\t\texpression = Module.parsePipes(expression);\n\t\texpression = expression.replace(/(┌)|(┘)/g, function(...g2) {\n\t\t\treturn g2[1] ? '(' : ')';\n\t\t});\n\t\treturn Module.parseOptionalChaining(expression);\n\t}\n\n\tstatic parsePipes(expression) {\n\t\tconst l = '┌';\n\t\tconst r = '┘';\n\t\tconst rx1 = /(.*?[^\\|])\\|([^\\|]+)/;\n\t\twhile (expression.match(rx1)) {\n\t\t\texpression = expression.replace(rx1, function(...g1) {\n\t\t\t\tconst value = g1[1].trim();\n\t\t\t\tconst params = Module.parsePipeParams(g1[2]);\n\t\t\t\tconst func = params.shift().trim();\n\t\t\t\treturn `$$pipes.${func}.transform┌${[value, ...params]}┘`;\n\t\t\t});\n\t\t}\n\t\treturn expression;\n\t}\n\n\tstatic parsePipeParams(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === ':' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word.trim());\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word.trim());\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic parseOptionalChaining(expression) {\n\t\tconst regex = /(\\w+(\\?\\.))+([\\.|\\w]+)/g;\n\t\tlet previous;\n\t\texpression = expression.replace(regex, function(...args) {\n\t\t\tconst tokens = args[0].split('?.');\n\t\t\tfor (let i = 0; i < tokens.length - 1; i++) {\n\t\t\t\tconst a = i > 0 ? `(${tokens[i]} = ${previous})` : tokens[i];\n\t\t\t\tconst b = tokens[i + 1];\n\t\t\t\tprevious = i > 0 ? `${a}.${b}` : `(${a} ? ${a}.${b} : void 0)`;\n\t\t\t}\n\t\t\treturn previous || '';\n\t\t});\n\t\treturn expression;\n\t}\n\n\tgetInstance(node) {\n\t\tif (node === document) {\n\t\t\treturn window;\n\t\t}\n\t\tconst context = getContextByNode(node);\n\t\tif (context) {\n\t\t\treturn context.instance;\n\t\t}\n\t}\n\n\tgetParentInstance(node) {\n\t\treturn Module.traverseUp(node, (node) => {\n\t\t\treturn this.getInstance(node);\n\t\t});\n\t}\n\n\tparse(node, instance) {\n\t\tfor (let i = 0; i < node.childNodes.length; i++) {\n\t\t\tconst child = node.childNodes[i];\n\t\t\tif (child.nodeType === 1) {\n\t\t\t\tconst context = getContextByNode(child);\n\t\t\t\tif (!context) {\n\t\t\t\t\tthis.parse(child, instance);\n\t\t\t\t}\n\t\t\t} else if (child.nodeType === 3) {\n\t\t\t\tthis.parseTextNode(child, instance);\n\t\t\t}\n\t\t}\n\t}\n\n\tparseTextNode(node, instance) {\n\t\tlet expressions = node.nodeExpressions;\n\t\tif (!expressions) {\n\t\t\texpressions = this.parseTextNodeExpression(node.nodeValue);\n\t\t}\n\t\tconst replacedText = expressions.reduce((p, c) => {\n\t\t\tlet text;\n\t\t\tif (typeof c === 'function') {\n\t\t\t\ttext = this.resolve(c, instance, instance);\n\t\t\t\tif (text == undefined) { // !!! keep == loose equality\n\t\t\t\t\ttext = '';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttext = c;\n\t\t\t}\n\t\t\treturn p + text;\n\t\t}, '');\n\t\tif (node.nodeValue !== replacedText) {\n\t\t\tconst textNode = document.createTextNode(replacedText);\n\t\t\ttextNode.nodeExpressions = expressions;\n\t\t\tnode.parentNode.replaceChild(textNode, node);\n\t\t}\n\t}\n\n\tparseTextNodeExpression(expression) {\n\t\tconst expressions = [];\n\t\tconst regex = /\\{{2}((([^{}])|(\\{([^{}]|(\\{.*?\\}))+?\\}))*?)\\}{2}/g;\n\t\tlet lastIndex = 0,\n\t\t\tmatches;\n\t\tconst pushFragment = function(from, to) {\n\t\t\tconst fragment = expression.substring(from, to);\n\t\t\texpressions.push(fragment);\n\t\t};\n\t\twhile ((matches = regex.exec(expression)) !== null) {\n\t\t\tconst index = regex.lastIndex - matches[0].length;\n\t\t\tif (index > lastIndex) {\n\t\t\t\tpushFragment(index, lastIndex);\n\t\t\t}\n\t\t\tlastIndex = regex.lastIndex;\n\t\t\tconst fragment = this.makeFunction(matches[1]);\n\t\t\texpressions.push(fragment);\n\t\t}\n\t\tconst length = expression.length;\n\t\tif (length > lastIndex) {\n\t\t\tpushFragment(lastIndex, length);\n\t\t}\n\t\treturn expressions;\n\t}\n\n\tresolve(expressionFunc, changes, payload) {\n\t\t// console.log(expressionFunc, changes, payload);\n\t\treturn expressionFunc.apply(changes, [payload, this]);\n\t}\n\n\tmakeHosts(meta, instance, node) {\n\t\tif (meta.hosts) {\n\t\t\tObject.keys(meta.hosts).forEach(key => {\n\t\t\t\tconst factory = meta.hosts[key];\n\t\t\t\tinstance[key] = getHost(instance, factory, node);\n\t\t\t});\n\t\t}\n\t}\n\n\tmakeInput(instance, key) {\n\t\tconst { node } = getContext(instance);\n\t\tlet input, expression = null;\n\t\tif (node.hasAttribute(key)) {\n\t\t\t// const attribute = node.getAttribute(key).replace(/{{/g, '\"+').replace(/}}/g, '+\"');\n\t\t\tconst attribute = node.getAttribute(key).replace(/({{)|(}})|(\")/g, function(match, a, b, c) {\n\t\t\t\tif (a) {\n\t\t\t\t\treturn '\"+';\n\t\t\t\t}\n\t\t\t\tif (b) {\n\t\t\t\t\treturn '+\"';\n\t\t\t\t}\n\t\t\t\tif (c) {\n\t\t\t\t\treturn '\\\"';\n\t\t\t\t}\n\t\t\t});\n\t\t\texpression = `\"${attribute}\"`;\n\t\t} else if (node.hasAttribute(`[${key}]`)) {\n\t\t\texpression = node.getAttribute(`[${key}]`);\n\t\t}\n\t\tif (expression !== null) {\n\t\t\tinput = this.makeFunction(expression);\n\t\t}\n\t\treturn input;\n\t}\n\n\tmakeInputs(meta, instance) {\n\t\tconst inputs = {};\n\t\tif (meta.inputs) {\n\t\t\tmeta.inputs.forEach((key, i) => {\n\t\t\t\tconst input = this.makeInput(instance, key);\n\t\t\t\tif (input) {\n\t\t\t\t\tinputs[key] = input;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn inputs;\n\t}\n\n\tmakeOutput(instance, key) {\n\t\tconst context = getContext(instance);\n\t\tconst node = context.node;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst expression = node.getAttribute(`(${key})`);\n\t\tconst outputFunction = this.makeFunction(expression, ['$event']);\n\t\tconst output$ = new Subject().pipe(\n\t\t\ttap((event) => {\n\t\t\t\tthis.resolve(outputFunction, parentInstance, event);\n\t\t\t})\n\t\t);\n\t\toutput$.pipe(\n\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t).subscribe();\n\t\tinstance[key] = output$;\n\t\treturn outputFunction;\n\t}\n\n\tmakeOutputs(meta, instance) {\n\t\tconst outputs = {};\n\t\tif (meta.outputs) {\n\t\t\tmeta.outputs.forEach((key, i) => outputs[key] = this.makeOutput(instance, key));\n\t\t}\n\t\treturn outputs;\n\t}\n\n\tresolveInputsOutputs(instance, changes) {\n\t\tconst context = getContext(instance);\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst inputs = context.inputs;\n\t\tfor (let key in inputs) {\n\t\t\tconst inputFunction = inputs[key];\n\t\t\tconst value = this.resolve(inputFunction, parentInstance, instance);\n\t\t\tinstance[key] = value;\n\t\t}\n\t\t/*\n\t\tconst outputs = context.outputs;\n\t\tfor (let key in outputs) {\n\t\t\tconst inpuoutputFunctiontFunction = outputs[key];\n\t\t\tconst value = this.resolve(outputFunction, parentInstance, null);\n\t\t\t// console.log(`setted -> ${key}`, value);\n\t\t}\n\t\t*/\n\t}\n\n\tdestroy() {\n\t\tthis.remove(this.meta.node);\n\t\tthis.meta.node.innerHTML = this.meta.nodeInnerHTML;\n\t}\n\n\tremove(node, keepInstance) {\n\t\tconst keepContext = keepInstance ? getContext(keepInstance) : undefined;\n\t\tModule.traverseDown(node, (node) => {\n\t\t\tconst rxcompId = node.rxcompId;\n\t\t\tif (rxcompId) {\n\t\t\t\tconst keepContexts = Module.deleteContext(rxcompId, keepContext);\n\t\t\t\tif (keepContexts.length === 0) {\n\t\t\t\t\tdelete node.rxcompId;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn node;\n\t}\n\n\tstatic makeContext(module, instance, parentInstance, node, factory, selector) {\n\t\tinstance.rxcompId = ++ID;\n\t\tconst context = { module, instance, parentInstance, node, factory, selector };\n\t\tconst rxcompNodeId = node.rxcompId = (node.rxcompId || instance.rxcompId);\n\t\tconst nodeContexts = NODES[rxcompNodeId] || (NODES[rxcompNodeId] = []);\n\t\tnodeContexts.push(context);\n\t\treturn CONTEXTS[instance.rxcompId] = context;\n\t}\n\n\tstatic deleteContext(id, keepContext) {\n\t\tconst keepContexts = [];\n\t\tconst nodeContexts = NODES[id];\n\t\tif (nodeContexts) {\n\t\t\tnodeContexts.forEach(context => {\n\t\t\t\tif (context === keepContext) {\n\t\t\t\t\tkeepContexts.push(keepContext);\n\t\t\t\t} else {\n\t\t\t\t\tconst instance = context.instance;\n\t\t\t\t\tinstance.unsubscribe$.next();\n\t\t\t\t\tinstance.unsubscribe$.complete();\n\t\t\t\t\tif (typeof instance.onDestroy === 'function') {\n\t\t\t\t\t\tinstance.onDestroy();\n\t\t\t\t\t\tdelete CONTEXTS[instance.rxcompId];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (keepContexts.length) {\n\t\t\t\tNODES[id] = keepContexts;;\n\t\t\t} else {\n\t\t\t\tdelete NODES[id];\n\t\t\t}\n\t\t}\n\t\treturn keepContexts;\n\t}\n\n\tstatic matchSelectors(node, selectors, results) {\n\t\tfor (let i = 0; i < selectors.length; i++) {\n\t\t\tconst match = selectors[i](node);\n\t\t\tif (match) {\n\t\t\t\tconst factory = match.factory;\n\t\t\t\tif (factory.prototype instanceof Component && factory.meta.template) {\n\t\t\t\t\tnode.innerHTML = factory.meta.template;\n\t\t\t\t}\n\t\t\t\tresults.push(match);\n\t\t\t\tif (factory.prototype instanceof Structure) {\n\t\t\t\t\t// console.log('Structure', node);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic querySelectorsAll(node, selectors, results) {\n\t\tif (node.nodeType === 1) {\n\t\t\tconst matches = this.matchSelectors(node, selectors, []);\n\t\t\tresults = results.concat(matches);\n\t\t\tconst structure = matches.find(x => x.factory.prototype instanceof Structure);\n\t\t\tif (structure) {\n\t\t\t\treturn results;\n\t\t\t}\n\t\t\tconst childNodes = node.childNodes;\n\t\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\t\tresults = this.querySelectorsAll(childNodes[i], selectors, results);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic traverseUp(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseUp(node.parentNode, callback, i + 1);\n\t}\n\n\tstatic traverseDown(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tlet result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tif (node.nodeType === 1) {\n\t\t\tlet j = 0,\n\t\t\t\tt = node.childNodes.length;\n\t\t\twhile (j < t && !result) {\n\t\t\t\tresult = this.traverseDown(node.childNodes[j], callback, i + 1);\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic traversePrevious(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traversePrevious(node.previousSibling, callback, i + 1);\n\t}\n\n\tstatic traverseNext(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseNext(node.nextSibling, callback, i + 1);\n\t}\n\n}\n\nexport function getContext(instance) {\n\treturn CONTEXTS[instance.rxcompId];\n}\n\nexport function getContextByNode(node) {\n\tlet context;\n\tconst nodeContexts = NODES[node.rxcompId];\n\tif (nodeContexts) {\n\t\tcontext = nodeContexts.reduce((previous, current) => {\n\t\t\tif (current.factory.prototype instanceof Component) {\n\t\t\t\treturn current;\n\t\t\t} else if (current.factory.prototype instanceof Context) {\n\t\t\t\treturn previous ? previous : current;\n\t\t\t} else {\n\t\t\t\treturn previous;\n\t\t\t}\n\t\t}, null);\n\t\t// console.log(node.rxcompId, context);\n\t}\n\treturn context;\n}\n\nexport function getHost(instance, factory, node) {\n\tif (!node) {\n\t\tnode = getContext(instance).node;\n\t}\n\tif (node.rxcompId) {\n\t\tconst nodeContexts = NODES[node.rxcompId];\n\t\tif (nodeContexts) {\n\t\t\t// console.log(nodeContexts);\n\t\t\tfor (let i = 0; i < nodeContexts.length; i++) {\n\t\t\t\tconst context = nodeContexts[i];\n\t\t\t\tif (context.instance !== instance) {\n\t\t\t\t\t// console.log(context.instance, instance);\n\t\t\t\t\tif (context.instance instanceof factory) {\n\t\t\t\t\t\treturn context.instance;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif (node.parentNode) {\n\t\treturn getHost(instance, factory, node.parentNode);\n\t}\n}\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class ClassDirective extends Directive {\n\n\tonInit() {\n\t\tconst { module, node } = getContext(this);\n\t\tconst expression = node.getAttribute('[class]');\n\t\tthis.classFunction = module.makeFunction(expression);\n\t\t// console.log('ClassDirective.onInit', this.classList, expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst { module, node } = getContext(this);\n\t\tconst classList = module.resolve(this.classFunction, changes, this);\n\t\tfor (let key in classList) {\n\t\t\tclassList[key] ? node.classList.add(key) : node.classList.remove(key);\n\t\t}\n\t\t// console.log('ClassDirective.onChanges', classList);\n\t}\n\n}\n\nClassDirective.meta = {\n\tselector: `[[class]]`,\n};\n","import { fromEvent } from 'rxjs';\nimport { shareReplay, takeUntil } from 'rxjs/operators';\nimport Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nconst EVENTS = ['mousedown', 'mouseup', 'mousemove', 'click', 'dblclick', 'mouseover', 'mouseout', 'mouseenter', 'mouseleave', 'contextmenu', 'touchstart', 'touchmove', 'touchend', 'keydown', 'keyup', 'input', 'change', 'loaded'];\n\nexport default class EventDirective extends Directive {\n\n\tonInit() {\n\t\tconst { module, node, parentInstance, selector } = getContext(this);\n\t\tconst event = this.event = selector.replace(/\\[|\\]|\\(|\\)/g, '');\n\t\tconst event$ = this.event$ = fromEvent(node, event).pipe(shareReplay(1));\n\t\tconst expression = node.getAttribute(`(${event})`);\n\t\tif (expression) {\n\t\t\tconst outputFunction = module.makeFunction(expression, ['$event']);\n\t\t\tevent$.pipe(\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(event => {\n\t\t\t\t// console.log(parentInstance);\n\t\t\t\tmodule.resolve(outputFunction, parentInstance, event);\n\t\t\t});\n\t\t} else {\n\t\t\tparentInstance[`${event}$`] = event$;\n\t\t}\n\t\t// console.log('EventDirective.onInit', 'selector', selector, 'event', event);\n\t}\n\n}\n\nEventDirective.meta = {\n\tselector: `[(${EVENTS.join(')],[(')})]`,\n};\n","import Context from '../core/context';\n\nexport default class ForItem extends Context {\n\n\t// !!! try with payload options { key, $key, value, $value, index, count } or use onInit()\n\n\tconstructor(key, $key, value, $value, index, count, parentInstance) {\n\t\t// console.log('ForItem', arguments);\n\t\tsuper(parentInstance);\n\t\t/*\n\t\tsuper(parentInstance, {\n\t\t\t[key]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$key;\n\t\t\t\t},\n\t\t\t\tset: function(key) {\n\t\t\t\t\tthis.$key = key;\n\t\t\t\t}\n\t\t\t},\n\t\t\t[value]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\tthis.$value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t*/\n\t\tthis[key] = $key;\n\t\tthis[value] = $value;\n\t\tthis.index = index;\n\t\tthis.count = count;\n\t}\n\n\tget first() { return this.index === 0; }\n\n\tget last() { return this.index === this.count - 1; }\n\n\tget even() { return this.index % 2 === 0; }\n\n\tget odd() { return !this.even; }\n\n}\n","import Structure from '../core/structure';\nimport { getContext } from '../module/module';\nimport ForItem from './for.item';\n\nexport default class ForStructure extends Structure {\n\n\tonInit() {\n\t\tconst { module, node } = getContext(this);\n\t\tconst forbegin = this.forbegin = document.createComment(`*for begin`);\n\t\tforbegin.rxcompId = node.rxcompId;\n\t\tnode.parentNode.replaceChild(forbegin, node);\n\t\tconst forend = this.forend = document.createComment(`*for end`);\n\t\tforbegin.parentNode.insertBefore(forend, forbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*for');\n\t\t// this.expression = expression;\n\t\tnode.removeAttribute('*for');\n\t\tconst tokens = this.tokens = this.getExpressionTokens(expression);\n\t\tthis.forFunction = module.makeFunction(tokens.iterable);\n\t\tthis.instances = [];\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\t// resolve\n\t\tconst tokens = this.tokens;\n\t\tlet result = module.resolve(this.forFunction, changes, this) || [];\n\t\tconst isArray = Array.isArray(result);\n\t\tconst array = isArray ? result : Object.keys(result);\n\t\tconst total = array.length;\n\t\tconst previous = this.instances.length;\n\t\t// let nextSibling = this.forbegin.nextSibling;\n\t\tfor (let i = 0; i < Math.max(previous, total); i++) {\n\t\t\tif (i < total) {\n\t\t\t\tconst key = isArray ? i : array[i];\n\t\t\t\tconst value = isArray ? array[key] : result[key];\n\t\t\t\tif (i < previous) {\n\t\t\t\t\t// update\n\t\t\t\t\tconst instance = this.instances[i];\n\t\t\t\t\tinstance[tokens.key] = key;\n\t\t\t\t\tinstance[tokens.value] = value;\n\t\t\t\t\t/*\n\t\t\t\t\tif (!nextSibling) {\n\t\t\t\t\t\tconst context = getContext(instance);\n\t\t\t\t\t\tconst node = context.node;\n\t\t\t\t\t\tthis.forend.parentNode.insertBefore(node, this.forend);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextSibling = nextSibling.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t} else {\n\t\t\t\t\t// create\n\t\t\t\t\tconst clonedNode = node.cloneNode(true);\n\t\t\t\t\tdelete clonedNode.rxcompId;\n\t\t\t\t\tthis.forend.parentNode.insertBefore(clonedNode, this.forend);\n\t\t\t\t\tconst args = [tokens.key, key, tokens.value, value, i, total, context.parentInstance]; // !!! context.parentInstance unused?\n\t\t\t\t\tconst instance = module.makeInstance(clonedNode, ForItem, context.selector, context.parentInstance, args);\n\t\t\t\t\tconst forItemContext = getContext(instance);\n\t\t\t\t\t// console.log('ForStructure', clonedNode, forItemContext.instance.constructor.name);\n\t\t\t\t\tmodule.compile(clonedNode, forItemContext.instance);\n\t\t\t\t\t// nextSibling = clonedNode.nextSibling;\n\t\t\t\t\tthis.instances.push(instance);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// remove\n\t\t\t\tconst instance = this.instances[i];\n\t\t\t\tconst { node } = getContext(instance);\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\tmodule.remove(node);\n\t\t\t}\n\t\t}\n\t\tthis.instances.length = array.length;\n\t\t// console.log('ForStructure', this.instances, tokens);\n\t}\n\n\tgetExpressionTokens(expression) {\n\t\tif (expression === null) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tif (expression.trim().indexOf('let ') === -1 || expression.trim().indexOf(' of ') === -1) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tconst expressions = expression.split(';').map(x => x.trim()).filter(x => x !== '');\n\t\tconst forExpressions = expressions[0].split(' of ').map(x => x.trim());\n\t\tlet value = forExpressions[0].replace(/\\s*let\\s*/, '');\n\t\tconst iterable = forExpressions[1];\n\t\tlet key = 'index';\n\t\tconst keyValueMatches = value.match(/\\[(.+)\\s*,\\s*(.+)\\]/);\n\t\tif (keyValueMatches) {\n\t\t\tkey = keyValueMatches[1];\n\t\t\tvalue = keyValueMatches[2];\n\t\t}\n\t\tif (expressions.length > 1) {\n\t\t\tconst indexExpressions = expressions[1].split(/\\s*let\\s*|\\s*=\\s*index/).map(x => x.trim());\n\t\t\tif (indexExpressions.length === 3) {\n\t\t\t\tkey = indexExpressions[1];\n\t\t\t}\n\t\t}\n\t\treturn { key, value, iterable };\n\t}\n\n}\n\nForStructure.meta = {\n\tselector: '[*for]',\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class HrefDirective extends Directive {\n\n\tonChanges(changes) {\n\t\tconst { node } = getContext(this);\n\t\tnode.setAttribute('href', this.href);\n\t}\n\n}\n\nHrefDirective.meta = {\n\tselector: '[[href]]',\n\tinputs: ['href'],\n};\n","import Structure from '../core/structure';\nimport { getContext } from '../module/module';\n\nexport default class IfStructure extends Structure {\n\n\tonInit() {\n\t\tconst { module, node } = getContext(this);\n\t\tconst ifbegin = this.ifbegin = document.createComment(`*if begin`);\n\t\tifbegin.rxcompId = node.rxcompId;\n\t\tnode.parentNode.replaceChild(ifbegin, node);\n\t\tconst ifend = this.ifend = document.createComment(`*if end`);\n\t\tifbegin.parentNode.insertBefore(ifend, ifbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*if');\n\t\tthis.ifFunction = module.makeFunction(expression);\n\t\tconst clonedNode = node.cloneNode(true);\n\t\tclonedNode.removeAttribute('*if');\n\t\tthis.clonedNode = clonedNode;\n\t\tthis.node = clonedNode.cloneNode(true);\n\t\t// console.log('IfStructure.expression', expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst { module } = getContext(this);\n\t\t// console.log('IfStructure.onChanges', changes);\n\t\tconst value = module.resolve(this.ifFunction, changes, this);\n\t\tconst node = this.node;\n\t\tif (value) {\n\t\t\tif (!node.parentNode) {\n\t\t\t\tthis.ifend.parentNode.insertBefore(node, this.ifend);\n\t\t\t\tmodule.compile(node);\n\t\t\t}\n\t\t} else {\n\t\t\tif (node.parentNode) {\n\t\t\t\tmodule.remove(node, this);\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\tthis.node = this.clonedNode.cloneNode(true);\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nIfStructure.meta = {\n\tselector: '[*if]',\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class InnerHtmlDirective extends Directive {\n\n\tonChanges(changes) {\n\t\tconst { node } = getContext(this);\n\t\tnode.innerHTML = this.innerHTML == undefined ? '' : this.innerHTML; // !!! keep == loose equality\n\t}\n\n}\n\nInnerHtmlDirective.meta = {\n\tselector: `[innerHTML]`,\n\tinputs: ['innerHTML'],\n};\n","export default class Pipe {\n\n\tstatic transform(value) {\n\t\treturn value;\n\t}\n\n}\n","import Pipe from \"../core/pipe\";\n\nexport default class JsonPipe extends Pipe {\n\n\tstatic transform(value) {\n\t\treturn JSON.stringify(value, null, '\\t');\n\t}\n\n}\n\nJsonPipe.meta = {\n\tname: 'json',\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class SrcDirective extends Directive {\n\n\tonChanges(changes) {\n\t\tconst { node } = getContext(this);\n\t\tnode.setAttribute('src', this.src);\n\t}\n\n}\n\nSrcDirective.meta = {\n\tselector: '[[src]]',\n\tinputs: ['src'],\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class StyleDirective extends Directive {\n\n\tonInit() {\n\t\tconst { module, node } = getContext(this);\n\t\tconst expression = node.getAttribute('[style]');\n\t\tthis.styleFunction = module.makeFunction(expression);\n\t\t// console.log('StyleDirective.onInit', expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst { module, node } = getContext(this);\n\t\tconst style = module.resolve(this.styleFunction, changes, this);\n\t\tfor (let key in style) {\n\t\t\tnode.style.setProperty(key, style[key]);\n\t\t}\n\t\t// console.log('StyleDirective.onChanges', changes, style);\n\t}\n\n}\n\nStyleDirective.meta = {\n\tselector: `[[style]]`\n};\n","import ClassDirective from './class/class.directive';\nimport EventDirective from './event/event.directive';\nimport ForStructure from './for/for.structure';\nimport HrefDirective from './href/href.directive';\nimport IfStructure from './if/if.structure';\nimport InnerHtmlDirective from './inner-html/inner-html.directive';\nimport JsonPipe from './json/json.pipe';\nimport Module from './module/module';\nimport SrcDirective from './src/src.directive';\nimport StyleDirective from './style/style.directive';\n\nexport default class CoreModule extends Module {}\nconst factories = [\n\tClassDirective,\n\tEventDirective,\n\tForStructure,\n\tHrefDirective,\n\tIfStructure,\n\tInnerHtmlDirective,\n\tSrcDirective,\n\tStyleDirective,\n];\nconst pipes = [\n\tJsonPipe,\n];\nCoreModule.meta = {\n\tdeclarations: [\n\t\t...factories,\n\t\t...pipes,\n\t],\n\texports: [\n\t\t...factories,\n\t\t...pipes,\n\t]\n};\n","import Component from '../core/component';\nimport Directive from '../core/directive';\nimport Pipe from '../core/pipe';\nimport Structure from '../core/structure';\n\nconst ORDER = [Structure, Component, Directive];\n\nexport default class Platform {\n\n\tstatic bootstrap(moduleFactory) {\n\t\tconst meta = this.resolveMeta(moduleFactory);\n\t\tconst bootstrap = meta.bootstrap;\n\t\tif (!bootstrap) {\n\t\t\tthrow ('missing bootstrap');\n\t\t}\n\t\tconst node = meta.node = this.querySelector(bootstrap.meta.selector);\n\t\tif (!node) {\n\t\t\tthrow (`missing node ${bootstrap.meta.selector}`);\n\t\t}\n\t\tmeta.nodeInnerHTML = node.innerHTML;\n\t\tconst pipes = meta.pipes = this.resolvePipes(meta);\n\t\tconst factories = meta.factories = this.resolveFactories(meta);\n\t\tthis.sortFactories(factories);\n\t\tfactories.unshift(bootstrap);\n\t\tconst selectors = meta.selectors = this.unwrapSelectors(factories);\n\t\tconst module = new moduleFactory();\n\t\tmodule.meta = meta;\n\t\tconst instances = module.compile(node, window);\n\t\tconst root = instances[0];\n\t\t// if (root instanceof module.meta.bootstrap) {\n\t\troot.pushChanges();\n\t\t// }\n\t\treturn module;\n\t}\n\n\tstatic querySelector(selector) {\n\t\treturn document.querySelector(selector);\n\t}\n\n\tstatic resolveMeta(moduleFactory) {\n\t\tconst meta = Object.assign({ imports: [], declarations: [], pipes: [], exports: [] }, moduleFactory.meta);\n\t\tmeta.imports = meta.imports.map(moduleFactory => this.resolveMeta(moduleFactory));\n\t\treturn meta;\n\t}\n\n\tstatic resolvePipes(meta, exported) {\n\t\tconst importedPipes = meta.imports.map(meta => this.resolvePipes(meta, true));\n\t\tconst pipes = {};\n\t\tconst pipeList = (exported ? meta.exports : meta.declarations).filter(x => x.prototype instanceof Pipe);\n\t\tpipeList.forEach(pipeFactory => pipes[pipeFactory.meta.name] = pipeFactory);\n\t\treturn Object.assign({}, ...importedPipes, pipes);\n\t}\n\n\tstatic resolveFactories(meta, exported) {\n\t\tconst importedFactories = meta.imports.map(meta => this.resolveFactories(meta, true));\n\t\tconst factoryList = (exported ? meta.exports : meta.declarations).filter(x => (x.prototype instanceof Structure || x.prototype instanceof Component || x.prototype instanceof Directive));\n\t\treturn Array.prototype.concat.call(factoryList, ...importedFactories);\n\t}\n\n\tstatic sortFactories(factories) {\n\t\tfactories.sort((a, b) => {\n\t\t\tconst ai = ORDER.reduce((p, c, i) => a.prototype instanceof c ? i : p, -1);\n\t\t\tconst bi = ORDER.reduce((p, c, i) => b.prototype instanceof c ? i : p, -1);\n\t\t\t// return ai - bi;\n\t\t\tconst o = ai - bi;\n\t\t\tif (o === 0) {\n\t\t\t\treturn (a.meta.hosts ? 1 : 0) - (b.meta.hosts ? 1 : 0);\n\t\t\t}\n\t\t\treturn o;\n\t\t});\n\t}\n\n\tstatic getExpressions(selector) {\n\t\tlet matchers = [];\n\t\tselector.replace(/\\.([\\w\\-\\_]+)|\\[(.+?\\]*)(\\=)(.*?)\\]|\\[(.+?\\]*)\\]|([\\w\\-\\_]+)/g, function(value, c1, a2, u3, v4, a5, e6) {\n\t\t\tif (c1) {\n\t\t\t\tmatchers.push(function(node) {\n\t\t\t\t\treturn node.classList.contains(c1);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (a2) {\n\t\t\t\tmatchers.push(function(node) {\n\t\t\t\t\treturn (node.hasAttribute(a2) && node.getAttribute(a2) === v4) ||\n\t\t\t\t\t\t(node.hasAttribute(`[${a2}]`) && node.getAttribute(`[${a2}]`) === v4);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (a5) {\n\t\t\t\tmatchers.push(function(node) {\n\t\t\t\t\treturn node.hasAttribute(a5) || node.hasAttribute(`[${a5}]`);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (e6) {\n\t\t\t\tmatchers.push(function(node) {\n\t\t\t\t\treturn node.nodeName.toLowerCase() === e6.toLowerCase();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn matchers;\n\t}\n\n\tstatic unwrapSelectors(factories) {\n\t\tconst selectors = [];\n\t\tfactories.forEach(factory => {\n\t\t\tfactory.meta.selector.split(',').forEach(selector => {\n\t\t\t\tselector = selector.trim();\n\t\t\t\tlet excludes = [];\n\t\t\t\tconst matchSelector = selector.replace(/\\:not\\((.+?)\\)/g, (value, unmatchSelector) => {\n\t\t\t\t\texcludes = this.getExpressions(unmatchSelector);\n\t\t\t\t\treturn '';\n\t\t\t\t});\n\t\t\t\tconst includes = this.getExpressions(matchSelector);\n\t\t\t\tselectors.push((node) => {\n\t\t\t\t\tconst include = includes.reduce((result, e) => {\n\t\t\t\t\t\treturn result && e(node);\n\t\t\t\t\t}, true);\n\t\t\t\t\tconst exclude = excludes.reduce((result, e) => {\n\t\t\t\t\t\treturn result || e(node);\n\t\t\t\t\t}, false);\n\t\t\t\t\tif (include && !exclude) {\n\t\t\t\t\t\treturn { node, factory, selector };\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\treturn selectors;\n\t}\n\n\tstatic isBrowser() {\n\t\treturn window;\n\t}\n\n\t// static isServer() {}\n\n}\n","import Platform from './platform';\n\nexport default class Browser extends Platform {}\n","import { Browser, Component, CoreModule, Module, Pipe } from '../../src/rxcomp';\n\nclass RootComponent extends Component {\n\tonInit() {\n\t\tthis.time = new Date();\n\t\tthis.value = 2;\n\t}\n}\nRootComponent.meta = {\n\tselector: '[root-component]',\n};\n\nclass TimePipe extends Pipe {\n\tstatic transform(value, options = 1) {\n\t\tconst date = new Date(value);\n\t\treturn `${date.getHours()}:${date.getMinutes()}`;\n\t}\n}\nTimePipe.meta = {\n\tname: 'time',\n};\n\nclass MultPipe extends Pipe {\n\tstatic transform(value, mult1 = 2, mult2 = 1) {\n\t\treturn Number(value) * Number(mult1) * Number(mult2);\n\t}\n}\nMultPipe.meta = {\n\tname: 'mult',\n};\n\nclass AppModule extends Module {}\nAppModule.meta = {\n\timports: [\n\t\tCoreModule\n\t],\n\tdeclarations: [\n\t\tTimePipe,\n\t\tMultPipe\n\t],\n\tbootstrap: RootComponent,\n};\n\nBrowser.bootstrap(AppModule);\n"]}