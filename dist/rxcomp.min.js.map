{"version":3,"sources":["dist/rxcomp.js","../src/core/directive.js","../src/core/component.js","../src/core/context.js","../src/module/module.js","../src/class/class.directive.js","../src/event/event.directive.js","../src/core/structure.js","../src/for/for.item.js","../src/for/for.structure.js","../src/if/if.structure.js","../src/inner-html/inner-html.directive.js","../src/core/pipe.js","../src/json/json.pipe.js","../src/style/style.directive.js","../src/core.module.js","../src/platform/platform.js","../src/platform/browser.js"],"names":["global","factory","exports","module","require","define","amd","self","rxcomp","rxjs","operators","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","_setPrototypeOf","o","p","setPrototypeOf","_construct","Parent","args","Class","Reflect","construct","sham","Proxy","Date","toString","call","e","isNativeReflectConstruct","a","push","apply","instance","Function","bind","arguments","Directive","Component","RESERVED_PROPERTIES","Context","_Component","descriptors","_this","mergeDescriptors","getPrototypeOf","defineProperties","ReferenceError","_assertThisInitialized","source","properties","getOwnPropertyNames","_loop","shift","indexOf","hasOwnProperty","getOwnPropertyDescriptor","value","_len","Array","_key","ID","CONTEXTS","NODES","REMOVED_IDS","Module","_proto","compile","node","parentInstance","querySelectorsAll","meta","selectors","map","match","makeInstance","selector","undefined","filter","x","_this2","parentNode","isComponent","getParentInstance","initialized","context","makeContext","changes$","BehaviorSubject","unsubscribe$","Subject","pushChanges","next","parse","setTimeout","onView","inputs","makeInputs","outputs","makeOutputs","onInit","pipe","takeUntil","subscribe","changes","resolveInputsOutputs","onChanges","makeFunction","expression","params","join","pipes","transforms","getPipesSegments","trim","transformOptionalChaining","reduce","transform","getPipeParamsSegments","name","makeInput","getContext","getAttribute","makeOutput","_this3","outputFunction","output$","tap","event","resolve","getInstance","document","window","getContextByNode","_this4","traverseUp","remove","traverseDown","id","complete","onDestroy","dataset","rxcompId","deleteContext","destroy","innerHTML","nodeInnerHTML","evaluate","text","_this5","replace","parse_func_","console","error","message","childNodes","child","nodeType","nodeExpression","nodeValue","replacedText","textNode","createTextNode","replaceChild","expressionFunc","payload","_this6","forEach","_this7","inputFunction","previous","tokens","split","b","segments","word","block","t","c","substr","matchSelectors","results","template","callback","result","j","traversePrevious","previousSibling","traverseNext","nextSibling","rxcompNodeId","nodeContexts","index","splice","current","ClassDirective","_Directive","classFunction","classList","add","EventDirective","event$","fromEvent","shareReplay","Structure","ForItem","_Context","$key","$value","count","Constructor","protoProps","staticProps","get","even","ForStructure","_Structure","forbegin","createComment","forend","insertBefore","removeAttribute","getExpressionTokens","forFunction","iterable","instances","isArray","array","keys","total","Math","max","clonedNode","cloneNode","forItemContext","removeChild","expressions","forExpressions","keyValueMatches","indexExpressions","IfStructure","ifbegin","ifend","ifFunction","InnerHtmlDirective","innerHtmlExpression","Pipe","JsonPipe","_Pipe","JSON","stringify","StyleDirective","styleFunction","style","setProperty","CoreModule","_Module","factories","declarations","concat","ORDER","Platform","bootstrap","moduleFactory","resolveMeta","querySelector","resolvePipes","resolveFactories","sortFactories","unshift","unwrapSelectors","assign","imports","exported","importedPipes","pipeFactory","_Array$prototype$conc","importedFactories","factoryList","sort","className","has","attribute","hasAttribute","nodeName","toLowerCase","isBrowser","Browser","_Platform"],"mappings":"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","file":"dist/rxcomp.min.js","sourcesContent":[null,"export default class Directive {\n\n}\n","export default class Component {\n\n}\n","// import { BehaviorSubject, Subject } from 'rxjs';\nimport Component from './component';\n\nconst RESERVED_PROPERTIES = ['constructor', 'rxcompId', 'onInit', 'onChanges', 'onDestroy', 'pushChanges', 'changes$', 'unsubscribe$'];\n\nexport default class Context extends Component {\n\n\tconstructor(instance, descriptors = {}) {\n\t\tsuper();\n\t\tdescriptors = Context.mergeDescriptors(instance, instance, descriptors);\n\t\tdescriptors = Context.mergeDescriptors(Object.getPrototypeOf(instance), instance, descriptors);\n\t\t/*\n\t\tconst subjects = {\n\t\t\tchanges$: {\n\t\t\t\tvalue: new BehaviorSubject(this),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t},\n\t\t\tunsubscribe$: {\n\t\t\t\tvalue: new Subject(),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t}\n\t\t};\n\t\t*/\n\t\tObject.defineProperties(this, descriptors);\n\t}\n\n\tstatic mergeDescriptors(source, instance, descriptors = {}) {\n\t\tconst properties = Object.getOwnPropertyNames(source);\n\t\twhile (properties.length) {\n\t\t\tlet key = properties.shift();\n\t\t\tif (RESERVED_PROPERTIES.indexOf(key) === -1 && !descriptors.hasOwnProperty(key)) {\n\t\t\t\t// console.log('Context.mergeDescriptors', key, source[key]);\n\t\t\t\tconst descriptor = Object.getOwnPropertyDescriptor(source, key);\n\t\t\t\tif (typeof descriptor.value == \"function\") {\n\t\t\t\t\tdescriptor.value = (...args) => {\n\t\t\t\t\t\tinstance[key].apply(instance, args);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tdescriptors[key] = descriptor;\n\t\t\t}\n\t\t}\n\t\treturn descriptors;\n\t}\n\n}\n","import { BehaviorSubject, Subject } from 'rxjs';\nimport { takeUntil, tap } from 'rxjs/operators';\nimport Component from '../core/component';\nimport Context from '../core/context';\n\nlet ID = 0;\nconst CONTEXTS = {};\nconst NODES = {};\nconst REMOVED_IDS = [];\n\nexport default class Module {\n\n\tcompile(node, parentInstance) {\n\t\tconst instances = Module.querySelectorsAll(node, this.meta.selectors, []).map(match => {\n\t\t\tconst instance = this.makeInstance(match.node, match.factory, match.selector, parentInstance);\n\t\t\tif (match.factory.prototype instanceof Component) {\n\t\t\t\tparentInstance = undefined;\n\t\t\t}\n\t\t\treturn instance;\n\t\t}).filter(x => x);\n\t\t// console.log('compile', instances, node, parentInstance);\n\t\treturn instances;\n\t}\n\n\tmakeInstance(node, factory, selector, parentInstance, args) {\n\t\tif (parentInstance || node.parentNode) {\n\t\t\tconst isComponent = factory.prototype instanceof Component;\n\t\t\tconst meta = factory.meta;\n\t\t\t// collect parentInstance scope\n\t\t\tparentInstance = parentInstance || this.getParentInstance(node);\n\t\t\tif (!parentInstance) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// creating factory instance\n\t\t\tconst instance = new factory(...(args || []));\n\t\t\t// creating instance context\n\t\t\tconst context = Module.makeContext(this, instance, parentInstance, node, factory, selector);\n\t\t\t// injecting changes$ and unsubscribe$ subjects\n\t\t\tObject.defineProperties(instance, {\n\t\t\t\tchanges$: {\n\t\t\t\t\tvalue: new BehaviorSubject(instance),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t},\n\t\t\t\tunsubscribe$: {\n\t\t\t\t\tvalue: new Subject(),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t}\n\t\t\t});\n\t\t\tlet initialized;\n\t\t\t// injecting instance pushChanges method\n\t\t\tconst module = this;\n\t\t\tinstance.pushChanges = function() {\n\t\t\t\t// console.log(new Error(`pushChanges ${instance.constructor.name}`).stack);\n\t\t\t\tthis.changes$.next(this);\n\t\t\t\t// parse component text nodes\n\t\t\t\tif (isComponent) {\n\t\t\t\t\t// console.log('Module.parse', instance.constructor.name);\n\t\t\t\t\tinitialized ? module.parse(node, instance) : setTimeout(function() { module.parse(node, instance); });\n\t\t\t\t}\n\t\t\t\t// calling onView event\n\t\t\t\tif (typeof instance.onView === 'function') {\n\t\t\t\t\t// console.log('onView', instance.constructor.name);\n\t\t\t\t\tinstance.onView();\n\t\t\t\t}\n\t\t\t};\n\t\t\t// creating component input and outputs\n\t\t\t// if (isComponent && meta) {\n\t\t\tif (meta) {\n\t\t\t\tcontext.inputs = this.makeInputs(meta, instance);\n\t\t\t\tcontext.outputs = this.makeOutputs(meta, instance);\n\t\t\t}\n\t\t\t// calling onInit event\n\t\t\tif (typeof instance.onInit === 'function') {\n\t\t\t\tinstance.onInit();\n\t\t\t}\n\t\t\tinitialized = true;\n\t\t\t// subscribe to parent changes\n\t\t\tif (parentInstance.changes$) {\n\t\t\t\tparentInstance.changes$.pipe(\n\t\t\t\t\t// filter(() => node.parentNode),\n\t\t\t\t\t// debounceTime(1),\n\t\t\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t\t\t).subscribe(changes => {\n\t\t\t\t\t// resolve component input outputs\n\t\t\t\t\t// if (isComponent && meta) {\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tthis.resolveInputsOutputs(instance, changes);\n\t\t\t\t\t}\n\t\t\t\t\t// calling onChanges event with parentInstance\n\t\t\t\t\tif (typeof instance.onChanges === 'function') {\n\t\t\t\t\t\t// console.log('onChanges', instance.constructor.name);\n\t\t\t\t\t\t// console.log('onChanges', instance.constructor.meta.selector, changes);\n\t\t\t\t\t\tinstance.onChanges(changes);\n\t\t\t\t\t}\n\t\t\t\t\t// push instance changes for subscribers\n\t\t\t\t\tinstance.pushChanges();\n\t\t\t\t});\n\t\t\t}\n\t\t\t/*\n\t\t\t// parse component text nodes\n\t\t\tif (isComponent) {\n\t\t\t\tthis.parse(node, instance);\n\t\t\t}\n\t\t\t*/\n\t\t\treturn instance;\n\t\t}\n\t}\n\n\tmakeContext(instance, parentInstance, node, selector) {\n\t\tconst context = Module.makeContext(this, instance, parentInstance, node, instance.constructor, selector);\n\t\t// console.log('Module.makeContext', context, context.instance, context.node);\n\t\treturn context;\n\t}\n\n\tmakeFunction(expression, params = ['$instance']) {\n\t\tif (!expression) {\n\t\t\treturn () => { return null; };\n\t\t}\n\t\tconst args = params.join(',');\n\t\tconst pipes = this.meta.pipes;\n\t\tconst transforms = Module.getPipesSegments(expression);\n\t\texpression = transforms.shift().trim();\n\t\texpression = this.transformOptionalChaining(expression);\n\t\t// console.log(pipes, transforms, expression);\n\t\t// console.log(transforms.length, params);\n\t\t// keyword 'this' represents changes from func.apply(changes, instance)\n\t\tif (transforms.length) {\n\t\t\texpression = transforms.reduce((expression, transform, i) => {\n\t\t\t\tconst params = Module.getPipeParamsSegments(transform);\n\t\t\t\tconst name = params.shift().trim();\n\t\t\t\tconst pipe = pipes[name];\n\t\t\t\tif (!pipe || typeof pipe.transform !== 'function') {\n\t\t\t\t\tthrow (`missing pipe '${name}'`);\n\t\t\t\t}\n\t\t\t\treturn `$$pipes.${name}.transform(${expression},${params.join(',')})`;\n\t\t\t}, expression);\n\t\t\t// console.log('expression', expression);\n\t\t\tconst expression_func = new Function(`with(this) {\n\t\t\t\treturn (function (${args}, $$module) {\n\t\t\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t} else {\n\t\t\t// console.log('expression', args, expression);\n\t\t\t// console.log('${expression.replace(/\\'/g,'\"')}', this);\n\t\t\tconst expression_func = new Function(`with(this) {\n\t\t\t\treturn (function (${args}, $$module) {\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t}\n\t}\n\n\tmakeInput(instance, name) {\n\t\tconst context = getContext(instance);\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute(`[${name}]`);\n\t\treturn this.makeFunction(expression);\n\t}\n\n\tmakeOutput(instance, name) {\n\t\tconst context = getContext(instance);\n\t\tconst node = context.node;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst expression = node.getAttribute(`(${name})`);\n\t\tconst outputFunction = this.makeFunction(expression, ['$event']);\n\t\tconst output$ = new Subject().pipe(\n\t\t\ttap((event) => {\n\t\t\t\tthis.resolve(outputFunction, parentInstance, event);\n\t\t\t})\n\t\t);\n\t\toutput$.pipe(\n\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t).subscribe();\n\t\tinstance[name] = output$;\n\t\treturn outputFunction;\n\t}\n\n\tgetInstance(node) {\n\t\tif (node === document) {\n\t\t\treturn window;\n\t\t}\n\t\tconst context = getContextByNode(node);\n\t\tif (context) {\n\t\t\treturn context.instance;\n\t\t}\n\t}\n\n\tgetParentInstance(node) {\n\t\treturn Module.traverseUp(node, (node) => {\n\t\t\treturn this.getInstance(node);\n\t\t});\n\t}\n\n\tremove(node) {\n\t\tModule.traverseDown(node, (node) => {\n\t\t\tfor (let id in CONTEXTS) {\n\t\t\t\tconst context = CONTEXTS[id];\n\t\t\t\tif (context.node === node) {\n\t\t\t\t\tconst instance = context.instance;\n\t\t\t\t\tinstance.unsubscribe$.next();\n\t\t\t\t\tinstance.unsubscribe$.complete();\n\t\t\t\t\tif (typeof instance.onDestroy === 'function') {\n\t\t\t\t\t\tinstance.onDestroy();\n\t\t\t\t\t}\n\t\t\t\t\tdelete node.dataset.rxcompId;\n\t\t\t\t\tREMOVED_IDS.push(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t// console.log('Module.remove', REMOVED_IDS);\n\t\twhile (REMOVED_IDS.length) {\n\t\t\tModule.deleteContext(REMOVED_IDS.shift());\n\t\t}\n\t\treturn node;\n\t}\n\n\tdestroy() {\n\t\tthis.remove(this.meta.node);\n\t\tthis.meta.node.innerHTML = this.meta.nodeInnerHTML;\n\t}\n\n\tevaluate(text, instance) {\n\t\tconst parse_eval_ = (...args) => {\n\t\t\tconst expression = args[1];\n\t\t\t// console.log('expression', expression);\n\t\t\ttry {\n\t\t\t\tconst parse_func_ = this.makeFunction(expression);\n\t\t\t\treturn this.resolve(parse_func_, instance, instance);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t\treturn e.message;\n\t\t\t}\n\t\t};\n\t\treturn text.replace(/\\{{2}((([^{}])|(\\{([^{}]|(\\{.*?\\}))+?\\}))*?)\\}{2}/g, parse_eval_);\n\t\t// return text.replace(/\\{{2}((([^{}])|(\\{[^{}]+?\\}))*?)\\}{2}/g, parse_eval_);\n\t}\n\n\tparse(node, instance) {\n\t\t// console.log('parse', instance.constructor.name, node);\n\t\tfor (let i = 0; i < node.childNodes.length; i++) {\n\t\t\tconst child = node.childNodes[i];\n\t\t\tif (child.nodeType === 1) {\n\t\t\t\tconst context = getContextByNode(child);\n\t\t\t\tif (!context) {\n\t\t\t\t\tthis.parse(child, instance);\n\t\t\t\t}\n\t\t\t} else if (child.nodeType === 3) {\n\t\t\t\tconst expression = child.nodeExpression || child.nodeValue;\n\t\t\t\tconst replacedText = this.evaluate(expression, instance);\n\t\t\t\t// console.log(instance.constructor.name, expression, replacedText);\n\t\t\t\tif (expression !== replacedText) {\n\t\t\t\t\tchild.nodeExpression = child.nodeExpression || expression;\n\t\t\t\t\tconst textNode = document.createTextNode(replacedText);\n\t\t\t\t\tnode.replaceChild(textNode, child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tresolve(expressionFunc, changes, payload) {\n\t\treturn expressionFunc.apply(changes, [payload, this]);\n\t}\n\n\tmakeInputs(meta, instance) {\n\t\tconst inputs = {};\n\t\tif (meta.inputs) {\n\t\t\tmeta.inputs.forEach((key, i) => inputs[key] = this.makeInput(instance, key));\n\t\t}\n\t\treturn inputs;\n\t}\n\n\tmakeOutputs(meta, instance) {\n\t\tconst outputs = {};\n\t\tif (meta.outputs) {\n\t\t\tmeta.outputs.forEach((key, i) => outputs[key] = this.makeOutput(instance, key));\n\t\t}\n\t\treturn outputs;\n\t}\n\n\tresolveInputsOutputs(instance, changes) {\n\t\tconst context = getContext(instance);\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst inputs = context.inputs;\n\t\tfor (let key in inputs) {\n\t\t\tconst inputFunction = inputs[key];\n\t\t\tconst value = this.resolve(inputFunction, parentInstance, instance);\n\t\t\tinstance[key] = value;\n\t\t}\n\t\t/*\n\t\tconst outputs = context.outputs;\n\t\tfor (let key in outputs) {\n\t\t\tconst inpuoutputFunctiontFunction = outputs[key];\n\t\t\tconst value = this.resolve(outputFunction, parentInstance, null);\n\t\t\t// console.log(`setted -> ${key}`, value);\n\t\t}\n\t\t*/\n\t}\n\n\ttransformOptionalChaining(expression) {\n\t\tconst regex = /(\\w+(\\?\\.))+([\\.|\\w]+)/g;\n\t\tlet previous;\n\t\texpression = expression.replace(regex, (...args) => {\n\t\t\tconst tokens = args[0].split('?.');\n\t\t\tfor (let i = 0; i < tokens.length - 1; i++) {\n\t\t\t\tconst a = i > 0 ? `(${tokens[i]} = ${previous})` : tokens[i];\n\t\t\t\tconst b = tokens[i + 1];\n\t\t\t\tprevious = i > 0 ? `${a}.${b}` : `(${a} ? ${a}.${b} : void 0)`;\n\t\t\t\t// log(previous);\n\t\t\t}\n\t\t\treturn previous || '';\n\t\t});\n\t\treturn expression;\n\t}\n\n\tstatic getPipesSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === '|' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic getPipeParamsSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === ':' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic matchSelectors(node, selectors, results) {\n\t\tfor (let i = 0; i < selectors.length; i++) {\n\t\t\tconst match = selectors[i](node);\n\t\t\tif (match) {\n\t\t\t\tconst factory = match.factory;\n\t\t\t\tif (factory.prototype instanceof Component && factory.meta.template) {\n\t\t\t\t\tnode.innerHTML = factory.meta.template;\n\t\t\t\t}\n\t\t\t\tresults.push(match);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic querySelectorsAll(node, selectors, results) {\n\t\tif (node.nodeType === 1) {\n\t\t\tresults = this.matchSelectors(node, selectors, results);\n\t\t}\n\t\tconst childNodes = node.childNodes;\n\t\tif (childNodes) {\n\t\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\t\tresults = this.querySelectorsAll(childNodes[i], selectors, results);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic traverseUp(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseUp(node.parentNode, callback, i + 1);\n\t}\n\n\tstatic traverseDown(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tlet result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tif (node.nodeType === 1) {\n\t\t\tlet j = 0,\n\t\t\t\tt = node.childNodes.length;\n\t\t\twhile (j < t && !result) {\n\t\t\t\tresult = this.traverseDown(node.childNodes[j], callback, i + 1);\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic traversePrevious(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traversePrevious(node.previousSibling, callback, i + 1);\n\t}\n\n\tstatic traverseNext(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseNext(node.nextSibling, callback, i + 1);\n\t}\n\n\tstatic makeContext(module, instance, parentInstance, node, factory, selector) {\n\t\tinstance.rxcompId = ++ID;\n\t\tconst context = { module, instance, parentInstance, node, factory, selector };\n\t\tconst rxcompNodeId = node.dataset.rxcompId = (node.dataset.rxcompId || ++ID);\n\t\tconst nodeContexts = NODES[rxcompNodeId] || (NODES[rxcompNodeId] = []);\n\t\tnodeContexts.push(context);\n\t\treturn CONTEXTS[instance.rxcompId] = context;\n\t}\n\n\tstatic deleteContext(id) {\n\t\tconst context = CONTEXTS[id];\n\t\tconst nodeContexts = NODES[context.node.dataset.rxcompId];\n\t\tif (nodeContexts) {\n\t\t\tconst index = nodeContexts.indexOf(context);\n\t\t\tif (index !== -1) {\n\t\t\t\tnodeContexts.splice(index, 1);\n\t\t\t}\n\t\t}\n\t\tdelete CONTEXTS[id];\n\t}\n\n}\n\nexport function getContext(instance) {\n\treturn CONTEXTS[instance.rxcompId];\n}\n\nexport function getContextByNode(node) {\n\tlet context;\n\tconst nodeContexts = NODES[node.dataset.rxcompId];\n\tif (nodeContexts) {\n\t\tcontext = nodeContexts.reduce((previous, current) => {\n\t\t\tif (current.node === node && current.factory.prototype instanceof Component) {\n\t\t\t\tif (previous && current.factory.prototype instanceof Context) {\n\t\t\t\t\treturn previous;\n\t\t\t\t} else {\n\t\t\t\t\treturn current;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn previous;\n\t\t\t}\n\t\t}, null);\n\t}\n\treturn context;\n}\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class ClassDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[class]');\n\t\tthis.classFunction = module.makeFunction(expression);\n\t\t// console.log('ClassDirective.onInit', this.classList, expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst classList = module.resolve(this.classFunction, changes, this);\n\t\tfor (let key in classList) {\n\t\t\tclassList[key] ? node.classList.add(key) : node.classList.remove(key);\n\t\t}\n\t\t// console.log('ClassDirective.onChanges', classList);\n\t}\n\n}\n\nClassDirective.meta = {\n\tselector: `[[class]]`,\n};\n","import { fromEvent } from 'rxjs';\nimport { shareReplay, takeUntil } from 'rxjs/operators';\nimport Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nconst EVENTS = ['click', 'mousedown', 'mouseup', 'touchstart', 'touchmove', 'touchend', 'keydown', 'keyup', 'input', 'change', 'loaded'];\n\nexport default class EventDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst event = this.event = selector.replace(/\\[|\\]|\\(|\\)/g, '');\n\t\tconst event$ = this.event$ = fromEvent(node, event).pipe(shareReplay(1));\n\t\tconst expression = node.getAttribute(`(${event})`);\n\t\tif (expression) {\n\t\t\tconst outputFunction = module.makeFunction(expression, ['$event']);\n\t\t\tevent$.pipe(\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(event => {\n\t\t\t\tmodule.resolve(outputFunction, parentInstance, event);\n\t\t\t});\n\t\t} else {\n\t\t\tparentInstance[`${event}$`] = event$;\n\t\t}\n\t\t// console.log('EventDirective.onInit', 'selector', selector, 'event', event);\n\t}\n\n}\n\nEventDirective.meta = {\n\tselector: `[(${EVENTS.join(')],[(')})]`,\n};\n","export default class Structure {\n\n}\n","import Context from '../core/context';\n\nexport default class ForItem extends Context {\n\n\t// !!! try with payload options { key, $key, value, $value, index, count } or use onInit()\n\n\tconstructor(key, $key, value, $value, index, count, parentInstance) {\n\t\t// console.log('ForItem', arguments);\n\t\tsuper(parentInstance);\n\t\t/*\n\t\tsuper(parentInstance, {\n\t\t\t[key]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$key;\n\t\t\t\t},\n\t\t\t\tset: function(key) {\n\t\t\t\t\tthis.$key = key;\n\t\t\t\t}\n\t\t\t},\n\t\t\t[value]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\tthis.$value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t*/\n\t\tthis[key] = $key;\n\t\tthis[value] = $value;\n\t\tthis.index = index;\n\t\tthis.count = count;\n\t}\n\n\tget first() { return this.index === 0; }\n\n\tget last() { return this.index === this.count - 1; }\n\n\tget even() { return this.index % 2 === 0; }\n\n\tget odd() { return !this.even; }\n\n\t/*\n\tonDestroy() {\n\t\tconsole.log('onDestroy');\n\t}\n\t*/\n\n}\n","import Structure from '../core/structure';\nimport { getContext } from '../module/module';\nimport ForItem from './for.item';\n\nexport default class ForStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst forbegin = this.forbegin = document.createComment(`*for begin`);\n\t\tnode.parentNode.replaceChild(forbegin, node);\n\t\tconst forend = this.forend = document.createComment(`*for end`);\n\t\tforbegin.parentNode.insertBefore(forend, forbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*for');\n\t\tnode.removeAttribute('*for');\n\t\tconst tokens = this.tokens = this.getExpressionTokens(expression);\n\t\tthis.forFunction = module.makeFunction(tokens.iterable);\n\t\tthis.instances = [];\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\t// resolve\n\t\tconst tokens = this.tokens;\n\t\tlet result = module.resolve(this.forFunction, changes, this) || [];\n\t\tconst isArray = Array.isArray(result);\n\t\tconst array = isArray ? result : Object.keys(result);\n\t\tconst total = array.length;\n\t\tconst previous = this.instances.length;\n\t\t// let nextSibling = this.forbegin.nextSibling;\n\t\tfor (let i = 0; i < Math.max(previous, total); i++) {\n\t\t\tif (i < total) {\n\t\t\t\tconst key = isArray ? i : array[i];\n\t\t\t\tconst value = isArray ? array[key] : result[key];\n\t\t\t\tif (i < previous) {\n\t\t\t\t\t// update\n\t\t\t\t\tconst instance = this.instances[i];\n\t\t\t\t\tinstance[tokens.key] = key;\n\t\t\t\t\tinstance[tokens.value] = value;\n\t\t\t\t\t/*\n\t\t\t\t\tif (!nextSibling) {\n\t\t\t\t\t\tconst context = getContext(instance);\n\t\t\t\t\t\tconst node = context.node;\n\t\t\t\t\t\tthis.forend.parentNode.insertBefore(node, this.forend);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnextSibling = nextSibling.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t\t*/\n\t\t\t\t} else {\n\t\t\t\t\t// create\n\t\t\t\t\tconst clonedNode = node.cloneNode(true);\n\t\t\t\t\tdelete clonedNode.dataset.rxcompId;\n\t\t\t\t\tthis.forend.parentNode.insertBefore(clonedNode, this.forend);\n\t\t\t\t\tconst args = [tokens.key, key, tokens.value, value, i, total, context.parentInstance]; // !!! context.parentInstance unused?\n\t\t\t\t\tconst instance = module.makeInstance(clonedNode, ForItem, context.selector, context.parentInstance, args);\n\t\t\t\t\tconst forItemContext = getContext(instance);\n\t\t\t\t\t// console.log('ForStructure', clonedNode, forItemContext.instance.constructor.name);\n\t\t\t\t\tmodule.compile(clonedNode, forItemContext.instance);\n\t\t\t\t\t// nextSibling = clonedNode.nextSibling;\n\t\t\t\t\tthis.instances.push(instance);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// remove\n\t\t\t\tconst instance = this.instances[i];\n\t\t\t\tconst context = getContext(instance);\n\t\t\t\tconst node = context.node;\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\tmodule.remove(node);\n\t\t\t}\n\t\t}\n\t\tthis.instances.length = array.length;\n\t\t// console.log('ForStructure', this.instances, tokens);\n\t}\n\n\tgetExpressionTokens(expression) {\n\t\tif (expression === null) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tif (expression.trim().indexOf('let ') === -1 || expression.trim().indexOf(' of ') === -1) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tconst expressions = expression.split(';').map(x => x.trim()).filter(x => x !== '');\n\t\tconst forExpressions = expressions[0].split(' of ').map(x => x.trim());\n\t\tlet value = forExpressions[0].replace(/\\s*let\\s*/, '');\n\t\tconst iterable = forExpressions[1];\n\t\tlet key = 'index';\n\t\tconst keyValueMatches = value.match(/\\[(.+)\\s*,\\s*(.+)\\]/);\n\t\tif (keyValueMatches) {\n\t\t\tkey = keyValueMatches[1];\n\t\t\tvalue = keyValueMatches[2];\n\t\t}\n\t\tif (expressions.length > 1) {\n\t\t\tconst indexExpressions = expressions[1].split(/\\s*let\\s*|\\s*=\\s*index/).map(x => x.trim());\n\t\t\tif (indexExpressions.length === 3) {\n\t\t\t\tkey = indexExpressions[1];\n\t\t\t}\n\t\t}\n\t\treturn { key, value, iterable };\n\t}\n\n}\n\nForStructure.meta = {\n\tselector: '[*for]',\n};\n","import Structure from '../core/structure';\nimport { getContext } from '../module/module';\n\nexport default class IfStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst ifbegin = this.ifbegin = document.createComment(`*if begin`);\n\t\tnode.parentNode.replaceChild(ifbegin, node);\n\t\tconst ifend = this.ifend = document.createComment(`*if end`);\n\t\tifbegin.parentNode.insertBefore(ifend, ifbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*if');\n\t\tthis.expression = expression;\n\t\tthis.ifFunction = module.makeFunction(expression);\n\t\tconst clonedNode = node.cloneNode(true);\n\t\tclonedNode.removeAttribute('*if');\n\t\tthis.clonedNode = clonedNode;\n\t\t// console.log('IfStructure.expression', expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\t// console.log('IfStructure.onChanges', changes, this.expression);\n\t\tconst value = module.resolve(this.ifFunction, changes, this);\n\t\tif (value) {\n\t\t\tif (!this.clonedNode.parentNode) {\n\t\t\t\tthis.ifend.parentNode.insertBefore(this.clonedNode, this.ifend);\n\t\t\t\tmodule.compile(this.clonedNode);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.clonedNode.parentNode) {\n\t\t\t\tthis.clonedNode.parentNode.removeChild(this.clonedNode);\n\t\t\t\tmodule.remove(this.clonedNode);\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nIfStructure.meta = {\n\tselector: '[*if]',\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class InnerHtmlDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst key = selector.replace(/\\[(.+)\\]/, (...matches) => {\n\t\t\treturn matches[1];\n\t\t});\n\t\tlet expression = node.getAttribute(key);\n\t\tif (!expression) {\n\t\t\tthrow (`invalid ${key}`);\n\t\t}\n\t\tif (key === '[innerHTML]') {\n\t\t\texpression = `{{${expression}}}`;\n\t\t}\n\t\tthis.innerHtmlExpression = expression;\n\t\t// console.log('InnerHtmlDirective.onInit', node, expression, key);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst innerHTML = context.module.evaluate(this.innerHtmlExpression, changes);\n\t\t// console.log('InnerHtmlDirective.onChanges', this.innerHtmlExpression, innerHTML);\n\t\tconst node = context.node;\n\t\tnode.innerHTML = innerHTML;\n\t}\n\n}\n\nInnerHtmlDirective.meta = {\n\tselector: `[[innerHTML]],[innerHTML]`\n};\n","export default class Pipe {\n\n\tstatic transform(value) {\n\t\treturn value;\n\t}\n\n}\n","import Pipe from \"../core/pipe\";\n\nexport default class JsonPipe extends Pipe {\n\n\tstatic transform(value) {\n\t\treturn JSON.stringify(value);\n\t}\n\n}\n\nJsonPipe.meta = {\n\tname: 'json',\n};\n","import Directive from '../core/directive';\nimport { getContext } from '../module/module';\n\nexport default class StyleDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[style]');\n\t\tthis.styleFunction = module.makeFunction(expression);\n\t\t// console.log('StyleDirective.onInit', expression);\n\t}\n\n\tonChanges(changes) {\n\t\tconst context = getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst style = module.resolve(this.styleFunction, changes, this);\n\t\tfor (let key in style) {\n\t\t\tnode.style.setProperty(key, style[key]);\n\t\t}\n\t\t// console.log('StyleDirective.onChanges', changes, style);\n\t}\n\n}\n\nStyleDirective.meta = {\n\tselector: `[[style]]`\n};\n","import ClassDirective from './class/class.directive';\nimport EventDirective from './event/event.directive';\nimport ForStructure from './for/for.structure';\nimport IfStructure from './if/if.structure';\nimport InnerHtmlDirective from './inner-html/inner-html.directive';\nimport JsonPipe from './json/json.pipe';\nimport Module from './module/module';\nimport StyleDirective from './style/style.directive';\n\nexport default class CoreModule extends Module {}\nconst factories = [\n\tClassDirective,\n\tEventDirective,\n\tForStructure,\n\tIfStructure,\n\tInnerHtmlDirective,\n\tStyleDirective,\n\tJsonPipe,\n];\nconst pipes = [\n\tJsonPipe,\n];\nCoreModule.meta = {\n\tdeclarations: [\n\t\t...factories,\n\t\t...pipes,\n\t],\n\texports: [\n\t\t...factories,\n\t\t...pipes,\n\t]\n};\n","import Component from '../core/component';\nimport Directive from '../core/directive';\nimport Pipe from '../core/pipe';\nimport Structure from '../core/structure';\n\nconst ORDER = [Structure, Component, Directive];\n\nexport default class Platform {\n\n\tstatic bootstrap(moduleFactory) {\n\t\tconst meta = this.resolveMeta(moduleFactory);\n\t\tconst bootstrap = meta.bootstrap;\n\t\tif (!bootstrap) {\n\t\t\tthrow ('missing bootstrap');\n\t\t}\n\t\tconst node = meta.node = this.querySelector(bootstrap.meta.selector);\n\t\tif (!node) {\n\t\t\tthrow (`missing node ${bootstrap.meta.selector}`);\n\t\t}\n\t\tmeta.nodeInnerHTML = node.innerHTML;\n\t\tconst pipes = meta.pipes = this.resolvePipes(meta);\n\t\tconst factories = meta.factories = this.resolveFactories(meta);\n\t\tthis.sortFactories(factories);\n\t\tfactories.unshift(bootstrap);\n\t\tconst selectors = meta.selectors = this.unwrapSelectors(factories);\n\t\tconst module = new moduleFactory();\n\t\tmodule.meta = meta;\n\t\tconst instances = module.compile(node, window);\n\t\tconst root = instances[0];\n\t\t// if (root instanceof module.meta.bootstrap) {\n\t\troot.pushChanges();\n\t\t// }\n\t\treturn module;\n\t}\n\n\tstatic querySelector(selector) {\n\t\treturn document.querySelector(selector);\n\t}\n\n\tstatic resolveMeta(moduleFactory) {\n\t\tconst meta = Object.assign({ imports: [], declarations: [], pipes: [], exports: [] }, moduleFactory.meta);\n\t\tmeta.imports = meta.imports.map(moduleFactory => this.resolveMeta(moduleFactory));\n\t\treturn meta;\n\t}\n\n\tstatic resolvePipes(meta, exported) {\n\t\tconst importedPipes = meta.imports.map(meta => this.resolvePipes(meta, true));\n\t\tconst pipes = {};\n\t\tconst pipeList = (exported ? meta.exports : meta.declarations).filter(x => x.prototype instanceof Pipe);\n\t\tpipeList.forEach(pipeFactory => pipes[pipeFactory.meta.name] = pipeFactory);\n\t\treturn Object.assign({}, ...importedPipes, pipes);\n\t}\n\n\tstatic resolveFactories(meta, exported) {\n\t\tconst importedFactories = meta.imports.map(meta => this.resolveFactories(meta, true));\n\t\tconst factoryList = (exported ? meta.exports : meta.declarations).filter(x => (x.prototype instanceof Structure || x.prototype instanceof Component || x.prototype instanceof Directive));\n\t\treturn Array.prototype.concat.call(factoryList, ...importedFactories);\n\t}\n\n\tstatic sortFactories(factories) {\n\t\tfactories.sort((a, b) => {\n\t\t\tconst ai = ORDER.reduce((p, c, i) => a.prototype instanceof c ? i : p, -1);\n\t\t\tconst bi = ORDER.reduce((p, c, i) => b.prototype instanceof c ? i : p, -1);\n\t\t\treturn ai - bi;\n\t\t});\n\t}\n\n\tstatic unwrapSelectors(factories) {\n\t\tconst selectors = [];\n\t\tfactories.forEach(factory => {\n\t\t\tfactory.meta.selector.split(',').forEach(selector => {\n\t\t\t\tselector = selector.trim();\n\t\t\t\tif (selector.indexOf('.') === 0) {\n\t\t\t\t\tconst className = selector.replace(/\\./g, '');\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.classList.has(className);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else if (selector.match(/\\[(.+)\\]/)) {\n\t\t\t\t\tconst attribute = selector.substr(1, selector.length - 2);\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.hasAttribute(attribute);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.nodeName.toLowerCase() === selector.toLowerCase();\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn selectors;\n\t}\n\n\tstatic isBrowser() {\n\t\treturn window;\n\t}\n\n\t// static isServer() {}\n\n}\n","import Platform from './platform';\n\nexport default class Browser extends Platform {}\n"]}