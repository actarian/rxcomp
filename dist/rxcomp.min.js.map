{"version":3,"sources":["dist/rxcomp.js","../lib/directive/directive.js","../lib/component/component.js","../lib/module/module.js","../lib/class/class.directive.js","../lib/event/event.directive.js","../lib/structure/structure.js","../lib/for/for.item.js","../lib/context/context.js","../lib/for/for.structure.js","../lib/if/if.structure.js","../lib/inner-html/inner-html.directive.js","../lib/json/json.pipe.js","../lib/style/style.directive.js"],"names":["global","factory","exports","module","require","define","amd","self","rxcomp","rxjs","operators","this","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_inheritsLoose","subClass","superClass","prototype","create","constructor","__proto__","Directive","meta","selector","Component","ID","CONTEXTS","Module","options","bootstrap","pipes","forEach","x","name","node","document","querySelector","root","makeInstance","window","selectors","unwrapSelectors","factories","_proto","use$","_this","of","querySelectorsAll","pipe","filter","matches","map","match","shareReplay","parentInstance","_this2","parentNode","isComponent","getParentScope","instance","defineProperties","state$","value","BehaviorSubject","unsubscribe$","Subject","pushState","next","context","setContext","inputs","makeInputs","outputs","makeOutputs","onInit","takeUntil","subscribe","state","resolveInputsOutputs","parse","remove","ids","traverseDown","_i","_Object$entries","entries","_Object$entries$_i","id","complete","onDestroy","push","compile","parent","_this3","$id","undefined","_this4","parse_eval_","expression","arguments","console","log","parse_func_","makeFunction","resolve","parse_replace_","text","replace","childNodes","child","nodeType","nodeValue","replacedText","textNode","createTextNode","replaceChild","expressionFunc","payload","apply","_this5","makeInput","_this6","makeOutput","_this7","getContext","keys","inputFunction","getScope","getComponentInstanceByNode","_this8","traverseUp","onState","optionalChaining","previous","_len","args","Array","_key","tokens","split","a","b","params","transforms","getPipesSegments","shift","trim","reduce","transform","getPipeParamsSegments","join","Function","debug","getAttribute","_this9","outputFunction","output$","tap","event","contexts_","segments","word","block","t","c","substr","indexOf","className","classList","has","attribute","hasAttribute","nodeName","toLowerCase","matchSelectors","results","template","innerHTML","callback","result","j","traversePrevious","previousSibling","traverseNext","nextSibling","find","ClassDirective","_Directive","classFunction","add","EventDirective","event$","fromEvent","Structure","ForItem","_Context","$key","$value","index","count","call","Constructor","protoProps","staticProps","get","even","descriptors","parentPrototypeDescriptors","getOwnPropertyDescriptors","getPrototypeOf","parentDescriptors","_len2","_key2","assign","ForStructure","_Structure","forbegin","createComment","forend","insertBefore","removeAttribute","getExpressionTokens","forFunction","iterable","instances","isArray","array","total","Math","max","clonedNode","cloneNode","removeChild","expressions","forExpressions","keyValueMatches","indexExpressions","IfStructure","ifbegin","ifend","ifFunction","InnerHtmlDirective","innerHtmlFunction","JsonPipe","JSON","stringify","StyleDirective","styleFunction","style"],"mappings":"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","file":"dist/rxcomp.min.js","sourcesContent":[null,"export default class Directive {\n\n}\n\nDirective.meta = {\n\tselector: '[(directive)]',\n};\n","export default class Component {\n\n}\n\nComponent.meta = {\n\tselector: '[component]',\n};\n","import { BehaviorSubject, of , Subject } from 'rxjs';\nimport { filter, map, shareReplay, takeUntil, tap } from 'rxjs/operators';\nimport Component from '../component/component';\n\nlet ID = 0;\nconst CONTEXTS = {};\n\nexport default class Module {\n\n\tconstructor(options) {\n\t\tif (!options) {\n\t\t\tthrow ('missing options');\n\t\t}\n\t\tif (!options.bootstrap) {\n\t\t\tthrow ('missing bootstrap');\n\t\t}\n\t\tthis.options = options;\n\t\tconst pipes = {};\n\t\tif (options.pipes) {\n\t\t\toptions.pipes.forEach(x => pipes[x.meta.name] = x);\n\t\t}\n\t\tthis.pipes = pipes;\n\t\tconst bootstrap = options.bootstrap;\n\t\tthis.node = document.querySelector(bootstrap.meta.selector);\n\t\tif (!this.node) {\n\t\t\tthrow (`missing node ${bootstrap.meta.selector}`);\n\t\t}\n\t\tthis.root = this.makeInstance(this.node, bootstrap, bootstrap.meta.selector, window);\n\t\tthis.selectors = Module.unwrapSelectors(options.factories);\n\t}\n\n\tuse$() {\n\t\treturn of(Module.querySelectorsAll(this.node, this.selectors, [])).pipe(\n\t\t\tfilter(matches => matches.length > 0),\n\t\t\tmap((matches) => {\n\t\t\t\treturn matches.map(match => this.makeInstance(match.node, match.factory, match.selector));\n\t\t\t}),\n\t\t\tshareReplay(1)\n\t\t);\n\t}\n\n\tmakeInstance(node, factory, selector, parentInstance) {\n\t\tif (node.parentNode) {\n\t\t\tconst isComponent = factory.prototype instanceof Component;\n\t\t\tconst meta = factory.meta;\n\t\t\tparentInstance = parentInstance || this.getParentScope(node.parentNode);\n\t\t\tif (!parentInstance) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst instance = new factory();\n\t\t\tObject.defineProperties(instance, {\n\t\t\t\tstate$: {\n\t\t\t\t\tvalue: new BehaviorSubject(instance),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t},\n\t\t\t\tunsubscribe$: {\n\t\t\t\t\tvalue: new Subject(),\n\t\t\t\t\twritable: false,\n\t\t\t\t\tenumerable: false,\n\t\t\t\t}\n\t\t\t});\n\t\t\tinstance.pushState = function() {\n\t\t\t\tthis.state$.next(this);\n\t\t\t};\n\t\t\tconst context = Module.setContext(this, instance, parentInstance, node, factory, selector);\n\t\t\tif (isComponent) {\n\t\t\t\tcontext.inputs = this.makeInputs(meta, instance);\n\t\t\t\tcontext.outputs = this.makeOutputs(meta, instance);\n\t\t\t}\n\t\t\tif (typeof instance.onInit === 'function') {\n\t\t\t\tinstance.onInit();\n\t\t\t}\n\t\t\tif (parentInstance.state$) {\n\t\t\t\tparentInstance.state$.pipe(\n\t\t\t\t\t// filter(() => node.parentNode),\n\t\t\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t\t\t).subscribe(state => {\n\t\t\t\t\tif (isComponent) {\n\t\t\t\t\t\tthis.resolveInputsOutputs(instance, state);\n\t\t\t\t\t}\n\t\t\t\t\tthis.pushState(instance, state);\n\t\t\t\t\tif (isComponent) {\n\t\t\t\t\t\tthis.parse(node, instance);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn instance;\n\t\t}\n\t}\n\n\tremove(node) {\n\t\tconst ids = [];\n\t\tModule.traverseDown(node, (node) => {\n\t\t\tfor (let [id, context] of Object.entries(CONTEXTS)) {\n\t\t\t\tif (context.node === node) {\n\t\t\t\t\tconst instance = context.instance;\n\t\t\t\t\tinstance.unsubscribe$.next();\n\t\t\t\t\tinstance.unsubscribe$.complete();\n\t\t\t\t\tif (typeof instance.onDestroy === 'function') {\n\t\t\t\t\t\tinstance.onDestroy();\n\t\t\t\t\t}\n\t\t\t\t\tids.push(id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tids.forEach(id => delete CONTEXTS[id]);\n\t\t// console.log('Module.remove', ids);\n\t\treturn node;\n\t}\n\n\tcompile(node, parent) {\n\t\tif (parent) {\n\t\t\tconst $id = ++ID;\n\t\t\tparent.$id = $id;\n\t\t\tconst context = Module.setContext(this, parent, parent.parentInstance, node, parent.constructor);\n\t\t}\n\t\tconst matches = Module.querySelectorsAll(node, this.selectors, []);\n\t\tconst instances = matches.map(match => {\n\t\t\tconst instance = this.makeInstance(match.node, match.factory, match.selector, parent);\n\t\t\tif (match.factory.prototype instanceof Component) {\n\t\t\t\tparent = undefined; // !!!\n\t\t\t}\n\t\t\treturn instance;\n\t\t}).filter(x => x !== undefined);\n\t\treturn instances;\n\t}\n\n\tparse(node, instance) {\n\t\t// console.log('node', node.childNodes.length, node);\n\t\tconst parse_eval_ = (...args) => {\n\t\t\tconst expression = args[1];\n\t\t\tconsole.log('expression', expression);\n\t\t\tconst parse_func_ = this.makeFunction(expression);\n\t\t\treturn this.resolve(parse_func_, instance, instance);\n\t\t};\n\t\tconst parse_replace_ = function(text) {\n\t\t\tconsole.log(text);\n\t\t\treturn text.replace(/{{2}(?!{)(.*?)}{2}/g, parse_eval_);\n\t\t};\n\t\t/*\n\t\tif (node.hasAttribute('[innerHTML]')) {\n\t\t\tconst innerHTML = `{{${node.getAttribute('[innerHTML]')}}}`;\n\t\t\tnode.innerHTML = parse_replace_(innerHTML);\n\t\t} else if (node.hasAttribute('innerHTML')) {\n\t\t\tconst innerHTML = node.getAttribute('innerHTML');\n\t\t\tnode.innerHTML = parse_replace_(innerHTML);\n\t\t} else {\n\n\t\t}\n\t\t*/\n\t\tfor (let i = 0; i < node.childNodes.length; i++) {\n\t\t\tconst child = node.childNodes[i];\n\t\t\tif (child.nodeType === 1) {\n\t\t\t\tthis.parse(child, instance);\n\t\t\t} else if (child.nodeType === 3) {\n\t\t\t\tconst text = child.nodeValue;\n\t\t\t\tconst replacedText = parse_replace_(text);\n\t\t\t\tif (text !== replacedText) {\n\t\t\t\t\t// node.setAttribute('innerHTML', text);\n\t\t\t\t\tconst textNode = document.createTextNode(replacedText);\n\t\t\t\t\tnode.replaceChild(textNode, child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tresolve(expressionFunc, state, payload) {\n\t\treturn expressionFunc.apply(state, [payload, this]);\n\t}\n\n\tmakeInputs(meta, instance) {\n\t\tconst inputs = {};\n\t\tif (meta.inputs) {\n\t\t\tmeta.inputs.forEach((key, i) => inputs[key] = this.makeInput(instance, key));\n\t\t}\n\t\treturn inputs;\n\t}\n\n\tmakeOutputs(meta, instance) {\n\t\tconst outputs = {};\n\t\tif (meta.outputs) {\n\t\t\tmeta.outputs.forEach((key, i) => outputs[key] = this.makeOutput(instance, key));\n\t\t}\n\t\treturn outputs;\n\t}\n\n\tresolveInputsOutputs(instance, state) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst inputs = context.inputs;\n\t\tObject.keys(inputs).forEach(key => {\n\t\t\tconst inputFunction = inputs[key];\n\t\t\tconst value = this.resolve(inputFunction, parentInstance, instance);\n\t\t\tinstance[key] = value;\n\t\t});\n\t\t/*\n\t\tconst outputs = context.outputs;\n\t\tObject.keys(outputs).forEach(key => {\n\t\t\tconst inpuoutputFunctiontFunction = outputs[key];\n\t\t\tconst value = this.resolve(outputFunction, parentInstance, null);\n\t\t\t// console.log(`setted -> ${key}`, value);\n\t\t});\n\t\t*/\n\t}\n\n\tgetScope(node) {\n\t\tif (node === document) {\n\t\t\treturn window;\n\t\t}\n\t\tconst instance = Module.getComponentInstanceByNode(node);\n\t\treturn instance;\n\t}\n\n\tgetParentScope(node) {\n\t\treturn Module.traverseUp(node, (node) => {\n\t\t\treturn this.getScope(node);\n\t\t});\n\t}\n\n\tpushState(instance, state) {\n\t\tif (typeof instance.onState === 'function') {\n\t\t\t// console.log('onState', instance.constructor.meta.selector, state);\n\t\t\tinstance.onState(state);\n\t\t}\n\t\tif (instance.state$) {\n\t\t\tinstance.state$.next(instance);\n\t\t}\n\t}\n\n\t//\n\n\toptionalChaining(expression) {\n\t\tconst regex = /(\\w+(\\?\\.))+([\\.|\\w]+)/g;\n\t\tlet previous;\n\t\texpression = expression.replace(regex, (...args) => {\n\t\t\tconst tokens = args[0].split('?.');\n\t\t\tfor (let i = 0; i < tokens.length - 1; i++) {\n\t\t\t\tconst a = i > 0 ? `(${tokens[i]} = ${previous})` : tokens[i];\n\t\t\t\tconst b = tokens[i + 1];\n\t\t\t\tprevious = i > 0 ? `${a}.${b}` : `(${a} ? ${a}.${b} : void 0)`;\n\t\t\t\t// log(previous);\n\t\t\t}\n\t\t\treturn previous || '';\n\t\t});\n\t\treturn expression;\n\t}\n\n\tmakeFunction(expression, params = ['$instance']) {\n\t\tif (!expression) {\n\t\t\treturn () => { return null; };\n\t\t}\n\t\tconst pipes = this.pipes;\n\t\tconst transforms = Module.getPipesSegments(expression);\n\t\texpression = transforms.shift().trim();\n\t\texpression = this.optionalChaining(expression);\n\t\t// console.log('expression', \"${expression}\", ${params.join(',')}, this);\n\t\t// return expression_func;\n\t\t// console.log(pipes, transforms, expression);\n\t\t// console.log(transforms.length, params);\n\t\tparams.push('module');\n\t\t// keyword 'this' represents state from func.apply(state, instance)\n\t\tif (transforms.length) {\n\t\t\texpression = transforms.reduce((expression, transform, i) => {\n\t\t\t\tconst params = Module.getPipeParamsSegments(transform);\n\t\t\t\tconst name = params.shift().trim();\n\t\t\t\tconst pipe = pipes[name];\n\t\t\t\tif (!pipe || typeof pipe.transform !== 'function') {\n\t\t\t\t\tthrow (`missing pipe ${name}`);\n\t\t\t\t}\n\t\t\t\treturn `pipes.${name}.transform(${expression},${params.join(',')})`;\n\t\t\t}, expression);\n\t\t\tconsole.log('expression', expression);\n\t\t\tconst expression_func = new Function(`with(this) {\n\t\t\t\treturn (function (${params.join(',')}) {\n\t\t\t\t\tconst pipes = module.pipes;\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t} else {\n\t\t\tconsole.log('expression', expression);\n\t\t\tconst expression_func = new Function(this.options.debug ? `with(this) {\n\t\t\t\treturn (function (${params.join(',')}) {\n\t\t\t\t\tlet value;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = ${expression};\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tvalue = e.message;\n\t\t\t\t\t\t// console.error(e.message);\n\t\t\t\t\t\t// '<span style=\"color:red;\">' + e.message + ' in expression ' + expression + '</span>';\n\t\t\t\t\t}\n\t\t\t\t\treturn value;\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}` : `with(this) {\n\t\t\t\treturn (function (${params.join(',')}) {\n\t\t\t\t\treturn ${expression};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`);\n\t\t\treturn expression_func;\n\t\t}\n\t}\n\n\tmakeInput(instance, name) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute(`[${name}]`);\n\t\treturn this.makeFunction(expression);\n\t}\n\n\tmakeOutput(instance, name) {\n\t\tconst context = Module.getContext(instance);\n\t\tconst node = context.node;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst expression = node.getAttribute(`(${name})`);\n\t\tconst outputFunction = this.makeFunction(expression, ['$event']);\n\t\tconst output$ = new Subject().pipe(\n\t\t\ttap((event) => {\n\t\t\t\tthis.resolve(outputFunction, parentInstance, event);\n\t\t\t})\n\t\t);\n\t\toutput$.pipe(\n\t\t\ttakeUntil(instance.unsubscribe$)\n\t\t).subscribe();\n\t\tinstance[name] = output$;\n\t\treturn outputFunction;\n\t}\n\n\t//\n\n\tcontexts_() {\n\t\treturn CONTEXTS;\n\t}\n\n\t//\n\n\tstatic getPipesSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === '|' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic getPipeParamsSegments(expression) {\n\t\tconst segments = [];\n\t\tlet i = 0,\n\t\t\tword = '',\n\t\t\tblock = 0;\n\t\tconst t = expression.length;\n\t\twhile (i < t) {\n\t\t\tconst c = expression.substr(i, 1);\n\t\t\tif (c === '{' || c === '(' || c === '[') {\n\t\t\t\tblock++;\n\t\t\t}\n\t\t\tif (c === '}' || c === ')' || c === ']') {\n\t\t\t\tblock--;\n\t\t\t}\n\t\t\tif (c === ':' && block === 0) {\n\t\t\t\tif (word.length) {\n\t\t\t\t\tsegments.push(word);\n\t\t\t\t}\n\t\t\t\tword = '';\n\t\t\t} else {\n\t\t\t\tword += c;\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\tif (word.length) {\n\t\t\tsegments.push(word);\n\t\t}\n\t\treturn segments;\n\t}\n\n\tstatic unwrapSelectors(factories) {\n\t\tconst selectors = [];\n\t\tfactories.forEach(factory => {\n\t\t\tfactory.meta.selector.split(',').forEach(selector => {\n\t\t\t\tselector = selector.trim();\n\t\t\t\tif (selector.indexOf('.') === 0) {\n\t\t\t\t\tconst className = selector.replace(/\\./g, '');\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.classList.has(className);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else if (selector.match(/\\[(.+)\\]/)) {\n\t\t\t\t\tconst attribute = selector.substr(1, selector.length - 2);\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.hasAttribute(attribute);\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tselectors.push((node) => {\n\t\t\t\t\t\tconst match = node.nodeName.toLowerCase() === selector.toLowerCase();\n\t\t\t\t\t\treturn match ? { node, factory, selector } : false;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn selectors;\n\t}\n\n\tstatic matchSelectors(node, selectors, results) {\n\t\tselectors.forEach(selector => {\n\t\t\tconst match = selector(node);\n\t\t\tif (match) {\n\t\t\t\tconst factory = match.factory;\n\t\t\t\tif (factory.prototype instanceof Component && factory.meta.template) {\n\t\t\t\t\tnode.innerHTML = factory.meta.template;\n\t\t\t\t}\n\t\t\t\tresults.push(match);\n\t\t\t}\n\t\t});\n\t\treturn results;\n\t}\n\n\tstatic querySelectorsAll(node, selectors, results) {\n\t\tif (node.nodeType === 1) {\n\t\t\tresults = this.matchSelectors(node, selectors, results);\n\t\t}\n\t\tconst childNodes = node.childNodes;\n\t\tif (childNodes) {\n\t\t\tfor (let i = 0; i < childNodes.length; i++) {\n\t\t\t\tresults = this.querySelectorsAll(childNodes[i], selectors, results);\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\tstatic traverseUp(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseUp(node.parentNode, callback, i + 1);\n\t}\n\n\tstatic traverseDown(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tlet result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\tif (node.nodeType === 1) {\n\t\t\tlet j = 0,\n\t\t\t\tt = node.childNodes.length;\n\t\t\twhile (j < t && !result) {\n\t\t\t\tresult = this.traverseDown(node.childNodes[j], callback, i + 1);\n\t\t\t\tj++;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic traversePrevious(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traversePrevious(node.previousSibling, callback, i + 1);\n\t}\n\n\tstatic traverseNext(node, callback, i = 0) {\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\t\tconst result = callback(node, i);\n\t\tif (result) {\n\t\t\treturn result;\n\t\t}\n\t\treturn this.traverseNext(node.nextSibling, callback, i + 1);\n\t}\n\n\tstatic use$(options) {\n\t\t/*\n\t\tif (!options.factories) {\n\t\t\toptions.factories = [\n\t\t\t\tClassDirective,\n\t\t\t\tEventDirective,\n\t\t\t\tIfStructure,\n\t\t\t\tForStructure,\n\t\t\t\tStyleDirective\n\t\t\t];\n\t\t}\n\t\tif (!options.pipes) {\n\t\t\toptions.pipes = [\n\t\t\t\tJsonPipe\n\t\t\t];\n\t\t}\n\t\t*/\n\t\treturn new Module(options).use$();\n\t}\n\n\tstatic getContext(instance) {\n\t\treturn CONTEXTS[instance.$id];\n\t}\n\n\tstatic setContext(module, instance, parentInstance, node, factory, selector) {\n\t\tconst $id = ++ID;\n\t\tinstance.$id = $id;\n\t\treturn CONTEXTS[$id] = { module, instance, parentInstance, node, factory, selector };\n\t}\n\n\tstatic getComponentInstanceByNode(node) {\n\t\tconst id = Object.keys(CONTEXTS).find(id => CONTEXTS[id].node === node && CONTEXTS[id].factory.prototype instanceof Component);\n\t\tif (id) {\n\t\t\tconst context = CONTEXTS[id];\n\t\t\treturn context.instance;\n\t\t}\n\t}\n\n}\n","import Directive from '../directive/directive';\nimport Module from '../module/module';\n\nexport default class ClassDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[class]');\n\t\tthis.classFunction = module.makeFunction(expression);\n\t\t// this.classList = [...node.classList.keys()];\n\t\t// console.log('ClassDirective.onInit', this.classList, expression);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst classList = module.resolve(this.classFunction, state, this);\n\t\tObject.keys(classList).forEach(key => {\n\t\t\tif (classList[key]) {\n\t\t\t\tnode.classList.add(key);\n\t\t\t} else {\n\t\t\t\tnode.classList.remove(key);\n\t\t\t}\n\t\t});\n\t\t// console.log('ClassDirective.onState', classList);\n\t}\n\n}\n\nClassDirective.meta = {\n\tselector: `[[class]]`,\n};\n","import { fromEvent } from 'rxjs';\nimport { shareReplay, takeUntil } from 'rxjs/operators';\nimport Directive from '../directive/directive';\nimport Module from '../module/module';\n\nconst EVENTS = ['click', 'mousedown', 'mouseup', 'touchstart', 'touchmove', 'touchend', 'keydown', 'keyup', 'input', 'change', 'loaded'];\n\nexport default class EventDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst parentInstance = context.parentInstance;\n\t\tconst event = this.event = selector.replace(/\\[|\\]|\\(|\\)/g, '');\n\t\tconst event$ = this.event$ = fromEvent(node, event).pipe(shareReplay(1));\n\t\tconst expression = node.getAttribute(`(${event})`);\n\t\tif (expression) {\n\t\t\tconst outputFunction = module.makeFunction(expression, ['$event']);\n\t\t\tevent$.pipe(\n\t\t\t\ttakeUntil(this.unsubscribe$)\n\t\t\t).subscribe(event => {\n\t\t\t\t// console.log(parentInstance);\n\t\t\t\tmodule.resolve(outputFunction, parentInstance, event);\n\t\t\t});\n\t\t} else {\n\t\t\tparentInstance[`${event}$`] = event$;\n\t\t}\n\t\t// console.log('EventDirective.onInit', 'selector', selector, 'event', event);\n\t}\n\n}\n\nEventDirective.meta = {\n\tselector: `[(${EVENTS.join(')],[(')})]`,\n};\n","export default class Structure {\n\n}\n\nStructure.meta = {\n\tselector: '[(directive)]',\n};\n","import Context from '../context/context';\n\nexport default class ForItem extends Context {\n\n\tconstructor(key, $key, value, $value, index, count, parentInstance) {\n\t\tconsole.log(key, $key, value, $value);\n\t\tsuper(parentInstance);\n\t\t/*\n\t\tsuper(parentInstance, {\n\t\t\t[key]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$key;\n\t\t\t\t},\n\t\t\t\tset: function(key) {\n\t\t\t\t\tthis.$key = key;\n\t\t\t\t}\n\t\t\t},\n\t\t\t[value]: {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn this.$value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\tthis.$value = value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t*/\n\t\tthis[key] = $key;\n\t\tthis[value] = $value;\n\t\tthis.index = index;\n\t\tthis.count = count;\n\t}\n\n\tget first() { return this.index === 0; }\n\n\tget last() { return this.index === this.count - 1; }\n\n\tget even() { return this.index % 2 === 0; }\n\n\tget odd() { return !this.even; }\n\n\tpushState() {\n\t\tthis.state$.next(this);\n\t}\n\n}\n","import { BehaviorSubject, Subject } from \"rxjs\";\n\nexport default class Context {\n\n\tconstructor(parent, descriptors) {\n\t\tconst parentPrototypeDescriptors = Object.getOwnPropertyDescriptors(Object.getPrototypeOf(parent));\n\t\tdelete parentPrototypeDescriptors.constructor;\n\t\tObject.keys(parentPrototypeDescriptors).forEach(key => {\n\t\t\tconst descriptor = parentPrototypeDescriptors[key];\n\t\t\tif (typeof descriptor.value == \"function\") {\n\t\t\t\tdescriptor.value = (...args) => {\n\t\t\t\t\tparent[key].apply(parent, args);\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\t// console.log('parentPrototypeDescriptors', parentPrototypeDescriptors);\n\t\tconst parentDescriptors = Object.getOwnPropertyDescriptors(parent);\n\t\tObject.keys(parentDescriptors).forEach(key => {\n\t\t\tconst descriptor = parentDescriptors[key];\n\t\t\tif (typeof descriptor.value == \"function\") {\n\t\t\t\tdescriptor.value = (...args) => {\n\t\t\t\t\tparent[key].apply(parent, args);\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\t\t// console.log('parentDescriptors', parentDescriptors);\n\t\tObject.defineProperties(this, Object.assign(parentPrototypeDescriptors, parentDescriptors, {\n\t\t\tstate$: {\n\t\t\t\tvalue: new BehaviorSubject(this),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t},\n\t\t\tunsubscribe$: {\n\t\t\t\tvalue: new Subject(),\n\t\t\t\twritable: false,\n\t\t\t\tenumerable: false,\n\t\t\t}\n\t\t}, descriptors));\n\t\tthis.pushState = () => {\n\t\t\tthis.state$.next(this);\n\t\t};\n\t}\n\n}\n","import Module from '../module/module';\nimport Structure from '../structure/structure';\nimport ForItem from './for.item';\n\nexport default class ForStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst forbegin = this.forbegin = document.createComment(`*for begin`);\n\t\tnode.parentNode.replaceChild(forbegin, node);\n\t\tconst forend = this.forend = document.createComment(`*for end`);\n\t\tforbegin.parentNode.insertBefore(forend, forbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*for');\n\t\tnode.removeAttribute('*for');\n\t\tconst tokens = this.tokens = this.getExpressionTokens(expression);\n\t\tthis.forFunction = module.makeFunction(tokens.iterable);\n\t\tthis.instances = [];\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\t// resolve\n\t\tconst tokens = this.tokens;\n\t\tlet result = module.resolve(this.forFunction, state, this) || [];\n\t\tconst isArray = Array.isArray(result);\n\t\tconst array = isArray ? result : Object.keys(result);\n\t\tconst total = array.length;\n\t\tconst previous = this.instances.length;\n\t\tlet nextSibling = this.forbegin.nextSibling;\n\t\tfor (let i = 0; i < Math.max(previous, total); i++) {\n\t\t\tif (i < total) {\n\t\t\t\tconst key = isArray ? i : array[i];\n\t\t\t\tconst value = isArray ? array[key] : result[key];\n\t\t\t\tif (i < previous) {\n\t\t\t\t\t// update\n\t\t\t\t\tconst clonedNode = nextSibling;\n\t\t\t\t\tconst instance = this.instances[i];\n\t\t\t\t\tinstance[tokens.key] = key;\n\t\t\t\t\tinstance[tokens.value] = value;\n\t\t\t\t\tinstance.pushState();\n\t\t\t\t\tmodule.parse(clonedNode, instance);\n\t\t\t\t\tnextSibling = nextSibling.nextSibling;\n\t\t\t\t} else {\n\t\t\t\t\t// create\n\t\t\t\t\tconst clonedNode = node.cloneNode(true);\n\t\t\t\t\tthis.forend.parentNode.insertBefore(clonedNode, this.forend);\n\t\t\t\t\tconst instance = new ForItem(tokens.key, key, tokens.value, value, i, total, context.parentInstance);\n\t\t\t\t\tmodule.compile(clonedNode, instance);\n\t\t\t\t\tmodule.parse(clonedNode, instance);\n\t\t\t\t\tnextSibling = clonedNode.nextSibling;\n\t\t\t\t\tthis.instances.push(instance);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// remove\n\t\t\t\tconst instance = this.instances[i];\n\t\t\t\tconst context = Module.getContext(instance);\n\t\t\t\tconst node = context.node;\n\t\t\t\tnode.parentNode.removeChild(node);\n\t\t\t\tmodule.remove(node);\n\t\t\t}\n\t\t}\n\t\tthis.instances.length = array.length;\n\t\tconsole.log(this.instances, tokens);\n\t}\n\n\tgetExpressionTokens(expression) {\n\t\tif (expression === null) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tif (expression.trim().indexOf('let ') === -1 || expression.trim().indexOf(' of ') === -1) {\n\t\t\tthrow ('invalid for');\n\t\t}\n\t\tconst expressions = expression.split(';').map(x => x.trim()).filter(x => x !== '');\n\t\tconst forExpressions = expressions[0].split(' of ').map(x => x.trim());\n\t\tlet value = forExpressions[0].replace(/\\s*let\\s*/, '');\n\t\tconst iterable = forExpressions[1];\n\t\tlet key = 'index';\n\t\tconst keyValueMatches = value.match(/\\[(.+)\\s*,\\s*(.+)\\]/);\n\t\tif (keyValueMatches) {\n\t\t\tkey = keyValueMatches[1];\n\t\t\tvalue = keyValueMatches[2];\n\t\t}\n\t\tif (expressions.length > 1) {\n\t\t\tconst indexExpressions = expressions[1].split(/\\s*let\\s*|\\s*=\\s*index/).map(x => x.trim());\n\t\t\tif (indexExpressions.length === 3) {\n\t\t\t\tkey = indexExpressions[1];\n\t\t\t}\n\t\t}\n\t\treturn { key, value, iterable };\n\t}\n\n\t/*\n\tonState_unoptimized(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst tokens = this.tokens;\n\t\twhile (this.forbegin.nextSibling !== this.forend) {\n\t\t\tconst nextSibling = this.forbegin.nextSibling;\n\t\t\tthis.forbegin.parentNode.removeChild(nextSibling);\n\t\t\tmodule.remove(nextSibling);\n\t\t}\n\t\tconst array = module.resolve(this.forFunction, state, this).map((value, index, array) => {\n\t\t\tconst item = new ForItem(tokens.key, index, tokens.value, value, array, this.parent);\n\t\t\tconst clonedNode = node.cloneNode(true);\n\t\t\tthis.forend.parentNode.insertBefore(clonedNode, this.forend);\n\t\t\tconst instances = module.compile(clonedNode, item);\n\t\t\tmodule.parse(clonedNode, item);\n\t\t\treturn item;\n\t\t});\n\t\t// console.log('ForStructure.onState', array);\n\t}\n\t*/\n\n}\n\nForStructure.meta = {\n\tselector: '[*for]',\n};\n","import Module from '../module/module';\nimport Structure from '../structure/structure';\n\nexport default class IfStructure extends Structure {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst ifbegin = this.ifbegin = document.createComment(`*if begin`);\n\t\tnode.parentNode.replaceChild(ifbegin, node);\n\t\tconst ifend = this.ifend = document.createComment(`*if end`);\n\t\tifbegin.parentNode.insertBefore(ifend, ifbegin.nextSibling);\n\t\tconst expression = node.getAttribute('*if');\n\t\tthis.expression = expression;\n\t\tthis.ifFunction = module.makeFunction(expression);\n\t\tconst clonedNode = node.cloneNode(true);\n\t\tclonedNode.removeAttribute('*if');\n\t\tthis.clonedNode = clonedNode;\n\t\t// console.log('expression', expression);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\t// console.log('IfStructure.onState', state, this.expression);\n\t\tconst value = module.resolve(this.ifFunction, state, this);\n\t\tif (value) {\n\t\t\tif (!this.clonedNode.parentNode) {\n\t\t\t\tthis.ifend.parentNode.insertBefore(this.clonedNode, this.ifend);\n\t\t\t\tmodule.compile(this.clonedNode);\n\t\t\t\tmodule.parse(this.clonedNode, state);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.clonedNode.parentNode) {\n\t\t\t\tthis.clonedNode.parentNode.removeChild(this.clonedNode);\n\t\t\t\tmodule.remove(this.clonedNode);\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nIfStructure.meta = {\n\tselector: '[*if]',\n};\n","import Directive from '../directive/directive';\nimport Module from '../module/module';\n\nexport default class InnerHtmlDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst selector = context.selector;\n\t\tconst expression = node.getAttribute(selector);\n\t\tthis.innerHtmlFunction = module.makeFunction(expression);\n\t\tconsole.log('InnerHtmlDirective.onInit', expression, selector);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst innerHTML = module.resolve(this.innerHtmlFunction, state, this);\n\t\t// node.innerHTML = innerHTML;\n\t\tconsole.log('InnerHtmlDirective.onState', state, innerHTML);\n\t}\n\n}\n\nInnerHtmlDirective.meta = {\n\tselector: `[[innerHTML]],[innerHTML]`\n};\n","export default class JsonPipe {\n\n\tstatic transform(value) {\n\t\treturn JSON.stringify(value);\n\t}\n\n}\n\nJsonPipe.meta = {\n\tname: 'json',\n};\n","import Directive from '../directive/directive';\nimport Module from '../module/module';\n\nexport default class StyleDirective extends Directive {\n\n\tonInit() {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst expression = node.getAttribute('[style]');\n\t\tthis.styleFunction = module.makeFunction(expression);\n\t\t// console.log('StyleDirective.onInit', expression);\n\t}\n\n\tonState(state) {\n\t\tconst context = Module.getContext(this);\n\t\tconst module = context.module;\n\t\tconst node = context.node;\n\t\tconst style = module.resolve(this.styleFunction, state, this);\n\t\tObject.keys(style).forEach(key => {\n\t\t\tnode.style[key] = style[key];\n\t\t});\n\t\t// console.log('StyleDirective.onState', state, style);\n\t}\n\n}\n\nStyleDirective.meta = {\n\tselector: `[[style]]`\n};\n"]}