/**
 * @license rxcomp v1.0.0-alpha.11
 * (c) 2019 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("rxcomp",["exports","rxjs","rxjs/operators"],e):e((t=t||self).rxcomp={},t.rxjs,t.rxjs.operators)}(this,(function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e,n){return(s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&i(o,n.prototype),o}).apply(null,arguments)}var u=function(){},a=function(){},c=["constructor","rxcompId","onInit","onChanges","onDestroy","pushChanges","changes$","unsubscribe$"],f=function(t){function e(n,r){var o;return void 0===r&&(r={}),o=t.call(this)||this,r=e.mergeDescriptors(n,n,r),r=e.mergeDescriptors(Object.getPrototypeOf(n),n,r),Object.defineProperties(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(o),r),o}return o(e,t),e.mergeDescriptors=function(t,e,n){void 0===n&&(n={});for(var r=Object.getOwnPropertyNames(t),o=function(){var o=r.shift();if(-1===c.indexOf(o)&&!n.hasOwnProperty(o)){var i=Object.getOwnPropertyDescriptor(t,o);"function"==typeof i.value&&(i.value=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];e[o].apply(e,n)}),n[o]=i}};r.length;)o();return n},e}(a),p=0,l={},h={},d=[],v=function(){function t(){}var r=t.prototype;return r.compile=function(e,n){var r,o=this;return t.querySelectorsAll(e,this.meta.selectors,[]).map((function(t){r&&r!==t.node&&(n=void 0);var e=o.makeInstance(t.node,t.factory,t.selector,n);return t.factory.prototype instanceof a&&(r=t.node),e})).filter((function(t){return t}))},r.makeInstance=function(r,o,i,u,c){var f=this;if(u||r.parentNode){var p=o.prototype instanceof a,l=o.meta;if(!(u=u||this.getParentInstance(r.parentNode)))return;var h,d=s(o,c||[]),v=t.makeContext(this,d,u,r,o,i);Object.defineProperties(d,{changes$:{value:new e.BehaviorSubject(d),writable:!1,enumerable:!1},unsubscribe$:{value:new e.Subject,writable:!1,enumerable:!1}});var m=this;return d.pushChanges=function(){this.changes$.next(this),p&&(h?m.parse(r,d):setTimeout((function(){m.parse(r,d)}))),"function"==typeof d.onView&&d.onView()},l&&(this.makeHosts(l,d,r),v.inputs=this.makeInputs(l,d),v.outputs=this.makeOutputs(l,d)),"function"==typeof d.onInit&&d.onInit(),h=!0,u.changes$&&u.changes$.pipe(n.takeUntil(d.unsubscribe$)).subscribe((function(t){l&&f.resolveInputsOutputs(d,t),"function"==typeof d.onChanges&&d.onChanges(t),d.pushChanges()})),d}},r.makeContext=function(e,n,r,o){return t.makeContext(this,e,n,r,e.constructor,o)},r.makeFunction=function(e,n){if(void 0===n&&(n=["$instance"]),!e)return function(){return null};var r=n.join(","),o=this.meta.pipes,i=t.getPipesSegments(e);return e=i.shift().trim(),e=this.transformOptionalChaining(e),i.length?(e=i.reduce((function(e,n,r){var i=t.getPipeParamsSegments(n),s=i.shift().trim(),u=o[s];if(!u||"function"!=typeof u.transform)throw"missing pipe '"+s+"'";return"$$pipes."+s+".transform("+e+","+i.join(",")+")"}),e),new Function("with(this) {\n\t\t\t\treturn (function ("+r+", $$module) {\n\t\t\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\t\t\treturn "+e+";\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}")):new Function("with(this) {\n\t\t\t\treturn (function ("+r+", $$module) {\n\t\t\t\t\treturn "+e+";\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}")},r.getInstance=function(t){if(t===document)return window;var e=y(t);return e?e.instance:void 0},r.getParentInstance=function(e){var n=this;return t.traverseUp(e,(function(t){return n.getInstance(t)}))},r.remove=function(e){for(t.traverseDown(e,(function(t){for(var e in l){var n=l[e];if(n.node===t){var r=n.instance;r.unsubscribe$.next(),r.unsubscribe$.complete(),"function"==typeof r.onDestroy&&r.onDestroy(),delete t.dataset.rxcompId,d.push(e)}}}));d.length;)t.deleteContext(d.shift());return e},r.destroy=function(){this.remove(this.meta.node),this.meta.node.innerHTML=this.meta.nodeInnerHTML},r.evaluate=function(t,e){var n=this;return t.replace(/\{{2}((([^{}])|(\{([^{}]|(\{.*?\}))+?\}))*?)\}{2}/g,(function(){var t=arguments.length<=1?void 0:arguments[1];try{var r=n.makeFunction(t);return n.resolve(r,e,e)}catch(t){return console.error(t),t.message}}))},r.parse=function(t,e){for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(1===r.nodeType)y(r)||this.parse(r,e);else if(3===r.nodeType){var o=r.nodeExpression||r.nodeValue,i=this.evaluate(o,e);if(o!==i){var s=document.createTextNode(i);s.nodeExpression=o,t.replaceChild(s,r)}}}},r.resolve=function(t,e,n){return t.apply(e,[n,this])},r.makeHosts=function(t,e,n){t.hosts&&Object.keys(t.hosts).forEach((function(r){var o=t.hosts[r];e[r]=g(e,o,n)}))},r.makeInput=function(t,e){var n,r=m(t).node,o=null;return r.hasAttribute(e)?o="'"+r.getAttribute(e).replace("{{","'+").replace("}}","+'")+"'":r.hasAttribute("["+e+"]")&&(o=r.getAttribute("["+e+"]")),null!==o&&(n=this.makeFunction(o)),n},r.makeInputs=function(t,e){var n=this,r={};return t.inputs&&t.inputs.forEach((function(t,o){var i=n.makeInput(e,t);i&&(r[t]=i)})),r},r.makeOutput=function(t,r){var o=this,i=m(t),s=i.node,u=i.parentInstance,a=s.getAttribute("("+r+")"),c=this.makeFunction(a,["$event"]),f=(new e.Subject).pipe(n.tap((function(t){o.resolve(c,u,t)})));return f.pipe(n.takeUntil(t.unsubscribe$)).subscribe(),t[r]=f,c},r.makeOutputs=function(t,e){var n=this,r={};return t.outputs&&t.outputs.forEach((function(t,o){return r[t]=n.makeOutput(e,t)})),r},r.resolveInputsOutputs=function(t,e){var n=m(t),r=n.parentInstance,o=n.inputs;for(var i in o){var s=o[i],u=this.resolve(s,r,t);t[i]=u}},r.transformOptionalChaining=function(t){var e;return t=t.replace(/(\w+(\?\.))+([\.|\w]+)/g,(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var o=n[0].split("?."),i=0;i<o.length-1;i++){var s=i>0?"("+o[i]+" = "+e+")":o[i],u=o[i+1];e=i>0?s+"."+u:"("+s+" ? "+s+"."+u+" : void 0)"}return e||""}))},t.getPipesSegments=function(t){for(var e=[],n=0,r="",o=0,i=t.length;n<i;){var s=t.substr(n,1);"{"!==s&&"("!==s&&"["!==s||o++,"}"!==s&&")"!==s&&"]"!==s||o--,"|"===s&&0===o?(r.length&&e.push(r),r=""):r+=s,n++}return r.length&&e.push(r),e},t.getPipeParamsSegments=function(t){for(var e=[],n=0,r="",o=0,i=t.length;n<i;){var s=t.substr(n,1);"{"!==s&&"("!==s&&"["!==s||o++,"}"!==s&&")"!==s&&"]"!==s||o--,":"===s&&0===o?(r.length&&e.push(r),r=""):r+=s,n++}return r.length&&e.push(r),e},t.matchSelectors=function(t,e,n){for(var r=0;r<e.length;r++){var o=e[r](t);if(o){var i=o.factory;i.prototype instanceof a&&i.meta.template&&(t.innerHTML=i.meta.template),n.push(o)}}return n},t.querySelectorsAll=function(t,e,n){if(1===t.nodeType){n=this.matchSelectors(t,e,n);for(var r=t.childNodes,o=0;o<r.length;o++)n=this.querySelectorsAll(r[o],e,n)}return n},t.traverseUp=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);return r||this.traverseUp(t.parentNode,e,n+1)}},t.traverseDown=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);if(r)return r;if(1===t.nodeType)for(var o=0,i=t.childNodes.length;o<i&&!r;)r=this.traverseDown(t.childNodes[o],e,n+1),o++;return r}},t.traversePrevious=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);return r||this.traversePrevious(t.previousSibling,e,n+1)}},t.traverseNext=function(t,e,n){if(void 0===n&&(n=0),t){var r=e(t,n);return r||this.traverseNext(t.nextSibling,e,n+1)}},t.makeContext=function(t,e,n,r,o,i){e.rxcompId=++p;var s={module:t,instance:e,parentInstance:n,node:r,factory:o,selector:i},u=r.dataset.rxcompId=r.dataset.rxcompId||e.rxcompId;return(h[u]||(h[u]=[])).push(s),l[e.rxcompId]=s},t.deleteContext=function(t){var e=l[t],n=h[e.node.dataset.rxcompId];if(n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}delete l[t]},t}();function m(t){return l[t.rxcompId]}function y(t){var e,n=h[t.dataset.rxcompId];return n&&(e=n.reduce((function(t,e){return e.factory.prototype instanceof a?e:e.factory.prototype instanceof f?t||e:t}),null)),e}function g(t,e,n){if(n||(n=m(t).node),n.dataset){var r=h[n.dataset.rxcompId];if(r)for(var o=0;o<r.length;o++){var i=r[o];if(i.instance!==t&&i.instance instanceof e)return i.instance}return n.parentNode?g(t,e,n.parentNode):void 0}}var b=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){var t=m(this),e=t.module,n=t.node.getAttribute("[class]");this.classFunction=e.makeFunction(n)},n.onChanges=function(t){var e=m(this),n=e.module,r=e.node,o=n.resolve(this.classFunction,t,this);for(var i in o)o[i]?r.classList.add(i):r.classList.remove(i)},e}(u);b.meta={selector:"[[class]]"};var x=function(t){function r(){return t.apply(this,arguments)||this}return o(r,t),r.prototype.onInit=function(){var t=m(this),r=t.module,o=t.node,i=t.parentInstance,s=t.selector,u=this.event=s.replace(/\[|\]|\(|\)/g,""),a=this.event$=e.fromEvent(o,u).pipe(n.shareReplay(1)),c=o.getAttribute("("+u+")");if(c){var f=r.makeFunction(c,["$event"]);a.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){r.resolve(f,i,t)}))}else i[u+"$"]=a},r}(u);x.meta={selector:"[("+["click","mousedown","mouseup","touchstart","touchmove","touchend","keydown","keyup","input","change","loaded"].join(")],[(")+")]"};var w=function(){},k=function(t){function e(e,n,r,o,i,s,u){var a;return(a=t.call(this,u)||this)[e]=n,a[r]=o,a.index=i,a.count=s,a}var n,i,s;return o(e,t),n=e,(i=[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}])&&r(n.prototype,i),s&&r(n,s),e}(f),I=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){var t=m(this),e=t.module,n=t.node,r=this.forbegin=document.createComment("*for begin");n.parentNode.replaceChild(r,n);var o=this.forend=document.createComment("*for end");r.parentNode.insertBefore(o,r.nextSibling);var i=n.getAttribute("*for");n.removeAttribute("*for");var s=this.tokens=this.getExpressionTokens(i);this.forFunction=e.makeFunction(s.iterable),this.instances=[]},n.onChanges=function(t){for(var e=m(this),n=e.module,r=e.node,o=this.tokens,i=n.resolve(this.forFunction,t,this)||[],s=Array.isArray(i),u=s?i:Object.keys(i),a=u.length,c=this.instances.length,f=0;f<Math.max(c,a);f++)if(f<a){var p=s?f:u[f],l=s?u[p]:i[p];if(f<c){var h=this.instances[f];h[o.key]=p,h[o.value]=l}else{var d=r.cloneNode(!0);delete d.dataset.rxcompId,this.forend.parentNode.insertBefore(d,this.forend);var v=[o.key,p,o.value,l,f,a,e.parentInstance],y=n.makeInstance(d,k,e.selector,e.parentInstance,v),g=m(y);n.compile(d,g.instance),this.instances.push(y)}}else{var b=m(this.instances[f]).node;b.parentNode.removeChild(b),n.remove(b)}this.instances.length=u.length},n.getExpressionTokens=function(t){if(null===t)throw"invalid for";if(-1===t.trim().indexOf("let ")||-1===t.trim().indexOf(" of "))throw"invalid for";var e=t.split(";").map((function(t){return t.trim()})).filter((function(t){return""!==t})),n=e[0].split(" of ").map((function(t){return t.trim()})),r=n[0].replace(/\s*let\s*/,""),o=n[1],i="index",s=r.match(/\[(.+)\s*,\s*(.+)\]/);if(s&&(i=s[1],r=s[2]),e.length>1){var u=e[1].split(/\s*let\s*|\s*=\s*index/).map((function(t){return t.trim()}));3===u.length&&(i=u[1])}return{key:i,value:r,iterable:o}},e}(w);I.meta={selector:"[*for]"};var C=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){var t=m(this),e=t.module,n=t.node,r=this.ifbegin=document.createComment("*if begin");n.parentNode.replaceChild(r,n);var o=this.ifend=document.createComment("*if end");r.parentNode.insertBefore(o,r.nextSibling);var i=n.getAttribute("*if");this.expression=i,this.ifFunction=e.makeFunction(i);var s=n.cloneNode(!0);s.removeAttribute("*if"),this.clonedNode=s},n.onChanges=function(t){var e=m(this).module;e.resolve(this.ifFunction,t,this)?this.clonedNode.parentNode||(this.ifend.parentNode.insertBefore(this.clonedNode,this.ifend),e.compile(this.clonedNode)):this.clonedNode.parentNode&&(this.clonedNode.parentNode.removeChild(this.clonedNode),e.remove(this.clonedNode))},e}(w);C.meta={selector:"[*if]"};var N=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.prototype.onChanges=function(t){m(this).node.innerHTML=this.innerHTML},e}(u);N.meta={selector:"[innerHTML]",inputs:["innerHTML"]};var O=function(){function t(){}return t.transform=function(t){return t},t}(),j=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.transform=function(t){return JSON.stringify(t,null,"\t")},e}(O);j.meta={name:"json"};var P=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){var t=m(this),e=t.module,n=t.node.getAttribute("[style]");this.styleFunction=e.makeFunction(n)},n.onChanges=function(t){var e=m(this),n=e.module,r=e.node,o=n.resolve(this.styleFunction,t,this);for(var i in o)r.style.setProperty(i,o[i])},e}(u);P.meta={selector:"[[style]]"};var S=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(v),$=[b,x,I,C,N,P,j],A=[j];S.meta={declarations:[].concat($,A),exports:[].concat($,A)};var F=[w,a,u],D=function(){function t(){}return t.bootstrap=function(t){var e=this.resolveMeta(t),n=e.bootstrap;if(!n)throw"missing bootstrap";var r=e.node=this.querySelector(n.meta.selector);if(!r)throw"missing node "+n.meta.selector;e.nodeInnerHTML=r.innerHTML;e.pipes=this.resolvePipes(e);var o=e.factories=this.resolveFactories(e);this.sortFactories(o),o.unshift(n);e.selectors=this.unwrapSelectors(o);var i=new t;return i.meta=e,i.compile(r,window)[0].pushChanges(),i},t.querySelector=function(t){return document.querySelector(t)},t.resolveMeta=function(t){var e=this,n=Object.assign({imports:[],declarations:[],pipes:[],exports:[]},t.meta);return n.imports=n.imports.map((function(t){return e.resolveMeta(t)})),n},t.resolvePipes=function(t,e){var n=this,r=t.imports.map((function(t){return n.resolvePipes(t,!0)})),o={};return(e?t.exports:t.declarations).filter((function(t){return t.prototype instanceof O})).forEach((function(t){return o[t.meta.name]=t})),Object.assign.apply(Object,[{}].concat(r,[o]))},t.resolveFactories=function(t,e){var n,r=this,o=t.imports.map((function(t){return r.resolveFactories(t,!0)})),i=(e?t.exports:t.declarations).filter((function(t){return t.prototype instanceof w||t.prototype instanceof a||t.prototype instanceof u}));return(n=Array.prototype.concat).call.apply(n,[i].concat(o))},t.sortFactories=function(t){t.sort((function(t,e){var n=F.reduce((function(e,n,r){return t.prototype instanceof n?r:e}),-1)-F.reduce((function(t,n,r){return e.prototype instanceof n?r:t}),-1);return 0===n?(t.meta.hosts?1:0)-(e.meta.hosts?1:0):n}))},t.getExpressions=function(t){var e=[];return t.replace(/\.([\w\-\_]+)|\[(.+?\]*)(\=)(.*?)\]|\[(.+?\]*)\]|([\w\-\_]+)/g,(function(t,n,r,o,i,s,u){n&&e.push((function(t){return t.classList.contains(n)})),r&&e.push((function(t){return t.hasAttribute(r)&&t.getAttribute(r)===i||t.hasAttribute("["+r+"]")&&t.getAttribute("["+r+"]")===i})),s&&e.push((function(t){return t.hasAttribute(s)||t.hasAttribute("["+s+"]")})),u&&e.push((function(t){return t.nodeName.toLowerCase()===u.toLowerCase()}))})),e},t.unwrapSelectors=function(t){var e=this,n=[];return t.forEach((function(t){t.meta.selector.split(",").forEach((function(r){r=r.trim();var o=[],i=r.replace(/\:not\((.+?)\)/g,(function(t,n){return o=e.getExpressions(n),""})),s=e.getExpressions(i);n.push((function(e){var n=s.reduce((function(t,n){return t&&n(e)}),!0),i=o.reduce((function(t,n){return t||n(e)}),!1);return!(!n||i)&&{node:e,factory:t,selector:r}}))}))})),n},t.isBrowser=function(){return window},t}(),T=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(D);t.Browser=T,t.ClassDirective=b,t.Component=a,t.Context=f,t.CoreModule=S,t.Directive=u,t.EventDirective=x,t.ForStructure=I,t.IfStructure=C,t.InnerHtmlDirective=N,t.JsonPipe=j,t.Module=v,t.Pipe=O,t.Platform=D,t.Structure=w,t.StyleDirective=P,t.getContext=m,t.getContextByNode=y,t.getHost=g,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=rxcomp.min.js.map