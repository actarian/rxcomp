/**
 * @license rxcomp v1.0.0-beta.5
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["exports","rxjs","rxjs/operators"],t):t((e=e||self).rxcomp={},e.rxjs,e.rxjs.operators)}(this,(function(e,t,s){"use strict";class n{constructor(...e){}}class o extends n{}class r extends n{}const i=["constructor","rxcompId","onInit","onChanges","onDestroy","pushChanges","changes$","unsubscribe$"];class c extends r{constructor(e,t={}){super(),t=c.mergeDescriptors(e,e,t),t=c.mergeDescriptors(Object.getPrototypeOf(e),e,t),Object.defineProperties(this,t)}static mergeDescriptors(e,t,s={}){const n=Object.getOwnPropertyNames(e);for(;n.length;){let o=n.shift();if(-1===i.indexOf(o)&&!s.hasOwnProperty(o)){const n=Object.getOwnPropertyDescriptor(e,o);"function"==typeof n.value&&(n.value=(...e)=>t[o].apply(t,e)),s[o]=n}}return s}}class a extends n{}let u=0;const l={},p={};class h{compile(e,t){let s;return h.querySelectorsAll(e,this.meta.selectors,[]).map(e=>{s&&s!==e.node&&(t=void 0);const n=this.makeInstance(e.node,e.factory,e.selector,t);return e.factory.prototype instanceof r&&(s=e.node),n}).filter(e=>e)}makeInstance(e,o,i,c,a){if(c||e.parentNode){const u=o.prototype instanceof r,l=o.meta;if(!(c=c||this.getParentInstance(e.parentNode)))return;const p=new o(...a||[]),d=h.makeContext(this,p,c,e,o,i);let m;Object.defineProperties(p,{changes$:{value:new t.BehaviorSubject(p),writable:!1,enumerable:!1},unsubscribe$:{value:new t.Subject,writable:!1,enumerable:!1}});const f=this;return p.pushChanges=function(){this.changes$.next(this),u&&(m?f.parse(e,p):setTimeout((function(){f.parse(e,p)}))),p.onView&&p.onView()},l&&(this.makeHosts(l,p,e),d.inputs=this.makeInputs(l,p),d.outputs=this.makeOutputs(l,p)),p.onInit&&p.onInit(),m=!0,c instanceof n&&c.changes$&&c.changes$.pipe(s.takeUntil(p.unsubscribe$)).subscribe(e=>{l&&this.resolveInputsOutputs(p,e),p.onChanges&&p.onChanges(e),p.pushChanges()}),p}}makeContext(e,t,s,n){return h.makeContext(this,e,t,s,e.constructor,n)}makeFunction(e,t=["$instance"]){if(e){e=h.parseExpression(e);const s=t.join(",");return new Function(`with(this) {\n\t\t\t\treturn (function (${s}, $$module) {\n\t\t\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\t\t\treturn ${e};\n\t\t\t\t}.bind(this)).apply(this, arguments);\n\t\t\t}`)}return()=>null}getInstance(e){if(e instanceof Document)return window;const t=m(e);return t?t.instance:void 0}getParentInstance(e){return h.traverseUp(e,e=>this.getInstance(e))}parse(e,t){for(let s=0;s<e.childNodes.length;s++){const n=e.childNodes[s];if(1===n.nodeType){const e=n;m(e)||this.parse(e,t)}else if(3===n.nodeType){const e=n;this.parseTextNode(e,t)}}}parseTextNode(e,t){let s=e.nodeExpressions;s||(s=this.parseTextNodeExpression(e.nodeValue));const n=s.reduce((e,s)=>{let n;return"function"==typeof s?(n=this.resolve(s,t,t),null==n&&(n="")):n=s,e+n},"");if(e.nodeValue!==n){const t=document.createTextNode(n);t.nodeExpressions=s,e.parentNode.replaceChild(t,e)}}pushFragment(e,t,s,n){const o=e.substring(t,s);n.push(o)}parseTextNodeExpression(e){const t=[],s=/\{{2}((([^{}])|(\{([^{}]|(\{.*?\}))+?\}))*?)\}{2}/g;let n,o=0;for(;null!==(n=s.exec(e));){const r=s.lastIndex-n[0].length;r>o&&this.pushFragment(e,r,o,t),o=s.lastIndex;const i=this.makeFunction(n[1]);t.push(i)}const r=e.length;return r>o&&this.pushFragment(e,o,r,t),t}resolve(e,t,s){return e.apply(t,[s,this])}makeHosts(e,t,s){e.hosts&&Object.keys(e.hosts).forEach(n=>{const o=e.hosts[n];t[n]=f(t,o,s)})}makeInput(e,t){const{node:s}=d(e);let n,o=null;if(s.hasAttribute(t)){o=`"${s.getAttribute(t).replace(/({{)|(}})|(")/g,(function(e,t,s,n){return t?'"+':s?'+"':n?'"':void 0}))}"`}else s.hasAttribute(`[${t}]`)&&(o=s.getAttribute(`[${t}]`));return null!==o&&(n=this.makeFunction(o)),n}makeInputs(e,t){const s={};return e.inputs&&e.inputs.forEach((e,n)=>{const o=this.makeInput(t,e);o&&(s[e]=o)}),s}makeOutput(e,n){const o=d(e),r=o.node,i=o.parentInstance,c=r.getAttribute(`(${n})`),a=this.makeFunction(c,["$event"]),u=(new t.Subject).pipe(s.tap(e=>{this.resolve(a,i,e)}));return u.pipe(s.takeUntil(e.unsubscribe$)).subscribe(),e[n]=u,a}makeOutputs(e,t){const s={};return e.outputs&&e.outputs.forEach((e,n)=>s[e]=this.makeOutput(t,e)),s}resolveInputsOutputs(e,t){const s=d(e),n=s.parentInstance,o=s.inputs;for(let t in o){const s=o[t],r=this.resolve(s,n,e);e[t]=r}}destroy(){this.remove(this.meta.node),this.meta.node.innerHTML=this.meta.nodeInnerHTML}remove(e,t){const s=t?d(t):void 0;return h.traverseDown(e,e=>{const t=e.rxcompId;if(t){0===h.deleteContext(t,s).length&&delete e.rxcompId}}),e}static parseExpression(e){const t=/(\()([^\(\)]*)(\))/;for(;e.match(t);)e=e.replace(t,(function(...e){return`┌${h.parsePipes(e[2])}┘`}));return e=(e=h.parsePipes(e)).replace(/(┌)|(┘)/g,(function(...e){return e[1]?"(":")"})),h.parseOptionalChaining(e)}static parsePipes(e){const t=/(.*?[^\|])\|([^\|]+)/;for(;e.match(t);)e=e.replace(t,(function(e,...t){const s=t[0].trim(),n=h.parsePipeParams(t[1]);return`$$pipes.${n.shift().trim()}.transform┌${[s,...n]}┘`}));return e}static parsePipeParams(e){const t=[];let s=0,n="",o=0;const r=e.length;for(;s<r;){const r=e.substr(s,1);"{"!==r&&"("!==r&&"["!==r||o++,"}"!==r&&")"!==r&&"]"!==r||o--,":"===r&&0===o?(n.length&&t.push(n.trim()),n=""):n+=r,s++}return n.length&&t.push(n.trim()),t}static parseOptionalChaining(e){let t;return e=e.replace(/(\w+(\?\.))+([\.|\w]+)/g,(function(e,...s){const n=e.split("?.");for(let e=0;e<n.length-1;e++){const s=e>0?`(${n[e]} = ${t})`:n[e],o=n[e+1];t=e>0?`${s}.${o}`:`(${s} ? ${s}.${o} : void 0)`}return t||""}))}static makeContext(e,t,s,n,o,r){t.rxcompId=++u;const i={module:e,instance:t,parentInstance:s,node:n,factory:o,selector:r},c=n.rxcompId=n.rxcompId||t.rxcompId;return(p[c]||(p[c]=[])).push(i),l[t.rxcompId]=i,i}static deleteContext(e,t){const s=[],n=p[e];return n&&(n.forEach(e=>{if(e===t)s.push(t);else{const t=e.instance;t.unsubscribe$.next(),t.unsubscribe$.complete(),t.onDestroy&&(t.onDestroy(),delete l[t.rxcompId])}}),s.length?p[e]=s:delete p[e]),s}static matchSelectors(e,t,s){for(let n=0;n<t.length;n++){const o=t[n](e);if(o){const t=o.factory;if(t.prototype instanceof r&&t.meta.template&&(e.innerHTML=t.meta.template),s.push(o),t.prototype instanceof a)break}}return s}static querySelectorsAll(e,t,s){if(1===e.nodeType){const n=this.matchSelectors(e,t,[]);if(s=s.concat(n),n.find(e=>e.factory.prototype instanceof a))return s;const o=e.childNodes;for(let e=0;e<o.length;e++)s=this.querySelectorsAll(o[e],t,s)}return s}static traverseUp(e,t,s=0){if(!e)return;const n=t(e,s);return n||this.traverseUp(e.parentNode,t,s+1)}static traverseDown(e,t,s=0){if(!e)return;let n=t(e,s);if(n)return n;if(1===e.nodeType){let o=0,r=e.childNodes.length;for(;o<r&&!n;)n=this.traverseDown(e.childNodes[o],t,s+1),o++}return n}static traversePrevious(e,t,s=0){if(!e)return;const n=t(e,s);return n||this.traversePrevious(e.previousSibling,t,s+1)}static traverseNext(e,t,s=0){if(!e)return;const n=t(e,s);return n||this.traverseNext(e.nextSibling,t,s+1)}}function d(e){return l[e.rxcompId]}function m(e){let t;const s=e.rxcompId;if(s){const e=p[s];e&&(t=e.reduce((e,t)=>t.factory.prototype instanceof r?t:t.factory.prototype instanceof c?e||t:e,null))}return t}function f(e,t,s){if(s||(s=d(e).node),s.rxcompId){const t=p[s.rxcompId];if(t)for(let s=0;s<t.length;s++){const o=t[s];if(o.instance!==e&&o.instance instanceof n)return o.instance}}if(s.parentNode)return f(e,t,s.parentNode)}class g extends o{onInit(){const{module:e,node:t}=d(this),s=t.getAttribute("[class]");this.classFunction=e.makeFunction(s)}onChanges(e){const{module:t,node:s}=d(this),n=t.resolve(this.classFunction,e,this);for(let e in n)n[e]?s.classList.add(e):s.classList.remove(e)}}g.meta={selector:"[[class]]"};class x extends o{onInit(){const{module:e,node:n,parentInstance:o,selector:r}=d(this),i=this.event=r.replace(/\[|\]|\(|\)/g,""),c=this.event$=t.fromEvent(n,i).pipe(s.shareReplay(1)),a=n.getAttribute(`(${i})`);if(a){const t=e.makeFunction(a,["$event"]);c.pipe(s.takeUntil(this.unsubscribe$)).subscribe(s=>{e.resolve(t,o,s)})}else o[`${i}$`]=c}}x.meta={selector:`[(${["mousedown","mouseup","mousemove","click","dblclick","mouseover","mouseout","mouseenter","mouseleave","contextmenu","touchstart","touchmove","touchend","keydown","keyup","input","change","loaded"].join(")],[(")})]`};class v extends c{constructor(e,t,s,n,o,r,i){super(i),this[e]=t,this[s]=n,this.index=o,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}class b extends a{constructor(){super(...arguments),this.instances=[]}onInit(){const{module:e,node:t}=d(this),s=this.forbegin=document.createComment("*for begin");s.rxcompId=t.rxcompId,t.parentNode.replaceChild(s,t);const n=this.forend=document.createComment("*for end");s.parentNode.insertBefore(n,s.nextSibling);const o=t.getAttribute("*for");t.removeAttribute("*for");const r=this.token=this.getExpressionToken(o);this.forFunction=e.makeFunction(r.iterable)}onChanges(e){const t=d(this),s=t.module,n=t.node,o=this.token;let r=s.resolve(this.forFunction,e,this)||[];const i=Array.isArray(r),c=i?r:Object.keys(r),a=c.length,u=this.instances.length;for(let e=0;e<Math.max(u,a);e++)if(e<a){const l=i?e:c[e],p=i?c[l]:r[l];if(e<u){const t=this.instances[e];t[o.key]=l,t[o.value]=p}else{const r=n.cloneNode(!0);delete r.rxcompId,this.forend.parentNode.insertBefore(r,this.forend);const i=[o.key,l,o.value,p,e,a,t.parentInstance],c=s.makeInstance(r,v,t.selector,t.parentInstance,i);if(c){const e=d(c);s.compile(r,e.instance),this.instances.push(c)}}}else{const t=this.instances[e],{node:n}=d(t);n.parentNode.removeChild(n),s.remove(n)}this.instances.length=c.length}getExpressionToken(e){if(null===e)throw"invalid for";if(-1===e.trim().indexOf("let ")||-1===e.trim().indexOf(" of "))throw"invalid for";const t=e.split(";").map(e=>e.trim()).filter(e=>""!==e),s=t[0].split(" of ").map(e=>e.trim());let n=s[0].replace(/\s*let\s*/,"");const o=s[1];let r="index";const i=n.match(/\[(.+)\s*,\s*(.+)\]/);if(i&&(r=i[1],n=i[2]),t.length>1){const e=t[1].split(/\s*let\s*|\s*=\s*index/).map(e=>e.trim());3===e.length&&(r=e[1])}return{key:r,value:n,iterable:o}}}b.meta={selector:"[*for]"};class y extends o{onChanges(e){const{node:t}=d(this);t.setAttribute("href",this.href)}}y.meta={selector:"[[href]]",inputs:["href"]};class I extends a{constructor(){super(...arguments),this.instances=[]}onInit(){const{module:e,node:t}=d(this),s=this.ifbegin=document.createComment("*if begin");s.rxcompId=t.rxcompId,t.parentNode.replaceChild(s,t);const n=this.ifend=document.createComment("*if end");s.parentNode.insertBefore(n,s.nextSibling);const o=t.getAttribute("*if");this.ifFunction=e.makeFunction(o);const r=t.cloneNode(!0);r.removeAttribute("*if"),this.clonedNode=r,this.node=r.cloneNode(!0)}onChanges(e){const{module:t}=d(this),s=t.resolve(this.ifFunction,e,this),n=this.node;s?n.parentNode||(this.ifend.parentNode.insertBefore(n,this.ifend),t.compile(n)):n.parentNode&&(t.remove(n,this),n.parentNode.removeChild(n),this.node=this.clonedNode.cloneNode(!0))}}I.meta={selector:"[*if]"};class $ extends o{onChanges(e){const{node:t}=d(this);t.innerHTML=null==this.innerHTML?"":this.innerHTML}}$.meta={selector:"[innerHTML]",inputs:["innerHTML"]};class k{static transform(e){return e}}class w extends k{static transform(e){return JSON.stringify(e,null,"\t")}}w.meta={name:"json"};class C extends o{onChanges(e){const{node:t}=d(this);t.setAttribute("src",this.src)}}C.meta={selector:"[[src]]",inputs:["src"]};class N extends o{onInit(){const{module:e,node:t}=d(this),s=t.getAttribute("[style]");this.styleFunction=e.makeFunction(s)}onChanges(e){const{module:t,node:s}=d(this),n=t.resolve(this.styleFunction,e,this);for(let e in n)s.style.setProperty(e,n[e])}}N.meta={selector:"[[style]]"};class F extends h{}const A=[g,x,b,y,I,$,C,N],O=[w];F.meta={declarations:[...A,...O],exports:[...A,...O]};const P=[a,r,o];class j{static bootstrap(e){const t=this.resolveMeta(e);console.log(t);const s=t.bootstrap;if(!s)throw"missing bootstrap";const n=t.node=this.querySelector(s.meta.selector);if(!n)throw`missing node ${s.meta.selector}`;t.nodeInnerHTML=n.innerHTML;t.pipes=this.resolvePipes(t);const o=t.factories=this.resolveFactories(t);this.sortFactories(o),o.unshift(s);t.selectors=this.unwrapSelectors(o);const r=new e;return r.meta=t,r.compile(n,window)[0].pushChanges(),r}static querySelector(e){return document.querySelector(e)}static resolveMeta(e){const t=Object.assign({imports:[],declarations:[],pipes:[],exports:[]},e.meta);return t.imports=t.imports.map(e=>this.resolveMeta(e)),t}static resolvePipes(e,t){const s=e.imports.map(e=>this.resolvePipes(e,!0)),n={};return(t?e.exports:e.declarations).filter(e=>e.prototype instanceof k).forEach(e=>n[e.meta.name]=e),Object.assign({},...s,n)}static resolveFactories(e,t){const s=e.imports.map(e=>this.resolveFactories(e,!0)),n=(t?e.exports:e.declarations).filter(e=>e.prototype instanceof a||e.prototype instanceof r||e.prototype instanceof o);return Array.prototype.concat.call(n,...s)}static sortFactories(e){e.sort((e,t)=>{const s=P.reduce((t,s,n)=>e.prototype instanceof s?n:t,-1)-P.reduce((e,s,n)=>t.prototype instanceof s?n:e,-1);return 0===s?(e.meta.hosts?1:0)-(t.meta.hosts?1:0):s})}static getExpressions(e){let t=[];return e.replace(/\.([\w\-\_]+)|\[(.+?\]*)(\=)(.*?)\]|\[(.+?\]*)\]|([\w\-\_]+)/g,(function(e,s,n,o,r,i,c){return s&&t.push((function(e){return e.classList.contains(s)})),n&&t.push((function(e){return e.hasAttribute(n)&&e.getAttribute(n)===r||e.hasAttribute(`[${n}]`)&&e.getAttribute(`[${n}]`)===r})),i&&t.push((function(e){return e.hasAttribute(i)||e.hasAttribute(`[${i}]`)})),c&&t.push((function(e){return e.nodeName.toLowerCase()===c.toLowerCase()})),""})),t}static unwrapSelectors(e){const t=[];return e.forEach(e=>{e.meta.selector.split(",").forEach(s=>{s=s.trim();let n=[];const o=s.replace(/\:not\((.+?)\)/g,(e,t)=>(n=this.getExpressions(t),"")),r=this.getExpressions(o);t.push(t=>{const o=r.reduce((e,s)=>e&&s(t),!0),i=n.reduce((e,s)=>e||s(t),!1);return!(!o||i)&&{node:t,factory:e,selector:s}})})}),t}static isBrowser(){return Boolean(window)}}e.Browser=class extends j{},e.ClassDirective=g,e.Component=r,e.Context=c,e.CoreModule=F,e.Directive=o,e.EventDirective=x,e.ForItem=v,e.ForStructure=b,e.HrefDirective=y,e.IfStructure=I,e.InnerHtmlDirective=$,e.JsonPipe=w,e.Module=h,e.Pipe=k,e.Platform=j,e.SrcDirective=C,e.Structure=a,e.StyleDirective=N,e.getContext=d,e.getContextByNode=m,e.getHost=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=rxcomp.min.js.map